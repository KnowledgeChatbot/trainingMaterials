{"Questions":["如何做好数据备份？","数据备份"],"Answer":"尽管 Azure 提供了完善的数据存储存储方案，比如一份数据在本地存三份，支持异地数据镜像等，但这只解决了数据物理损坏的问题，而没解决逻辑损坏的问题。比如，维护人员不小心删除了 Blob 上的文件、程序 Bug 删除或者修改了数据内容等等。此外，备份的另一个作用是支持容灾。容灾有两个基本概念，分别是 RTO 和 RPO。Azure 存储提供的异地镜像能力可以实现30分钟的 RPO，但 Azure 并没有承诺 RTO，也就是说，如果 Azure 的某个站点的存储服务发生故障，其恢复时间可能会比较长，在这段时间内，尽管数据没有丢失，但是我们并没有办法访问数据，包括镜像数据。下表是 Azure 中各种数据服务的备份和容灾能力说明：服务名称本地数据冗余方式本地备份异地数据镜像存储服务3份，Active-Active无异步复制到异地，RPO=30分钟，无RTOSQL 数据库3份，一主两备无(新功能开发中)无IaaS 虚拟机系统盘和挂接的磁盘仅保留数据，同存储服务无仅保留数据，同存储服务IaaS 虚拟机临时盘无无无PaaS 云服务、移动服务、Web 应用仅保留发布的软件包、代码无无因此，对云中的数据进行备份还是很有必要的。具体来说，每种数据的备份方式不尽相同。*   SQL 数据库。 Azure 门户上为 SQL 数据库提供了备份功能，用户点击备份按钮即可将数据库内容以 Data Tier Application 的格式导出到 Blob 存储上。用户可以下载该备份文件导入到本地的 SQL Server 上，也可以用该文件恢复一个 SQL 数据库。对于 SQL 数据库，建议采用自动化脚本定期进行备份，比如每天一次，保留 7 天。SQL 数据库不支持定期任务，我们可以采用 Windows 任务计划或者 Linux 的 Cron 来运行定期脚本。具体的命令可以参考[https://github.com/richorama/SQLDatabaseBackup](//github.com/richorama/SQLDatabaseBackup)。*   Blob 存储。Blob 存储本身不提供备份功能，只能进行快照。快照可以回滚文件到之前的版本，但是无法恢复被删除的文件（Azure 不支持 Container 快照）。所以，对于重要的文件，建议编写脚本进行定期备份。备份的目的地址，可以是另一个存储账户，或者是本地。AzCopy 这个工具可以用来在不同的存储账户之间进行文件拷贝，也可以用来在本地和 Blob 之间传输文件[http://blogs.msdn.com/b/windowsazurestorage/archive/2013/04/01/azcopy-using-cross-account-copy-blob.aspx](http://blogs.msdn.com/b/windowsazurestorage/archive/2013/04/01/azcopy-using-cross-account-copy-blob.aspx)。*   IaaS 虚拟机。目前可用的方法，是进行虚拟机磁盘对应 Blob 文件的快照。具体可以参考[http://blog.csdn.net/shaunfang/article/details/8933405#t0](http://blog.csdn.net/shaunfang/article/details/8933405#t0)。 *   IaaS 虚拟机文件。可采用各种传统文件备份工具。对于Windows Server，可以使用 Azure 的云备份服务[http://blog.csdn.net/shaunfang/article/details/8933405#t1](http://blog.csdn.net/shaunfang/article/details/8933405#t1)。 *   IaaS 虚拟机中的数据库。可采用各种数据库的备份工具或者将数据库导出再进行文件备份。以上各种数据的备份都是定期进行的，建议编写程序或者脚本，专门找一台虚拟机运行。有一些公司开发了一些运维工具，比如：Cerebrata 提供的 [Azure Management Cmdlets]()。该工具提供了命令行工具，可以进行 Blob、Table 的备份，SQL 数据库备份，详见[http://www.cerebrata.com/products/azure-management-cmdlets/introduction](http://www.cerebrata.com/products/azure-management-cmdlets/introduction)。"}