{"Title":"使用 Java 获取经典模式虚拟机监视数据","Description":"如何通过 Java 获取经典模式虚拟机监视数据","Content":"\r\n# 使用 Java 获取经典模式虚拟机监视数据\r\n\r\n在 .Net 中可以借助 Monitor Package 来获取 Azure 经典虚拟机的监视数据，但是在 Java 的 SDK 中并没有封装该部分 API，我们可以使用 Azure 相关的 API 来获取该部分数据。\r\n\r\nAzure 中提供两个可以获取监视数据的 API，一个是用于获取经典虚拟机支持的监视规则定义，另外一个是用于获取经典虚拟机的监视数据。以下分别介绍这两个 REST API。\r\n\r\n## 获取经典虚拟机支持的监视规则定义\r\n\r\n### Endpoint\r\n\r\nhttps://management.core.chinacloudapi.cn/{subscription}/services/monitoring/metricdefinitions/query?resourceId={resource id}\r\n\r\n### 请求头部参数\r\n\r\n| 参数名称 | 参数值 |\r\n|:------------:|:----------:|\r\n| x-ms-version | 2013-10-01 |\r\n| Content-Type | application/xml |\r\n\r\n### 请求参数\r\n\r\n| 参数名称 | 参数值 |\r\n|:------------:|:----------:|\r\n| resourceId | 资源 ID，示例：/hostedservices/{hostedservice name}/deployments/{deployment name}/roles/{role name} |\r\n\r\n### 调用示例\r\n\r\n```\r\nString filter =  String.format(\"resourceId=/hostedservices/%s/deployments/%s/roles/%s\",\r\n        \"kevin-vs-never\",\r\n        \"kevin-vs-never\",\r\n        \"kevin-vs-never\");\r\nURI uri = new URI(\"https\", \"management.core.chinacloudapi.cn\",\r\n        String.format(\"/%s/services/monitoring/metricdefinitions/query\", AbstactTest.SUB_ID), filter, null);\r\nURL url = uri.toURL();\r\nMap<String, String> params = new HashMap<String, String>();\r\nparams.put(\"x-ms-version\", \"2013-10-01\");\r\nparams.put(\"Content-Type\", \"application/xml\");\r\nString result = AzureRestClient.processGetRequest(url, params);\r\n```\r\n\r\n### 示例代码\r\n\r\nGetMetricDefineOldTest : [https://github.com/wacn/AOG-CodeSample/blob/master/AzureServiceManager/Java/azure-service-manager/src/test/java/com/vianet/azure/sdk/manage/monitor/TestVMMetric.java#L73](https://github.com/wacn/AOG-CodeSample/blob/master/AzureServiceManager/Java/azure-service-manager/src/test/java/com/vianet/azure/sdk/manage/monitor/TestVMMetric.java#L73)\r\n\r\n## 获取经典虚拟机的监视数据\r\n\r\n### Endpoint\r\n\r\nhttps://management.core.chinacloudapi.cn/{subscription}/services/monitoring/metricdefinitions/query?resourceId={resource id}&names={names}/ &timeGrain={timeGrain}&startTime={startTime}&endTime={endTime}\r\n\r\n### 请求头部参数\r\n\r\n| 参数名称 | 参数值 |\r\n|:------------:|:----------:|\r\n| x-ms-version | 2013-10-01 |\r\n| Content-Type | application/xml |\r\n\r\n### 请求参数\r\n\r\n| 参数名称 | 参数值 |\r\n|:------------:|----------|\r\n| resourceId | 资源 ID，示例：/hostedservices/{hostedservice}/deployments/{deployment}/roles/{role} |\r\n| names | 监视规则，可以多个规则，以逗号分隔，示例：Network In,Network Out,Disk Read Bytes/sec,Disk Write Bytes/sec |\r\n| timeGrain | 值为 PT1H, PT5M |\r\n| startTime | 起始时间，示例：2017-04-02T00:00:00.0000000Z |\r\n| endTime | 结束时间，示例：2017-04-03T00:00:00.0000000Z |\r\n\r\n### 调用示例\r\n\r\n```\r\nString filter =  String.format(\"resourceId=/hostedservices/%s/deployments/%s/roles/%s&namespace=%s&names=%s&timeGrain=%s&startTime=%s&endTime=%s\",\r\n        \"kevin-vs-never\",\r\n        \"kevin-vs-never\",\r\n        \"kevin-vs-never\",\r\n        \"\",\r\n        \"Network In,Network Out,Disk Read Bytes/sec,Disk Write Bytes/sec\",\r\n        \"PT1H\",\r\n        \"2017-04-03T00:00:00.0000000Z\",\r\n        \"2017-04-05T23:59:59.0000000Z\");\r\nURI uri = new URI(\"https\", \"management.core.chinacloudapi.cn\",\r\n        String.format(\"/%s/services/monitoring/metricvalues/query\", AbstactTest.SUB_ID), filter, null);\r\nURL url = uri.toURL();\r\nMap<String, String> params = new HashMap<String, String>();\r\nparams.put(\"x-ms-version\", \"2013-10-01\");\r\nparams.put(\"Content-Type\", \"application/xml\");\r\nString result = AzureRestClient.processGetRequest(url, params);\r\n```\r\n\r\n### 示例代码\r\n\r\nGetMetricOldTest :[https://github.com/wacn/AOG-CodeSample/blob/master/AzureServiceManager/Java/azure-service-manager/src/test/java/com/vianet/azure/sdk/manage/monitor/TestVMMetric.java#L89](https://github.com/wacn/AOG-CodeSample/blob/master/AzureServiceManager/Java/azure-service-manager/src/test/java/com/vianet/azure/sdk/manage/monitor/TestVMMetric.java#L89)"}