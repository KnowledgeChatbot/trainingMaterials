{"Title":"连接到 Azure AD 时对 WebApi 项目所做的更改","Description":"介绍使用 Visual Studio 连接到 Azure AD 时，WebApi 项目会发生什么情况","Content":"\r\n# <a name=\"what-happened-to-my-webapi-project-visual-studio-azure-active-directory-connected-service\"></a>我的 WebApi 项目（Visual Studio Azure Active Directory 连接服务）发生了什么情况\r\n> [!div class=\"op_single_selector\"]\r\n>- [入门](./vs-active-directory-webapi-getting-started.md)\r\n>- [发生了什么情况](./vs-active-directory-webapi-what-happened.md)\r\n\r\n## <a name=\"references-have-been-added\"></a>已添加引用\r\n### <a name=\"nuget-package-references\"></a>NuGet 包引用\r\n- `Microsoft.Owin`\r\n- `Microsoft.Owin.Host.SystemWeb`\r\n- `Microsoft.Owin.Security`\r\n- `Microsoft.Owin.Security.ActiveDirectory`\r\n- `Microsoft.Owin.Security.Jwt`\r\n- `Microsoft.Owin.Security.OAuth`\r\n- `Owin`\r\n- `System.IdentityModel.Tokens.Jwt`\r\n\r\n### <a name=\"net-references\"></a>.NET 引用\r\n- `Microsoft.Owin`\r\n- `Microsoft.Owin.Host.SystemWeb`\r\n- `Microsoft.Owin.Security`\r\n- `Microsoft.Owin.Security.ActiveDirectory`\r\n- `Microsoft.Owin.Security.Jwt`\r\n- `Microsoft.Owin.Security.OAuth`\r\n- `Owin`\r\n- `System.IdentityModel.Tokens.Jwt`\r\n\r\n## <a name=\"code-changes\"></a>代码更改\r\n### <a name=\"code-files-were-added-to-your-project\"></a>代码文件已添加到您的项目\r\n身份验证启动类 **App_Start/Startup.Auth.cs**（包含 Azure AD 身份验证的启动逻辑）已添加到你的项目。\r\n\r\n### <a name=\"startup-code-was-added-to-your-project\"></a>启动代码已添加到您的项目\r\n如果项目中已经有一个 Startup 类，**Configuration** 方法将进行更新，以包括对 `ConfigureAuth(app)` 的调用。 否则，Startup 类已添加到您的项目。\r\n\r\n### <a name=\"your-appconfig-or-webconfig-file-has-new-configuration-values\"></a>您的 app.config 或 web.config 文件具有新的配置值。\r\n已添加以下配置条目。\r\n\r\n```\r\n<appSettings>\r\n    <add key=\"ida:ClientId\" value=\"ClientId from the new Azure AD App\" />\r\n    <add key=\"ida:Tenant\" value=\"Your selected Azure AD Tenant\" />\r\n    <add key=\"ida:Audience\" value=\"The App ID Uri from the wizard\" />\r\n</appSettings>`\r\n```\r\n\r\n### <a name=\"an-azure-ad-app-was-created\"></a>已创建 Azure AD 应用\r\n已在您在向导中选定的目录内创建一个 Azure AD 应用程序。\r\n\r\n[详细了解 Azure Active Directory](https://www.azure.cn/home/features/identity/)\r\n\r\n## <a name=\"if-i-checked-disable-individual-user-accounts-authentication-what-additional-changes-were-made-to-my-project\"></a>如果我选中“*禁用单个用户帐户身份验证*”，会对我的项目进行哪些额外的更改？\r\nNuGet 包引用已删除，文件已删除和备份。 根据你的项目的状态，你可能需要手动删除额外的引用或文件，或者根据需要修改代码。\r\n\r\n### <a name=\"nuget-package-references-removed-for-those-present\"></a>删除的 NuGet 包引用（针对已存在的）\r\n- `Microsoft.AspNet.Identity.Core`\r\n- `Microsoft.AspNet.Identity.EntityFramework`\r\n- `Microsoft.AspNet.Identity.Owin`\r\n\r\n### <a name=\"code-files-backed-up-and-removed-for-those-present\"></a>备份的和删除的代码文件（针对已存在的）\r\n以下每个文件都已备份并从项目中删除。 备份文件位于项目根目录的“Backup”文件夹中。\r\n\r\n- `App_Start\\IdentityConfig.cs`\r\n- `Controllers\\AccountController.cs`\r\n- `Controllers\\ManageController.cs`\r\n- `Models\\IdentityModels.cs`\r\n- `Providers\\ApplicationOAuthProvider.cs`\r\n\r\n### <a name=\"code-files-backed-up-for-those-present\"></a>备份的的代码文件（针对已存在的）\r\n以下每个文件在替换之前已备份。 备份文件位于项目根目录的“Backup”文件夹中。\r\n\r\n- `Startup.cs`\r\n- `App_Start\\Startup.Auth.cs`\r\n\r\n## <a name=\"if-i-checked-read-directory-data-what-additional-changes-were-made-to-my-project\"></a>如果我选中“*读取目录数据*”，会对我的项目进行其他哪些更改？\r\n### <a name=\"additional-changes-were-made-to-your-appconfig-or-webconfig\"></a>对 app.config 或 web.config 做出的其他更改\r\n添加了以下附加配置条目。\r\n\r\n```\r\n<appSettings>\r\n    <add key=\"ida:Password\" value=\"Your Azure AD App's new password\" />\r\n</appSettings>\r\n```\r\n\r\n### <a name=\"your-azure-active-directory-app-was-updated\"></a>你的 Azure Active Directory 应用已更新\r\n你的 Azure Active Directory 应用已更新为包括“*读取目录数据*”权限，并已创建一个附加密钥，并在随后用作 `web.config` 文件中的 *ida:Password*。\r\n\r\n## <a name=\"next-steps\"></a>后续步骤\r\n- [详细了解 Azure Active Directory](https://www.azure.cn/home/features/identity/)\r\n"}