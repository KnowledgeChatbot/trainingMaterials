{"Title":"通用 SQL 连接器分步指南","Description":"本文将指导你完成一个使用通用 SQL 连接器的简单 HR 系统分步示例。","Content":"\r\n# 通用 SQL 连接器分步说明\r\n本主题是一份循序渐进的指南。其中将会创建一个简单的示例 HR 数据库，然后使用它导入一些用户及其组成员身份。\r\n\r\n## 准备示例数据库\r\n在运行 SQL Server 的服务器上，运行[附录 A](#appendix-a) 中的 SQL 脚本。此脚本创建名为 GSQLDEMO 的示例数据库。创建的数据库的对象模型如下图所示：\r\n![对象模型](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/objectmodel.png)\r\n\r\n还会创建要用于连接到数据库的用户。在本演练中，用户名为 FABRIKAM\\\\SQLUser 并位于域中。\r\n\r\n## 创建 ODBC 连接文件\r\n通用 SQL 连接器使用 ODBC 连接到远程服务器。首先，需要创建一个包含 ODBC 连接信息的文件。\r\n\r\n1. 在服务器上启动 ODBC 管理实用工具：\r\n\r\n    ![ODBC](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc.png)\r\n\r\n2. 选择“文件 DSN”选项卡。单击“添加...”。\r\n\r\n    ![ODBC1](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc1.png)\r\n\r\n3. 现成的驱动程序将正常工作，因此，请选择它并单击“下一步>”。\r\n\r\n    ![ODBC2](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc2.png)\r\n\r\n4. 为该文件指定名称，如 **GenericSQL**。\r\n\r\n    ![ODBC3](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc3.png)\r\n\r\n5. 单击“完成”。\r\n\r\n    ![ODBC4](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc4.png)\r\n\r\n6. 配置连接的时间。为数据源提供适当的说明，提供运行 SQL Server 的服务器的名称。\r\n\r\n    ![ODBC5](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc5.png)\r\n\r\n7. 选择使用 SQL 进行身份验证的方式。本示例使用 Windows 身份验证。\r\n\r\n    ![ODBC6](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc6.png)\r\n\r\n8. 提供示例数据库的名称 **GSQLDEMO**。\r\n\r\n    ![ODBC7](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc7.png)\r\n\r\n9. 保留此屏幕上默认设置的所有内容。单击“完成”。\r\n\r\n    ![ODBC8](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc8.png)\r\n\r\n10. 若要验证所有设置是否正常工作，请单击“测试数据源”。\r\n\r\n    ![ODBC9](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc9.png)\r\n\r\n11. 请确保测试成功。\r\n\r\n    ![ODBC10](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc10.png)\r\n\r\n12. ODBC 配置文件现在应在“文件 DSN”中可见。\r\n\r\n    ![ODBC11](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/odbc11.png)\r\n\r\n现在，我们已有了所需的文件，可以开始创建连接器了。\r\n\r\n## 创建通用 SQL 连接器\r\n1. 在同步服务管理器 UI 中，依次选择“连接器”和“创建”。选择“通用 SQL (Microsoft)”，并为它指定描述性的名称。\r\n\r\n    ![Connector1](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/connector1.png)\r\n\r\n2. 找到在上一节中创建的 DSN 文件并将其上载到服务器。提供用于连接到数据库的凭据。\r\n\r\n    ![Connector2](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/connector2.png)\r\n\r\n3. 在本演练中，可以简单地说有两种对象类型：“用户”和“组”。\r\n\r\n    ![Connector3](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/connector3.png)\r\n\r\n4. 为了查找属性，我们希望连接器通过查看表本身来检测这些属性。由于 **Users** 是 SQL 中的保留字，需要在方括号 [ ] 中指定它。\r\n\r\n    ![Connector4](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/connector4.png)\r\n\r\n5. 定义定位点属性和 DN 属性的时间。对于**用户**，我们使用两个属性（即 username 和 EmployeeID）的组合。对于**组**，我们使用 GroupName（在实际工作中不太现实，但在本演练中，它可正常工作）。\r\n\r\n    ![Connector5](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/connector5.png)\r\n\r\n6. 并非所有属性类型都可以在 SQL 数据库中检测到。特别是无法检测到引用属性类型。对于组对象类型，我们需要更改要引用的 OwnerID 和 MemberID。\r\n\r\n    ![Connector6](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/connector6.png)\r\n\r\n7. 在上一步骤中选为引用属性的属性需要是这些值引用的对象类型。在本例中，为用户对象类型。\r\n\r\n    ![Connector7](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/connector7.png)\r\n\r\n8. 在“全局参数”页中，选择“水印”作为增量策略。另外，以日期/时间格式 **yyyy-MM-dd HH:mm:ss** 键入。\r\n\r\n    ![Connector8](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/connector8.png)\r\n\r\n9. 在“配置分区和层次结构”页上，选择这两种对象类型。\r\n\r\n    ![Connector9](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/connector9.png)\r\n\r\n10. 在“选择对象类型”和“选择属性”中，选择这两种对象类型和所有属性。在“配置定位点”页上，单击“完成”。\r\n\r\n## 创建运行配置文件\r\n1. 在同步服务管理器 UI 中，依次选择“连接器”和“配置运行配置文件”。单击“新建配置文件”。从“完全导入”开始。\r\n\r\n    ![Runprofile1](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/runprofile1.png)\r\n\r\n2. 选择类型“完全导入(仅暂存)”。\r\n\r\n    ![Runprofile2](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/runprofile2.png)\r\n\r\n3. 选择分区 **OBJECT=User**。\r\n\r\n    ![Runprofile3](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/runprofile3.png)\r\n\r\n4. 选择“表”并键入 **[USERS]**。向下滚动到多值对象类型部分，并按下图所示输入数据。选择“完成”保存步骤。\r\n\r\n    ![Runprofile4a](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/runprofile4a.png) \r\n\r\n    ![Runprofile4b](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/runprofile4b.png)\r\n\r\n5. 选择“新建步骤”。这一次，请选择 **OBJECT=Group**。在最后一页上，使用下图所示的配置。单击“完成”。\r\n\r\n    ![Runprofile5a](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/runprofile5a.png)\r\n\r\n    ![Runprofile5b](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/runprofile5b.png)\r\n\r\n6. 可选：如果需要，可以配置更多运行配置文件。本演练只使用“完全导入”。\r\n7. 单击“确定”完成运行配置文件的更改。\r\n\r\n## 添加一些测试数据，并测试导入\r\n在示例数据库中填写一些测试数据。准备就绪后，请依次选择“运行”和“完全导入”。\r\n\r\n以下是拥有两个电话号码的用户和一个包含一些成员的组。\r\n\r\n![cs1](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/cs1.png)\r\n\r\n![cs2](./media/active-directory-aadconnectsync-connector-genericsql-step-by-step/cs2.png)\r\n\r\n## 附录 A <a name=\"appendix-a\"></a>\r\n**用于创建示例数据库的 SQL 脚本**\r\n\r\nSQL\r\n\r\n```SQL\r\n---Creating the Database---------\r\nCreate Database GSQLDEMO\r\nGo\r\n-------Using the Database-----------\r\nUse [GSQLDEMO]\r\nGo\r\n-------------------------------------\r\nUSE [GSQLDEMO]\r\nGO\r\n/****** Object:  Table [dbo].[GroupMembers]   ******/\r\nSET ANSI_NULLS ON\r\nGO\r\nSET QUOTED_IDENTIFIER ON\r\nGO\r\nCREATE TABLE [dbo].[GroupMembers](\r\n    [MemberID] [int] NOT NULL,\r\n    [Group_ID] [int] NOT NULL\r\n) ON [PRIMARY]\r\n\r\nGO\r\n/****** Object:  Table [dbo].[GROUPS]   ******/\r\nSET ANSI_NULLS ON\r\nGO\r\nSET QUOTED_IDENTIFIER ON\r\nGO\r\nCREATE TABLE [dbo].[GROUPS](\r\n    [GroupID] [int] NOT NULL,\r\n    [GROUPNAME] [nvarchar](200) NOT NULL,\r\n    [DESCRIPTION] [nvarchar](200) NULL,\r\n    [WATERMARK] [datetime] NULL,\r\n    [OwnerID] [int] NULL,\r\nPRIMARY KEY CLUSTERED\r\n(\r\n    [GroupID] ASC\r\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\r\n) ON [PRIMARY]\r\n\r\nGO\r\n/****** Object:  Table [dbo].[USERPHONE]   ******/\r\nSET ANSI_NULLS ON\r\nGO\r\nSET QUOTED_IDENTIFIER ON\r\nGO\r\nSET ANSI_PADDING ON\r\nGO\r\nCREATE TABLE [dbo].[USERPHONE](\r\n    [USER_ID] [int] NULL,\r\n    [Phone] [varchar](20) NULL\r\n) ON [PRIMARY]\r\n\r\nGO\r\nSET ANSI_PADDING OFF\r\nGO\r\n/****** Object:  Table [dbo].[USERS]   ******/\r\nSET ANSI_NULLS ON\r\nGO\r\nSET QUOTED_IDENTIFIER ON\r\nGO\r\nCREATE TABLE [dbo].[USERS](\r\n    [USERID] [int] NOT NULL,\r\n    [USERNAME] [nvarchar](200) NOT NULL,\r\n    [FirstName] [nvarchar](100) NULL,\r\n    [LastName] [nvarchar](100) NULL,\r\n    [DisplayName] [nvarchar](100) NULL,\r\n    [ACCOUNTDISABLED] [bit] NULL,\r\n    [EMPLOYEEID] [int] NOT NULL,\r\n    [WATERMARK] [datetime] NULL,\r\nPRIMARY KEY CLUSTERED\r\n(\r\n    [USERID] ASC\r\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\r\n) ON [PRIMARY]\r\n\r\nGO\r\nALTER TABLE [dbo].[GroupMembers]  WITH CHECK ADD  CONSTRAINT [FK_GroupMembers_GROUPS] FOREIGN KEY([Group_ID])\r\nREFERENCES [dbo].[GROUPS] ([GroupID])\r\nGO\r\nALTER TABLE [dbo].[GroupMembers] CHECK CONSTRAINT [FK_GroupMembers_GROUPS]\r\nGO\r\nALTER TABLE [dbo].[GroupMembers]  WITH CHECK ADD  CONSTRAINT [FK_GroupMembers_USERS] FOREIGN KEY([MemberID])\r\nREFERENCES [dbo].[USERS] ([USERID])\r\nGO\r\nALTER TABLE [dbo].[GroupMembers] CHECK CONSTRAINT [FK_GroupMembers_USERS]\r\nGO\r\nALTER TABLE [dbo].[GROUPS]  WITH CHECK ADD  CONSTRAINT [FK_GROUPS_USERS] FOREIGN KEY([OwnerID])\r\nREFERENCES [dbo].[USERS] ([USERID])\r\nGO\r\nALTER TABLE [dbo].[GROUPS] CHECK CONSTRAINT [FK_GROUPS_USERS]\r\nGO\r\nALTER TABLE [dbo].[USERPHONE]  WITH CHECK ADD  CONSTRAINT [FK_USERPHONE_USER] FOREIGN KEY([USER_ID])\r\nREFERENCES [dbo].[USERS] ([USERID])\r\nGO\r\nALTER TABLE [dbo].[USERPHONE] CHECK CONSTRAINT [FK_USERPHONE_USER]\r\nGO\r\n```\r\n\r\n<!---HONumber=Mooncake_0306_2017-->\r\n<!---Update_Description: wording update -->"}