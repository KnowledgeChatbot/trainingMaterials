{"Title":"将现有的自定义 DNS 名称映射到 Azure Web 应用","Description":"了解如何在 Azure 应用服务中向 Web 应用、移动应用后端或 API 应用添加现有的自定义 DNS 域名（虚域）。","Content":"# <a name=\"map-an-existing-custom-dns-name-to-azure-web-apps\"></a>将现有的自定义 DNS 名称映射到 Azure Web 应用\r\n\r\n[Azure Web 应用](app-service-web-overview.md)提供高度可缩放、自修补的 Web 托管服务。 本教程介绍如何将现有的自定义 DNS 名称映射到 Azure Web 应用。\r\n\r\n![在门户中导航到 Azure 应用](./media/app-service-web-tutorial-custom-domain/app-with-custom-dns.png)\r\n\r\n本教程介绍如何执行下列操作：\r\n\r\n> [!div class=\"checklist\"]\r\n> * 使用 CNAME 记录映射子域（例如 `www.contoso.com`）\r\n> * 使用 A 记录映射根域（例如 `contoso.com`）\r\n> * 使用 CNAME 记录映射通配符域（例如 `*.contoso.com`）\r\n> * 使用脚本自动执行域映射\r\n\r\n可以使用 **CNAME 记录**或 **A 记录**将自定义 DNS 名称映射到应用服务。 \r\n\r\n> [!NOTE]\r\n> 我们建议对除根域（例如 `contoso.com`）以外的所有自定义 DNS 名称使用 CNAME。 \r\n\r\n## <a name=\"prerequisites\"></a>先决条件\r\n\r\n若要完成本教程，需执行以下操作：\r\n\r\n* [创建应用服务应用](/app-service/)，或使用为另一教程创建的应用。\r\n* 购买域名，确保可以访问域提供商（如 GoDaddy）的 DNS 注册表。\r\n\r\n  例如，若要添加 `contoso.com` 和 `www.contoso.com` 的 DNS 条目，必须能够配置 `contoso.com` 根域的 DNS 设置。\r\n\r\n## <a name=\"prepare-the-app\"></a>准备应用\r\n\r\n若要将自定义 DNS 名称映射到 Web 应用，Web 应用的[应用服务计划](https://www.azure.cn/pricing/details/app-service/)必须位于付费层（“共享”、“基本”、“标准”或“高级”）。 在此步骤中，需确保应用服务计划位于受支持的定价层。\r\n\r\n### <a name=\"sign-in-to-azure\"></a>登录 Azure\r\n\r\n打开 [Azure 门户](https://portal.azure.cn)，然后使用 Azure 帐户登录。\r\n\r\n### <a name=\"navigate-to-the-app-in-the-azure-portal\"></a>在 Azure 门户中导航到应用\r\n\r\n从左侧菜单中选择“应用服务”，然后选择应用的名称。\r\n\r\n![在门户中导航到 Azure 应用](./media/app-service-web-tutorial-custom-domain/select-app.png)\r\n\r\n可以看到应用服务应用的管理页面。  \r\n\r\n<a name=\"checkpricing\"></a>\r\n\r\n### <a name=\"check-the-pricing-tier\"></a>检查定价层\r\n\r\n在应用页面的左侧导航窗格中，向下滚动到“设置”部分，然后选择“扩展(应用服务计划)”。\r\n\r\n![扩展菜单](./media/app-service-web-tutorial-custom-domain/scale-up-menu.png)\r\n\r\n蓝色的框突出显示了应用的当前层。 检查以确保应用不在“免费”层中。 **免费**层不支持自定义 DNS。 \r\n\r\n![检查定价层](./media/app-service-web-tutorial-custom-domain/check-pricing-tier.png)\r\n\r\n如果应用服务计划不是**免费的**，请关闭“选择定价层”页面并跳到[映射 CNAME 记录](#cname)。\r\n\r\n<a name=\"scaleup\"></a>\r\n\r\n### <a name=\"scale-up-the-app-service-plan\"></a>扩展应用服务计划\r\n\r\n选择任一非免费层（“共享”、“基本”、“标准”或“高级”）。 \r\n\r\n单击“选择”。\r\n\r\n![检查定价层](./media/app-service-web-tutorial-custom-domain/choose-pricing-tier.png)\r\n\r\n如果看到以下通知，则表示缩放操作已完成。\r\n\r\n![缩放操作确认](./media/app-service-web-tutorial-custom-domain/scale-notification.png)\r\n\r\n<a name=\"cname\"></a>\r\n\r\n## <a name=\"map-a-cname-record\"></a>映射 CNAME 记录\r\n\r\n在教程示例中，为 `www` 子域（例如 `www.contoso.com`）添加 CNAME 记录。\r\n\r\n[!INCLUDE [Access DNS records with domain provider](../../includes/app-service-web-access-dns-records.md)]\r\n\r\n### <a name=\"create-the-cname-record\"></a>创建 CNAME 记录\r\n\r\n添加一条 CNAME 记录，以便将子域映射到应用的默认主机名（`<app_name>.chinacloudsites.cn`，其中 `<app_name>` 是应用的名称）。\r\n\r\n对于 `www.contoso.com` 域示例，添加一条 CNAME 记录来将名称 `www` 映射到 `<app_name>.chinacloudsites.cn`。\r\n\r\n添加 CNAME 后，DNS 记录页与以下示例相似：\r\n\r\n![在门户中导航到 Azure 应用](./media/app-service-web-tutorial-custom-domain/cname-record.png)\r\n\r\n### <a name=\"enable-the-cname-record-mapping-in-azure\"></a>在 Azure 中启用 CNAME 记录映射\r\n\r\n在 Azure 门户中，在应用页面的左侧导航窗格中，选择“自定义域”。 \r\n\r\n![自定义域菜单](./media/app-service-web-tutorial-custom-domain/custom-domain-menu.png)\r\n\r\n在应用的“自定义域”页面中，将完全限定的自定义 DNS 名称 (`www.contoso.com`) 添加到列表。\r\n\r\n单击“添加主机名”旁边的 **+** 图标。\r\n\r\n![添加主机名](./media/app-service-web-tutorial-custom-domain/add-host-name-cname.png)\r\n\r\n键入你为其添加了 CNAME 记录的完全限定的域名，例如 `www.contoso.com`。 \r\n\r\n选择“验证”。\r\n\r\n“添加主机名”按钮会被激活。 \r\n\r\n确保“主机名记录类型”设置为“CNAME（www.example.com 或任何子域）”。\r\n\r\n选择“添加主机名”。\r\n\r\n![将 DNS 名称添加到应用](./media/app-service-web-tutorial-custom-domain/validate-domain-name-cname.png)\r\n\r\n新主机名可能需要经过一段时间后才会反映在应用的“自定义域”页中。 请尝试刷新浏览器来更新数据。\r\n\r\n![已添加 CNAME 记录](./media/app-service-web-tutorial-custom-domain/cname-record-added.png)\r\n\r\n如果之前错过了某个步骤或者在某个位置的输入不正确，则会在页面的底部看到验证错误。\r\n\r\n![验证错误](./media/app-service-web-tutorial-custom-domain/verification-error-cname.png)\r\n\r\n<a name=\"a\"></a>\r\n\r\n## <a name=\"map-an-a-record\"></a>映射 A 记录\r\n\r\n在教程示例中，将为根域（例如 `contoso.com`）添加 A 记录。 \r\n\r\n<a name=\"info\"></a>\r\n\r\n### <a name=\"copy-the-apps-ip-address\"></a>复制应用的 IP 地址\r\n\r\n若要映射 A 记录，需要具有应用的外部 IP 地址。 在 Azure 门户中，可以在应用的“自定义域”页面中找到此 IP 地址。\r\n\r\n在 Azure 门户中，在应用页面的左侧导航窗格中，选择“自定义域”。 \r\n\r\n![自定义域菜单](./media/app-service-web-tutorial-custom-domain/custom-domain-menu.png)\r\n\r\n在“自定义域”页面中，复制应用的 IP 地址。\r\n\r\n![在门户中导航到 Azure 应用](./media/app-service-web-tutorial-custom-domain/mapping-information.png)\r\n\r\n[!INCLUDE [Access DNS records with domain provider](../../includes/app-service-web-access-dns-records.md)]\r\n\r\n### <a name=\"create-the-a-record\"></a>创建 A 记录\r\n\r\n若要将 A 记录映射到应用，应用服务需要**两条** DNS 记录：\r\n\r\n- **A** 记录映射到应用的 IP 地址。\r\n- **TXT** 记录映射到应用的默认主机名 `<app_name>.chinacloudsites.cn`。 应用服务仅在配置时使用此记录来验证你是否拥有自定义域。 自定义域经过验证并且在应用服务中配置后，可以删除此 TXT 记录。 \r\n\r\n对于 `contoso.com` 域示例，根据下表创建 A 和 TXT 记录（`@` 通常表示根域）。 \r\n\r\n| 记录类型 | 主机 | 值 |\r\n| - | - | - |\r\n| A | `@` | 通过[复制应用的 IP 地址](#info)获得的 IP 地址 |\r\n| TXT | `@` | `<app_name>.chinacloudsites.cn` |\r\n\r\n添加记录后，DNS 记录页面看起来如以下示例：\r\n\r\n![DNS 记录页](./media/app-service-web-tutorial-custom-domain/a-record.png)\r\n\r\n<a name=\"enable-a\"></a>\r\n\r\n### <a name=\"enable-the-a-record-mapping-in-the-app\"></a>在应用中启用 A 记录映射\r\n\r\n在 Azure 门户中，返回到应用的“自定义域”页面，将完全限定的自定义 DNS 名称（例如 `contoso.com`）添加到列表。\r\n\r\n单击“添加主机名”旁边的 **+** 图标。\r\n\r\n![添加主机名](./media/app-service-web-tutorial-custom-domain/add-host-name.png)\r\n\r\n键入你为其配置了 A 记录的完全限定的域名，例如 `contoso.com`。\r\n\r\n选择“验证”。\r\n\r\n“添加主机名”按钮会被激活。 \r\n\r\n确保“主机名记录类型”设置为“A 记录 (example.com)”。\r\n\r\n选择“添加主机名”。\r\n\r\n![将 DNS 名称添加到应用](./media/app-service-web-tutorial-custom-domain/validate-domain-name.png)\r\n\r\n新主机名可能需要经过一段时间后才会反映在应用的“自定义域”页中。 请尝试刷新浏览器来更新数据。\r\n\r\n![已添加 A 记录](./media/app-service-web-tutorial-custom-domain/a-record-added.png)\r\n\r\n如果之前错过了某个步骤或者在某个位置的输入不正确，则会在页面的底部看到验证错误。\r\n\r\n![验证错误](./media/app-service-web-tutorial-custom-domain/verification-error.png)\r\n\r\n<a name=\"wildcard\"></a>\r\n\r\n## <a name=\"map-a-wildcard-domain\"></a>映射通配符域\r\n\r\n在教程示例中，你通过添加 CNAME 记录将[通配符 DNS 名称](https://en.wikipedia.org/wiki/Wildcard_DNS_record)（例如 `*.contoso.com`）映射到应用服务应用。 \r\n\r\n[!INCLUDE [Access DNS records with domain provider](../../includes/app-service-web-access-dns-records.md)]\r\n\r\n### <a name=\"create-the-cname-record\"></a>创建 CNAME 记录\r\n\r\n添加一条 CNAME 记录来将通配符名称映射到应用的默认主机名 (`<app_name>.chinacloudsites.cn`)。\r\n\r\n对于 `*.contoso.com` 域示例，CNAME 记录将名称 `*` 映射到 `<app_name>.chinacloudsites.cn`。\r\n\r\n添加 CNAME 后，DNS 记录页面看起来如以下示例：\r\n\r\n![在门户中导航到 Azure 应用](./media/app-service-web-tutorial-custom-domain/cname-record-wildcard.png)\r\n\r\n### <a name=\"enable-the-cname-record-mapping-in-the-app\"></a>在应用中启用 CNAME 记录映射\r\n\r\n现在，可以向应用中添加与通配符名称匹配的任何子域了（例如，`sub1.contoso.com` 和 `sub2.contoso.com` 与 `*.contoso.com` 匹配）。 \r\n\r\n在 Azure 门户中，在应用页面的左侧导航窗格中，选择“自定义域”。 \r\n\r\n![自定义域菜单](./media/app-service-web-tutorial-custom-domain/custom-domain-menu.png)\r\n\r\n单击“添加主机名”旁边的 **+** 图标。\r\n\r\n![添加主机名](./media/app-service-web-tutorial-custom-domain/add-host-name-cname.png)\r\n\r\n键入与通配符域匹配的完全限定的域名（例如 `sub1.contoso.com`），然后选择“验证”。\r\n\r\n“添加主机名”按钮会被激活。 \r\n\r\n确保“主机名记录类型”设置为“CNAME 记录（www.example.com 或任何子域）”。\r\n\r\n选择“添加主机名”。\r\n\r\n![将 DNS 名称添加到应用](./media/app-service-web-tutorial-custom-domain/validate-domain-name-cname-wildcard.png)\r\n\r\n新主机名可能需要经过一段时间后才会反映在应用的“自定义域”页中。 请尝试刷新浏览器来更新数据。\r\n\r\n再次选择 **+** 图标来添加与通配符域匹配的另一主机名。 例如，添加 `sub2.contoso.com`。\r\n\r\n![已添加 CNAME 记录](./media/app-service-web-tutorial-custom-domain/cname-record-added-wildcard2.png)\r\n\r\n## <a name=\"test-in-browser\"></a>在浏览器中测试\r\n\r\n浏览到前面配置的 DNS 名称（例如，`contoso.com`、`www.contoso.com`、`sub1.contoso.com` 和 `sub2.contoso.com`）。\r\n\r\n![在门户中导航到 Azure 应用](./media/app-service-web-tutorial-custom-domain/app-with-custom-dns.png)\r\n\r\n## <a name=\"automate-with-scripts\"></a>使用脚本自动执行\r\n\r\n可以在 [Azure CLI](https://docs.azure.cn/zh-cn/cli/install-azure-cli?view=azure-cli-lastest) 或 [Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview) 中使用脚本自动管理自定义域。 \r\n\r\n### <a name=\"azure-cli\"></a>Azure CLI \r\n\r\n[!INCLUDE [azure-cli-2-azurechinacloud-environment-parameter](../../includes/azure-cli-2-azurechinacloud-environment-parameter.md)]\r\n\r\n以下命令将配置的自定义 DNS 名称添加到应用服务应用。 \r\n\r\n```bash \r\naz appservice web config hostname add \\\r\n    --webapp <app_name> \\\r\n    --resource-group <resource_group_name> \\ \r\n    --name <fully_qualified_domain_name> \r\n``` \r\n\r\n有关详细信息，请参阅[将自定义域映射到 Web 应用](./scripts/app-service-cli-configure-custom-domain.md)。 \r\n\r\n### <a name=\"azure-powershell\"></a>Azure PowerShell \r\n\r\n以下命令将配置的自定义 DNS 名称添加到应用服务应用。 \r\n\r\n```PowerShell  \r\nSet-AzureRmWebApp `\r\n    -Name <app_name> `\r\n    -ResourceGroupName <resource_group_name> ` \r\n    -HostNames @(\"<fully_qualified_domain_name>\",\"<app_name>.chinacloudsites.cn\") \r\n```\r\n\r\n有关详细信息，请参阅[将自定义域分配到 Web 应用](./scripts/app-service-powershell-configure-custom-domain.md)。\r\n\r\n## <a name=\"next-steps\"></a>后续步骤\r\n\r\n在本教程中，你已学习了如何执行以下操作：\r\n\r\n> [!div class=\"checklist\"]\r\n> * 使用 CNAME 记录映射子域\r\n> * 使用 A 记录映射根域\r\n> * 使用 CNAME 记录映射通配符域\r\n> * 使用脚本自动执行域映射\r\n\r\n转到下一教程，了解如何将自定义 SSL 证书绑定到 Web 应用。\r\n\r\n> [!div class=\"nextstepaction\"]\r\n> [将现有的自定义 SSL 证书绑定到 Azure Web 应用](app-service-web-tutorial-custom-ssl.md)\r\n\r\n<!--Update_Description: add the includes file of accessing DNS record with domain provider-->"}