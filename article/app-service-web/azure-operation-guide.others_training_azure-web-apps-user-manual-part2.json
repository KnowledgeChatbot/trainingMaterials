{"Title":"Azure Web 应用用户手册 - 第二部分","Description":"详细介绍如何创建和管理 Azure Web 应用。","Content":"\r\n# Azure Web 应用用户手册 - 第二部分\r\n\r\n- [Azure Web 应用用户手册 - 第一部分](./azure-web-apps-user-manual-part1.md)\r\n- [Azure Web 应用用户手册 - 第三部分](./azure-web-apps-user-manual-part3.md)\r\n\r\n##<a name=\"section_4\"></a> 2. 开始创建 Azure Web 应用\r\n###<a name=\"section_4_1\"></a> 2.1 规划好 Azure 订阅\r\n订阅是进行 Azure 账单分拆的最小单位。\r\n\r\n如果企业内部需要进行内部成本核算，例如 IT 部门、销售部门、市场部门均需要使用 Azure，并且根据不同的部门的 Azure 实际使用量进行内部成本核算，就需要实现规划好三个不同的 Azure 订阅。在创建 Azure IaaS 相关资源的时候，将这些资源创建在不同的订阅下。\r\n\r\n###<a name=\"section_4_2\"></a> 2.2 选择订阅\r\n登陆 Azure [经典管理门户] (https://manage.windowsazure.cn)，输入账户和密码。\r\n\r\n点击右上角的订阅按钮，如下图:\r\n\r\n![subscription](./media/azure-web-apps-user-manual-part2/subscription.png)\r\n\r\n###<a name=\"section_4_3\"></a> 2.3 模拟场景\r\nContoso 公司已经采购了 Azure 中国的服务，并且开发部门使用 Visual Studio 2013，开发 ASP.NET 应用程序。\r\n\r\n在开始以下内容之前，请准备：\r\n\r\n1. Azure 中国账户\r\n2. Visual Studio 2013\r\n\r\n###<a name=\"section_4_4\"></a> 2.4 创建一个空的 Azure Web 应用\r\n1. 登录 Azure [经典管理门户](https://manage.windowsazure.cn)\r\n2. 输入相应的用户名和密码\r\n3. 点击 Azure 管理界面左下角的新建图标，如下图：\r\n\r\n    ![new](./media/azure-web-apps-user-manual-part2/new.png)\r\n\r\n4. 点击计算-> Web 应用->自定义创建，如下图：\r\n\r\n    ![custom](./media/azure-web-apps-user-manual-part2/custom.png)\r\n\r\n5. 在弹出的界面里，输入 Web 应用的名称，命令为 LeiWebSite。如下图：\r\n\r\n    ![web_create](./media/azure-web-apps-user-manual-part2/web_create.png)\r\n\r\n    注意上图中：\r\n    * (1)\tURL，输入需要的 DNS 名称\r\n    * (2)\tAPP Service 计划，选择创建新的 App Service 计划\r\n    * (3)\t区域，选择中国东部的数据中心\r\n\r\n6. 在弹出的界面里，输入 Web 应用的名称，命令为 LeiWebSite。如下图：\r\n\r\n    ![web_app2](./media/azure-web-apps-user-manual-part2/web_app2.png)\r\n\r\n    注意上图中：\r\n    * (1)\t名称就是输入的DNS名称\r\n    * (2)\t定价层为免费，就是在服务类型中的免费 (Free) 模式\r\n\r\n7. 然后在IE浏览器中输入创建成功的 Azure Web 应用 DNS 地址：http://leiwebsite.chinacloudsites.cn/，就可以看到欢迎界面，如下图：\r\n\r\n    ![web_app_browse](./media/azure-web-apps-user-manual-part2/web_app_browse.png)\r\n\r\n###<a name=\"section_4_5\"></a> 2.5 下载发布配置文件\r\n1. 回到 Azure [经典管理门户](https://manage.windowsazure.cn)\r\n2. 点击之前创建的 Azure Web 应用名称，如下图红色部分：\r\n\r\n    ![web_app3](./media/azure-web-apps-user-manual-part2/web_app3.png)\r\n\r\n3. 页面跳转，点击仪表板页面，点击右下角的下载发布配置文件。如下图：\r\n\r\n    ![dashboard](./media/azure-web-apps-user-manual-part2/dashboard.png)\r\n\r\n4. 把下载的文件保存在本地计算机的 D 盘。\r\n\r\n###<a name=\"section_4_6\"></a> 2.6 创建一个 Hello World 项目\r\n在上一节中，创建了一个空的 Azure Web 应用。在本节中，将在本地通过 Visual Studio 2013 创建一个 Web 应用。\r\n\r\n1. 首先以管理员身份，运行 Visual Studio 2013\r\n2. 创建一个新的 Web Project，命名为 LeiWebSiteProject，如下图：\r\n\r\n    ![visual_studio](./media/azure-web-apps-user-manual-part2/visual_studio.png)\r\n\r\n3. 选择一个 Web 应用的 Template，这里使用 Web Form，如下图：\r\n\r\n    ![visual_studio2](./media/azure-web-apps-user-manual-part2/visual_studio2.png)\r\n\r\n4. 修改 Project 中的 Default.aspx 页面逻辑，增加 Hello Azure Web 应用逻辑，如下图：\r\n\r\n    ![visual_studio3](./media/azure-web-apps-user-manual-part2/visual_studio3.png)\r\n\r\n###<a name=\"section_4_7\"></a> 2.7 将网站代码通过 Visual Studio 部署\r\n1. 点击 Visual Studio 2013，点击项目文件，右键 Publish。如下图：\r\n\r\n    ![visual_studio4](./media/azure-web-apps-user-manual-part2/visual_studio4.png)\r\n\r\n2. 在弹出的界面中，选择 Import\r\n\r\n    ![visual_studio5](./media/azure-web-apps-user-manual-part2/visual_studio5.png)\r\n\r\n3. 在弹出的界面中，点击 Browse，选择在 [2.5 节](#section_4_5)中\r\n\r\n    ![visual_studio6](./media/azure-web-apps-user-manual-part2/visual_studio6.png)\r\n\r\n4. 选择完毕后，在 Setting 页面，可以选择需要发布的版本是 Debug 还是 Release，如下图：\r\n\r\n    ![visual_studio7](./media/azure-web-apps-user-manual-part2/visual_studio7.png)\r\n\r\n5. 最后在 Preview 页面，点击 Publish 即可。如下图：\r\n\r\n    ![visual_studio8](./media/azure-web-apps-user-manual-part2/visual_studio8.png)\r\n\r\n6. 如果 Azure Web 应用最后在 Preview 页面，点击 Publish 即可。如下图：\r\n\r\n    ![visual_studio9](./media/azure-web-apps-user-manual-part2/visual_studio9.png)\r\n\r\n7. 等发布成功了以后，就可以通过访问成功的 Azure Web 应用的 DNS 地址，如下图：\r\n\r\n    ![visual_studio10](./media/azure-web-apps-user-manual-part2/visual_studio10.png)\r\n\r\n8. Visual Studio 支持增量部署，假设修改某个页面内容，只需要右键 Publish，在步骤 \"Preview\" 中可以看到，系统会提示更新的内容：\r\n\r\n    ![visual_studio11](./media/azure-web-apps-user-manual-part2/visual_studio11.png)\r\n\r\n###<a name=\"section_4_8\"></a> 2.8 将网站代码通过 FTP 部署\r\n1. 如果使用的是 Visual Studio，当通过以上两节内容，下载了发布配置文件并通过 Visual Studio Publish，也可以通过FTP进行发布，如下图：\r\n\r\n    ![visual_studio12](./media/azure-web-apps-user-manual-part2/visual_studio12.png)\r\n\r\n    ![visual_studio13](./media/azure-web-apps-user-manual-part2/visual_studio13.png)\r\n\r\n2. 介绍一下通过 Azure [经典管理门户](https://manage.windowsazure.cn)，来发布 Azure Web 应用。\r\n\r\n    点击创建成功的 Azure Web 应用，如下图红色区域：\r\n\r\n    ![web_app3](./media/azure-web-apps-user-manual-part2/web_app3.png)\r\n\r\n3. 页面跳转，点击仪表板。如下图：\r\n\r\n    ![dashboard2](./media/azure-web-apps-user-manual-part2/dashboard2.png)\r\n\r\n4. 在仪表板栏目中，点击下图中的 ”重置部署凭据”。如下图：\r\n\r\n    ![dashboard3](./media/azure-web-apps-user-manual-part2/dashboard3.png)\r\n\r\n5. 在弹出的页面中，设置 FTP 的用户名和密码，如下图：\r\n\r\n    ![ftp_cred](./media/azure-web-apps-user-manual-part2/ftp_cred.png)\r\n\r\n6. 重置 FTP 密码完成后，可以浏览到 FTP 的地址和登录名，如下图：\r\n\r\n    ![ftp_cred2](./media/azure-web-apps-user-manual-part2/ftp_cred2.png)\r\n\r\n    注意：FTP 的登录名是包含 [DNS]\\[UserName]\r\n    <br/>虽然在步骤 5 中设置了用户名是 leizhang，但是在登录 FTP 服务器的时候必须使用 LeiWebSite\\leizhang\r\n\r\n7. 打开 Windows 资源管理器，地址输入上图中的 FTP 主机名，用户名为 LeiWebSite\\leizhang，密码为在步骤 5 中设置的密码，如下图：\r\n\r\n    ![ftp_cred3](./media/azure-web-apps-user-manual-part2/ftp_cred3.png)\r\n\r\n8. 登录成功后，将本地的项目文件保存到 FTP 中的 Site 目录下的 wwwroot 目录下，如下图：\r\n\r\n    ![ftp_cred4](./media/azure-web-apps-user-manual-part2/ftp_cred4.png)\r\n\r\n###<a name=\"section_4_9\"></a> 2.9 缩放 Azure Web 应用\r\n####<a name=\"section_4_9_1\"></a> 2.9.1 横向扩展 Azure Web 应用\r\n在[第 1.8 节](./azure-web-apps-user-manual-part1.md#section_3_8)中，已经介绍了 Azure Web 应用单个实例大小，如下：\r\n\r\n* (1)\t小型，配置为：单核心，1.75GB 内存\r\n* (2)\t中型，配置为：双核心，3.5GB 内存\r\n* (3)\t大型，配置为：四核心，7GB 内存\r\n\r\n在[第 1.9 节](./azure-web-apps-user-manual-part1.md#section_3_9)中，介绍了 Azure Web 应用提供不同的服务类型，如下图所示：\r\n\r\n<table border=\"1\">\r\n<thead>\r\n<tr>\r\n<th></th>\t\t\t\t<th>免费</th>\t<th>共享</th>\t\t<th>基本</th>\t\t\t\t<th>标准</th>\r\n</tr>\r\n</thead>\r\n<tbody>\r\n<tr>\r\n<td>横向扩展实例数</td>\t<td>不支持</td>\t<td>6个共享实例</td>\t<td>3个专用实例</td>\t\t\t<td>10 个专用实例</td>\r\n</tr>\r\n<tr>\r\n<td>服务级别</td>\t\t<td>不支持</td>\t<td>不支持</td>\t\t<td>99.9%</td>\t<td>99.9%</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n\r\n1. 在 Azure [经典管理门户](https://manage.windowsazure.cn)，点击缩放:\r\n\r\n    ![scale2](./media/azure-web-apps-user-manual-part2/scale2.png)\r\n\r\n2. 点击 App Service 计划定价层，如下图。如果想把 Web 应用设置为共享模式，并且有 6 个共享实例做横向扩展，请按照下图设置：\r\n\r\n    ![scale3](./media/azure-web-apps-user-manual-part2/scale3.png)\r\n\r\n3. 如果想把 Web 应用设置为基本模式，并且有 3 个基本实例做横向扩展，每个实例配置为 1Core/1.75GB，请按照下图设置：\r\n\r\n    ![scale4](./media/azure-web-apps-user-manual-part2/scale4.png)\r\n\r\n4. 如果想把 Web 应用设置为标准模式，并且有 10 个标准实例做横向扩展，每个实例配置为 2Core/3.5GB，请按照下图设置：\r\n\r\n    ![scale5](./media/azure-web-apps-user-manual-part2/scale5.png)\r\n\r\n>[!NOTE]\r\n>本节中横向扩展的 Azure Web 应用，是按照固定的实例个数，24*7 静态响应客户端请求的。\r\n\r\n####<a name=\"section_4_9_2\"></a> 2.9.2 动态缩放 Azure Web 应用\r\nAzure 还具有弹性扩展的优势，在访问量比较高的情况下，可以设置若干多台 Azure Web 应用做负载均衡；在访问量比较低的情况下，可以减少 Azure Web 应用的并发数量。\r\n\r\n>[!NOTE]\r\n>只有在 Azure Web 应用标准模式下，才支持自动扩展功能。\r\n\r\n假设一个场景，某个部署在 Azure Web 应用的企业官网，访问量是固定的。\r\n\r\n* (1)\t在周 1-5 的工作日中，访问高峰期时间是 8:00:-23:00，横向扩展 10 台 2Core/3.5GB 的 Azure Web 应用做负载均衡\r\n* (2)\t在周 1-5 的工作日中，访问低谷期时间 23:00-8:00，横向缩小为 2 台 2Core/3.5GB 的 Azure Web 应用做负载均衡\r\n* (3)\t在周末全天是访问的高峰期，横向扩展 10 台 2Core/3.5GB 的 Azure Web 应用做负载均衡\r\n\r\n<br/>\r\n\r\n1. 首先点击 Azure Web 应用的缩放选项，设置计划定价层为标准，然后点击设置计划时间，如下图：\r\n\r\n    ![scale6](./media/azure-web-apps-user-manual-part2/scale6.png)\r\n\r\n2. 在弹出的窗口中，进行如下设置：\r\n\r\n    * (1)\t勾选 ”日夜的缩放设置不同” 和 ”工作日和周末的缩放设置不同”\r\n    * (2)\t设置开始时间和结束时间，8:00AM 和 11:00PM\r\n    * (3)\t时区使用默认的 UTC+8 时区\r\n\r\n    ![scale7](./media/azure-web-apps-user-manual-part2/scale7.png)\r\n\r\n    设置完毕后请保存。\r\n\r\n3. 先设置工作日白天的动态缩放策略，如下图：\r\n\r\n    ![scale8](./media/azure-web-apps-user-manual-part2/scale8.png)\r\n\r\n    **在周 1-5 的工作白天 (之前定义的访问高峰时间 8:00:-23:00)，横向扩展 10 台 2Core/3.5GB 的 Azure Web 应用做负载均衡**\r\n\r\n4. 再设置工作日夜间的动态缩放策略，如下图：\r\n\r\n    ![scale9](./media/azure-web-apps-user-manual-part2/scale9.png)\r\n\r\n    **在周 1-5 的工作夜间 (之前定义的访问低谷时间 23:00:-8:00 )，横向扩展 2 台 2Core/3.5GB 的 Azure Web 应用做负载均衡**\r\n\r\n5. 最后设置双休日的动态缩放策略，如下图：\r\n\r\n    ![scale10](./media/azure-web-apps-user-manual-part2/scale10.png)\r\n\r\n    **在周末全天，横向扩展 10 台 2Core/3.5GB 的 Azure Web 应用做负载均衡。**\r\n\r\n###<a name=\"section_4_10\"></a> 2.10 配置 Azure Web 应用\r\n1. 还可以对于 Azure Web 应用进行配置，如下图：\r\n\r\n    ![configure](./media/azure-web-apps-user-manual-part2/configure.png)\r\n\r\n2. 配置 Web 应用的运行环境，如下图：\r\n\r\n    ![configure2](./media/azure-web-apps-user-manual-part2/configure2.png)\r\n\r\n3. 配置默认页面：\r\n\r\n    ![configure3](./media/azure-web-apps-user-manual-part2/configure3.png)\r\n\r\n4. 配置虚拟目录：\r\n\r\n    ![configure4](./media/azure-web-apps-user-manual-part2/configure4.png)\r\n\r\n###<a name=\"section_4_11\"></a> 2.11 监控 Azure Web 应用\r\n1. 点击监视器，如下图：\r\n\r\n    ![monitor](./media/azure-web-apps-user-manual-part2/monitor.png)\r\n\r\n2. 可以显示过去 1 小时、24 小时、7 天内的 Azure Web 应用监控指标\r\n\r\n    ![monitor2](./media/azure-web-apps-user-manual-part2/monitor2.png)\r\n\r\n3. 或者根据需要，增加监控指标内容。如下图：\r\n\r\n    ![monitor3](./media/azure-web-apps-user-manual-part2/monitor3.png)\r\n\r\n4. 注意：上图中关于 CPU 的监控指标是 CPU Time，而不是一般情况下的 CPU 利用率 (CPU Usage)。这是因为对于 ”免费” 和 ”共享” 级别，分别包括每天 60 分钟和 240 分钟的 CPU Time。"}