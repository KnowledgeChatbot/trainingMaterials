{"Title":"JAVA 网站上传大文件报 500 错误","Description":"JAVA 网站上传大文件报 500 错误","Content":"\r\n# JAVA 网站上传大文件报 500 错误\r\n\r\n## **问题描述**\r\n\r\n当通过 JAVA 网站上传大文件，会报 500 错误。\r\n\r\n## **问题分析**\r\n\r\n因为 Azure 的 Java 网站都是基于 IIS 转发的，所以我们需要关注 IIS 的文件上传限制以及 requestTimeout。\r\n\r\n## **解决方法**\r\n\r\n1. 由于 IIS 默认请求体的大小为 28.6M，若上传的文件超过这个大小，还需要在 web.config 文件中修改 IIS 请求体的大小,具体修改可以参照下面的例子：\r\n\r\n    ```\r\n    <configuration>\r\n    <system.webServer>\r\n        <security>\r\n            <requestFiltering>\r\n                    <requestLimits maxAllowedContentLength=\"300000000\"/>\r\n            </requestFiltering>\r\n        </security>\r\n    </system.webServer>\r\n    <system.web>\r\n                    <httpRuntime maxRequestLength=\"300000000\" appRequestQueueLimit=\"100\" useFullyQualifiedRedirectUrl=\"true\" executionTimeout=\"600\"/>\r\n    </system.web>\r\n    </configuration>\r\n    ```\r\n\r\n2. 若上传大文件，建议配置 requestTimeout 为较长时间，默认是2分钟。\r\n\r\n    ```\r\n    <httpPlatform processPath=\"<Your_Project_Path>\\bin\\apache-tomcat-8.0.28\\apache-tomcat-8.0.28\\bin\\startup.bat\"     arguments=\"\" stdoutLogEnabled=\"true\" stdoutLogFile=\"<Your_stdout_Log_File_Path>\"   requestTimeout=\"00:02:00\">\r\n    ```\r\n\r\n3. 做完上述的配置之后，建议在管理门户重启网站。\r\n\r\n## **参考链接**\r\n\r\n- [Request Limits <requestLimits>](https://www.iis.net/configreference/system.webserver/security/requestfiltering/requestlimits#001)\r\n\r\n- [HttpPlatformHandler Configuration Reference](http://www.iis.net/learn/extensions/httpplatformhandler/httpplatformhandler-configuration-reference)"}