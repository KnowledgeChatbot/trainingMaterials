{"Title":"针对 Azure web 应用的开源技术常见问题解答","Description":"获取有关 Azure App Service Web 应用功能中开源技术常见问题的解答。","Content":"# <a name=\"open-source-technologies-faqs-for-web-apps-in-azure\"></a>针对 Azure 中 Web 应用的开源技术常见问题的解答\r\n\r\n本文对 [Azure App Service Web 应用功能](https://www.azure.cn/home/features/app-service/web-apps/)开源技术常见问题 (FAQ) 进行了解答。\r\n\r\n[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]\r\n\r\n## <a name=\"how-do-i-turn-on-php-logging-to-troubleshoot-php-issues\"></a>如何启用 PHP 日志记录以便对 PHP 问题进行故障排除？\r\n\r\n打开 PHP 日志记录：\r\n\r\n1. 登录到 [Kudu 网站](https://*yourwebsitename*.scm.chinacloudsites.cn)。\r\n2. 在顶部菜单中，选择“调试控制台” > “CMD”。\r\n3. 选择“Site”文件夹。\r\n4. 选择“wwwroot”文件夹。\r\n5. 选择“+”图标，然后选择“新建文件”。\r\n6. 将文件名称设置为“.user.ini”。\r\n7. 选择“.user.ini”旁边的铅笔图标。\r\n8. 在文件中，添加以下代码：`log_errors=on`\r\n9. 选择“保存”。\r\n10. 选择“wp-config.php”旁边的铅笔图标。\r\n11. 将文本更改为以下代码：\r\n   ```\r\n   //Enable WP_DEBUG modedefine('WP_DEBUG', true);//Enable debug logging to /wp-content/debug.logdefine('WP_DEBUG_LOG', true);\r\n   //Supress errors and warnings to screendefine('WP_DEBUG_DISPLAY', false);//Supress PHP errors to screenini_set('display_errors', 0);\r\n   ```\r\n12. 在 Azure 门户中的 Web 应用菜单中，重启 Web 应用。\r\n\r\n有关详细信息，请参阅[启用 WordPress 错误日志](https://blogs.msdn.microsoft.com/azureossds/2015/10/09/logging-php-errors-in-wordpress-2/)。\r\n\r\n## <a name=\"how-do-i-log-python-application-errors-in-apps-that-are-hosted-in-app-service\"></a>如何在应用服务中承载的应用中记录 Python 应用程序错误？\r\n\r\n捕获 Python 应用程序错误：\r\n\r\n1. 在 Azure 门户中的 Web 应用中，选择“设置”。\r\n2. 在“设置”选项卡上，选择“应用程序设置”。\r\n3. 在“应用设置”下，输入以下键/值对：\r\n    * 键：WSGI_LOG\r\n    * 值：D:\\home\\site\\wwwroot\\logs.txt（输入所选文件名）\r\n\r\n现在应可在 wwwroot 文件夹中的 logs.txt 文件中看到错误。\r\n\r\n## <a name=\"how-do-i-change-the-version-of-the-nodejs-application-that-is-hosted-in-app-service\"></a>如何更改应用服务中承载的 Node.js 应用程序的版本？\r\n\r\n若要更改 Node.js 应用程序的版本，可以使用以下选项之一：\r\n\r\n*   在 Azure 门户中，使用“应用设置”。\r\n    1. 在 Azure 门户中，转到自己的 Web 应用。\r\n    2. 在“设置”边栏选项卡上，选择“应用程序设置”。\r\n    3. 在“应用设置”中，可以包含 WEBSITE_NODE_DEFAULT_VERSION 作为键，并将所需 Node.js 版本作为值。\r\n    4. 转到 [Kudu 控制台](https://*yourwebsitename*.scm.chinacloudsites.cn)。\r\n    5. 若要检查 Node.js 版本，请输入以下命令：  \r\n   ```\r\n   node -v\r\n   ```\r\n*   修改 iisnode.yml 文件。 更改 iisnode.yml 文件中的 Node.js 版本将仅设置该 iisnode 使用的运行时环境。 你的及其他 Kudu cmd 仍使用在 Azure 门户中的“应用设置”中设置的 Node.js 版本。\r\n\r\n    若要手动设置 iisnode.yml，请在应用根文件夹中创建一个 iisnode.yml 文件。 在该文件中，包括以下行：\r\n   ```\r\n   nodeProcessCommandLine: \"D:\\Program Files (x86)\\nodejs\\5.9.1\\node.exe\"\r\n   ```\r\n\r\n*   在源控件部署期间通过使用 package.json 设置该 iisnode.yml 文件。\r\n    Azure 源控件部署过程包含以下步骤：\r\n    1. 将内容移动到 Azure web 应用。\r\n    2. 如果 Web 应用根文件夹中不存在默认部署脚本，请创建一个（deploy.cmd、.deployment 文件）。\r\n    3. 如果提及 package.json 文件 > 引擎 `\"engines\": {\"node\": \"5.9.1\",\"npm\": \"3.7.3\"}` 中的 Node.js 版本，请运行在其中创建 iisnode.yml 文件的部署脚本\r\n    4. 该 iisnode.yml 文件具有以下代码行：\r\n        ```\r\n        nodeProcessCommandLine: \"D:\\Program Files (x86)\\nodejs\\5.9.1\\node.exe\"\r\n        ```\r\n\r\n## <a name=\"i-see-the-message-error-establishing-a-database-connection-in-my-wordpress-app-thats-hosted-in-app-service-how-do-i-troubleshoot-this\"></a>我在应用服务中承载的我的 WordPress 应用中看到消息“建立数据库连接时出错”。 如何解决此问题？\r\n\r\n如果在 Azure WordPress 应用中看到此错误，为启用 php_errors.log 和 debug.log，请完成[启用 WordPress 错误日志](https://blogs.msdn.microsoft.com/azureossds/2015/10/09/logging-php-errors-in-wordpress-2/)中详述的步骤。\r\n\r\n启用日志后，重新生成错误，然后查看日志以了解是否连接已不够用：\r\n```\r\n[09-Oct-2015 00:03:13 UTC] PHP Warning: mysqli_real_connect(): (HY000/1226): User 'abcdefghijk79' has exceeded the 'max_user_connections' resource (current value: 4) in D:\\home\\site\\wwwroot\\wp-includes\\wp-db.php on line 1454\r\n```\r\n\r\n如果在 debug.log 或 php_errors.log 文件中看到此错误，则表示应用连接数已超出可用数目。 如果是承载于 ClearDB 上，请验证[服务计划](https://www.cleardb.com/pricing.view)中可用的连接数。\r\n\r\n## <a name=\"how-do-i-debug-a-nodejs-app-thats-hosted-in-app-service\"></a>如何调试应用服务中承载的 Node.js 应用？\r\n\r\n1.  转到 [Kudu 控制台](https://*yourwebsitename*.scm.chinacloudsites.cn/DebugConsole)。\r\n2.  转到应用程序日志文件夹 (D:\\home\\LogFiles\\Application)。\r\n3.  在 logging_errors.txt 文件中，检查内容。\r\n\r\n## <a name=\"how-do-i-install-native-python-modules-in-an-app-service-web-app-or-api-app\"></a>如何在应用服务 Web 应用或 API 应用中安装本机 Python 模块？\r\n\r\n某些包可能并不通过使用 pip 在 Azure 中安装。 该包可能在 Python 包索引上不可用，或可能需要编译器（编译器在运行应用服务中 Web 应用的计算机上不可用）。 有关在应用服务 Web 应用和 API 应用中安装本机模块的信息，请参阅[在应用服务中安装 Python 模块](https://blogs.msdn.microsoft.com/azureossds/2015/06/29/install-native-python-modules-on-azure-web-apps-api-apps/)。\r\n\r\n## <a name=\"how-do-i-deploy-a-django-app-to-app-service-by-using-git-and-the-new-version-of-python\"></a>如何通过使用 Git 和新版 Python 将 Django 应用部署到应用服务？\r\n\r\n有关安装 Django 的信息，请参阅[将 Django 应用部署到应用服务](https://blogs.msdn.microsoft.com/azureossds/2016/08/25/deploying-django-app-to-azure-app-services-using-git-and-new-version-of-python/)。\r\n\r\n## <a name=\"where-are-the-tomcat-log-files-located\"></a>Tomcat 日志文件位于何处？\r\n\r\n对于 Azure 应用商店和自定义部署：\r\n\r\n* 文件夹位置：D:\\home\\site\\wwwroot\\bin\\apache-tomcat-8.0.33\\logs\r\n* 感兴趣的文件：\r\n    * catalina.*yyyy-mm-dd*.log\r\n    * host-manager.*yyyy-mm-dd*.log\r\n    * localhost.*yyyy-mm-dd*.log\r\n    * manager.*yyyy-mm-dd*.log\r\n    * site_access_log.*yyyy-mm-dd*.log\r\n\r\n对于门户“应用设置”部署：\r\n\r\n* 文件夹位置：D:\\home\\LogFiles\r\n* 感兴趣的文件：\r\n    * catalina.*yyyy-mm-dd*.log\r\n    * host-manager.*yyyy-mm-dd*.log\r\n    * localhost.*yyyy-mm-dd*.log\r\n    * manager.*yyyy-mm-dd*.log\r\n    * site_access_log.*yyyy-mm-dd*.log\r\n\r\n## <a name=\"how-do-i-troubleshoot-jdbc-driver-connection-errors\"></a>如何解决 JDBC 驱动程序连接错误的问题？\r\n\r\n在 Tomcat 日志中，可能会看到以下消息：\r\n\r\n```\r\nThe web application[ROOT] registered the JDBC driver [com.mysql.jdbc.Driver] but failed to unregister it when the web application was stopped. To prevent a memory leak,the JDBC Driver has been forcibly unregistered\r\n```\r\n\r\n若要解决该错误：\r\n\r\n1. 从 app/lib 文件夹中删除 sqljdbc*.jar 文件。\r\n2. 如果使用自定义 Tomcat 或 Azure 应用商店 Tomcat Web 服务器，请将此 .jar 文件复制到 Tomcat lib 文件夹中。\r\n3. 如果从 Azure 门户启用 Java（选择“Java 1.8” > “Tomcat 服务器”），请在并行于应用的文件夹中复制 sqljdbc.* jar 文件。 然后，将以下 classpath 设置添加到 web.config 文件中：\r\n\r\n    ```\r\n    <httpPlatform>\r\n    <environmentVariables>\r\n    <environmentVariablename =\"JAVA_OPTS\" value=\" -Djava.net.preferIPv4Stack=true\r\n    -Xms128M -classpath %CLASSPATH%;[Path to the sqljdbc*.jarfile]\" />\r\n    </environmentVariables>\r\n    </httpPlatform>\r\n    ```\r\n\r\n## <a name=\"why-do-i-see-errors-when-i-attempt-to-copy-live-log-files\"></a>为什么当我尝试复制实时日志文件时看到错误？\r\n\r\n如果尝试复制 Java 应用（例如 Tomcat）的实时日志文件，可能会看到此 FTP 错误：\r\n\r\n```\r\nError transferring file [filename] Copying files from remote side failed.\r\n\r\nThe process cannot access the file because it is being used by another process.\r\n```\r\n\r\n错误消息可能会有所不同，具体取决于 FTP 客户端。\r\n\r\n所有 Java 应用都具有此锁定问题。 仅 Kudu 支持在应用运行时下载此文件。\r\n\r\n停止应用可允许对这些文件的 FTP 访问。\r\n\r\n另一解决方法是编写按计划运行并将这些文件复制到另一个目录的 WebJob。 对于示例项目，请参阅 [CopyLogsJob](https://github.com/kamilsykora/CopyLogsJob) 项目。\r\n\r\n## <a name=\"where-do-i-find-the-log-files-for-jetty\"></a>在哪里可以找到 Jetty 的日志文件？\r\n\r\n对于应用商店和自定义部署，日志文件位于 D:\\home\\site\\wwwroot\\bin\\jetty-distribution-9.1.2.v20140210\\logs 文件夹。 请注意，文件夹位置取决于所使用的 Jetty 版本。 例如，以下提供的路径用于 Jetty 9.1.2。 查找 jetty_*YYYY_MM_DD*.stderrout.log。\r\n\r\n对于门户应用设置部署，日志文件位于 D:\\home\\LogFiles。 查找 jetty_*YYYY_MM_DD*.stderrout.log\r\n\r\n## <a name=\"can-i-send-email-from-my-azure-web-app\"></a>是否可从 Azure web 应用发送电子邮件？\r\n\r\n应用服务没有内置电子邮件功能。 有关从应用发送电子邮件的一些不错的替代方案，请参阅此 [Stack Overflow 讨论](http://stackoverflow.com/questions/17666161/sending-email-from-azure)。\r\n\r\n## <a name=\"why-does-my-wordpress-site-redirect-to-another-url\"></a>为什么我的 WordPress 站点会重定向到另一个 URL？\r\n\r\n如果已在最近迁移到 Azure，WordPress 可能会重定向到旧的域 URL。 这是由 MySQL 数据库中的设置所致。\r\n\r\nWordPress Buddy+ 是可用于在数据库中直接更新重定向 URL 的 Azure 站点扩展。 有关使用 WordPress Buddy+ 的详细信息，请参阅 [WordPress 工具及使用 WordPress Buddy+ 进行 MySQL 迁移](https://blogs.msdn.microsoft.com/azureossds/2016/12/21/wordpress-tools-and-mysql-migration-with-wordpress-buddy/)。\r\n\r\n或者，如果希望通过使用 SQL 查询或 PHPMyAdmin 手动更新重定向 URL，请参阅 [WordPress：重定向到错误 URL](https://blogs.msdn.microsoft.com/azureossds/2016/07/12/wordpress-redirecting-to-wrong-url/)。\r\n\r\n## <a name=\"how-do-i-change-my-wordpress-sign-in-password\"></a>如何更改我的 WordPress 登录密码？\r\n\r\n如果忘记了 WordPress 登录密码，可以使用 WordPress Buddy+ 进行更新。 若要重置密码，请安装 WordPress Buddy+ Azure 站点扩展，然后完成 [WordPress 工具及使用 WordPress Buddy+ 进行 MySQL 迁移](https://blogs.msdn.microsoft.com/azureossds/2016/12/21/wordpress-tools-and-mysql-migration-with-wordpress-buddy/)中所述的步骤。\r\n\r\n## <a name=\"i-cant-sign-in-to-wordpress-how-do-i-resolve-this\"></a>我无法登录到 WordPress。 如何解决此问题？\r\n\r\n如果发现最近安装插件后被锁在 WordPress 外，可能插件有误。 WordPress Buddy+ 是 Azure 站点扩展，可帮助禁用 WordPress 中的插件。 有关详细信息，请参阅 [WordPress 工具及使用 WordPress Buddy+ 进行 MySQL 迁移](https://blogs.msdn.microsoft.com/azureossds/2016/12/21/wordpress-tools-and-mysql-migration-with-wordpress-buddy/)。\r\n\r\n## <a name=\"how-do-i-migrate-my-wordpress-database\"></a>如何迁移我的 WordPress 数据库？\r\n\r\n有多种方法可用于迁移连接到 WordPress 网站的 MySQL 数据库：\r\n\r\n* 开发人员：使用[命令提示符或 PHPMyAdmin](https://blogs.msdn.microsoft.com/azureossds/2016/03/02/migrating-data-between-mysql-databases-using-kudu-console-azure-app-service/)\r\n* 非开发人员：使用 [WordPress Buddy+](https://blogs.msdn.microsoft.com/azureossds/2016/12/21/wordpress-tools-and-mysql-migration-with-wordpress-buddy/)\r\n\r\n## <a name=\"how-do-i-help-make-wordpress-more-secure\"></a>我如何提供帮助，可让 WordPress 更加安全？\r\n\r\n若要了解有关 WordPress 的安全性最佳做法，请参阅 [Azure 中的 WordPress 安全性最佳做法](https://blogs.msdn.microsoft.com/azureossds/2016/12/26/best-practices-for-wordpress-security-on-azure/)。\r\n\r\n## <a name=\"i-am-trying-to-use-phpmyadmin-and-i-see-the-message-access-denied-how-do-i-resolve-this\"></a>我在尝试使用 PHPMyAdmin 时看到消息“拒绝访问。” 如何解决此问题？\r\n\r\n如果 MySQL 应用内功能尚未在此应用服务实例中运行，可能会遇到此问题。 若要解决此问题，请尝试访问自己的网站。 这将启动所需的进程，包括 MySQL 应用内进程。 若要验证 MySQL 应用内功能正在运行，确保进程资源管理器 的进程中列出了 mysqld.exe。\r\n\r\n确保 MySQL 应用内功能运行后，尝试使用 PHPMyAdmin。\r\n\r\n## <a name=\"i-get-an-http-403-error-when-i-try-to-import-or-export-my-mysql-in-app-database-by-using-phpmyadmin-how-do-i-resolve-this\"></a>在尝试使用 PHPMyadmin 导入或导出 MySQL 应用内数据库时，收到了 HTTP 403 错误。 如何解决此问题？\r\n\r\n如果使用的是较旧版本的 Chrome，则可能遇到一个已知的 bug。 要解决此问题，请升级到较新版本的 Chrome。 还可尝试使用不会出现此问题的另一种浏览器，如 Internet Explorer 或 Microsoft Edge。\r\n\r\n<!--Update_Description: update meta data-->"}