{"Title":"如何为 Web 应用配置自定义 Tomcat 环境","Description":"如何为 Web 应用配置自定义 Tomcat 环境","Content":"\r\n# 如何为 Web 应用配置自定义 Tomcat 环境\r\n\r\n1. 在门户上选择打开 Java 环境，选择 JDK 版本和 Tomcat 版本。\r\n\r\n    ![01](media/aog-app-service-web-howto-configure-custom-tomcat-environment/01.png)\r\n\r\n2. 从官网下载要使用的 tomcat 版本，解压到本地目录。\r\n\r\n3. 修改 `conf/server.xml` 配置文件：\r\n\r\n    > [Tip]\r\n    > 可以在此文件中自定义自己的配置\r\n\r\n    1. 将 `port` 改成 `-1`：                   \r\n\r\n        ![02](media/aog-app-service-web-howto-configure-custom-tomcat-environment/02.png)\r\n\r\n    2. 将 `Http-connect port` 改成 `${port.http}`：\r\n\r\n        ![03](media/aog-app-service-web-howto-configure-custom-tomcat-environment/03.png)\r\n\r\n    3. 注释 AJP 和 HTTPS 连接\r\n\r\n        ![04](media/aog-app-service-web-howto-configure-custom-tomcat-environment/04.png)\r\n\r\n    4. 将 `host` 改变为 `127.0.0.1`，并将 appBase 定位到 wwwroot 下的 webapps 目录：\r\n\r\n        若 appbase 定位的是 `../../webapps`，那项目文件应该放在 `site-->wwwroot-->webapps-->ROOT` 目录下。</br>\r\n        若 appbase 定位的是 `webapps`，那项目文件应该放在 `/site/wwwroot/bin/apache-tomcat-<version>/webapps/ROOT`。\r\n\r\n        ![05](media/aog-app-service-web-howto-configure-custom-tomcat-environment/05.png)\r\n\r\n4. 修改 `conf/catalina.properties` 文件，末尾加入 `java.net.preferIPv4Stack=true`。\r\n\r\n5. 上传 `Tomcat/java` 目录到 `site/wwwroot/bin`：\r\n\r\n    ![06](media/aog-app-service-web-howto-configure-custom-tomcat-environment/06.png)\r\n\r\n6. 在 `site/wwwroot` 目录下上传 web.config 内容如下：\r\n\r\n    ```XML\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n    <configuration>\r\n      <system.webServer>\r\n        <handlers>\r\n          <add name=\"httpPlatformHandler\" path=\"*\" verb=\"*\" modules=\"httpPlatformHandler\" resourceType=\"Unspecified\" />\r\n        </handlers>\r\n        <httpPlatform processPath=\"%HOME%\\site\\wwwroot\\bin\\tomcat\\bin\\startup.bat\"  arguments=\"\">\r\n          <environmentVariables>\r\n            <environmentVariable name=\"CATALINA_OPTS\" value=\"-Dport.http=%HTTP_PLATFORM_PORT%\" />\r\n            <environmentVariable name=\"CATALINA_HOME\" value=\"%HOME%\\site\\wwwroot\\bin\\tomcat\" />\r\n            <environmentVariable name=\"JRE_HOME\" value=\"D:\\home\\site\\wwwroot\\bin\\java\\jdk1.6.0_45\\jre6\" />   <!-- 这个是指定 jre 的路径-->\r\n            <environmentVariable name=\"JAVA_OPTS\" value=\"-Djava.net.preferIPv4Stack=true\" />\r\n          </environmentVariables>\r\n        </httpPlatform>\r\n      </system.webServer>\r\n    </configuration>\r\n    ```\r\n\r\n7. 重启网站进行检查配置是否生效。"}