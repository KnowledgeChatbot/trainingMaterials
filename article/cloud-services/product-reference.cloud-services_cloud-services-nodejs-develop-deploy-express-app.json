{"Title":"使用 Express 构建 Web 应用程序 (Node.js)","Description":"本教程以云服务教程为基础，演示如何使用 Express 模块。","Content":"# <a name=\"build-a-nodejs-web-application-using-express-on-an-azure-cloud-service\"></a>使用 Express 在 Azure 云服务中生成 Node.js Web 应用程序\r\n\r\nNode.js 包含核心运行时中最小的一个功能集。\r\n开发人员在开发 Node.js 应用程序时经常会使用第三方模块来提供额外功能。 本教程使用 [Express][Express] 模块新建一个应用程序，该模块可提供用于创建 Node.js Web 应用程序的 MVC 框架。\r\n\r\n以下是已完成应用程序的屏幕截图：\r\n\r\n![显示“Welcome to Express in Azure”的 Web 浏览器](./media/cloud-services-nodejs-develop-deploy-express-app/node36.png)\r\n\r\n##<a name=\"create-a-cloud-service-project\"></a>创建云服务项目\r\n[!INCLUDE [install-dev-tools](../../includes/install-dev-tools.md)]\r\n\r\n执行下列步骤可新建一个名为“expressapp”的云服务项目：\r\n\r\n1. 在“开始”菜单或“开始”屏幕中，搜索“Windows PowerShell”。 最后，右键单击“Windows PowerShell”并选择“以管理员身份运行”。\r\n\r\n    ![Azure PowerShell 图标](./media/cloud-services-nodejs-develop-deploy-express-app/azure-powershell-start.png)\r\n\r\n2. 将目录切换到 c:\\\\node 目录，然后输入下列命令，新建一个名为 expressapp 的解决方案和名为 WebRole1 的 Web 角色：\r\n\r\n    ```\r\n    PS C:\\node> New-AzureServiceProject expressapp\r\n    PS C:\\Node\\expressapp> Add-AzureNodeWebRole\r\n    PS C:\\Node\\expressapp> Set-AzureServiceProjectRole WebRole1 Node 0.10.21\r\n    ```\r\n\r\n    > [!NOTE]\r\n    > 默认情况下， **Add-azurenodewebrole** 使用旧版 Node.js。 上述 **Set-azureserviceprojectrole** 语句将指示 Azure 使用 v0.10.21 版本的节点。  请注意，这些参数区分大小写。  通过检查 WebRole1\\package.json 中的“engines”属性可以验证是否已选择正确的 Node.js 版本。\r\n\r\n##<a name=\"install-express\"></a>安装 Express\r\n\r\n1. 通过发出以下命令安装 Express 生成器：\r\n\r\n    ```\r\n    PS C:\\node\\expressapp> npm install express-generator -g\r\n    ```\r\n\r\n    npm 命令的输出应与以下结果类似。\r\n\r\n    ![Windows PowerShell 显示 npm install express 命令的输出。](./media/cloud-services-nodejs-develop-deploy-express-app/express-g.png)\r\n\r\n2. 将目录切换到 **WebRole1** 目录，并使用 express 命令生成一个新的应用程序：\r\n\r\n    ```\r\n    PS C:\\node\\expressapp\\WebRole1> express\r\n    ```\r\n\r\n    系统会提示是否覆盖之前创建的应用程序。 输入 y 或 yes 继续操作。 Express 会生成用于生成应用程序的 app.js 文件和一个文件夹结构。\r\n\r\n    ![express 命令的输出](./media/cloud-services-nodejs-develop-deploy-express-app/node23.png)\r\n\r\n5.  若要安装在 package.json 文件中定义的其他依赖项，请输入以下命令：\r\n\r\n    ```\r\n    PS C:\\node\\expressapp\\WebRole1> npm install\r\n    ```\r\n\r\n    ![npm install 命令的输出](./media/cloud-services-nodejs-develop-deploy-express-app/node26.png)\r\n\r\n6.  使用以下命令将 bin/www 文件复制到 server.js。 这样，云服务便可以找到此应用程序的入口点。\r\n\r\n    ```\r\n    PS C:\\node\\expressapp\\WebRole1> copy bin/www server.js\r\n    ```\r\n\r\n    完成此命令后，WebRole1 目录中应会生成一个 **server.js** 文件。\r\n\r\n7.  修改 **server.js** 以删除以下行中的“.”字符之一。\r\n\r\n    ```\r\n    var app = require('../app');\r\n    ```\r\n\r\n    完成此项修改后，该行应如下所示。\r\n\r\n    ```\r\n    var app = require('./app');\r\n    ```\r\n\r\n    之所以需要进行此更改，是因为我们已将文件（以前的 bin/www）移到了所需应用文件所在的同一个目录。 完成此更改后，请保存 **server.js** 文件。\r\n\r\n8.  使用以下命令以在 Azure 模拟器中运行应用程序：\r\n\r\n    ```\r\n    PS C:\\node\\expressapp\\WebRole1> Start-AzureEmulator -launch\r\n    ```\r\n\r\n    ![包含 Welcome to Express 的网页。](./media/cloud-services-nodejs-develop-deploy-express-app/node28.png)\r\n\r\n## <a name=\"modifying-the-view\"></a>修改视图\r\n\r\n现在，修改视图以显示消息“Welcome to Express in Azure”。\r\n\r\n1.  请输入以下命令来打开 index.jade 文件：\r\n\r\n    ```\r\n    PS C:\\node\\expressapp\\WebRole1> notepad views/index.jade\r\n    ```\r\n\r\n    ![index.jade 文件的内容。](./media/cloud-services-nodejs-develop-deploy-express-app/getting-started-19.png)\r\n\r\n    Jade 是 Express 应用程序使用的默认视图引擎。有关 Jade 视图引擎的详细信息，请参阅 [http://jade-lang.com][http://jade-lang.com]。\r\n\r\n2.  通过追加 **in Azure** 来修改最后一行文本。\r\n\r\n    ![index.jade 文件，最后一行的内容为：p Welcome to \\#{title} in Azure](./media/cloud-services-nodejs-develop-deploy-express-app/node31.png)\r\n\r\n3.  保存文件并退出记事本。\r\n\r\n4.  刷新浏览器即可看到所做的更改。\r\n\r\n    ![浏览器窗口，其中的页面包含 Welcome to Express in Azure](./media/cloud-services-nodejs-develop-deploy-express-app/node32.png)\r\n\r\n测试应用程序后，请使用 **Stop-AzureEmulator** cmdlet 停止模拟器。\r\n\r\n##<a name=\"publishing-the-application-to-azure\"></a>将应用程序发布到 Azure\r\n\r\n在 Azure PowerShell 窗口中，可使用 **Publish-AzureServiceProject** cmdlet 将应用程序部署到云服务\r\n\r\n```\r\nPS C:\\node\\expressapp\\WebRole1> Publish-AzureServiceProject -ServiceName myexpressapp -Location \"China East\" -Launch\r\n```\r\n\r\n在部署操作完成后，浏览器将打开并显示该网页。\r\n\r\n![Web 浏览器中显示 Express 页。URL 指示它现在托管在 Azure 上。](./media/cloud-services-nodejs-develop-deploy-express-app/node36.png)\r\n\r\n## <a name=\"next-steps\"></a>后续步骤\r\n\r\n有关详细信息，请参阅 [Node.js 开发人员中心](https://www.azure.cn/develop/nodejs/)。\r\n\r\n  [Node.js Web Application]: ./cloud-services-nodejs-develop-deploy-app.md\r\n  [Express]: http://expressjs.com/\r\n  [http://jade-lang.com]: http://jade-lang.com\r\n\r\n<!--Update_Description:update wording-->"}