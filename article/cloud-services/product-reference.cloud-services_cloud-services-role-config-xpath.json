{"Title":"云服务角色配置 XPath 速查表","Description":"可在云服务角色配置中用来将设置公开为环境变量的各种 XPath 设置。","Content":"# <a name=\"expose-role-configuration-settings-as-an-environment-variable-with-xpath\"></a>使用 XPath 将角色配置设置公共为环境变量\r\n\r\n在云服务辅助角色或 Web 角色服务定义文件中，可以将运行时配置值公开为环境变量。支持以下 XPath 值（分别对应于 API 值）。\r\n\r\n[Microsoft.WindowsAzure.ServiceRuntime](https://msdn.microsoft.com/zh-cn/library/microsoft.windowsazure.serviceruntime.roleenvironment.aspx) 库中也提供了这些 XPath 值。 \r\n\r\n## <a name=\"app-running-in-emulator\"></a> 应用在模拟器中运行\r\n\r\n指示应用正在模拟器中运行。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/Deployment/@emulated\" |\r\n| 代码 | var x = RoleEnvironment.IsEmulated; |\r\n\r\n## <a name=\"deployment-id\"></a>部署 ID\r\n\r\n检索实例的部署 ID。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/Deployment/@id\" |\r\n| 代码 | var deploymentId = RoleEnvironment.DeploymentId; |\r\n\r\n## <a name=\"role-id\"></a>角色 ID \r\n\r\n检索实例的当前角色 ID。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/@id\" |\r\n| 代码 | var id = RoleEnvironment.CurrentRoleInstance.Id; |\r\n\r\n## <a name=\"update-domain\"></a>更新域\r\n\r\n检索实例的更新域。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/@updateDomain\" |\r\n| 代码 | var ud = RoleEnvironment.CurrentRoleInstance.UpdateDomain; |\r\n\r\n## <a name=\"fault-domain\"></a>容错域\r\n\r\n检索实例的容错域。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/@faultDomain\" |\r\n| 代码 | var fd = RoleEnvironment.CurrentRoleInstance.FaultDomain; |\r\n\r\n## <a name=\"role-name\"></a>角色名称\r\n\r\n检索实例的角色名称。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/@roleName\" |\r\n| 代码 | var rname = RoleEnvironment.CurrentRoleInstance.Role.Name; |\r\n\r\n## <a name=\"config-setting\"></a>配置设置\r\n\r\n检索指定配置设置的值。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/ConfigurationSettings/ConfigurationSetting[@name='Setting1']/@value\" |\r\n| 代码 | var setting = RoleEnvironment.GetConfigurationSettingValue(\"Setting1\"); |\r\n\r\n## <a name=\"local-storage-path\"></a>本地存储路径\r\n\r\n检索实例的本地存储路径。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='LocalStore1']/@path\" |\r\n| 代码 | var localResourcePath = RoleEnvironment.GetLocalResource(\"LocalStore1\").RootPath; |\r\n\r\n## <a name=\"local-storage-size\"></a>本地存储大小\r\n\r\n检索实例的本地存储大小。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/LocalResources/LocalResource[@name='LocalStore1']/@sizeInMB\" |\r\n| 代码 | var localResourceSizeInMB = RoleEnvironment.GetLocalResource(\"LocalStore1\").MaximumSizeInMegabytes; |\r\n\r\n## <a name=\"endpoint-protocol\"></a>终结点协议 \r\n\r\n检索实例的终结点协议。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/Endpoints/Endpoint[@name='Endpoint1']/@protocol\" |\r\n| 代码 | var prot = RoleEnvironment.CurrentRoleInstance.InstanceEndpoints[\"Endpoint1\"].Protocol; |\r\n\r\n## <a name=\"endpoint-ip\"></a>终结点 IP\r\n\r\n获取指定终结点的 IP 地址。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ---- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/Endpoints/Endpoint[@name='Endpoint1']/@address\" |\r\n| 代码 | var address = RoleEnvironment.CurrentRoleInstance.InstanceEndpoints[\"Endpoint1\"].IPEndpoint.Address |\r\n\r\n## <a name=\"endpoint-port\"></a>终结点端口 \r\n\r\n检索实例的终结点端口。\r\n\r\n| 类型 | 示例 |\r\n| ----- | ------- |\r\n| XPath | xpath=\"/RoleEnvironment/CurrentInstance/Endpoints/Endpoint[@name='Endpoint1']/@port\" |\r\n| 代码 | var port = RoleEnvironment.CurrentRoleInstance.InstanceEndpoints[\"Endpoint1\"].IPEndpoint.Port; |\r\n\r\n## <a name=\"example\"></a>示例\r\n\r\n下面是使用名为 `TestIsEmulated`、设置为 [@emulated xpath value](#app-running-in-emulator) 的环境变量创建启动任务的辅助角色示例。 \r\n\r\n```xml\r\n    <WorkerRole name=\"Role1\">\r\n        <ConfigurationSettings>\r\n          <Setting name=\"Setting1\" />\r\n        </ConfigurationSettings>\r\n        <LocalResources>\r\n          <LocalStorage name=\"LocalStore1\" sizeInMB=\"1024\"/>\r\n        </LocalResources>\r\n        <Endpoints>\r\n          <InternalEndpoint name=\"Endpoint1\" protocol=\"tcp\" />\r\n        </Endpoints>\r\n        <Startup>\r\n          <Task commandLine=\"example.cmd inputParm\">\r\n            <Environment>\r\n              <Variable name=\"TestConstant\" value=\"Constant\"/>\r\n              <Variable name=\"TestEmptyValue\" value=\"\"/>\r\n              <Variable name=\"TestIsEmulated\">\r\n                <RoleInstanceValue xpath=\"/RoleEnvironment/Deployment/@emulated\"/>\r\n              </Variable>\r\n              ...\r\n            </Environment>\r\n          </Task>\r\n        </Startup>\r\n        <Runtime>\r\n          <Environment>\r\n            <Variable name=\"TestConstant\" value=\"Constant\"/>\r\n            <Variable name=\"TestEmptyValue\" value=\"\"/>\r\n            <Variable name=\"TestIsEmulated\">\r\n              <RoleInstanceValue xpath=\"/RoleEnvironment/Deployment/@emulated\"/>\r\n            </Variable>\r\n            ...\r\n          </Environment>\r\n        </Runtime>\r\n        ...\r\n    </WorkerRole>\r\n```\r\n\r\n## <a name=\"next-steps\"></a>后续步骤\r\n\r\n了解有关 [ServiceConfiguration.cscfg](./cloud-services-model-and-package.md#cscfg) 文件的详细信息。\r\n\r\n创建 [ServicePackage.cspkg](./cloud-services-model-and-package.md#cspkg) 包。\r\n\r\n为角色启用 [远程桌面](cloud-services-role-enable-remote-desktop-new-portal.md) 。\r\n\r\n<!--Update_Description:update link references and wording-->"}