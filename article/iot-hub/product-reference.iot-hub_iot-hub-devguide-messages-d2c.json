{"Title":"了解 Azure IoT 中心设备到云的消息","Description":"开发人员指南 - 如何在 IoT 中心使用设备到云的消息传送。 包含有关发送遥测数据和非遥测数据，以及使用路由传送消息的信息。","Content":"# <a name=\"send-device-to-cloud-messages-to-iot-hub\"></a>将设备到云的消息发送到 IoT 中心\r\n\r\n若要将时序遥测数据和警报从设备发送到解决方案后端，可将设备到云的消息从设备发送到 IoT 中心。 有关 IoT 中心支持的其他设备到云的选项的介绍，请参阅[设备到云的通信指南][lnk-d2c-guidance]。\r\n\r\n通过面向设备的终结点 (**/devices/{deviceId}/messages/events**) 发送从设备到云的消息。 路由规则随后将消息路由到 IoT 中心内面向服务的终结点之一。 路由规则使用流经中心的设备到云消息的标头和正文来确定将消息路由到的位置。 默认情况下，消息将路由到与[事件中心][lnk-event-hubs]兼容的内置面向服务的终结点 (**messages/events**) 中。 因此，可以在解决方案后端使用标准[事件中心集成和 SDK][lnk-compatible-endpoint] 接收设备到云的消息。\r\n\r\nIoT 中心使用流式消息传递模式实现设备到云的消息传递。 与[事件中心][lnk-event-hubs]*事件*和[服务总线][lnk-servicebus]*消息*相比，IoT 中心的设备到云消息更类似前者，类似之处在于有大量事件通过可供多个读取器读取的服务。\r\n\r\n使用 IoT 中心进行的设备到云的消息传送具有以下特征：\r\n\r\n* 设备到云的消息可持久保留在 IoT 中心的默认 **messages/events** 终结点长达 7 天。\r\n* 设备到云的消息最大可为 256 KB，而且可分成多个批以优化发送。 批最大可为 256 KB。\r\n* 如[控制 IoT 中心的访问权限][lnk-devguide-security]部分中所述，IoT 中心允许基于设备的身份验证和访问控制。\r\n* 使用 IoT 中心最多可创建 10 个自定义终结点。 基于 IoT 中心上配置的路由，将消息传递到终结点。 有关详细信息，请参阅[路由规则](#routing-rules)。\r\n* IoT 中心支持数百万个同时连接的设备（请参阅[配额和限制][lnk-quotas]）。\r\n* IoT 中心不允许任意分区。 设备到云的消息根据其源于的 **deviceId**进行分区。\r\n\r\n有关 IoT 中心与事件中心服务之间的差异的详细信息，请参阅 [Azure IoT 中心与 Azure 事件中心的比较][lnk-comparison]。\r\n\r\n## <a name=\"send-non-telemetry-traffic\"></a>发送非遥测流量\r\n\r\n通常，除了遥测数据点之外，设备还会发送需要在解决方案后端单独执行和处理的消息与请求。 例如，关键警报必须在后端触发特定操作。 可轻松编写[路由规则][lnk-devguide-custom]，根据消息中的标头或消息正文中的值，将这些类型的消息发送到专用于其处理的终结点。\r\n\r\n有关此类消息的最佳处理方式的详细信息，请参阅 [教程：如何处理 IoT 中心设备到云的消息][lnk-d2c-tutorial] 教程。\r\n\r\n## <a name=\"route-device-to-cloud-messages\"></a>路由设备到云的消息\r\n\r\n可以使用两个选项将设备到云的消息路由到后端应用：\r\n\r\n* 使用内置的[与事件中心兼容的终结点][lnk-compatible-endpoint]，让后端应用能读取中心收到的设备到云消息。 若要了解内置的与事件中心兼容的终结点，请参阅[从内置终结点读取设备到云的消息][lnk-devguide-builtin]。\r\n* 使用路由规则将消息发送到 IoT 中心内的自定义终结点。 自定义终结点可让后端应用使用事件中心、服务总线队列或服务总线主题读取设备到云的消息。 若要了解路由和自定义终结点，请参阅[对设备到云的消息使用自定义终结点和路由规则][lnk-devguide-custom]。\r\n\r\n## <a name=\"anti-spoofing-properties\"></a>反欺骗属性\r\n\r\n为了避免设备到云的消息中出现设备欺骗，IoT 中心使用以下属性在所有消息上加上戳记：\r\n\r\n* **ConnectionDeviceId**\r\n* **ConnectionDeviceGenerationId**\r\n* **ConnectionAuthMethod**\r\n\r\n根据[设备标识属性][lnk-device-properties]，前两个属性包含源设备的 **deviceId** 和 **generationId**。\r\n\r\n**ConnectionAuthMethod** 属性包含具有以下属性的 JSON 序列化对象：\r\n\r\n```json\r\n{\r\n  \"scope\": \"{ hub | device}\",\r\n  \"type\": \"{ symkey | sas}\",\r\n  \"issuer\": \"iothub\"\r\n}\r\n```\r\n\r\n## <a name=\"next-steps\"></a>后续步骤\r\n\r\n有关可用于发送设备到云消息的 SDK 的信息，请参阅 [Azure IoT SDK][lnk-sdks]。\r\n\r\n[入门][lnk-get-started]教程介绍了如何从模拟设备和物理设备发送设备到云的消息。 有关更多详细信息，请参阅[使用路由处理 IoT 中心设备到云的消息][lnk-d2c-tutorial]教程。\r\n\r\n[lnk-devguide-builtin]: ./iot-hub-devguide-messages-read-builtin.md\r\n[lnk-devguide-custom]: ./iot-hub-devguide-messages-read-custom.md\r\n[lnk-comparison]: ./iot-hub-compare-event-hubs.md\r\n[lnk-d2c-guidance]: ./iot-hub-devguide-d2c-guidance.md\r\n[lnk-get-started]: ./iot-hub-get-started.md\r\n\r\n[lnk-event-hubs]: /event-hubs/\r\n[lnk-servicebus]: /service-bus/\r\n[lnk-quotas]: ./iot-hub-devguide-quotas-throttling.md\r\n[lnk-sdks]: ./iot-hub-devguide-sdks.md\r\n[lnk-compatible-endpoint]: ./iot-hub-devguide-messages-read-builtin.md\r\n[lnk-device-properties]: ./iot-hub-devguide-identity-registry.md#device-identity-properties\r\n[lnk-devguide-security]: ./iot-hub-devguide-security.md\r\n[lnk-d2c-tutorial]: ./iot-hub-csharp-csharp-process-d2c.md\r\n\r\n<!--Update_Description: update wording and link references-->\r\n"}