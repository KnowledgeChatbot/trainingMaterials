{"Title":"适用于 Open Source Media Framework 的平滑流式处理插件","Description":"了解如何使用适用于 Adobe Open Source Media Framework 的 Azure 媒体服务平滑流式处理插件。","Content":"\r\n# 如何使用适用于 Adobe Open Source Media Framework 的 Microsoft 平滑流式处理插件\r\n\r\n##概述\r\n\r\n适用于 Open Source Media Framework 2.0 的 Microsoft 平滑流式处理插件 (SS for OSMF) 扩展了 OSMF 的默认功能，并在新的和现有的 OSMF 播放器中添加了 Microsoft 平滑流式处理内容播放功能。该插件还为 Strobe Media Playback (SMP) 添加了平滑流式处理播放功能。\r\n\r\nSS for OSMF 包括两个版本的插件：\r\n\r\n- 适用于 OSMF 的静态平滑流式处理插件 (.swc)\r\n\r\n- 适用于 OSMF 的动态平滑流式处理插件 (.swf)\r\n\r\n本文档假设读者具有 OSMF 和 OSMF 插件方面的一般实践知识。有关 OSMF 的详细信息，请参阅 [OSMF 官方网站](http://osmf.org/)上的文档。\r\n\r\n###适用于 OSMF 2.0 的平滑流式处理插件\r\n\r\n该插件支持通过以下功能加载和播放按需平滑流式处理内容：\r\n\r\n- 按需平滑流式处理播放（播放、暂停、定位、停止）\r\n- 实时平滑流式处理播放（播放）\r\n- 实时 DVR 功能（暂停、定位、DVR 播放、现场直播）\r\n- 支持视频编解码器 - H.264\r\n- 支持音频编解码器 - AAC\r\n- 通过 OSMF 内置 API 切换多种音频语言\r\n- 通过 OSMF 内置 API 选择最佳播放质量\r\n- 通过 OSMF 字幕插件实现 Sidecar 隐藏字幕\r\n- Adobe&reg; Flash&reg; Player 11.4 或更高版本。\r\n- 此版本仅支持 OSMF 2.0。\r\n\r\n## 支持的功能和已知问题\r\n\r\n有关支持的功能、不支持的功能和已知问题的完整列表，请参阅[本文档](http://download.microsoft.com/download/3/1/B/31B63D97-574E-4A8D-BF8D-170744181724/Smooth_Streaming_Plugin_for_OSMF.pdf)。\r\n\r\n## 加载插件\r\n可静态（在编译时）或动态（在运行时）加载 OSMF 插件。适用于 OSMF 的平滑流式处理插件的下载内容包括动态和静态版本。\r\n\r\n- 静态加载：若要以静态方式加载，必须有一个静态库 (SWC) 文件。静态插件将添加为对项目的引用，并在编译时合并到最终输出文件中。\r\n\r\n- 动态加载：若要以动态方式加载，必须有一个预编译的 (SWF) 文件。动态插件在运行时中加载，不包含在项目输出中。（编译的输出）可以使用 HTTP 和 FILE 协议加载动态插件。\r\n\r\n有关静态和动态加载的详细信息，请参阅官方的 [OSMF 插件页](http://osmf.org/dev/osmf/OtherPDFs/osmf_plugin_dev_guide.pdf)。\r\n\r\n###SS for OSMF 静态加载\r\n以下代码段演示如何静态加载 SS for OSMF 插件以及如何使用 OSMF MediaFactory 类播放基本视频。在包含 SS for OSMF 代码之前，请确保项目引用包含“MSAdaptiveStreamingPlugin-v1.0.3-osmf2.0.swc”静态插件。\r\n\r\n```\r\npackage \r\n{\r\n\r\n    import com.microsoft.azure.media.AdaptiveStreamingPluginInfo;\r\n\r\n    import flash.display.*;\r\n    import org.osmf.media.*;\r\n    import org.osmf.containers.MediaContainer;\r\n    import org.osmf.events.MediaErrorEvent;\r\n    import org.osmf.events.MediaFactoryEvent;\r\n    import org.osmf.events.MediaPlayerStateChangeEvent;\r\n    import org.osmf.layout.*;\r\n\r\n    [SWF(width=\"1024\", height=\"768\", backgroundColor='#405050', frameRate=\"25\")]\r\n    public class TestPlayer extends Sprite\r\n    {        \r\n        public var _container:MediaContainer;\r\n        public var _mediaFactory:DefaultMediaFactory;\r\n        private var _mediaPlayerSprite:MediaPlayerSprite;\r\n\r\n        public function TestPlayer( )\r\n        {\r\n            stage.quality = StageQuality.HIGH;\r\n\r\n            initMediaPlayer();\r\n\r\n        }\r\n\r\n        private function initMediaPlayer():void\r\n        {\r\n\r\n            // Create the container (sprite) for managing display and layout\r\n            _mediaPlayerSprite = new MediaPlayerSprite();    \r\n            _mediaPlayerSprite.addEventListener(MediaErrorEvent.MEDIA_ERROR, onPlayerFailed);\r\n            _mediaPlayerSprite.addEventListener(MediaPlayerStateChangeEvent.MEDIA_PLAYER_STATE_CHANGE, onPlayerStateChange);\r\n            _mediaPlayerSprite.scaleMode = ScaleMode.NONE;\r\n            _mediaPlayerSprite.width = stage.stageWidth;\r\n            _mediaPlayerSprite.height = stage.stageHeight;\r\n            //Adds the container to the stage\r\n            addChild(_mediaPlayerSprite);\r\n\r\n            // Create a mediafactory instance\r\n            _mediaFactory = new DefaultMediaFactory();\r\n\r\n            // Add the listeners for PLUGIN_LOADING\r\n            _mediaFactory.addEventListener(MediaFactoryEvent.PLUGIN_LOAD,onPluginLoaded);\r\n            _mediaFactory.addEventListener(MediaFactoryEvent.PLUGIN_LOAD_ERROR, onPluginLoadFailed );\r\n\r\n            // Load the plugin class \r\n            loadAdaptiveStreamingPlugin( );  \r\n\r\n        }\r\n\r\n        private function loadAdaptiveStreamingPlugin( ):void\r\n        {\r\n            var pluginResource:MediaResourceBase;\r\n\r\n            pluginResource = new PluginInfoResource(new AdaptiveStreamingPluginInfo( )); \r\n            _mediaFactory.loadPlugin( pluginResource ); \r\n        }\r\n\r\n        private function onPluginLoaded( event:MediaFactoryEvent ):void\r\n        {\r\n            // The plugin is loaded successfully.\r\n            // Your web server needs to host a valid crossdomain.xml file to allow plugin to download Smooth Streaming files.\r\n        loadMediaSource(\"http://devplatem.vo.msecnd.net/Sintel/Sintel_H264.ism/manifest\")\r\n\r\n        }\r\n\r\n        private function onPluginLoadFailed( event:MediaFactoryEvent ):void\r\n        {\r\n            // The plugin is failed to load ...\r\n        }\r\n\r\n        private function onPlayerStateChange(event:MediaPlayerStateChangeEvent) : void\r\n        {\r\n            var state:String;\r\n\r\n            state =  event.state;\r\n\r\n            switch (state)\r\n            {\r\n                case MediaPlayerState.LOADING: \r\n\r\n                    // A new source is started to load.\r\n\r\n                    break;\r\n\r\n                case  MediaPlayerState.READY :   \r\n                    // Add code to deal with Player Ready when it is hit the first load after a source is loaded. \r\n\r\n                    break;\r\n\r\n                case MediaPlayerState.BUFFERING :\r\n\r\n                    break;\r\n\r\n                case  MediaPlayerState.PAUSED :\r\n                    break;      \r\n                // other states ...          \r\n            }\r\n        }\r\n\r\n        private function onPlayerFailed(event:MediaErrorEvent) : void\r\n        {\r\n            // Media Player is failed .           \r\n        }\r\n\r\n        private function loadMediaSource(sourceURL : String):void \r\n        {\r\n            // Take an URL of SmoothStreamingSource's manifest and add it to the page.\r\n\r\n            var resource:URLResource= new URLResource( sourceURL );\r\n\r\n            var element:MediaElement = _mediaFactory.createMediaElement( resource );\r\n            _mediaPlayerSprite.scaleMode = ScaleMode.LETTERBOX;\r\n            _mediaPlayerSprite.width = stage.stageWidth;\r\n            _mediaPlayerSprite.height = stage.stageHeight;\r\n\r\n            // Add the media element\r\n            _mediaPlayerSprite.media = element;\r\n        }     \r\n\r\n    }\r\n}\r\n```\r\n\r\n###SS for OSMF 动态加载\r\n\r\n以下代码段演示如何动态加载 SS for OSMF 插件以及如何使用 OSMF MediaFactory 类播放基本视频。在包含 SS for OSMF 代码之前，如果要使用 FILE 协议进行加载，请将“MSAdaptiveStreamingPlugin-v1.0.3-osmf2.0.swf”动态插件复制到项目文件夹；如果要进行 HTTP 加载，请将该插件复制到 Web 服务器下。不需要在项目引用中包含“MSAdaptiveStreamingPlugin-v1.0.3-osmf2.0.swc”。\r\n\r\n```\r\npackage\r\n{\r\n\r\n    import flash.display.*;\r\n    import org.osmf.media.*;\r\n    import org.osmf.containers.MediaContainer;\r\n    import org.osmf.events.MediaErrorEvent;\r\n    import org.osmf.events.MediaFactoryEvent;\r\n    import org.osmf.events.MediaPlayerStateChangeEvent;\r\n    import org.osmf.layout.*;\r\n    import flash.events.Event;\r\n    import flash.system.Capabilities;\r\n\r\n    //Sets the size of the SWF\r\n\r\n    [SWF(width=\"1024\", height=\"768\", backgroundColor='#405050', frameRate=\"25\")]\r\n    public class TestPlayer extends Sprite\r\n    {        \r\n        public var _container:MediaContainer;\r\n        public var _mediaFactory:DefaultMediaFactory;\r\n        private var _mediaPlayerSprite:MediaPlayerSprite;\r\n\r\n        public function TestPlayer( )\r\n        {\r\n            stage.quality = StageQuality.HIGH;\r\n            initMediaPlayer();\r\n        }\r\n\r\n        private function initMediaPlayer():void\r\n        {\r\n\r\n            // Create the container (sprite) for managing display and layout\r\n            _mediaPlayerSprite = new MediaPlayerSprite();    \r\n            _mediaPlayerSprite.addEventListener(MediaErrorEvent.MEDIA_ERROR, onPlayerFailed);\r\n            _mediaPlayerSprite.addEventListener(MediaPlayerStateChangeEvent.MEDIA_PLAYER_STATE_CHANGE, onPlayerStateChange);\r\n\r\n            //Adds the container to the stage\r\n            addChild(_mediaPlayerSprite);\r\n\r\n            // Create a mediafactory instance\r\n            _mediaFactory = new DefaultMediaFactory();\r\n\r\n            // Add the listeners for PLUGIN_LOADING\r\n            _mediaFactory.addEventListener(MediaFactoryEvent.PLUGIN_LOAD,onPluginLoaded);\r\n            _mediaFactory.addEventListener(MediaFactoryEvent.PLUGIN_LOAD_ERROR, onPluginLoadFailed );\r\n\r\n            // Load the plugin class \r\n            loadAdaptiveStreamingPlugin( );  \r\n\r\n        }\r\n\r\n        private function loadAdaptiveStreamingPlugin( ):void\r\n        {\r\n            var pluginResource:MediaResourceBase;\r\n            var adaptiveStreamingPluginUrl:String;\r\n\r\n            // Your dynamic plugin web server needs to host a valid crossdomain.xml file to allow loading plugins.\r\n\r\n            adaptiveStreamingPluginUrl = \"http://yourdomain/MSAdaptiveStreamingPlugin-v1.0.3-osmf2.0.swf\";\r\n            pluginResource = new URLResource(adaptiveStreamingPluginUrl);\r\n            _mediaFactory.loadPlugin( pluginResource ); \r\n\r\n        }\r\n\r\n        private function onPluginLoaded( event:MediaFactoryEvent ):void\r\n        {\r\n            // The plugin is loaded successfully.\r\n\r\n            // Your web server needs to host a valid crossdomain.xml file to allow plugin to download Smooth Streaming files.\r\n\r\n    loadMediaSource(\"http://devplatem.vo.msecnd.net/Sintel/Sintel_H264.ism/manifest\")\r\n        }\r\n\r\n        private function onPluginLoadFailed( event:MediaFactoryEvent ):void\r\n        {\r\n            // The plugin is failed to load ...\r\n        }\r\n\r\n        private function onPlayerStateChange(event:MediaPlayerStateChangeEvent) : void\r\n        {\r\n            var state:String;\r\n\r\n            state =  event.state;\r\n\r\n            switch (state)\r\n            {\r\n                case MediaPlayerState.LOADING: \r\n\r\n                    // A new source is started to load.\r\n\r\n                    break;\r\n\r\n                case  MediaPlayerState.READY :   \r\n                    // Add code to deal with Player Ready when it is hit the first load after a source is loaded. \r\n\r\n                    break;\r\n\r\n                case MediaPlayerState.BUFFERING :\r\n\r\n                    break;\r\n\r\n                case  MediaPlayerState.PAUSED :\r\n                    break;      \r\n                // other states ...          \r\n            }\r\n        }\r\n\r\n        private function onPlayerFailed(event:MediaErrorEvent) : void\r\n        {\r\n            // Media Player is failed .           \r\n        }\r\n\r\n        private function loadMediaSource(sourceURL : String):void \r\n        {\r\n            // Take an URL of SmoothStreamingSource's manifest and add it to the page.\r\n\r\n            var resource:URLResource= new URLResource( sourceURL );\r\n\r\n            var element:MediaElement = _mediaFactory.createMediaElement( resource );\r\n            _mediaPlayerSprite.scaleMode = ScaleMode.LETTERBOX;\r\n            _mediaPlayerSprite.width = stage.stageWidth;\r\n            _mediaPlayerSprite.height = stage.stageHeight;\r\n            // Add the media element\r\n            _mediaPlayerSprite.media = element;\r\n        }     \r\n\r\n    }\r\n}\r\n```\r\n\r\n##Strobe Media Playback 与 SS OSMF 动态插件\r\n\r\n适用于 OSMF 的平滑流式处理动态插件与 [Strobe Media Playback (SMP)](http://osmf.org/strobe_mediaplayback.html) 兼容。你可以使用 SS for OSMF 插件向 SMP 添加平滑流式处理内容播放功能。为此，请在进行 HTTP 加载时，使用以下步骤将“MSAdaptiveStreamingPlugin-v1.0.3-osmf2.0.swf”复制到 Web 服务器下：\r\n\r\n1. 浏览 [Strobe Media Playback 设置页](http://osmf.org/dev/2.0gm/setup.html)。 \r\n2. 将 src 设置为平滑流式处理源（例如 http://devplatem.vo.msecnd.net/Sintel/Sintel_H264.ism/manifest ） \r\n3. 进行所需的配置更改，然后单击“Preview and Update”（预览并更新）。\r\n\r\n    **注意** 你的内容 Web 服务器需要有效的 crossdomain.xml。 \r\n4. 使用常用的文本编辑器将该代码复制并粘贴到一个简单的 HTML 页，如以下示例所示：\r\n\r\n    ```\r\n    <html>\r\n    <body>\r\n    <object width=\"920\" height=\"640\"> \r\n    <param name=\"movie\" value=\"http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf\"></param>\r\n    <param name=\"flashvars\" value=\"src=http://devplatem.vo.msecnd.net/Sintel/Sintel_H264.ism/manifest &autoPlay=true\"></param>\r\n    <param name=\"allowFullScreen\" value=\"true\"></param>\r\n    <param name=\"allowscriptaccess\" value=\"always\"></param>\r\n    <param name=\"wmode\" value=\"direct\"></param>\r\n    <embed src=\"http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf\" \r\n        type=\"application/x-shockwave-flash\" \r\n        allowscriptaccess=\"always\" \r\n        allowfullscreen=\"true\" \r\n        wmode=\"direct\" \r\n        width=\"920\" \r\n        height=\"640\" \r\n        flashvars=\" src=http://devplatem.vo.msecnd.net/Sintel/Sintel_H264.ism/manifest&autoPlay=true\">\r\n    </embed>\r\n    </object>\r\n    </body>\r\n    </html>\r\n    ```\r\n\r\n5. 将平滑流式处理 OSMF 插件添加到 embed 代码中，然后保存。\r\n\r\n    ```\r\n    <html>\r\n    <object width=\"920\" height=\"640\"> \r\n    <param name=\"movie\" value=\"http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf\"></param>\r\n    <param name=\"flashvars\" value=\"src=http://devplatem.vo.msecnd.net/Sintel/Sintel_H264.ism/manifest&autoPlay=true&plugin_AdaptiveStreamingPlugin=http://yourdomain/MSAdaptiveStreamingPlugin-v1.0.3-osmf2.0.swf&AdaptiveStreamingPlugin_retryLive=true&AdaptiveStreamingPlugin_retryInterval=10\"></param>\r\n    <param name=\"allowFullScreen\" value=\"true\"></param>\r\n    <param name=\"allowscriptaccess\" value=\"always\"></param>\r\n    <param name=\"wmode\" value=\"direct\"></param>\r\n    <embed src=\"http://osmf.org/dev/2.0gm/StrobeMediaPlayback.swf\" \r\n        type=\"application/x-shockwave-flash\" \r\n        allowscriptaccess=\"always\" \r\n        allowfullscreen=\"true\" \r\n        wmode=\"direct\" \r\n        width=\"920\" \r\n        height=\"640\" \r\n        flashvars=\"src=http://devplatem.vo.msecnd.net/Sintel/Sintel_H264.ism/manifest&autoPlay=true&plugin_AdaptiveStreamingPlugin=http://yourdomain/MSAdaptiveStreamingPlugin-v1.0.3-osmf2.0.swf&AdaptiveStreamingPlugin_retryLive=true&AdaptiveStreamingPlugin_retryInterval=10\">\r\n    </embed>\r\n    </object>\r\n    </html>\r\n    ```\r\n\r\n6. \t保存 HTML 页，然后发布到 Web 服务器。使用你最常用的、已启用 Flash&reg; Player 的 Internet 浏览器（Internet Explorer、Chrome、Firefox 等）浏览到已发布的网页。\r\n7. \t在 Adobe&reg; Flash&reg; Player 中欣赏平滑流式处理内容。\r\n\r\n有关一般性 OSMF 开发的详细信息，请参阅官方的 [OSMF 开发页](http://osmf.org/resources.html)。\r\n\r\n##另请参阅\r\n\r\n[适用于 OSMF 的 Microsoft 自适应流式处理插件更新](https://azure.microsoft.com/blog/2014/10/27/microsoft-adaptive-streaming-plugin-for-osmf-update/)\r\n\r\n<!---HONumber=Mooncake_1114_2016-->"}