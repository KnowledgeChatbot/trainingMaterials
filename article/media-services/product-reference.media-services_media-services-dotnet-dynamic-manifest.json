{"Title":"使用 Azure 媒体服务 .NET SDK 创建筛选器","Description":"本主题介绍如何创建筛选器，以便客户端能够使用它们来流式传输流的特定部分。 媒体服务创建动态清单来存档此选择性流。","Content":"# <a name=\"creating-filters-with-azure-media-services-net-sdk\"></a>使用 Azure 媒体服务 .NET SDK 创建筛选器\r\n> [!div class=\"op_single_selector\"]\r\n> * [.NET](media-services-dotnet-dynamic-manifest.md)\r\n> * [REST](media-services-rest-dynamic-manifest.md)\r\n> \r\n> \r\n\r\n从 2.11 版开始，媒体服务支持为资产定义筛选器。 这些筛选器是服务器端规则，可让客户选择运行如下操作：只播放一段视频（而非播放完整视频），或只指定客户设备可以处理的一部分音频和视频再现内容（而非与该资产相关的所有再现内容）。 通过按客户请求创建的动态清单可以实现对资产进行筛选，并基于指定的筛选器流式传输视频。\r\n\r\n有关与筛选器和动态清单相关的更多详细信息，请参阅[动态清单概述](media-services-dynamic-manifest-overview.md)。\r\n\r\n本主题介绍如何使用媒体服务 .NET SDK 创建、更新和删除筛选器。 \r\n\r\n请注意，如果更新筛选器，流式处理终结点可能需要 2 分钟的时间来刷新规则。 如果内容是通过使用此筛选器提供的（并在代理和 CDN 缓存中缓存），则更新此筛选器会导致播放器失败。 建议在更新筛选器之后清除缓存。 如果此选项不可用，请考虑使用其他筛选器。 \r\n\r\n## <a name=\"types-used-to-create-filters\"></a>用于创建筛选器的类型\r\n创建筛选器时使用以下类型： \r\n\r\n* **IStreamingFilter**。  此类型基于以下 REST API [Filter](https://docs.microsoft.com/rest/api/media/operations/filter)\r\n* **IStreamingAssetFilter**。 此类型基于以下 REST API [AssetFilter](https://docs.microsoft.com/rest/api/media/operations/assetfilter)\r\n* PresentationTimeRange。 此类型基于以下 REST API [PresentationTimeRange](https://docs.microsoft.com/rest/api/media/operations/presentationtimerange)\r\n* FilterTrackSelectStatement 和 IFilterTrackPropertyCondition。 这些类型基于以下 REST API [FilterTrackSelect 和 FilterTrackPropertyCondition](https://docs.microsoft.com/rest/api/media/operations/filtertrackselect)\r\n\r\n## <a name=\"createupdatereaddelete-global-filters\"></a>创建/更新/读取/删除全局筛选器\r\n下面的代码演示如何使用 .NET 创建、更新、读取和删除资产筛选器。\r\n\r\n    string filterName = \"GlobalFilter_\" + Guid.NewGuid().ToString();\r\n\r\n    List<FilterTrackSelectStatement> filterTrackSelectStatements = new List<FilterTrackSelectStatement>();\r\n\r\n    FilterTrackSelectStatement filterTrackSelectStatement = new FilterTrackSelectStatement();\r\n    filterTrackSelectStatement.PropertyConditions = new List<IFilterTrackPropertyCondition>();\r\n    filterTrackSelectStatement.PropertyConditions.Add(new FilterTrackNameCondition(\"Track Name\", FilterTrackCompareOperator.NotEqual));\r\n    filterTrackSelectStatement.PropertyConditions.Add(new FilterTrackBitrateRangeCondition(new FilterTrackBitrateRange(0, 1), FilterTrackCompareOperator.NotEqual));\r\n    filterTrackSelectStatement.PropertyConditions.Add(new FilterTrackTypeCondition(FilterTrackType.Audio, FilterTrackCompareOperator.NotEqual));\r\n    filterTrackSelectStatements.Add(filterTrackSelectStatement);\r\n\r\n    // Create\r\n    IStreamingFilter filter = _context.Filters.Create(filterName, new PresentationTimeRange(), filterTrackSelectStatements);\r\n\r\n    // Update\r\n    filter.PresentationTimeRange = new PresentationTimeRange(timescale: 500);\r\n    filter.Update();\r\n\r\n    // Read\r\n    var filterUpdated = _context.Filters.FirstOrDefault();\r\n    Console.WriteLine(filterUpdated.Name);\r\n\r\n    // Delete\r\n    filter.Delete();\r\n\r\n\r\n## <a name=\"createupdatereaddelete-asset-filters\"></a>创建/更新/读取/删除资产筛选器\r\n下面的代码演示如何使用 .NET 创建、更新、读取和删除资产筛选器。\r\n\r\n    string assetName = \"AssetFilter_\" + Guid.NewGuid().ToString();\r\n    var asset = _context.Assets.Create(assetName, AssetCreationOptions.None);\r\n\r\n    string filterName = \"AssetFilter_\" + Guid.NewGuid().ToString();\r\n\r\n\r\n    // Create\r\n    IStreamingAssetFilter filter = asset.AssetFilters.Create(filterName,\r\n                                        new PresentationTimeRange(), \r\n                                        new List<FilterTrackSelectStatement>());\r\n\r\n    // Update\r\n    filter.PresentationTimeRange = \r\n            new PresentationTimeRange(start: 6000000000, end: 72000000000);\r\n\r\n    filter.Update();\r\n\r\n    // Read\r\n    asset = _context.Assets.Where(c => c.Id == asset.Id).FirstOrDefault();\r\n    var filterUpdated = asset.AssetFilters.FirstOrDefault();\r\n    Console.WriteLine(filterUpdated.Name);\r\n\r\n    // Delete\r\n    filterUpdated.Delete();\r\n\r\n\r\n\r\n\r\n## <a name=\"build-streaming-urls-that-use-filters\"></a>生成使用筛选器的流式处理 URL\r\n有关如何发布和传送资产的信息，请参阅[将内容传送到客户概述](media-services-deliver-content-overview.md)。\r\n\r\n以下示例演示了如何将筛选器添加到流式处理 URL。\r\n\r\n**MPEG DASH** \r\n\r\n```\r\nhttp://testendpoint-testaccount.streaming.mediaservices.chinacloudapi.cn/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=mpd-time-csf, filter=MyFilter)\r\n```\r\n\r\n**Apple HTTP Live Streaming (HLS) V4**\r\n\r\n```\r\nhttp://testendpoint-testaccount.streaming.mediaservices.chinacloudapi.cn/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=m3u8-aapl, filter=MyFilter)\r\n```\r\n\r\n**Apple HTTP Live Streaming (HLS) V3**\r\n\r\n```\r\nhttp://testendpoint-testaccount.streaming.mediaservices.chinacloudapi.cn/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=m3u8-aapl-v3, filter=MyFilter)\r\n```\r\n\r\n**平滑流**\r\n\r\n```\r\nhttp://testendpoint-testaccount.streaming.mediaservices.chinacloudapi.cn/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(filter=MyFilter)\r\n```\r\n\r\n**HDS**\r\n\r\n```\r\nhttp://testendpoint-testaccount.streaming.mediaservices.chinacloudapi.cn/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=f4m-f4f, filter=MyFilter)\r\n```\r\n\r\n## <a name=\"see-also\"></a>另请参阅 \r\n\r\n[动态清单概述](./media-services-dynamic-manifest-overview.md)"}