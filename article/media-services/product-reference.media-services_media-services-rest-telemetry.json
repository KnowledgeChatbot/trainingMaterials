{"Title":"使用 REST 配置 Azure 媒体服务遥测","Description":"本文介绍如何通过 REST API 使用 Azure 媒体服务遥测...","Content":"# <a name=\"configuring-azure-media-services-telemetry-with-rest\"></a>使用 REST 配置 Azure 媒体服务遥测\r\n\r\n本主题介绍使用 REST API 配置 Azure 媒体服务 (AMS) 遥测可采取的常规步骤。 \r\n\r\n>[!NOTE]\r\n>有关 AMS 遥测定义和使用方法的详细介绍，请参阅[概述](media-services-telemetry-overview.md)主题。\r\n\r\n本主题中所述步骤如下：\r\n\r\n- 获取与媒体服务帐户关联的存储帐户\r\n- 获取通知终结点\r\n- 创建用于监视的通知终结点。 \r\n\r\n    若要创建通知终结点，将 EndPointType 设置为 AzureTable (2) 并将 endPontAddress 设置为存储表（例如 https://telemetryvalidationstore.table.core.chinacloudapi.cn/）。\r\n\r\n- 获取监视配置\r\n\r\n    为要监视的服务创建监视配置设置。 最多允许一个监视配置设置。 \r\n\r\n- 添加监视配置\r\n\r\n## <a name=\"get-the-storage-account-associated-with-a-media-services-account\"></a>获取与媒体服务帐户关联的存储帐户\r\n\r\n###<a name=\"request\"></a>请求\r\n\r\n```\r\nGET https://wamsbjbclus001rest-hs.chinacloudapp.cn/API/StorageAccounts HTTP/1.1\r\nx-ms-version: 2.13\r\nDataServiceVersion: 3.0\r\nMaxDataServiceVersion: 3.0\r\nAccept: application/json; odata=verbose\r\nAuthorization: (redacted)\r\nHost: wamsbjbclus001rest-hs.chinacloudapp.cn\r\nResponse\r\nHTTP/1.1 200 OK\r\nCache-Control: no-cache\r\nContent-Length: 370\r\nContent-Type: application/json;odata=verbose;charset=utf-8\r\nServer: Microsoft-IIS/8.5\r\nrequest-id: 8206e222-2a59-482c-a6a9-de6b8bda57fb\r\nx-ms-request-id: 8206e222-2a59-482c-a6a9-de6b8bda57fb\r\nX-Content-Type-Options: nosniff\r\nDataServiceVersion: 2.0;\r\naccess-control-expose-headers: request-id, x-ms-request-id\r\nX-Powered-By: ASP.NET\r\nStrict-Transport-Security: max-age=31536000; includeSubDomains\r\nDate: Wed, 02 Dec 2015 05:10:40 GMT\r\n\r\n{\"d\":{\"results\":[{\"__metadata\":{\"id\":\"https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/StorageAccounts('telemetryvalidationstore')\",\"uri\":\"https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/StorageAccounts('telemetryvalidationstore')\",\"type\":\"Microsoft.Cloud.Media.Vod.Rest.Data.Models.StorageAccount\"},\"Name\":\"telemetryvalidationstore\",\"IsDefault\":true,\"BytesUsed\":null}]}}\r\n```\r\n\r\n## <a name=\"get-the-notification-endpoints\"></a>获取通知终结点\r\n\r\n###<a name=\"request\"></a>请求\r\n\r\n```\r\nGET https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/NotificationEndPoints HTTP/1.1\r\nx-ms-version: 2.13\r\nDataServiceVersion: 3.0\r\nMaxDataServiceVersion: 3.0\r\nAccept: application/json; odata=verbose\r\nAuthorization: (redacted)\r\nHost: wamsbjbclus001rest-hs.chinacloudapp.cn\r\n```\r\n\r\n###<a name=\"response\"></a>响应\r\n```\r\nHTTP/1.1 200 OK\r\nCache-Control: no-cache\r\nContent-Length: 20\r\nContent-Type: application/json;odata=verbose;charset=utf-8\r\nServer: Microsoft-IIS/8.5\r\nrequest-id: c68de2b3-0be1-4823-b622-6ca6f94a96b5\r\nx-ms-request-id: c68de2b3-0be1-4823-b622-6ca6f94a96b5\r\nX-Content-Type-Options: nosniff\r\nDataServiceVersion: 2.0;\r\naccess-control-expose-headers: request-id, x-ms-request-id\r\nX-Powered-By: ASP.NET\r\nStrict-Transport-Security: max-age=31536000; includeSubDomains\r\nDate: Wed, 02 Dec 2015 05:10:40 GMT\r\n\r\n{  \r\n       \"d\":{  \r\n          \"results\":[]\r\n       }\r\n}\r\n```\r\n\r\n## <a name=\"create-a-notification-endpoint-for-monitoring\"></a>创建用于监视的通知终结点\r\n\r\n###<a name=\"request\"></a>请求\r\n\r\n```\r\nPOST https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/NotificationEndPoints HTTP/1.1\r\nx-ms-version: 2.13\r\nDataServiceVersion: 3.0\r\nMaxDataServiceVersion: 3.0\r\nAccept: application/json; odata=verbose\r\nAuthorization: (redacted)\r\nContent-Type: application/json; charset=utf-8\r\nHost: wamsbjbclus001rest-hs.chinacloudapp.cn\r\nContent-Length: 115\r\n\r\n{  \r\n       \"Name\":\"monitoring\",\r\n       \"EndPointAddress\":\"https://telemetryvalidationstore.table.core.chinacloudapi.cn/\",\r\n       \"EndPointType\":2\r\n}\r\n```\r\n\r\n>[!NOTE]\r\n>请务必将“https://telemetryvalidationstore.table.core.chinacloudapi.cn”值更改为存储帐户。\r\n\r\n###<a name=\"response\"></a>响应\r\n\r\n```\r\nHTTP/1.1 201 Created\r\nCache-Control: no-cache\r\nContent-Length: 578\r\nContent-Type: application/json;odata=verbose;charset=utf-8\r\nLocation: https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/NotificationEndPoints('nb%3Anepid%3AUUID%3A76bb4faf-ea29-4815-840a-9a8e20102fc4')\r\nServer: Microsoft-IIS/8.5\r\nrequest-id: e8fa5a60-7d8b-4b00-a7ee-9b0f162fe0a9\r\nx-ms-request-id: e8fa5a60-7d8b-4b00-a7ee-9b0f162fe0a9\r\nX-Content-Type-Options: nosniff\r\nDataServiceVersion: 1.0;\r\naccess-control-expose-headers: request-id, x-ms-request-id\r\nX-Powered-By: ASP.NET\r\nStrict-Transport-Security: max-age=31536000; includeSubDomains\r\nDate: Wed, 02 Dec 2015 05:10:42 GMT\r\n\r\n{\"d\":{\"__metadata\":{\"id\":\"https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/NotificationEndPoints('nb%3Anepid%3AUUID%3A76bb4faf-ea29-4815-840a-9a8e20102fc4')\",\"uri\":\"https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/NotificationEndPoints('nb%3Anepid%3AUUID%3A76bb4faf-ea29-4815-840a-9a8e20102fc4')\",\"type\":\"Microsoft.Cloud.Media.Vod.Rest.Data.Models.NotificationEndPoint\"},\"Id\":\"nb:nepid:UUID:76bb4faf-ea29-4815-840a-9a8e20102fc4\",\"Name\":\"monitoring\",\"Created\":\"\\/Date(1449033042667)\\/\",\"EndPointAddress\":\"https://telemetryvalidationstore.table.core.chinacloudapi.cn/\",\"EndPointType\":2}}\r\n```\r\n\r\n## <a name=\"get-the-monitoring-configurations\"></a>获取监视配置\r\n\r\n### <a name=\"request\"></a>请求\r\n\r\n```\r\nGET https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/MonitoringConfigurations HTTP/1.1\r\nx-ms-version: 2.13\r\nDataServiceVersion: 3.0\r\nMaxDataServiceVersion: 3.0\r\nAccept: application/json; odata=verbose\r\nAuthorization: (redacted)\r\nHost: wamsbjbclus001rest-hs.chinacloudapp.cn\r\n```\r\n\r\n###<a name=\"response\"></a>响应\r\n\r\n```\r\nHTTP/1.1 200 OK\r\nCache-Control: no-cache\r\nContent-Length: 20\r\nContent-Type: application/json;odata=verbose;charset=utf-8\r\nServer: Microsoft-IIS/8.5\r\nrequest-id: 00a3ee37-bb19-4fca-b5c7-a92b629d4416\r\nx-ms-request-id: 00a3ee37-bb19-4fca-b5c7-a92b629d4416\r\nX-Content-Type-Options: nosniff\r\nDataServiceVersion: 3.0;\r\naccess-control-expose-headers: request-id, x-ms-request-id\r\nX-Powered-By: ASP.NET\r\nStrict-Transport-Security: max-age=31536000; includeSubDomains\r\nDate: Wed, 02 Dec 2015 05:10:42 GMT\r\n\r\n{\"d\":{\"results\":[]}}\r\n```\r\n\r\n## <a name=\"add-a-monitoring-configuration\"></a>添加监视配置\r\n\r\n### <a name=\"request\"></a>请求\r\n\r\n```\r\nPOST https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/MonitoringConfigurations HTTP/1.1\r\nx-ms-version: 2.13\r\nDataServiceVersion: 3.0\r\nMaxDataServiceVersion: 3.0\r\nAccept: application/json; odata=verbose\r\nAuthorization: (redacted)\r\nContent-Type: application/json; charset=utf-8\r\nHost: wamsbjbclus001rest-hs.chinacloudapp.cn\r\nContent-Length: 133\r\n\r\n{  \r\n   \"NotificationEndPointId\":\"nb:nepid:UUID:76bb4faf-ea29-4815-840a-9a8e20102fc4\",\r\n   \"Settings\":[  \r\n      {  \r\n     \"Component\":\"Channel\",\r\n     \"Level\":\"Normal\"\r\n      }\r\n   ]\r\n}\r\n```\r\n\r\n### <a name=\"response\"></a>响应\r\n\r\n```\r\nHTTP/1.1 201 Created\r\nCache-Control: no-cache\r\nContent-Length: 825\r\nContent-Type: application/json;odata=verbose;charset=utf-8\r\nLocation: https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/MonitoringConfigurations('nb%3Amcid%3AUUID%3A1a8931ae-799f-45fd-8aeb-9641740295c2')\r\nServer: Microsoft-IIS/8.5\r\nrequest-id: daede9cb-8684-41b0-a921-a3af66430cbe\r\nx-ms-request-id: daede9cb-8684-41b0-a921-a3af66430cbe\r\nX-Content-Type-Options: nosniff\r\nDataServiceVersion: 3.0;\r\naccess-control-expose-headers: request-id, x-ms-request-id\r\nX-Powered-By: ASP.NET\r\nStrict-Transport-Security: max-age=31536000; includeSubDomains\r\nDate: Wed, 02 Dec 2015 05:10:43 GMT\r\n\r\n{\"d\":{\"__metadata\":{\"id\":\"https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/MonitoringConfigurations('nb%3Amcid%3AUUID%3A1a8931ae-799f-45fd-8aeb-9641740295c2')\",\"uri\":\"https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/MonitoringConfigurations('nb%3Amcid%3AUUID%3A1a8931ae-799f-45fd-8aeb-9641740295c2')\",\"type\":\"Microsoft.Cloud.Media.Vod.Rest.Data.Models.MonitoringConfiguration\"},\"Id\":\"nb:mcid:UUID:1a8931ae-799f-45fd-8aeb-9641740295c2\",\"NotificationEndPointId\":\"nb:nepid:UUID:76bb4faf-ea29-4815-840a-9a8e20102fc4\",\"Created\":\"2015-12-02T05:10:43.7680396Z\",\"LastModified\":\"2015-12-02T05:10:43.7680396Z\",\"Settings\":{\"__metadata\":{\"type\":\"Collection(Microsoft.Cloud.Media.Vod.Rest.Data.Models.ComponentMonitoringSettings)\"},\"results\":[{\"Component\":\"Channel\",\"Level\":\"Normal\"},{\"Component\":\"StreamingEndpoint\",\"Level\":\"Disabled\"}]}}}\r\n```\r\n\r\n## <a name=\"stop-telemetry\"></a>停止遥测\r\n\r\n###<a name=\"request\"></a>请求\r\n\r\n```\r\nDELETE https://wamsbjbclus001rest-hs.chinacloudapp.cn/api/MonitoringConfigurations('nb%3Amcid%3AUUID%3A1a8931ae-799f-45fd-8aeb-9641740295c2')\r\nx-ms-version: 2.13\r\nDataServiceVersion: 3.0\r\nMaxDataServiceVersion: 3.0\r\nAccept: application/json; odata=verbose\r\nAuthorization: (redacted)\r\nContent-Type: application/json; charset=utf-8\r\nHost: wamsbjbclus001rest-hs.chinacloudapp.cn\r\n```\r\n## <a name=\"consuming-telemetry-information\"></a>使用遥测信息\r\n\r\n有关使用遥测信息的信息，请参阅 [此主题](media-services-telemetry-overview.md)。\r\n\r\n"}