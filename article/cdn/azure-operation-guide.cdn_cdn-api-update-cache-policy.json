{"Title":"Azure China CDN API doc-update cache policy","Description":"Learn How to create Live Streaming acceleration type CDN on Azure Management Portal and default caching rules for Live Streaming CDN","Content":"\r\n# 节点管理-设置缓存规则\r\n\r\n> [!div class=\"op_single_selector\"]\r\n> * [中文](https://docs.azure.cn/zh-cn/cdn/cdn-api-update-cache-policy)\r\n> * [英文](https://docs.azure.cn/en-us/cdn/cdn-api-update-cache-policy)\r\n\r\n通过该API可以针对目录，文件名和全路径配置缓存规则。\r\n\r\n* 根据目录进行配置：目录必须以 \"/\" 开头，比如： \"/pic\", \"/doc\", \"/htdoc/data\" 等等。后台会匹配指定目录下的所有文件，包括子目录*\r\n* 根据文件后缀配置：常用文件后缀名，比如：\"jpg\", \"png\", \"gif\", \"txt\", \"m4v\", \"mp3\" 等等。后台会匹配 所有文件夹下 指定的文件后缀。\r\n* 根据全路径配置：用来指定 一个文件，必须以 \"/\" 开头。比如：\"/sites/doc/example.doc\"。注意：如果用户填的全路径是\"/\"，则它匹配首页。\r\n\r\n>注意 用户填写配置规则时，字符串中不要包含 “{”, “}”, “(”, “)”, “[”, “]”, “.”, “?\", “*”, “\\”, “^”, “$” 等特殊字符。\r\n\r\n>注意 **时间填为0表示禁止缓存，不缓存规则优先执行。**\r\n\r\n## 请求\r\n<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\r\n  <th align=\"left\"><strong>方法</strong>\r\n    </td>\r\n  <th align=\"left\"><strong>请求 URI</strong>\r\n    </td>  \r\n  <tr>\r\n    <td>PUT</td>\r\n    <td>https://restapi.cdn.azure.cn/subscriptions/{subscriptionId}/endpoints/{endpointId}/cacherules?apiVersion=1.0</td>\r\n  </tr>\r\n</table>\r\n\r\n### URI参数\r\n<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\r\n  <th align=\"left\"><strong>参数名</strong>\r\n    </td>\r\n  <th align=\"left\"><strong>描述</strong>\r\n    </td>  \r\n  <tr>\r\n    <td>subscriptionId</td>\r\n    <td>订阅唯一标识</td>\r\n  </tr\r\n  <tr>\r\n    <td>endpointId</td>\r\n    <td>目标节点唯一标识</td>\r\n  </tr>\r\n</table>\r\n\r\n### 请求 Headers\r\n\r\n| 请求包头 | 描述 |\r\n|:-----------|:-----------|\r\n| x-azurecdn-request-date | 必填。符合yyyy-MM-dd hh:mm:ss格式的UTC当前请求时间 |\r\n| Authorization | 必填。授权头请参考[CDN API签名机制](./cdn-api-signature.md) |\r\n| content-type | 必填。application/json |\r\n\r\n### 请求 Body\r\n```\r\n{\r\n  \"Rules\": [\r\n    {\r\n      \"Type\": \"Dir\",\r\n      \"Items\": [\r\n        \"/test1/\",\r\n        \"/test2/\"\r\n      ],\r\n      \"TTL\": 86400\r\n    },\r\n    {\r\n      \"Type\": \"Suffix\",\r\n      \"Items\": [\r\n        \"7z\",\r\n        \"apk\",\r\n        \"wdf\",\r\n        \"cab\"\r\n      ],\r\n      \"TTL\": 2592000\r\n    },\r\n    {\r\n      \"Type\": \"FullUri\",\r\n      \"Items\": [\r\n        \"/test1/test.xml\",\r\n        \"/test2/test.txt\"\r\n      ],\r\n      \"TTL\": 86400\r\n    },\r\n  ],\r\n  \"IgnoreCacheControl\": false,\r\n  \"IgnoreCookie\": false,\r\n  \"IgnoreQueryString\": false\r\n}\r\n```\r\n<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\r\n  <th align=\"left\"><strong>参数名称</strong>\r\n    </td>\r\n  <th align=\"left\"><strong>描述</strong>\r\n    </td>\r\n  <tr>\r\n    <td>TTL</td>\r\n    <td>缓存时间,单位为秒</td>\r\n  </tr>\r\n  <tr>\r\n    <td>IgnoreCacheControl</td>\r\n    <td>是否忽略返回头中的cache-control头部对请求内容进行缓存\r\n    </td>\r\n  </tr>\r\n  <tr>\r\n    <td>IgnoreCookie</td>\r\n    <td>是否忽略返回头中的set-cookie头部对请求内容进行缓存\r\n    </td>\r\n  </tr>\r\n  <tr>\r\n    <td>IgnoreQueryString</td>\r\n    <td>是否忽略查询参数对请求内容进行缓存\r\n    </td>\r\n  </tr>\r\n  <tr>\r\n    <td>Type</td>\r\n    <td>缓存规则类型。\r\n        <ul>\r\n         <li>Suffix: 基于文件拓展名进行缓存</li>\r\n         <li>Dir: 对指定目录下的所有文件进行缓存</li>\r\n         <li>FullUri: 对指定路径的文件进行缓存</li>\r\n        </ul>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n## 响应\r\n\r\n响应由状态码，响应 headers以及响应 body组成。\r\n### 状态码\r\n<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\r\n  <th align=\"left\"><strong>状态码</strong>\r\n    </td>\r\n  <th align=\"left\"><strong>描述</strong>\r\n    </td>\r\n  <tr>\r\n    <td>202</td>\r\n    <td>表明服务器成功接受请求</td>\r\n  </tr>\r\n  <tr>\r\n    <td>其他</td>\r\n    <td>表示出错的通用回复</td>\r\n  </tr>\r\n</table>\r\n\r\n### 响应 Headers\r\n\r\n<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\r\n  <th align=\"left\"><strong>响应包头</strong>\r\n    </th>\r\n  <th align=\"left\"><strong>描述</strong>\r\n    </th>\r\n\r\n  <tr>\r\n    <td>X-Correlation-Id</td>\r\n    <td>该请求唯一标识，用于追踪请求信息。</td>\r\n  </tr>\r\n</table>\r\n\r\n### 响应 Body\r\n**请求成功的JSON示例**:\r\n\r\n```\r\n{\r\n  \"Succeeded\": true,\r\n  \"IsAsync\": true,\r\n  \"AsyncInfo\": {\r\n    \"TaskTrackId\": \"b520c544-ec34-4ac4-86f5-5394363919c3\",\r\n    \"TaskStatus\": \"Processing\"\r\n  }\r\n}\r\n```\r\n<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\r\n  <th align=\"left\"><strong>参数名称</strong>\r\n    </td>\r\n  <th align=\"left\"><strong>描述</strong>\r\n    </td>\r\n\r\n  <tr>\r\n    <td>TaskTrackId</td>\r\n    <td>操作唯一标识，可用于查询进度</td>\r\n  </tr>\r\n  <tr>\r\n    <td>TaskStatus</td>\r\n    <td>任务状态。\r\n        <ul>\r\n         <li>NotSet: 状态未知</li>\r\n         <li>Processing: 正在处理</li>\r\n         <li>Succeeded: 成功</li>\r\n         <li>Failed: 失败</li>\r\n        </ul>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n**请求失败的JSON示例**:\r\n```\r\n{\r\n  \"Succeeded\": false,\r\n  \"ErrorInfo\": {\r\n    \"Type\": \"MissingAuthorizationHeader\",\r\n    \"Message\": \"Missing authorization header.\"\r\n  }\r\n}\r\n```\r\n<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\r\n  <th align=\"left\"><strong>参数名称</strong>\r\n    </td>\r\n  <th align=\"left\"><strong>描述</strong>\r\n    </td>\r\n\r\n  <tr>\r\n    <td>Type</td>\r\n    <td>错误类型\r\n         <ul>\r\n            <li>CredentialInvalid:凭据不合法</li>\r\n            <li>ParameterMissing:缺少参数</li>\r\n            <li>ParameterInvalid：参数不合法</li>\r\n            <li>MissingAuthorizationHeader:缺少Authorization请求头</li>\r\n            <li>InvalidRequestDateHeader:请求时间不合法</li>\r\n            <li>MissingRequestDateHeader：缺少请求时间头</li>\r\n            <li>AuthorizationHeaderExpired:Authorization请求头已失效</li>\r\n            <li>InvalidAuthorizationHeader:Authorization请求头不合法</li>\r\n            <li>ApiKeyNotFound：API密钥不存在</li>\r\n            <li>InvalidApiKey:API密钥不合法</li>\r\n            <li>WrongSignature:签名不对</li>\r\n            <li>SubscriptionNotFound：订阅不存在</li>\r\n            <li>EndpointDoesNotBelongToSubscription：节点不属于订阅</li>\r\n            <li>EndpointNotInActiveState：节点不处于活跃状态</li>\r\n            <li>EndpointNotFound：节点不存在</li>\r\n            <li>MaliciousItemPathDetected：检查到恶意路径</li>\r\n            <li>PermissionDenied：权限不够</li>\r\n            <li>RequestThrottled：请求被限流</li>\r\n         </ul>    \r\n    </td>\r\n  </tr>\r\n  <tr>\r\n    <td>Message</td>\r\n    <td>错误信息</td>\r\n  </tr>\r\n</table>"}