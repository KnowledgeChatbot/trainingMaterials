{"Title":"自定义 Azure 应用程序网关的 Web 应用程序防火墙规则 - PowerShell","Description":"此页提供有关如何使用 PowerShell 自定义应用程序网关的 Web 应用程序防火墙规则的信息。","Content":"# <a name=\"customize-web-application-firewall-rules-through-powershell\"></a>通过 PowerShell 自定义 Web 应用程序防火墙规则\r\n\r\n> [!div class=\"op_single_selector\"]\r\n> * [Azure 门户](application-gateway-customize-waf-rules-portal.md)\r\n> * [PowerShell](application-gateway-customize-waf-rules-powershell.md)\r\n> * [Azure CLI 2.0](application-gateway-customize-waf-rules-cli.md)\r\n\r\n应用程序网关 Web 应用程序防火墙可为 Web 应用程序提供保护。 这些保护由 OWASP CRS 规则集提供。 某些规则可能会导致误报，并会阻止实际流量。  出于此原因，应用程序网关在启用了 Web 应用程序防火墙的应用程序网关上提供自定义规则组和规则的功能。 有关特定规则组和规则的详细信息，请访问 [Web 应用程序防火墙 CRS 规则组和规则](application-gateway-crs-rulegroups-rules.md)\r\n\r\n## <a name=\"view-rule-groups-and-rules\"></a>查看规则组和规则\r\n\r\n以下示例演示如何查看可在启用了 WAF 的应用程序网关上配置的规则和规则组。\r\n\r\n### <a name=\"view-rule-groups\"></a>查看规则组\r\n\r\n```powershell\r\nGet-AzureRmApplicationGatewayAvailableWafRuleSets\r\n```\r\n\r\n下面是截取自前一示例的响应。\r\n\r\n```\r\nOWASP (Ver. 3.0):\r\n\r\n    REQUEST-910-IP-REPUTATION:\r\n        Description:\r\n            \r\n        Rules:\r\n            RuleId     Description\r\n            ------     -----------\r\n            910011     Rule 910011\r\n            910012     Rule 910012\r\n            ...        ...\r\n\r\n    REQUEST-911-METHOD-ENFORCEMENT:\r\n        Description:\r\n            \r\n        Rules:\r\n            RuleId     Description\r\n            ------     -----------\r\n            911011     Rule 911011\r\n            ...        ...\r\n\r\nOWASP (Ver. 2.2.9):\r\n\r\n    crs_20_protocol_violations:\r\n        Description:\r\n            \r\n        Rules:\r\n            RuleId     Description\r\n            ------     -----------\r\n            960911     Invalid HTTP Request Line\r\n            981227     Apache Error: Invalid URI in Request.\r\n            960000     Attempted multipart/form-data bypass\r\n            ...        ...\r\n```\r\n\r\n## <a name=\"disable-rules\"></a>禁用规则\r\n\r\n以下示例在应用程序网关上禁用规则 `910018` 和 `910017`。\r\n\r\n```azurecli\r\naz network application-gateway waf-config set --resource-group AdatumAppGatewayRG --gateway-name AdatumAppGateway --enabled true --rule-set-version 3.0 --disabled-rules 910018 910017\r\n```\r\n\r\n## <a name=\"next-steps\"></a>后续步骤\r\n\r\n配置已禁用的规则后，可通过访问[应用程序网关诊断](application-gateway-diagnostics.md#diagnostic-logs)来了解如何查看 WAF 日志\r\n\r\n[fig1]: ./media/application-gateway-customize-waf-rules-portal/1.png\r\n[1]: ./media/application-gateway-customize-waf-rules-portal/figure1.png\r\n[2]: ./media/application-gateway-customize-waf-rules-portal/figure2.png\r\n[3]: ./media/application-gateway-customize-waf-rules-portal/figure3.png\r\n\r\n"}