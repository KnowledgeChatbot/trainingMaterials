{"Title":"使用 REST API 和模板部署资源","Description":"使用 Azure Resource Manager 和 Resource Manager REST API 将资源部署到 Azure。 资源在 Resource Manager 模板中定义。","Content":"# <a name=\"deploy-resources-with-resource-manager-templates-and-resource-manager-rest-api\"></a>使用 Resource Manager 模板和 Resource Manager REST API 部署资源\r\n> [!div class=\"op_single_selector\"]\r\n> * [PowerShell](resource-group-template-deploy.md)\r\n> * [Azure CLI](resource-group-template-deploy-cli.md)\r\n> * [门户](resource-group-template-deploy-portal.md)\r\n> * [REST API](resource-group-template-deploy-rest.md)\r\n> \r\n> \r\n\r\n本文介绍如何将 Resource Manager REST API 与 Resource Manager 模板配合使用向 Azure 部署资源。  \r\n\r\n> [!TIP]\r\n> 有关在部署过程中调试错误的帮助，请参阅：\r\n> \r\n> * [查看部署操作](resource-manager-deployment-operations.md)，了解如何获取有助于排查错误的信息\r\n> * [排查使用 Azure 资源管理器将资源部署到 Azure 时的常见错误](resource-manager-common-deployment-errors.md)，了解如何解决常见部署错误\r\n> \r\n> \r\n\r\n模板可以是本地文件或是可通过 URI 访问的外部文件。 如果模板驻留在存储帐户中，可以限制对该模板的访问，并在部署过程中提供共享访问签名 (SAS) 令牌。\r\n\r\n[!INCLUDE [resource-manager-deployments](../../includes/resource-manager-deployments.md)]\r\n\r\n## <a name=\"deploy-with-the-rest-api\"></a>使用 REST API 进行部署\r\n1. 设置 [常见参数和标头](https://docs.microsoft.com/rest/api/index)，包括身份验证令牌。\r\n2. 如果目前没有资源组，请创建资源组。 提供订阅 ID、新资源组的名称，以及解决方案所需的位置。 有关详细信息，请参阅 [创建资源组](https://docs.microsoft.com/rest/api/resources/resourcegroups#ResourceGroups_CreateOrUpdate)。\r\n\r\n        PUT https://management.chinacloudapi.cn/subscriptions/<YourSubscriptionId>/resourcegroups/<YourResourceGroupName>?api-version=2015-01-01\r\n            <common headers>\r\n            {\r\n                \"location\": \"China North\",\r\n                \"tags\": {\r\n                    \"tagname1\": \"tagvalue1\"\r\n                }\r\n            }\r\n3. 在执行部署之前，通过运行[验证模板部署](https://docs.microsoft.com/rest/api/resources/deployments#Deployments_Validate)操作来验证部署。 测试部署时，请提供与执行部署时所提供的完全相同的参数（如下一步中所示）。\r\n4. 创建部署。 提供订阅 ID、资源组的名称、部署的名称以及模板的链接。 有关模板文件的信息，请参阅[参数文件](#parameter-file)。 有关使用 REST API 创建资源组的详细信息，请参阅[创建模板部署](https://docs.microsoft.com/rest/api/resources/deployments#Deployments_CreateOrUpdate)。 请注意，**mode** 设置为 **Incremental**。 要运行完整部署，请将 **mode** 设置为 **Complete**。 使用完整模式时要小心，因为可能会无意中删除不在模板中的资源。\r\n\r\n        PUT https://management.chinacloudapi.cn/subscriptions/<YourSubscriptionId>/resourcegroups/<YourResourceGroupName>/providers/Microsoft.Resources/deployments/<YourDeploymentName>?api-version=2015-01-01\r\n            <common headers>\r\n            {\r\n                \"properties\": {\r\n                    \"templateLink\": {\r\n                        \"uri\": \"http://mystorageaccount.blob.core.chinacloudapi.cn/templates/template.json\",\r\n                        \"contentVersion\": \"1.0.0.0\"\r\n                    },\r\n                    \"mode\": \"Incremental\",\r\n                    \"parametersLink\": {\r\n                        \"uri\": \"http://mystorageaccount.blob.core.chinacloudapi.cn/templates/parameters.json\",\r\n                        \"contentVersion\": \"1.0.0.0\"\r\n                    }\r\n                }\r\n            }\r\n\r\n    如果想要记录响应内容或/和请求内容，请在请求中包括 **debugSetting**。\r\n\r\n        \"debugSetting\": {\r\n          \"detailLevel\": \"requestContent, responseContent\"\r\n        }\r\n   \r\n    可以将存储帐户设置为使用共享访问签名 (SAS) 令牌。 有关详细信息，请参阅[使用共享访问签名委托访问权限](https://docs.microsoft.com/rest/api/storageservices/delegating-access-with-a-shared-access-signature)。\r\n5. 获取模板部署的状态。 有关详细信息，请参阅 [获取有关模板部署的信息](https://docs.microsoft.com/rest/api/resources/deployments#Deployments_Get)。\r\n\r\n        GET https://management.chinacloudapi.cn/subscriptions/<YourSubscriptionId>/resourcegroups/<YourResourceGroupName>/providers/Microsoft.Resources/deployments/<YourDeploymentName>?api-version=2015-01-01\r\n            <common headers>\r\n\r\n## <a name=\"parameter-file\"></a>参数文件\r\n\r\n[!INCLUDE [resource-manager-parameter-file](../../includes/resource-manager-parameter-file.md)]\r\n\r\n## <a name=\"next-steps\"></a>后续步骤\r\n* 若要了解如何处理异步 REST 操作，请参阅[跟踪异步 Azure 操作](resource-manager-async-operations.md)。\r\n* 有关通过 .NET 客户端库部署资源的示例，请参阅[使用 .NET 库和模板部署资源](../virtual-machines/windows/csharp-template.md?toc=%2fvirtual-machines%2fwindows%2ftoc.json)。\r\n* 若要在模板中定义参数，请参阅[创作模板](resource-group-authoring-templates.md#parameters)。\r\n<!-- Redirect URL Not available (solution-dev-test-environments.md).-->\r\n* 有关企业可如何使用 Resource Manager 有效管理订阅的指南，请参阅 [Azure 企业基架 - 出于合规目的监管订阅](resource-manager-subscription-governance.md)。\r\n\r\n<!--Update_Description: update link-->"}