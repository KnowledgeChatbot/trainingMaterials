{"Title":"使用 SAS 令牌和 Azure CLI 部署 Azure 模板","Description":"使用 Azure Resource Manager 和 Azure CLI 从使用 SAS 令牌保护的模板将资源部署到 Azure。","Content":"# <a name=\"deploy-private-resource-manager-template-with-sas-token-and-azure-cli\"></a>使用 SAS 令牌和 Azure CLI 部署专用 Resource Manager 模板\r\n\r\n如果模板驻留在存储帐户中，你可以限制对该模板的访问，并在部署过程中提供共享访问签名 (SAS) 令牌。 本主题介绍如何将 Azure PowerShell 与 Resource Manager 模板配合使用在部署过程中提供 SAS 令牌。 \r\n\r\n## <a name=\"add-private-template-to-storage-account\"></a>将专用模板添加到存储帐户\r\n\r\n可以将模板添加到存储帐户，并在部署过程中使用 SAS 令牌链接到这些模板。\r\n\r\n> [!IMPORTANT]\r\n> 通过执行以下步骤，只有帐户所有者可以访问包含模板的 blob。 但是，如果为 blob 创建 SAS 令牌，则拥有该 URI 的任何人都可以访问 blob。 如果其他用户截获了该 URI，则此用户可以访问该模板。 使用 SAS 令牌是限制对模板的访问的好方法，但不应直接在模板中包括密码等敏感数据。\r\n> \r\n> \r\n\r\n以下示例设置专用存储帐户容器并上传模板：\r\n\r\n```azurecli\r\naz group create --name \"ManageGroup\" --location \"China East\"\r\naz storage account create \\\r\n    --resource-group ManageGroup \\\r\n    --location \"China East\" \\\r\n    --sku Standard_LRS \\\r\n    --kind Storage \\\r\n    --name {your-unique-name}\r\nconnection=$(az storage account show-connection-string \\\r\n    --resource-group ManageGroup \\\r\n    --name {your-unique-name} \\\r\n    --query connectionString)\r\naz storage container create \\\r\n    --name templates \\\r\n    --public-access Off \\\r\n    --connection-string $connection\r\naz storage blob upload \\\r\n    --container-name templates \\\r\n    --file vmlinux.json \\\r\n    --name vmlinux.json \\\r\n    --connection-string $connection\r\n```\r\n\r\n### <a name=\"provide-sas-token-during-deployment\"></a>在部署期间提供 SAS 令牌\r\n若要在存储帐户中部署专用模板，请生成 SAS 令牌，并将其包括在模板的 URI 中。 设置到期时间以允许足够的时间来完成部署。\r\n\r\n```azurecli\r\nexpiretime=$(date -u -d '30 minutes' +%Y-%m-%dT%H:%MZ)\r\nconnection=$(az storage account show-connection-string \\\r\n    --resource-group ManageGroup \\\r\n    --name {your-unique-name} \\\r\n    --query connectionString)\r\ntoken=$(az storage blob generate-sas \\\r\n    --container-name templates \\\r\n    --name vmlinux.json \\\r\n    --expiry $expiretime \\\r\n    --permissions r \\\r\n    --output tsv \\\r\n    --connection-string $connection)\r\nurl=$(az storage blob url \\\r\n    --container-name templates \\\r\n    --name vmlinux.json \\\r\n    --output tsv \\\r\n    --connection-string $connection)\r\naz group deployment create --resource-group ExampleGroup --template-uri $url?$token\r\n```\r\n\r\n有关将 SAS 令牌与链接模板配合使用的示例，请参阅[将已链接的模版与 Azure Resource Manager 配合使用](resource-group-linked-templates.md)。\r\n\r\n## <a name=\"next-steps\"></a>后续步骤\r\n* 有关部署模板的简介，请参阅[使用 Resource Manager 模板和 Azure PowerShell 部署资源](resource-group-template-deploy-cli.md)。\r\n* 有关用于部署模板的完整示例脚本，请参阅[部署 Resource Manager 模板脚本](resource-manager-samples-cli-deploy.md)\r\n* 若要在模板中定义参数，请参阅[创作模板](resource-group-authoring-templates.md#parameters)。\r\n* 有关企业可如何使用 Resource Manager 有效管理订阅的指南，请参阅 [Azure 企业基架 - 出于合规目的监管订阅](resource-manager-subscription-governance.md)。"}