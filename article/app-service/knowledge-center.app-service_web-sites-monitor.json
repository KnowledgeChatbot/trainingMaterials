{"Title":"在 Azure 应用服务中监视应用","Description":"了解如何使用 Azure 门户在 Azure 应用服务中监视应用。","Content":"# <a name=\"how-to-monitor-apps-in-azure-app-service\"></a>如何：在 Azure 应用服务中监视 Web 应用\r\n[应用服务](app-service-web-overview.md)在 [Azure 门户](https://portal.azure.cn)中提供了内置监视功能。\r\n还能查看应用的**配额**和**度量值**以及应用服务计划、设置**警报**，甚至基于这些度量值自动**缩放**。\r\n\r\n[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]\r\n\r\n## <a name=\"understanding-quotas-and-metrics\"></a>了解配额和度量值\r\n### <a name=\"quotas\"></a>配额\r\n对于托管在应用服务中的应用程序，其可用资源受到某些 *限制* 。 限制由与应用关联的**应用服务计划**定义。\r\n\r\n如果应用程序托管在**免费**或**共享**计划中，则该应用可用资源的限制由**配额**定义。\r\n\r\n如果应用程序托管在**基本**、**标准**或**高级**计划中，则该应用可用资源的限制由**应用服务计划**的**大小**（小、中、大）和**实例计数**（1、2、3...）设置。\r\n\r\n**免费**或**共享**应用的**配额**如下：\r\n\r\n* **CPU（短期）**\r\n  * 5 分钟内允许此应用程序使用的 CPU 量。 此配额每 5 分钟重置。\r\n* **CPU（天）**\r\n  * 1 天内允许此应用程序使用的 CPU 总量。 此配额每隔 24 小时在 UTC 午夜时间重置。\r\n* **内存**\r\n  * 允许此应用程序具有的内存总量。\r\n* **带宽**\r\n  * 1 天内允许此应用程序传出的带宽总量。\r\n    此配额每隔 24 小时在 UTC 午夜时间重置。\r\n* **Filesystem**\r\n  * 允许的存储空间总量。\r\n\r\n适用于托管在**基本**、**标准**和**高级**计划中的应用的唯一配额是**文件系统**。\r\n\r\n#### <a name=\"quota-enforcement\"></a>配额强制执行\r\n如果应用程序的使用量超过 **CPU（短期）**、**CPU（天）**或**带宽**配额，则将终止该应用程序，直到配额重置。 在此期间，所有传入请求都将导致 **HTTP 403**。\r\n![][http403]\r\n\r\n如果超过应用程序**内存**配额，则将重启该应用程序。\r\n\r\n如果超过**文件系统**配额，则任何写入操作都会失败，包括写入日志。\r\n\r\n可通过升级应用服务计划从应用中增加或删除配额。\r\n\r\n### <a name=\"metrics\"></a>度量值\r\n**度量值** 提供有关应用或应用服务计划行为的信息。\r\n\r\n对于 **应用程序**，可用度量值为：\r\n\r\n* **平均响应时间**\r\n  * 应用处理请求的平均时间（以毫秒为单位）。\r\n* **平均内存工作集**\r\n  * 应用使用的平均内存量（以 MiB 为单位）。\r\n* **CPU 时间**\r\n  * 应用使用的 CPU 量（以秒为单位）。 有关此指标的详细信息，请参阅：[CPU 时间与 CPU 百分比](#cpu-time-vs-cpu-percentage)\r\n* **数据输入**\r\n  * 应用使用的传入带宽量（以 MiB 为单位）。\r\n* **数据输出**\r\n  * 应用使用的传出带宽量（以 MiB 为单位）。\r\n* **Http 2xx**\r\n  * 导致 HTTP 状态代码的请求计数大于等于 200，但小于 300。\r\n* **Http 3xx**\r\n  * 导致 HTTP 状态代码的请求计数大于等于 300，但小于 400。\r\n* **Http 401**\r\n  * 导致 HTTP 401 状态代码的请求计数。\r\n* **Http 403**\r\n  * 导致 HTTP 403 状态代码的请求计数。\r\n* **Http 404**\r\n  * 导致 HTTP 404 状态代码的请求计数。\r\n* **Http 406**\r\n  * 导致 HTTP 406 状态代码的请求计数。\r\n* **Http 4xx**\r\n  * 导致 HTTP 状态代码的请求计数大于等于 400，但小于 500。\r\n* **Http 服务器错误**\r\n  * 导致 HTTP 状态代码的请求计数大于等于 500，但小于 600。\r\n* **内存工作集**\r\n  * 应用当前使用的内存量（以 MiB 为单位）。\r\n* **请求**\r\n  * 请求总数（不考虑是否导致 HTTP 状态代码）。\r\n\r\n对于**应用服务计划**，可用度量值为：\r\n\r\n> [!NOTE]\r\n> 应用服务计划指标仅适用于**基本**、**标准**和**高级**层中的计划。\r\n> \r\n> \r\n\r\n* **CPU 百分比**\r\n  * 计划的所有实例使用的平均 CPU 量。\r\n* **内存百分比**\r\n  * 计划的所有实例使用的平均内存量。\r\n* **数据输入**\r\n  * 计划的所有实例使用的平均输入带宽量。\r\n* **数据输出**\r\n  * 计划的所有实例使用的平均输出带宽量。\r\n* **磁盘队列长度**\r\n  * 在存储上排队的读取和写入请求的平均数量。 过高的磁盘队列长度表示应用程序可能由于磁盘 I/O 过多而速度变慢。\r\n* **Http 队列长度**\r\n  * 必须在队列排满之前排入队列中的 HTTP 请求的平均数量。 较高或不断增长的 HTTP 队列长度表示计划处于高负载状态。\r\n\r\n### <a name=\"cpu-time-vs-cpu-percentage\"></a>CPU 时间和 CPU 百分比\r\n<!-- To do: Fix Anchor (#CPU-time-vs.-CPU-percentage) -->\r\n\r\n有两个反映 CPU 使用率的指标。 **CPU 时间**和 **CPU 百分比**\r\n\r\n**CPU 时间**对托管在**免费**或**共享**计划中的应用很有用，因为这些应用的其中一个配额由应用所用的 CPU 时间定义。\r\n\r\n**CPU 百分比**对托管在**基本**、**标准**和**高级**计划中的应用很有用，因为这些应用可以按比例扩大，并且该指标能很好反映所有实例的总体使用情况。\r\n\r\n## <a name=\"metrics-granularity-and-retention-policy\"></a>度量值粒度和保留策略\r\n应用程序和应用服务计划的度量值由具有下列粒度和保留策略的服务进行记录和聚合：\r\n\r\n* **分钟**粒度级的度量值将保留 **48 小时**\r\n* **小时**粒度级的度量值将保留 **30 天**\r\n* **天**粒度级的度量值将保留 **90 天**\r\n\r\n## <a name=\"monitoring-quotas-and-metrics-in-the-azure-portal\"></a>在 Azure 门户中监视配额和度量值。\r\n可以在 [Azure 门户](https://portal.azure.cn)中查看影响应用程序的各种**配额**和**指标**。\r\n\r\n可以在“设置”>“配额”下找到![][quotas]\r\n**配额**。 在 UX 中可以查看：(1) 配额名称、(2) 配额重置时间间隔、(3) 配额当前限制和 (4) 当前值。\r\n\r\n可以直接从资源页访问![][metrics]\r\n**指标**。 还可以通过以下操作自定义图表：(1) **单击**图表，并选择 (2)“编辑图表”。\r\n可在此处更改要显示的 (3) **时间范围**、(4) **图表类型**和 (5) **度量值**。  \r\n\r\n可以在此处了解有关度量值的详细信息：[监视服务度量值](../monitoring-and-diagnostics/insights-how-to-customize-monitoring.md)。\r\n\r\n## <a name=\"alerts-and-autoscale\"></a>警报和自动缩放\r\n可将应用或应用服务计划的指标挂接到警报。 有关详细信息，请参阅[接收警报通知](../monitoring-and-diagnostics/insights-alerts-portal.md)。\r\n\r\n托管在基本、标准或高级应用服务计划中的应用服务应用支持**自动缩放**。 这样便可以配置监视应用服务计划度量值的规则，还能增加或减少根据需要提供其他资源或在过度预配时节约资金的实例计数。 可以在此处详细了解自动缩放：[如何缩放](../monitoring-and-diagnostics/insights-how-to-scale.md)。\r\n\r\n\r\n## <a name=\"whats-changed\"></a>发生的更改\r\n* 有关从网站更改为应用服务的指南，请参阅 [Azure 应用服务及其对现有 Azure 服务的影响](./app-service-web-overview.md)\r\n\r\n[fzilla]:http://go.microsoft.com/fwlink/?LinkId=247914\r\n[vmsizes]:/cloud-services/cloud-services-sizes-specs\r\n\r\n<!-- Images. -->\r\n[http403]: ./media/web-sites-monitor/http403.png\r\n[quotas]: ./media/web-sites-monitor/quotas.png\r\n[metrics]: ./media/web-sites-monitor/metrics.png\r\n\r\n<!--Update_Description: wording update-->"}