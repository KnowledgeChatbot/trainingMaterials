{"Title":"Azure 备份代理中设置的备份计划不执行","Description":"Azure 备份代理中设置的备份计划不执行","Content":"# Azure 备份代理中设置的备份计划不执行\r\n\r\n## 问题描述\r\n\r\n使用 Azure 备份将 Windows Server（或 Windows 客户端）文件和文件夹备份到 Azure，安装并配置了Azure备份代理中的备份计划, 例如：\r\n\r\n![specify-backup-schedule.png](media/aog-backup-qa-schedule-pending/specify-backup-schedule.png)\r\n\r\n但是备份计划并没有执行，在事件查看器中也没有相应的报错。\r\n\r\n> [!NOTE]\r\n> 事件查看器-> Applications and Services logs -> Cloud Backup -> Operational 中记录了Azure backup的操作记录。\r\n\r\n## 问题分析\r\n\r\nAzure 备份代理生成的备份任务会添加到任务计划，但该任务计划执行 `import-module msonlinebackup` 命令时失败。\r\n\r\n### 排错过程\r\n\r\n1.\t运行 Azure 备份代理，尝试手动运行一次备份，查看备份是否成功运行。\r\n2.\t打开任务计划 Task Scheduler，确保备份计划被成功创建。\r\n\r\n    ![task-scheduler.png](media/aog-backup-qa-schedule-pending/task-scheduler.png)\r\n\r\n3.  可以尝试新建一个备份任务，比如每 5 分钟执行一次备份，来查看该任务计划是否会成功执行。如此来判断时任务计划的问题还是备份本身的问题。\r\n\r\n4.\t打开任务计划详细，在 Actions 选项卡中查看具体的命令。可以看到任务计划实际是执行了`import-module msonlinebackup`, 为了进一步排错，复制该命令并尝试手动运行。\r\n\r\n    ![properties.png](media/aog-backup-qa-schedule-pending/properties.png)\r\n\r\n5.\t在手动执行命令时，发现import-module msonlinebackup报错Module 不存在。\r\n\r\n## 解决方法\r\n\r\n手动添加 MSOnlineBackup Module:\r\n\r\n1.\t到 `C:/ProgramFiles/Microsoft Azure Recovery Services/Bin/Modules/MSOnlineBackup` 文件夹下。\r\n2.\t拷贝 MSOnlineBackup.psd1 到 `C:\\Windows\\System32\\WindowsPowerShell\\v1.0.` 目录。\r\n3.\t重新运行 `import-module msonlinebackup` 命令。\r\n\r\n> [!NOTE]\r\n> 该解决方法只适用于符合 “**问题描述**” 中的场景 (安装了 Microsoft Azure Recovery Services Agent 的 Windows Server 以及 Windows Client)。如果本文未解决您的 Azure 问题，建议您下载并安装最新的 Azure 备份代理。  \r\n> 您也可以访问 MSDN 和 CSDN 上的 Azure 论坛。 您可以在这些论坛上发布您的问题。 此外，还可以通过在 Azure 支持站点上选择 “**获取支持**” 来发出 Azure 支持请求。"}