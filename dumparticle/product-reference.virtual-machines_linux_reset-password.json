{"Title":"如何在 Azure VM 上重置本地 Linux 密码","Description":"在 Azure VM 上重置本地 Linux 密码的步骤简介","Content":"# <a name=\"how-to-reset-local-linux-password-on-azure-vms\"></a>如何在 Azure VM 上重置本地 Linux 密码\r \r 本文介绍了几种重置本地 Linux 虚拟机 (VM) 密码的方法。 如果用户帐户已过期或者只是想要创建新帐户，则可以使用以下方法来创建新的本地管理员帐户并重新获得对 VM 的访问权限。\r \r ## <a name=\"symptoms\"></a>症状\r \r 无法登录到 VM 时会收到一条消息，指示所使用的密码不正确。 此外，无法在 Azure 门户上使用 VMAgent 重置密码。 \r \r ## <a name=\"manual-password-reset-procedure\"></a>手动密码重置过程\r \r 1.  删除 VM 并保留附加的磁盘。\r \r 2.  将 OS 驱动器作为数据磁盘附加到同一位置中的另一个临时 VM。\r \r 3.  在临时 VM 上运行以下 SSH 命令，成为超级用户。\r \r     ~~~~\r     sudo su\r     ~~~~\r \r 4.  运行 fdisk -l，或查看系统日志以查找新附加的磁盘。 找到要装载的驱动器名称。 然后在临时 VM 上，查找相关的日志文件。\r \r     ~~~~\r     grep SCSI /var/log/kern.log (ubuntu)\r     grep SCSI /var/log/messages (centos, suse, oracle)\r     ~~~~\r \r     下面是 grep 命令的示例输出：\r \r     ~~~~\r     kernel: [ 9707.100572] sd 3:0:0:0: [sdc] Attached SCSI disk\r     ~~~~\r \r 5.  创建名为 tempmount 的装入点。\r \r     ~~~~\r     mkdir /tempmount\r     ~~~~\r \r 6.  在该装入点上装载 OS 磁盘。 通常需要装载 sdc1 或 sdc2。 这将取决于断开的计算机磁盘 /etc 目录中的托管分区。\r \r     ~~~~\r     mount /dev/sdc1 /tempmount\r     ~~~~\r \r 7.  请在进行任何更改之前执行备份：\r \r     ~~~~\r     cp /etc/passwd /etc/passwd_orig    \r     cp /etc/shadow /etc/shadow_orig    \r     cp /tempmount/etc/passwd /etc/passwd\r     cp /tempmount/etc/shadow /etc/shadow \r     cp /tempmount/etc/passwd /tempmount/etc/passwd_orig\r     cp /tempmount/etc/shadow /tempmount/etc/shadow_orig\r     ~~~~\r \r 8.  重置所需的用户密码：\r \r     ~~~~\r     passwd <<USER>> \r     ~~~~\r \r 9.  将已修改的文件移动到断开的计算机磁盘上的正确位置。\r \r     ~~~~\r     cp /etc/passwd /tempmount/etc/passwd\r     cp /etc/shadow /tempmount/etc/shadow\r     cp /etc/passwd_orig /etc/passwd\r     cp /etc/shadow_orig /etc/shadow\r     ~~~~\r     \r 10. 返回到根目录并卸载磁盘。\r \r     ~~~~\r     cd /\r     umount /tempmount\r     ~~~~\r \r 11. 从管理门户分离磁盘。\r \r 12. 重新创建 VM。\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r * [Troubleshoot Azure VM by attaching OS disk to another Azure VM](http://social.technet.microsoft.com/wiki/contents/articles/18710.troubleshoot-azure-vm-by-attaching-os-disk-to-another-azure-vm.aspx)（通过将 OS 磁盘附加到另一个 Azure VM 对 Azure VM 进行故障排除）\r \r * [Azure CLI: How to delete and re-deploy a VM from VHD](https://blogs.msdn.microsoft.com/linuxonazure/2016/07/21/azure-cli-how-to-delete-and-re-deploy-a-vm-from-vhd/)（Azure CLI：如何从 VHD 删除和重新部署 VM）\r \r <!--Update_Description: update meta properties， wording update -->"}