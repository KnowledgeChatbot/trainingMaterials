{"Title":"将 ExpressRoute 线路从经典部署模型移动到 Resource Manager 部署模型：PowerShell","Description":"本页面介绍如何使用 PowerShell 将经典线路移动到 Resource Manager 部署模型。","Content":"\r # 使用 PowerShell 将 ExpressRoute 线路从经典部署模型移动到 Resource Manager 部署模型\r \r 若要将 ExpressRoute 线路同时用于经典部署模型和 Resource Manager 部署模型，必须将该线路移动到 Resource Manager 部署模型中。以下部分介绍使用 PowerShell 移动线路的步骤。\r \r ## 开始之前\r - 确保拥有最新版本的 Azure PowerShell 模块（至少为 1.0 版）。\r - 在开始配置之前，请务必查看[先决条件](./expressroute-prerequisites.md)、[路由要求](./expressroute-routing.md)和[工作流](./expressroute-workflows.md)。\r - 请参阅[将 ExpressRoute 线路从经典部署模型移动到 Resource Manager 部署模型](./expressroute-move.md)中提供的信息。请确保对限制和局限性有全面的了解。\r - 验证线路在经典部署模型中可完全正常运行。\r - 确保拥有一个在 Resource Manager 部署模型中创建的资源组。\r \r ## 移动 ExpressRoute 线路\r \r ### 步骤 1：从经典部署模型收集线路详细信息\r 登录 Azure 经典环境并收集服务密钥。\r \r 1. 登录到你的 Azure 帐户。\r \r     ```\r     Add-AzureAccount -Environment AzureChinaCloud\r     ```\r \r 2. 选择相应的 Azure 订阅。\r \r     ```\r     Select-AzureSubscription \"<Enter Subscription Name here>\"\r     ```\r \r 3. 为 Azure 和 ExpressRoute 导入 PowerShell 模块。\r \r     ```\r     # Import the PowerShell modules for Azure and ExpressRoute\r     Import-Module 'C:\\Program Files (x86)\\Microsoft SDKs\\Azure\\PowerShell\\ServiceManagement\\Azure\\Azure.psd1'\r     Import-Module 'C:\\Program Files (x86)\\Microsoft SDKs\\Azure\\PowerShell\\ServiceManagement\\Azure\\ExpressRoute\\ExpressRoute.psd1'\r     ```\r \r 4. 使用下面的 cmdlet 获取所有 ExpressRoute 线路的服务密钥。检索密钥后，请复制要移动到 Resource Manager 部署模型的线路的**服务密钥**。\r \r     ```\r     # Get the service keys of all your ExpressRoute circuits\r     Get-AzureDedicatedCircuit\r     ```\r \r ### 步骤 2：登录并创建资源组\r 登录 Resource Manager 环境并创建新的资源组。\r \r 1. 登录 Azure Resource Manager 环境。\r \r     ```\r     Login-AzureRmAccount -Environment $(Get-AzureRmEnvironment -Name AzureChinaCloud)\r     ```\r \r 2. 选择相应的 Azure 订阅。\r \r     ```\r     Get-AzureRmSubscription -SubscriptionName \"<Enter Subscription Name here>\" | Select-AzureRmSubscription\r     ```\r \r 3. 如果还没有资源组，请修改下面的片段，创建新的资源组。\r \r     ```\r     #Create a new resource group if you don't already have one\r     New-AzureRmResourceGroup -Name \"DemoRG\" -Location \"chinaeast\"\r     ```\r \r ### 步骤 3：将 ExpressRoute 线路转移到 Resource Manager 部署模型\r 现在，可以将 ExpressRoute 线路从经典部署模型移动到 Resource Manager 部署模型。在继续下一步之前，请先参阅[将 ExpressRoute 线路从经典部署模型转移到 Resource Manager 部署模型](./expressroute-move.md)中提供的信息。\r \r 若要移动线路，请修改并运行以下代码片段：\r \r ```\r Move-AzureRmExpressRouteCircuit -Name \"MyCircuit\" -ResourceGroupName \"DemoRG\" -Location \"chinaeast\" -ServiceKey \"<Service-key>\"\r ```\r \r >[!NOTE]\r > 转移完成之后，列在前一个 cmdlet 中的新名称用于处理资源。线路实质上已重命名。\r \r ## 修改线路访问\r \r ### 为两种部署模型启用 ExpressRoute 线路访问\r 将经典 ExpressRoute 线路移动到 Resource Manager 部署模型后，可以启用对两种部署模型的访问。运行以下 cmdlet 启用对两种部署模型的访问：\r \r 1. 获取线路详细信息。\r \r     ```\r     $ckt = Get-AzureRmExpressRouteCircuit -Name \"DemoCkt\" -ResourceGroupName \"DemoRG\"\r     ```\r \r 2. 将“允许经典操作”设置为“TRUE”。\r \r     ```\r     $ckt.AllowClassicOperations = $true\r     ```\r \r 3. 更新线路。成功完成此操作后，可以在经典部署模型中查看线路。\r \r     ```\r     Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt\r     ```\r \r 4. 运行以下 cmdlet 获取 ExpressRoute 线路的详细信息。服务密钥必须已列出。\r \r     ```\r     Get-AzureDedicatedCircuit\r     ```\r \r 5. 现在，可以使用经典 VNet 的经典部署模型命令以及 Resource Manager VNet 的 Resource Manager 命令来管理 ExpressRoute 线路的链接。以下文章将引导你了解如何管理 ExpressRoute 线路的链接：\r \r - [Link your virtual network to your ExpressRoute circuit in the Resource Manager deployment model](./expressroute-howto-linkvnet-arm.md)（在 Resource Manager 部署模型中将虚拟网络链接到 ExpressRoute 线路）\r - [Link your virtual network to your ExpressRoute circuit in the classic deployment model](./expressroute-howto-linkvnet-classic.md)（在经典部署模型中将虚拟网络链接到 ExpressRoute 线路）\r \r ### 禁用对经典部署模型的 ExpressRoute 线路访问\r 运行以下 cmdlet 可禁止访问经典部署模型。\r \r 1. 获取 ExpressRoute 线路的详细信息。\r \r     ```\r     $ckt = Get-AzureRmExpressRouteCircuit -Name \"DemoCkt\" -ResourceGroupName \"DemoRG\"\r     ```\r \r 2. 将“允许经典操作”设置为“FALSE”。\r \r     ```\r     $ckt.AllowClassicOperations = $false\r     ```\r \r 3. 更新线路。成功完成此操作后，你将无法在经典部署模型中查看线路。\r \r     ```\r     Set-AzureRmExpressRouteCircuit -ExpressRouteCircuit $ckt\r     ```\r \r ## 后续步骤\r \r - [创建和修改 ExpressRoute 线路的路由](./expressroute-howto-routing-arm.md)\r - [将虚拟网络链接到 ExpressRoute 线路](./expressroute-howto-linkvnet-arm.md)\r \r <!---HONumber=Mooncake_0320_2017-->"}