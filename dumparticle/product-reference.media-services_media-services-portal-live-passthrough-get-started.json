{"Title":"通过 Azure 门户使用本地编码器实时传送视频流","Description":"本教程指导你完成相关步骤，以便创建经配置后可以进行直通传递的“通道”。","Content":"# <a name=\"how-to-perform-live-streaming-with-on-premises-encoders-using-the-azure-portal\"></a>如何通过 Azure 门户使用本地编码器实时传送视频流\r > [!div class=\"op_single_selector\"]\r > * [门户](media-services-portal-live-passthrough-get-started.md)\r > * [.NET](media-services-dotnet-live-encode-with-onpremises-encoders.md)\r > * [REST](https://docs.microsoft.com/rest/api/media/operations/channel)\r > \r > \r \r 本教程指导你完成相关步骤，使用 Azure 门户创建经配置后可直通传递的“通道”  。 \r \r ## <a name=\"prerequisites\"></a>先决条件\r 以下是完成本教程所需具备的条件：\r \r * 一个 Azure 帐户。 有关详细信息，请参阅 [Azure 试用](https://www.azure.cn/pricing/1rmb-trial/)。 \r * 一个媒体服务帐户。 若要创建媒体服务帐户，请参阅[如何创建媒体服务帐户](media-services-portal-create-account.md)。\r * 网络摄像机。 例如， [Telestream Wirecast 编码器](http://www.telestream.net/wirecast/overview.htm)。\r \r 强烈建议阅读以下文章：\r \r * [Azure 媒体服务 RTMP 支持和实时编码器](https://azure.microsoft.com/blog/2014/09/18/azure-media-services-rtmp-support-and-live-encoders/)\r * [使用 Azure 媒体服务实时传送视频流概述](media-services-manage-channels-overview.md)\r * [使用可创建多比特率流的本地编码器实时传送视频流](media-services-live-streaming-with-onprem-encoders.md)\r \r ## <a id=\"scenario\"></a>常见实时流式处理方案\r 以下步骤说明了在创建常用的实时传送视频流应用程序时涉及的任务，这些应用程序使用的通道经配置后可以进行直通传递。 本教程说明了如何创建和管理直通通道和实时事件。\r \r >[!NOTE]\r >确保要从中流式传输内容的流式处理终结点处于“正在运行”状态。 \r \r 1. 将视频摄像机连接到计算机。 启动并配置输出多比特率 RTMP 或分段 MP4 流的本地实时编码器接收实时输入流。 有关详细信息，请参阅 [Azure 媒体服务 RTMP 支持和实时编码器](http://go.microsoft.com/fwlink/?LinkId=532824)。\r \r     此步骤也可以在创建频道后执行。\r 2. 创建并启动直通通道。\r 3. 检索频道引入 URL。 \r \r     实时编码器使用引入 URL 将流发送到频道。\r 4. 检索频道预览 URL。 \r \r     使用此 URL 来验证频道是否正常接收实时流。\r 5. 创建实时事件/节目。 \r \r     使用 Azure 门户时，创建实时事件的同时还会创建资产。 \r \r 6. 在准备好开始流式传输和存档时，启动事件/节目。\r 7. （可选）可以向实时编码器发信号，以启动广告。 将广告插入到输出流中。\r 8. 在要停止对事件进行流式传输和存档时，停止事件/节目。\r 9. 删除事件/节目（并选择性地删除资产）。     \r \r > [!IMPORTANT]\r > 请参阅[使用可创建多比特率流的本地编码器实时传送视频流](media-services-live-streaming-with-onprem-encoders.md)，了解与实时传送视频流（使用本地编码器和直通频道）相关的概念和注意事项。\r > \r > \r \r ## <a name=\"to-view-notifications-and-errors\"></a>查看通知和错误\r 若要查看 Azure 门户生成的通知和错误，请单击“通知”图标。\r \r ![通知](./media/media-services-portal-passthrough-get-started/media-services-notifications.png)\r \r ## <a name=\"create-and-start-pass-through-channels-and-events\"></a>创建并启动直通通道和事件\r 频道与事件/节目相关联，使用事件/节目，可以控制实时流中的段的发布和存储。 通道管理事件。 \r \r 可以通过设置 **存档窗口** 长度，指定希望保留节目录制内容的小时数。 此值的设置范围是最短 5 分钟，最长 25 小时。 存储时间窗口长度还决定了客户端能够从当前实时位置按时间向后搜索的最长时间。 超出指定时间长度后，事件也能够运行，但落在时间窗口长度后面的内容将不断被丢弃。 此属性的这个值还决定了客户端清单能够增加多长时间。\r \r 每个事件都与某个资产关联。 若要发布事件，必须为关联的资产创建按需定位符。 此定位符可用于生成提供给客户端的流 URL。\r \r 一个通道最多支持三个并发运行的事件，因此可以为同一传入流创建多个存档。 这样，便可以根据需要发布和存档事件的不同部分。 例如，业务要求是存档 6 小时的节目，但只广播过去 10 分钟的内容。 为了实现此目的，需要创建两个同时运行的节目。 一个节目设置为存档 6 小时的事件但不发布该节目。 另一个节目设置为存档 10 分钟的事件，并且要发布该节目。\r \r 不应重复使用现有的实时事件。 与之相反，应针对每个事件创建并启动新事件。\r \r 在准备好开始流式传输和存档时，启动事件。 在要停止对事件进行流式传输和存档时，停止节目。 \r \r 如果要删除存档的内容，请停止并删除事件，并删除关联的资产。 如果资产被某个事件使用，则无法将其删除，必须先删除该事件。 \r \r 即使停止并删除了事件，只要没有删除资产，用户也能够按需将你的已存档内容作为视频进行流式传输。\r \r 如果希望保留已存档的内容但不希望其可供流式传输，请删除流式传输定位符。\r \r ### <a name=\"to-use-the-portal-to-create-a-channel\"></a>使用门户来创建通道\r 本部分演示如何使用“快速创建”  选项来创建直通通道。\r \r 有关直通通道的详细信息，请参阅[使用可创建多比特率流的本地编码器实时传送视频流](media-services-live-streaming-with-onprem-encoders.md)。\r \r 1. 在 [Azure 门户](https://portal.azure.cn/)中，选择 Azure 媒体服务帐户。\r 2. 在“设置”窗口中，单击“实时传送视频流”。 \r \r     ![入门](./media/media-services-portal-passthrough-get-started/media-services-getting-started.png)\r \r     此时会显示“实时传送视频流”  窗口。\r 3. 单击“快速创建”  ，使用 RTMP 引入协议创建直通通道。\r \r     此时会显示“创建新通道”  窗口。\r 4. 为新通道命名，并单击“创建” 。 \r \r     此时会使用 RTMP 引入协议创建直通通道。\r \r ## <a name=\"create-events\"></a>创建事件\r 1. 选择要对其添加事件的通道。\r 2. 按“实时事件”  按钮。\r \r ![事件](./media/media-services-portal-passthrough-get-started/media-services-create-events.png)\r \r ## <a name=\"get-ingest-urls\"></a>获取引入 URL\r 创建通道后，可以获得要提供给实时编码器的引入 URL。 编码器使用这些 URL 来输入实时流。\r \r ![已创建](./media/media-services-portal-passthrough-get-started/media-services-channel-created.png)\r \r ## <a name=\"watch-the-event\"></a>观看事件\r 如果要观看事件，请在 Azure 门户中单击“观看”  ，或者先复制流式处理 URL，然后使用所选播放器进行播放。 \r \r ![已创建](./media/media-services-portal-passthrough-get-started/media-services-default-event.png)\r \r 停止时，实时事件会自动转换为点播内容。\r \r ## <a name=\"clean-up\"></a>清理\r 有关直通通道的详细信息，请参阅[使用可创建多比特率流的本地编码器实时传送视频流](media-services-live-streaming-with-onprem-encoders.md)。\r \r * 只有当频道中的所有事件/节目都已停止时，才能停止频道。  停止通道后，不会产生任何费用。 需要重新启动它时，它会采用相同的引入 URL，因此无需重新配置编码器。\r * 只有当频道中的所有实时事件都已删除时，才能删除频道。\r \r ## <a name=\"view-archived-content\"></a>查看存档的内容\r 即使停止并删除了事件，只要没有删除资产，用户也能够按需将你的已存档内容作为视频进行流式传输。 如果资产被某个事件使用，则无法将其删除，必须先删除该事件。 \r \r 若要管理资产，请选择“设置”，再单击“资产”。\r \r ![资产](./media/media-services-portal-passthrough-get-started/media-services-assets.png)\r \r "}