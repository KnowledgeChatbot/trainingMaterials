{"Title":"用于 .NET 的媒体服务 SDK 中的重试逻辑","Description":"本主题概述了用于 .NET 的媒体服务 SDK 中的重试逻辑。","Content":"# <a name=\"retry-logic-in-the-media-services-sdk-for-net\"></a>用于 .NET 的媒体服务 SDK 中的重试逻辑\r 使用 Azure 服务时，可能会发生暂时性故障。 如果发生暂时性故障，在大多数情况下，重试几次后操作即可成功。 用于 .NET 的媒体服务 SDK 可实现重试逻辑，用于处理与异常和错误相关的暂时性故障，引起这些异常和错误的原因包括 Web 请求、执行查询、保存更改和存储操作。  默认情况下，再次引发应用程序异常之前，用于 .NET 的媒体服务 SDK 将重试 4 次。 应用程序中的代码稍后必须正确处理此异常。  \r \r  下面是 Web 请求、存储、查询和 SaveChanges 策略的简要原则：  \r \r * 存储策略用于 Blob 存储操作（上传或下载资产文件）。  \r * Web 请求策略用于泛型 Web 请求（例如，获取身份验证令牌和解析用户群集终结点）。  \r * 查询策略用于查询 REST 中的实体（例如，mediaContext.Assets.Where(...)）。  \r * SaveChanges 策略用于执行服务中更改数据的任何操作（如创建实体、更新实体以及为操作调用服务函数）。  \r \r   本主题列出了用于 .NET 的媒体服务 SDK 的重试逻辑可处理的异常类型和错误代码。  \r \r ## <a name=\"exception-types\"></a>异常类型\r 下表介绍了用于 .NET 的媒体服务 SDK 对于可能导致暂时性故障的操作可处理和不可处理的异常。  \r \r | 异常 | Web 请求 | 存储 | 查询 | SaveChanges |\r | --- | --- | --- | --- | --- |\r | WebException<br/>有关详细信息，请参阅 [WebException 状态代码](media-services-retry-logic-in-dotnet-sdk.md#WebExceptionStatus)部分。 |是 |是 |是 |是 |\r | DataServiceClientException<br/> 有关详细信息，请参阅 [HTTP 错误和状态代码](media-services-retry-logic-in-dotnet-sdk.md#HTTPStatusCode)。 |否 |是 |是 |是 |\r | DataServiceQueryException<br/> 有关详细信息，请参阅 [HTTP 错误和状态代码](media-services-retry-logic-in-dotnet-sdk.md#HTTPStatusCode)。 |否 |是 |是 |是 |\r | DataServiceRequestException<br/> 有关详细信息，请参阅 [HTTP 错误和状态代码](media-services-retry-logic-in-dotnet-sdk.md#HTTPStatusCode)。 |否 |是 |是 |是 |\r | DataServiceTransportException |否 |否 |是 |是 |\r | TimeoutException |是 |是 |是 |否 |\r | SocketException |是 |是 |是 |是 |\r | StorageException |否 |是 |否 |否 |\r | IOException |否 |是 |否 |否 |\r \r ### <a name=\"WebExceptionStatus\"></a> WebException 状态代码\r 下表介绍了针对其实现重试逻辑的 WebException 错误代码。 [WebExceptionStatus](http://msdn.microsoft.com/library/system.net.webexceptionstatus.aspx) 枚举定义状态代码。  \r \r | 状态 | Web 请求 | 存储 | 查询 | SaveChanges |\r | --- | --- | --- | --- | --- |\r | ConnectFailure |是 |是 |是 |是 |\r | NameResolutionFailure |是 |是 |是 |是 |\r | ProxyNameResolutionFailure |是 |是 |是 |是 |\r | SendFailure |是 |是 |是 |是 |\r | PipelineFailure |是 |是 |是 |否 |\r | ConnectionClosed |是 |是 |是 |否 |\r | KeepAliveFailure |是 |是 |是 |否 |\r | UnknownError |是 |是 |是 |否 |\r | ReceiveFailure |是 |是 |是 |否 |\r | RequestCanceled |是 |是 |是 |否 |\r | 超时 |是 |是 |是 |否 |\r | ProtocolError <br/>ProtocolError 的重试受控于 HTTP 状态代码处理。 有关详细信息，请参阅 [HTTP 错误和状态代码](media-services-retry-logic-in-dotnet-sdk.md#HTTPStatusCode)。 |是 |是 |是 |是 |\r \r ### <a name=\"HTTPStatusCode\"></a> HTTP 错误状态代码\r 如果 Query 和 SaveChanges 操作引发 DataServiceClientException、DataServiceQueryException 或 DataServiceQueryException，则 StatusCode 属性中返回 HTTP 错误状态代码。  下表介绍了为哪些错误代码实现了重试逻辑。  \r \r | 状态 | Web 请求 | 存储 | 查询 | SaveChanges |\r | --- | --- | --- | --- | --- |\r | 401 |否 |是 |否 |否 |\r | 403 |否 |是<br/>处理等待时间较长的重试。 |否 |否 |\r | 408 |是 |是 |是 |是 |\r | 429 |是 |是 |是 |是 |\r | 500 |是 |是 |是 |否 |\r | 502 |是 |是 |是 |否 |\r | 503 |是 |是 |是 |是 |\r | 504 |是 |是 |是 |否 |\r \r 如果要查看用于 .NET 的媒体服务 SDK 的重试逻辑的实际实现，请参阅 [azure-sdk-for-media-services](https://github.com/Azure/azure-sdk-for-media-services/tree/dev/src/net/Client/TransientFaultHandling)。"}