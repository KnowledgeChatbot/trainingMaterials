{"Title":"Linux 虚拟机的安全审计","Description":"Linux 虚拟机的安全审计","Content":"# Linux 虚拟机的安全审计\r \r ## 背景介绍\r \r 对于系统管理员来说，系统出现问题是常事，出现问题，解决问题，不出现问题也要制造问题，然后解决问题。最为难也最费力的是领导的一句话：为什么会发生这个问题，以后怎么避免？如果是显性的问题，比如配置错误，性能问题，都可以很清晰的回答。但是如果是文件丢失了，权限被篡改了等问题就很不好回答，难点在于，没有问题发生的具体时间点以及现场环境。\r \r 那么，如果我们对系统的重要数据有一套安全审计机制，那么这个秋后算账就会变得有理有据了。以下，通过 Linux 的 auditd 服务来配置文件和目录的安全审计。\r \r > [!IMPORTANT]\r > 以下范例基于 Azure 平台部署的 CentOS7.3，如果您使用的是其他版本的 Linux 操作系统，请注意其中的差异性。\r \r ## 方案介绍\r \r 配置文件说明：\r \r - `/etc/audit/auditd.conf`\r \r     Audit 服务配置文件，可以配置日志存放路径，大小等。\r \r - `/etc/audit/rules.d/audit.rules`\r \r     Audit 审计规则，配置要审计的内容和规则。\r \r - `/var/log/audit/audit.log`\r \r     Audit 审计日志（默认），存放满足审计规则的活动记录。\r \r 文件和目录审计配置：\r \r 1. 执行命令安装 Audit 软件包：\r \r     `# yum install audit`\r \r 2. 启动 auditd 服务：\r \r     `# service auditd start`\r \r 3. 添加 auditd 为自启动服务：\r \r     `# systemctl enable auditd`\r \r 4. 配置文件和目录审计规则：\r \r     1. 编辑文件 `/etc/audit/rules.d/audit.rules`\r \r     2. 添加如下内容：\r \r         `-w /etc/audit/ -p wa -k test_audit_rule`\r \r     3. 保存并退出。\r \r         > [!NOTE]\r         > `-w`: 监视\r         > `-p`: 权限（`rwax`| 读·写·修改属性·执行）\r         > `-k`: 关键字 （用来作为索引）\r \r 5. 重启 auditd 服务使规则生效：\r \r     ```\r     # service auditd stop\r     # service auditd start\r     ```\r \r 6. 查看生效的审计规则：\r \r     `# auditctl -l`\r \r 7. 查看审计报表：\r \r     `# aureport -k`\r \r 8. 查看审计日志：\r \r     `# cat /var/log/audit/audit.log`\r \r ## 相关建议\r \r 1. 如果审计的内容比较多，那么日志生成会比较大，建议通过修改 `/etc/audit/auditd.conf` 中的 `log_file` 行，指定 log 保存目录，避免根目录磁盘空间问题导致系统故障。\r \r 2. 对于系统安全角度，建议针对系统命令 `/sbin:/bin:/usr/sbin:/usr/bin` 进行目录级别的写和修改权限审计，避免恶意病毒和木马对系统命令进行篡改和伪装。对系统配置目录 `/etc/` 进行目录级别的写和修改权限审计，避免配置文件的误删除或者文件内容的恶意删除修改。\r \r ## 相关文档\r \r - [Linux 虚拟机的安全加固](aog-virtual-machines-linux-security-reinforce.md)+\r - [Linux 虚拟机的 SSH 双重登录认证](aog-virtual-machines-linux-ssh-two-factor-authentication.md)"}