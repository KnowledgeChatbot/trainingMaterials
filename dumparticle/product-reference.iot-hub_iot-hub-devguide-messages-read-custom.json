{"Title":"了解 Azure IoT 中心自定义终结点","Description":"开发人员指南 - 使用路由规则将设备到云的消息路由到自定义终结点。","Content":"# <a name=\"use-message-routes-and-custom-endpoints-for-device-to-cloud-messages\"></a>对设备到云的消息使用消息路由和自定义终结点\r \r IoT 中心允许基于消息属性将[设备到云的消息][lnk-device-to-cloud]路由到面向 IoT 中心服务的终结点。 使用路由规则可将消息灵活发送到所需目标位置，无需借助其他服务来处理消息，也无需编写其他代码。 配置的每个路由规则都具有以下属性：\r \r | 属性      | 说明 |\r | ------------- | ----------- |\r | **Name**      | 用于标识规则的唯一名称。 |\r | **源**    | 要处理的数据流的来源。 例如，设备遥测。 |\r | **条件** | 路由规则的查询表达式，针对消息的标头和正文运行，用于确定它是否与终结点匹配。 有关构造路由条件的详细信息，请参阅 [参考 - 设备孪生和作业的查询语言][lnk-devguide-query-language]。 |\r | **终结点**  | IoT 中心将匹配条件的消息发送到的终结点的名称。 终结点应与 IoT 中心位于同一区域，否则跨区域写入将产生费用。 |\r \r 一条消息可能与多个路由规则的条件匹配，在这种情况下，IoT 中心会将该消息传递到与每个匹配规则关联的终结点。 IoT 中心还会自动删除重复的消息传递，因此如果消息与具有相同目标的多个规则匹配，则仅会将其写入该目标位置一次。\r \r IoT 中心有一个默认的[内置终结点][lnk-built-in]。 通过将订阅中的其他服务链接到中心，可以创建要将消息路由到的自定义终结点。 IoT 中心目前支持将 Azure 存储容器、事件中心、服务总线队列和服务总线主题用作自定义终结点。\r \r 使用路由和自定义终结点时，如果消息不与任何规则匹配，则只会将其传送到内置终结点。 若要将消息同时传送到内置终结点和自定义终结点，请添加一个可将消息发送到 **events** 终结点的路由。\r \r > [!NOTE]\r > IoT 中心仅支持将数据作为 blob 写入 Azure 存储容器。\r >\r >\r \r \r \r > [!WARNING]\r > 不支持将已启用**会话**或**重复项检测**的服务总线队列和主题用作自定义终结点。\r \r 有关在 IoT 中心创建自定义终结点的详细信息，请参阅 [IoT 中心终结点][lnk-devguide-endpoints]。\r \r 有关从自定义终结点读取数据的详细信息，请参阅：\r \r * 从 [Azure 存储容器][lnk-getstarted-storage]读取。\r * 从[事件中心][lnk-getstarted-eh]读取数据。\r * 从[服务总线队列][lnk-getstarted-queue]读取数据。\r * 从[服务总线主题][lnk-getstarted-topic]读取数据。\r \r ### <a name=\"next-steps\"></a>后续步骤\r \r 有关 IoT 中心终结点的详细信息，请参阅 [IoT 中心终结点][lnk-devguide-endpoints]。\r \r 有关用于定义路由规则的查询语言的详细信息，请参阅[用于设备孪生、作业和消息路由的 IoT 中心查询语言][lnk-devguide-query-language]。\r \r [使用路由处理 IoT 中心设备到云的消息][lnk-d2c-tutorial]教程介绍了如何使用路由规则和自定义终结点。\r \r [lnk-built-in]: ./iot-hub-devguide-messages-read-builtin.md\r [lnk-device-to-cloud]: ./iot-hub-devguide-messages-d2c.md\r [lnk-devguide-query-language]: ./iot-hub-devguide-query-language.md\r [lnk-devguide-endpoints]: ./iot-hub-devguide-endpoints.md\r [lnk-d2c-tutorial]: ./iot-hub-csharp-csharp-process-d2c.md\r [lnk-getstarted-eh]: ../event-hubs/event-hubs-csharp-ephcs-getstarted.md\r [lnk-getstarted-queue]: ../service-bus-messaging/service-bus-dotnet-get-started-with-queues.md\r [lnk-getstarted-topic]: ../service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions.md\r [lnk-getstarted-storage]: ../storage/blobs/storage-blobs-introduction.md\r \r <!--Update_Description: update wording and link references-->\r "}