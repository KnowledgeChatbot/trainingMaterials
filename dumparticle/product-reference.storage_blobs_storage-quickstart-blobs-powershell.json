{"Title":"Azure 快速入门 - 使用 PowerShell 将对象转移到 Azure Blob 存储或从中转移对象","Description":"快速了解如何使用 PowerShell 将对象转移到 Azure Blob 存储或从中转移对象","Content":"# <a name=\"transfer-objects-tofrom-azure-blob-storage-using-azure-powershell\"></a>使用 Azure PowerShell 将对象转移到 Azure Blob 存储或从中转移对象\r \r Azure PowerShell 模块用于从 PowerShell 命令行或脚本创建和管理 Azure 资源。 此指南详细介绍如何使用 PowerShell 在本地磁盘和 Azure Blob 存储之间传输文件。\r \r 如果没有 Azure 订阅，可以在开始前创建一个 [1 元帐户](https://www.azure.cn/pricing/1rmb-trial/?WT.mc_id=A261C142F)。\r \r 本快速入门需要 Azure PowerShell 模块 3.6 或更高版本。 运行 `Get-Module -ListAvailable AzureRM` 即可查找版本。 如果需要进行安装或升级，请参阅[安装 Azure PowerShell 模块](https://docs.microsoft.com/powershell/azure/install-azurerm-ps)。\r \r [!INCLUDE [storage-quickstart-tutorial-intro-include-powershell](../../../includes/storage-quickstart-tutorial-intro-include-powershell.md)]\r \r ## <a name=\"create-a-container\"></a>创建容器\r \r 始终将 blob 上传到容器中。 这样，就能够整理 blob 组，就像在计算机的文件夹中整理文件一样。\r \r 设置容器名称，然后使用 [New-AzureStorageContainer](https://docs.microsoft.com/powershell/module/azure.storage/new-azurestoragecontainer) 创建容器，将权限设置为“blob”以允许公共访问文件。 此示例中的容器名称是 quickstartblobs。\r \r ```powershell\r $containerName = \"quickstartblobs\"\r New-AzureStorageContainer -Name $containerName -Context $ctx -Permission blob\r ```\r \r ## <a name=\"upload-blobs-to-the-container\"></a>将 blob 上传到容器\r \r blob 存储支持块 blob、追加 blob 和页 blob。 用于备份 IaaS VM 的 VHD 文件都是页 blob。 追加 blob 用于日志记录，例如有时需要写入到文件，再继续添加更多信息。 Blob 存储中存储的大多数文件都是块 blob。 \r \r 要将文件上传到块 blob，请获取容器引用，然后获取对该容器中的块 blob 的引用。 具备 blob 引用后，可使用 [Set-AzureStorageBlobContent](https://docs.microsoft.com/powershell/module/azure.storage/set-azurestorageblobcontent) 将数据上传到其中。 此操作会创建 blob（若尚不存在），或者覆盖它（若已存在）。\r \r 以下示例将 Image001.jpg 和 Image002.png 从本地磁盘的 D:\\\\_TestImages 文件夹上传到刚创建的容器中。\r \r ```powershell\r # upload a file\r Set-AzureStorageBlobContent -File \"D:\\_TestImages\\Image001.jpg\" `\r   -Container $containerName `\r   -Blob \"Image001.jpg\" `\r   -Context $ctx \r \r # upload another file\r Set-AzureStorageBlobContent -File \"D:\\_TestImages\\Image002.png\" `\r   -Container $containerName `\r   -Blob \"Image002.png\" `\r   -Context $ctx\r ```\r \r 上传尽可能多的文件，然后继续操作。\r \r ## <a name=\"list-the-blobs-in-a-container\"></a>列出容器中的 Blob\r \r 使用 [Get-AzureStorageBlob](https://docs.microsoft.com/powershell/module/azure.storage/get-azurestorageblob) 获取容器中的 blob 列表。 此示例仅显示已上传的 blob 的名称。\r \r ```powershell\r Get-AzureStorageBlob -Container $ContainerName -Context $ctx | select Name \r ```\r \r ## <a name=\"download-blobs\"></a>下载 Blob\r \r 将 blob 下载到本地磁盘。 对于要下载的每个 blob，请设置名称并调用 [ Get-AzureStorageBlobContent ](https://docs.microsoft.com/powershell/module/azure.storage/get-azurestorageblobcontent) 以下载 blob。\r \r 此示例将 blob 下载到本地磁盘的 D:\\\\_TestImages\\Downloads 中。 \r \r ```powershell\r # download first blob\r Get-AzureStorageBlobContent -Blob \"Image001.jpg\" `\r   -Container $containerName `\r   -Destination \"D:\\_TestImages\\Downloads\\\" `\r   -Context $ctx \r \r # download another blob\r Get-AzureStorageBlobContent -Blob \"Image002.png\" `\r   -Container $containerName `\r   -Destination \"D:\\_TestImages\\Downloads\\\" `\r   -Context $ctx \r ```\r \r ## <a name=\"data-transfer-with-azcopy\"></a>使用 AzCopy 传输数据\r \r 若要按可编写脚本的方式高性能地传输 Azure 存储中的数据，还可使用 [AzCopy](../common/storage-use-azcopy.md?toc=%2fstorage%2fblobs%2ftoc.json) 实用工具。 可使用 AzCopy 将数据传输到 Blob、文件和表存储或将数据从中传出。\r \r 在以下快速示例中，AzCopy 命令用于将名为 myfile.txt 的文件从 PowerShell 窗口上传到 mystoragecontainer 容器 。\r \r ```PowerShell\r ./AzCopy `\r     /Source:C:\\myfolder `\r     /Dest:https://mystorageaccount.blob.core.chinacloudapi.cn/mystoragecontainer `\r     /DestKey:<storage-account-access-key> `\r     /Pattern:\"myfile.txt\"\r ```\r \r ## <a name=\"clean-up-resources\"></a>清理资源\r \r 删除所有已创建的资产。 最简单的操作方法是删除资源组。 这会一并删除组中包含的所有资源。 此情况下，会删除存储帐户和资源组本身。\r \r ```powershell\r Remove-AzureRmResourceGroup -Name $resourceGroup\r ```\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 在此快速入门中，介绍了如何在本地磁盘和 Azure Blob 存储之间传输文件。 要深入了解如何使用 Blob 存储，请继续学习 Blob 存储操作说明。\r \r > [!div class=\"nextstepaction\"]\r > [Blob 存储操作说明](storage-how-to-use-blobs-powershell.md)\r \r ### <a name=\"microsoft-azure-powershell-storage-cmdlets-reference\"></a>Microsoft Azure PowerShell 存储 cmdlet 参考\r * [存储 PowerShell cmdlet](https://docs.microsoft.com/powershell/module/azurerm.storage#storage)\r \r ### <a name=\"microsoft-azure-storage-explorer\"></a>Microsoft Azure 存储资源管理器\r * [Microsoft Azure 存储资源管理器](../../vs-azure-tools-storage-manage-with-storage-explorer.md?toc=%2fstorage%2fblobs%2ftoc.json)是 Microsoft 免费提供的独立应用，适用于在 Windows、macOS 和 Linux 上以可视方式处理 Azure 存储数据。"}