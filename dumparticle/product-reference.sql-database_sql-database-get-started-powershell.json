{"Title":"Azure PowerShell：创建 SQL 数据库","Description":"了解如何在 Azure 门户中创建 SQL 数据库逻辑服务器、服务器级防火墙规则和数据库。","Content":"# <a name=\"create-a-single-azure-sql-database-using-powershell\"></a>使用 PowerShell 创建单一 Azure SQL 数据库\r \r PowerShell 用于从命令行或脚本创建和管理 Azure 资源。 本指南详述了如何使用 PowerShell 在 [Azure 资源组](../azure-resource-manager/resource-group-overview.md)的 [Azure SQL 数据库逻辑服务器](sql-database-features.md)中部署 Azure SQL 数据库。\r \r 如果没有 Azure 订阅，请在开始前创建一个[试用帐户](https://www.azure.cn/pricing/1rmb-trial/)。\r \r 本教程需要 Azure PowerShell 模块 4.0 或更高版本。 运行 ` Get-Module -ListAvailable AzureRM` 即可查找版本。 如果需要进行安装或升级，请参阅[安装 Azure PowerShell 模块](https://docs.microsoft.com/powershell/azure/install-azurerm-ps)。 \r \r ## <a name=\"log-in-to-azure\"></a>登录 Azure\r \r 使用 [Add-AzureRmAccount -EnvironmentName AzureChinaCloud](https://docs.microsoft.com/powershell/module/azurerm.profile/add-azurermaccount) 命令登录到 Azure 订阅，并按屏幕说明操作。\r \r ```powershell\r Add-AzureRmAccount -EnvironmentName AzureChinaCloud\r ```\r \r ## <a name=\"create-variables\"></a>创建变量\r \r 定义在本快速入门的脚本中使用的变量。\r \r ```powershell\r # The data center and resource name for your resources\r $resourcegroupname = \"myResourceGroup\"\r $location = \"China East\"\r # The logical server name: Use a random value or replace with your own value (do not capitalize)\r $servername = \"server-$(Get-Random)\"\r # Set an admin login and password for your database\r # The login information for the server\r $adminlogin = \"ServerAdmin\"\r $password = \"ChangeYourAdminPassword1\"\r # The ip address range that you want to allow to access your server - change as appropriate\r $startip = \"0.0.0.0\"\r $endip = \"0.0.0.0\"\r # The database name\r $databasename = \"mySampleDatabase\"\r ```\r \r ## <a name=\"create-a-resource-group\"></a>创建资源组\r \r 使用 [New-AzureRmResourceGroup](https://docs.microsoft.com/powershell/module/azurerm.resources/new-azurermresourcegroup) 命令创建 [Azure 资源组](../azure-resource-manager/resource-group-overview.md)。 资源组是在其中以组的形式部署和管理 Azure 资源的逻辑容器。 以下示例在 `China East` 位置创建名为 `myResourceGroup` 的资源组。\r \r ```powershell\r New-AzureRmResourceGroup -Name $resourcegroupname -Location $location\r ```\r ## <a name=\"create-a-logical-server\"></a>创建逻辑服务器\r \r 使用 [New-AzureRmSqlServer](https://docs.microsoft.com/powershell/module/azurerm.sql/new-azurermsqlserver) 命令创建 [Azure SQL 数据库逻辑服务器](sql-database-features.md)。 逻辑服务器包含一组作为组管理的数据库。 以下示例使用管理员用户名 `ServerAdmin` 和密码 `ChangeYourAdminPassword1` 在资源组中创建随机命名的服务器。 根据需要替换这些预定义的值。\r \r ```powershell\r New-AzureRmSqlServer -ResourceGroupName $resourcegroupname `\r     -ServerName $servername `\r     -Location $location `\r     -SqlAdministratorCredentials $(New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $adminlogin, $(ConvertTo-SecureString -String $password -AsPlainText -Force))\r ```\r \r ## <a name=\"configure-a-server-firewall-rule\"></a>配置服务器防火墙规则\r \r 使用 [New-AzureRmSqlServerFirewallRule](https://docs.microsoft.com/powershell/module/azurerm.sql/new-azurermsqlserverfirewallrule) 命令创建 [Azure SQL 数据库服务器级防火墙规则](sql-database-firewall-configure.md)。 服务器级防火墙规则允许外部服务器（例如 SQL Server Management Studio 或 SQLCMD 实用程序）通过 SQL 数据库服务防火墙连接到 SQL 数据库。 在以下示例中，防火墙仅对其他 Azure 资源开放。 要启用外部连接，请将 IP 地址更改为适合环境的地址。 若要开放所有 IP 地址，请使用 0.0.0.0 作为起始 IP 地址，使用 255.255.255.255 作为结束地址。\r \r ```powershell\r New-AzureRmSqlServerFirewallRule -ResourceGroupName $resourcegroupname `\r     -ServerName $servername `\r     -FirewallRuleName \"AllowSome\" -StartIpAddress $startip -EndIpAddress $endip\r ```\r \r > [!NOTE]\r > 通过端口 1433 进行 SQL 数据库通信。 如果尝试从企业网络内部进行连接，则该网络的防火墙可能不允许经端口 1433 的出站流量。 如果是这样，则无法连接到 Azure SQL 数据库服务器，除非 IT 部门打开了端口 1433。\r >\r \r ## <a name=\"create-a-database-in-the-server-with-sample-data\"></a>使用示例数据在服务器中创建数据库\r \r 使用 [New-AzureRmSqlDatabase](https://docs.microsoft.com/powershell/module/azurerm.sql/new-azurermsqldatabase) 命令在服务器中创建 [S0 性能级别](sql-database-service-tiers.md)的数据库。 以下示例创建名为 `mySampleDatabase` 的数据库，并将 AdventureWorksLT 示例数据加载到该数据库中。 根据需要替换这些预定义的值（此集合中的其他快速入门基于此快速入门中的值）。\r \r ```powershell\r New-AzureRmSqlDatabase  -ResourceGroupName $resourcegroupname `\r     -ServerName $servername `\r     -DatabaseName $databasename `\r     -SampleName \"AdventureWorksLT\" `\r     -RequestedServiceObjectiveName \"S0\"\r ```\r \r ## <a name=\"clean-up-resources\"></a>清理资源\r \r 本教程系列中的其他快速入门教程是在本文的基础上制作的。 \r \r > [!TIP]\r > 如果计划继续使用后续的快速入门，请勿清除在本快速入门中创建的资源。 如果不打算继续，请在 Azure 门户中执行以下步骤，删除通过此快速入门创建的所有资源。\r >\r \r ```powershell\r Remove-AzureRmResourceGroup -ResourceGroupName $resourcegroupname\r ```\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 有了数据库以后，即可使用偏好的工具进行连接和查询。 若要了解详细信息，请选择下面的工具：\r \r - [SQL Server Management Studio](sql-database-connect-query-ssms.md)\r - [Visual Studio Code](sql-database-connect-query-vscode.md)\r - [.NET](sql-database-connect-query-dotnet.md)\r - [PHP](sql-database-connect-query-php.md)\r - [Node.js](sql-database-connect-query-nodejs.md)\r - [Java](sql-database-connect-query-java.md)\r - [Python](sql-database-connect-query-python.md)\r - [Ruby](sql-database-connect-query-ruby.md)\r \r "}