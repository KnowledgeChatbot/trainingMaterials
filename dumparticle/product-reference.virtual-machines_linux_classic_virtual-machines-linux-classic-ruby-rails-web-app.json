{"Title":"Azure VM 上的 Ruby on Rails Web 应用程序","Description":"在 Azure 上使用 Linux 虚拟机设置和托管基于 Ruby on Rails 的网站。","Content":"# <a name=\"ruby-on-rails-web-application-on-an-azure-vm\"></a>Azure VM 上的 Ruby on Rails Web 应用程序\r 本教程介绍如何在 Azure 中使用 Linux 虚拟机托管 Ruby on Rails 网站。  \r \r 本教程使用 Ubuntu Server 14.04 LTS 进行验证。 如果使用其他 Linux 发行版，可能需要修改安装 Rails 的步骤。\r \r > [!IMPORTANT]\r > Azure 具有用于创建和处理资源的两个不同的部署模型：[Resource Manager 和经典](../../../azure-resource-manager/resource-manager-deployment-model.md)。  本文介绍使用经典部署模型的情况。 Azure 建议大多数新部署使用 Resource Manager 模型。\r > [!INCLUDE [virtual-machines-common-classic-createportal](../../../../includes/virtual-machines-classic-portal.md)]\r >\r \r ## <a name=\"create-an-azure-vm\"></a>创建 Azure VM\r 首先，使用 Linux 映像创建 Azure VM。\r \r 若要创建 VM，可以使用 Azure 门户或 Azure 命令行接口 (CLI)。\r \r ### <a name=\"azure-portal\"></a>Azure 门户\r 1. 登录到 [Azure 门户](https://portal.azure.cn)\r 2. 单击“新建”，再在搜索框中键入“Ubuntu Server 14.04”。 单击搜索返回的条目。 对于部署模型，选择“经典”，再单击“创建”。\r 3. 在“基本信息”边栏选项卡中，输入以下必填字段的值：“名称”（用于 VM）、“用户名”、“身份验证类型”和相应凭据、“Azure 订阅”、“资源组”和“位置”。\r \r    ![创建新的 Ubuntu 映像](./media/virtual-machines-linux-classic-ruby-rails-web-app/createvm.png)\r \r 4. 预配 VM 后，依次单击 VM 名称和“设置”类别中的“终结点”。 找到“独立”下列出的 SSH 终结点。\r \r    ![默认终结点](./media/virtual-machines-linux-classic-ruby-rails-web-app/endpointsnewportal.png)\r \r ### <a name=\"azure-cli\"></a>Azure CLI\r 执行 [创建运行 Linux 的虚拟机][vm-instructions]中的步骤。\r \r 预配 VM 后，可通过运行以下命令获取 SSH 终结点：\r \r     azure vm endpoint list <vm-name>  \r \r ## <a name=\"install-ruby-on-rails\"></a>在 Rails 上安装 Ruby\r 1. 使用 SSH 连接到 VM。\r 2. 从 SSH 会话中，使用以下命令在虚拟机上安装 Ruby：\r \r         sudo apt-get update -y\r         sudo apt-get upgrade -y\r \r         sudo apt-add-repository ppa:brightbox/ruby-ng\r         sudo apt-get update\r         sudo apt-get install ruby2.4\r \r     > [!TIP]\r     > brightbox 存储库包含当前 Ruby 分发。\r \r     安装可能需要几分钟时间。 安装完成后，使用以下命令验证 Ruby 是否已安装：\r \r         ruby -v\r \r 3. 使用以下命令安装 Rails：\r \r         sudo gem install rails --no-rdoc --no-ri -V\r \r     使用 --no-rdoc 和 --no-ri 标志可跳过安装文档，从而加快速度。\r     执行此命令可能需要花费较长时间，添加 -V 可显示有关安装进度的信息。\r \r ## <a name=\"create-and-run-an-app\"></a>创建并运行应用\r 在仍通过 SSH 登录时，运行以下命令：\r \r     rails new myapp\r     cd myapp\r     rails server -b 0.0.0.0 -p 3000\r \r [new](http://guides.rubyonrails.org/command_line.html#rails-new) 命令创建新的 Rails 应用。 [server](http://guides.rubyonrails.org/command_line.html#rails-server) 命令启动 Rails 附带的 WEBrick Web 服务器。 （在生产环境中使用时，可能想要使用其他服务器，例如 Unicorn 或 Passenger。）\r \r 输出应显示如下。\r \r     => Booting WEBrick\r     => Rails 4.2.1 application starting in development on http://0.0.0.0:3000\r     => Run `rails server -h` for more startup options\r     => Ctrl-C to shutdown server\r     [2015-06-09 23:34:23] INFO  WEBrick 1.3.1\r     [2015-06-09 23:34:23] INFO  ruby 1.9.3 (2013-11-22) [x86_64-linux]\r     [2015-06-09 23:34:23] INFO  WEBrick::HTTPServer#start: pid=27766 port=3000\r \r ## <a name=\"add-an-endpoint\"></a>添加终结点\r 1. 转到 [Azure 门户](https://portal.azure.cn)并选择 VM。\r \r 2. 选择页面左侧“设置”中的“终结点”。\r \r 3. 单击页面顶部的“添加”。\r \r 4. 在“添加终结点”对话框页中，输入以下信息：\r \r    * **名称**：HTTP\r    * **协议**：TCP\r    * **公用端口**：80\r    * **专用端口**：3000\r    * **浮动 IP 地址**：已禁用\r    * **访问控制列表 - 顺序**：1001，或设置此访问规则优先级的其他值。\r    * **访问控制列表 - 名称**：allowHTTP\r    * **访问控制列表 - 操作**：允许\r    * **访问控制列表 - 远程子网**：1.0.0.0/16\r \r      此终结点有一个公用端口 80，可以将流量路由到专用端口 3000，即 Rails 服务器侦听的端口。 访问控制列表规则允许端口 80 上的公共流量。\r \r      ![new-endpoint](./media/virtual-machines-linux-classic-ruby-rails-web-app/createendpoint.png)\r \r 5. 单击“确定”，保存此终结点。\r \r 6. 此时应看到一条指出“正在保存虚拟机终结点”的消息。 此消息消失后，终结点即处于活动状态。 现在，可以通过导航到虚拟机的 DNS 名称测试应用程序。 网站应显示如下：\r \r     ![默认 rails 页面][default-rails-cloud]\r \r ## <a name=\"next-steps\"></a>后续步骤\r 在本教程中，手动执行大多数步骤。 在生产环境中，可在开发计算机上编写应用，并将其部署到 Azure VM。 此外，大多数生产环境都结合其他服务器进程（如 Apache 或 NginX）托管 Rails 应用程序，这些进程处理路由到多个 Rails 应用程序实例的请求并提供静态资源。 有关详细信息，请参阅 http://rubyonrails.org/deploy/。\r \r 若要详细了解 Ruby on Rails，请参阅 [Ruby on Rails 指南][rails-guides]。\r \r 若要从 Ruby 应用程序使用 Azure 服务，请参阅：\r \r * [使用 Blob 存储非结构化数据][blobs]\r * [使用表存储键/值对][tables]\r * [使用内容传送网络提供高带宽内容][cdn-howto]\r \r <!-- WA.com links -->\r [blobs]:../../../storage/blobs/storage-ruby-how-to-use-blob-storage.md\r [cdn-howto]:/develop/ruby/app-services/\r [tables]:../../../cosmos-db/table-storage-how-to-use-ruby.md\r [vm-instructions]:createportal.md\r \r <!-- External Links -->\r [rails-guides]:http://guides.rubyonrails.org/\r [sqlite3]:http://www.sqlite.org/\r \r <!-- Images -->\r \r [default-rails-cloud]:./media/virtual-machines-linux-classic-ruby-rails-web-app/basicrailscloud.png\r [vmlist]:./media/virtual-machines-linux-classic-ruby-rails-web-app/vmlist.png\r [endpoints]:./media/virtual-machines-linux-classic-ruby-rails-web-app/endpoints.png\r [new-endpoint]:./media/virtual-machines-linux-classic-ruby-rails-web-app/newendpoint.png\r [new-endpoint1]:./media/virtual-machines-linux-classic-ruby-rails-web-app/newendpoint1.png\r \r <!--Update_Description: update meta properties, add classic portal migration notice.-->"}