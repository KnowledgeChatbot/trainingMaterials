{"Title":"Azure 诊断扩展 1.3 及更高版本的配置架构","Description":"Microsoft Azure SDK 2.4 及更高版本中附带了 Azure 诊断 1.3 及更高版本的架构。","Content":"# <a name=\"azure-diagnostics-13-and-later-configuration-schema\"></a>Azure 诊断 1.3 及更高版本的配置架构\r \r > [!NOTE]\r > Azure 诊断扩展是用来从以下各项收集性能计数器和其他统计信息的组件：\r > - Azure 虚拟机 \r > - 虚拟机规模集\r > - Service Fabric \r > - 云服务 \r > - 网络安全组\r > \r > 在使用以下某个服务时，才需要参阅此页。\r >\r >\r \r \r 此页面适用于版本 1.3 及更高版本（Azure SDK 2.4 及更高版本）。 已对较新的配置节进行注释，以显示其添加于哪一版本。  \r \r 此处描述的配置文件用来在诊断监视器启动时设置诊断配置设置。  \r \r 此扩展可以与其他 Microsoft 诊断产品（例如 Azure Monitor）结合使用。\r \r \r \r 通过执行以下 PowerShell 命令来下载公共配置文件架构定义：  \r \r ```powershell  \r (Get-AzureServiceAvailableExtension -ExtensionName 'PaaSDiagnostics' -ProviderNamespace 'Microsoft.Azure.Diagnostics').PublicConfigurationSchema | Out-File –Encoding utf8 -FilePath 'C:\\temp\\WadConfig.xsd'  \r ```  \r \r 有关使用 Azure 诊断的详细信息，请参阅 [Azure 诊断扩展](azure-diagnostics.md)。  \r \r ## <a name=\"example-of-the-diagnostics-configuration-file\"></a>诊断配置文件示例  \r  以下示例演示典型的诊断配置文件：  \r \r ```xml  \r <?xml version=\"1.0\" encoding=\"utf-8\"?>  \r <DiagnosticsConfiguration  xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\">   \r   <PublicConfig>  \r     <WadCfg>  \r       <DiagnosticMonitorConfiguration overallQuotaInMB=\"10000\">  \r \r         <PerformanceCounters scheduledTransferPeriod=\"PT1M\">  \r           <PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT1M\" unit=\"percent\" />  \r         </PerformanceCounters>  \r \r         <Directories scheduledTransferPeriod=\"PT5M\">  \r           <IISLogs containerName=\"iislogs\" />  \r           <FailedRequestLogs containerName=\"iisfailed\" />  \r \r           <DataSources>  \r             <DirectoryConfiguration containerName=\"mynewprocess\">  \r               <Absolute path=\"C:\\MyNewProcess\" expandEnvironment=\"false\" />  \r             </DirectoryConfiguration>  \r             <DirectoryConfiguration containerName=\"badapp\">  \r               <Absolute path=\"%SYSTEMDRIVE%\\BadApp\" expandEnvironment=\"true\" />  \r             </DirectoryConfiguration>  \r             <DirectoryConfiguration containerName=\"goodapp\">  \r               <LocalResource name=\"Skippy\" relativePath=\"..\\PeanutButter\"/>  \r             </DirectoryConfiguration>  \r           </DataSources>  \r \r         </Directories>  \r \r         <EtwProviders>  \r           <EtwEventSourceProviderConfiguration   \r                        provider=\"MyProviderClass\"   \r                        scheduledTransferPeriod=\"PT5M\">  \r             <Event id=\"0\"/>  \r             <Event id=\"1\" eventDestination=\"errorTable\"/>  \r             <DefaultEvents />  \r           </EtwEventSourceProviderConfiguration>  \r           <EtwManifestProviderConfiguration provider=\"5974b00b-84c2-44bc-9e58-3a2451b4e3ad\" scheduledTransferLogLevelFilter=\"Information\" scheduledTransferPeriod=\"PT2M\">  \r             <Event id=\"0\"/>  \r             <DefaultEvents eventDestination=\"defaultTable\"/>  \r           </EtwManifestProviderConfiguration>  \r         </EtwProviders>  \r \r         <WindowsEventLog scheduledTransferPeriod=\"PT5M\">  \r           <DataSource name=\"System!*[System[Provider[@Name='Microsoft Antimalware']]]\"/>  \r           <DataSource name=\"System!*[System[Provider[@Name='NTFS'] and (EventID=55)]]\" />  \r           <DataSource name=\"System!*[System[Provider[@Name='disk'] and (EventID=7 or EventID=52 or EventID=55)]]\" />  \r         </WindowsEventLog>  \r \r         <Logs  bufferQuotaInMB=\"1024\"   \r              scheduledTransferPeriod=\"PT1M\"   \r              scheduledTransferLogLevelFilter=\"Verbose\"   \r              sinks=\"ApplicationInsights.AppLogs\"/>  <!-- sinks attribute added in 1.5 -->  \r \r         <CrashDumps containerName=\"wad-crashdumps\" directoryQuotaPercentage=\"30\" dumpType=\"Mini\">  \r           <CrashDumpConfiguration processName=\"mynewprocess.exe\" />  \r           <CrashDumpConfiguration processName=\"badapp.exe\"/>  \r         </CrashDumps>  \r \r         <DockerSources> <!-- Added in 1.9 --> \r           <Stats enabled=\"true\" sampleRate=\"PT1M\" scheduledTransferPeriod=\"PT1M\" />\r         </DockerSources>\r \r       </DiagnosticMonitorConfiguration>  \r \r       <SinksConfig>   <!-- Added in 1.5 -->  \r         <Sink name=\"ApplicationInsights\">   \r           <ApplicationInsights>{Insert InstrumentationKey}</ApplicationInsights>   \r           <Channels>   \r             <Channel logLevel=\"Error\" name=\"Errors\"  />   \r             <Channel logLevel=\"Verbose\" name=\"AppLogs\"  />   \r           </Channels>   \r         </Sink>   \r         <Sink name=\"EventHub\"> <!-- Added in 1.7 -->\r           <EventHub Url=\"https://myeventhub-ns.servicebus.chinacloudapi.cn/diageventhub\" SharedAccessKeyName=\"SendRule\" usePublisherId=\"false\" />\r         </Sink>\r         <Sink name=\"secondaryEventHub\"> <!-- Added in 1.7 -->\r           <EventHub Url=\"https://myeventhub-ns.servicebus.chinacloudapi.cn/secondarydiageventhub\" SharedAccessKeyName=\"SendRule\" usePublisherId=\"false\" />\r         </Sink>\r         <Sink name=\"secondaryStorageAccount\"> <!-- Added in 1.7 -->\r           <StorageAccount name=\"secondarydiagstorageaccount\" endpoint=\"https://core.chinacloudapi.cn\" />\r         </Sink>\r    </SinksConfig>\r \r   </WadCfg>  \r \r   <StorageAccount>diagstorageaccount</StorageAccount>\r   <StorageType>TableAndBlob</StorageType> <!-- Added in 1.8 -->  \r   </PublicConfig>  \r \r   <PrivateConfig>  <!-- Added in 1.3 -->  \r     <StorageAccount name=\"\" key=\"\" endpoint=\"\" sasToken=\"{sas token}\"  />  <!-- sasToken in Private config added in 1.8.1 -->  \r     <EventHub Url=\"https://myeventhub-ns.servicebus.chinacloudapi.cn/diageventhub\" SharedAccessKeyName=\"SendRule\" SharedAccessKey=\"{base64 encoded key}\" />\r    \r     <SecondaryStorageAccounts>\r        <StorageAccount name=\"secondarydiagstorageaccount\" key=\"{base64 encoded key}\" endpoint=\"https://core.chinacloudapi.cn\" sasToken=\"{sas token}\" />\r     </SecondaryStorageAccounts>\r    \r     <SecondaryEventHubs>\r        <EventHub Url=\"https://myeventhub-ns.servicebus.chinacloudapi.cn/secondarydiageventhub\" SharedAccessKeyName=\"SendRule\" SharedAccessKey=\"{base64 encoded key}\" />\r     </SecondaryEventHubs>\r \r   </PrivateConfig>  \r   <IsEnabled>true</IsEnabled>  \r </DiagnosticsConfiguration>  \r \r ```  \r \r 先前 XML 配置文件的 JSON 等效项。 \r \r PublicConfig 和 PrivateConfig 是分开的，因为在大多数使用案例中，它们作为不同的参数进行传递。 这些案例包括 Resource Manager 模板、虚拟机规模集 Powershell 和 Visual Studio。 \r \r ```json\r \"PublicConfig\" {\r     \"WadCfg\": {\r         \"DiagnosticMonitorConfiguration\": {\r             \"overallQuotaInMB\": 10000,\r             \"DiagnosticInfrastructureLogs\": {\r                 \"scheduledTransferLogLevelFilter\": \"Error\"\r             },\r             \"PerformanceCounters\": {\r                 \"scheduledTransferPeriod\": \"PT1M\",\r                 \"PerformanceCounterConfiguration\": [\r                     {\r                         \"counterSpecifier\": \"\\\\Processor(_Total)\\\\% Processor Time\",\r                         \"sampleRate\": \"PT1M\",\r                         \"unit\": \"percent\"\r                     }\r                 ]\r             },\r             \"Directories\": {\r                 \"scheduledTransferPeriod\": \"PT5M\",\r                 \"IISLogs\": {\r                     \"containerName\": \"iislogs\"\r                 },\r                 \"FailedRequestLogs\": {\r                     \"containerName\": \"iisfailed\"\r                 },\r                 \"DataSources\": [\r                     {\r                         \"containerName\": \"mynewprocess\",\r                         \"Absolute\": {\r                             \"path\": \"C:\\\\MyNewProcess\",\r                             \"expandEnvironment\": false\r                         }\r                     },\r                     {\r                         \"containerName\": \"badapp\",\r                         \"Absolute\": {\r                             \"path\": \"%SYSTEMDRIVE%\\\\BadApp\",\r                             \"expandEnvironment\": true\r                         }\r                     },\r                     {\r                         \"containerName\": \"goodapp\",\r                         \"LocalResource\": {\r                             \"relativePath\": \"..\\\\PeanutButter\",\r                             \"name\": \"Skippy\"\r                         }\r                     }\r                 ]\r             },\r             \"EtwProviders\": {\r                 \"sinks\": \"\",\r                 \"EtwEventSourceProviderConfiguration\": [\r                     {\r                         \"scheduledTransferPeriod\": \"PT5M\",\r                         \"provider\": \"MyProviderClass\",\r                         \"Event\": [\r                             {\r                                 \"id\": 0\r                             },\r                             {\r                                 \"id\": 1,\r                                 \"eventDestination\": \"errorTable\"\r                             }\r                         ],\r                         \"DefaultEvents\": {\r                         }\r                     }\r                 ],\r                 \"EtwManifestProviderConfiguration\": [\r                     {\r                         \"scheduledTransferPeriod\": \"PT2M\",\r                         \"scheduledTransferLogLevelFilter\": \"Information\",\r                         \"provider\": \"5974b00b-84c2-44bc-9e58-3a2451b4e3ad\",\r                         \"Event\": [\r                             {\r                                 \"id\": 0\r                             }\r                         ],\r                         \"DefaultEvents\": {\r                         }\r                     }\r                 ]\r             },\r             \"WindowsEventLog\": {\r                 \"scheduledTransferPeriod\": \"PT5M\",\r                 \"DataSource\": [\r                     {\r                         \"name\": \"System!*[System[Provider[@Name='Microsoft Antimalware']]]\"\r                     },\r                     {\r                         \"name\": \"System!*[System[Provider[@Name='NTFS'] and (EventID=55)]]\"\r                     },\r                     {\r                         \"name\": \"System!*[System[Provider[@Name='disk'] and (EventID=7 or EventID=52 or EventID=55)]]\"\r                     }\r                 ]\r             },\r             \"Logs\": {\r                 \"scheduledTransferPeriod\": \"PT1M\",\r                 \"scheduledTransferLogLevelFilter\": \"Verbose\",\r                 \"sinks\": \"ApplicationInsights.AppLogs\"\r             },\r             \"CrashDumps\": {\r                 \"directoryQuotaPercentage\": 30,\r                 \"dumpType\": \"Mini\",\r                 \"containerName\": \"wad-crashdumps\",\r                 \"CrashDumpConfiguration\": [\r                     {\r                         \"processName\": \"mynewprocess.exe\"\r                     },\r                     {\r                         \"processName\": \"badapp.exe\"\r                     }\r                 ]\r             }\r         },\r         \"SinksConfig\": {\r             \"Sink\": [\r                 {\r                     \"name\": \"ApplicationInsights\",\r                     \"ApplicationInsights\": \"{Insert InstrumentationKey}\",\r                     \"Channels\": {\r                         \"Channel\": [\r                             {\r                                 \"logLevel\": \"Error\",\r                                 \"name\": \"Errors\"\r                             },\r                             {\r                                 \"logLevel\": \"Verbose\",\r                                 \"name\": \"AppLogs\"\r                             }\r                         ]\r                     }\r                 },\r                 {\r                     \"name\": \"EventHub\",\r                     \"EventHub\": {\r                         \"Url\": \"https://myeventhub-ns.servicebus.chinacloudapi.cn/diageventhub\",\r                         \"SharedAccessKeyName\": \"SendRule\",\r                         \"usePublisherId\": false\r                     }\r                 },\r                 {\r                     \"name\": \"secondaryEventHub\",\r                     \"EventHub\": {\r                         \"Url\": \"https://myeventhub-ns.servicebus.chinacloudapi.cn/secondarydiageventhub\",\r                         \"SharedAccessKeyName\": \"SendRule\",\r                         \"usePublisherId\": false\r                     }\r                 },\r                 {\r                     \"name\": \"secondaryStorageAccount\",\r                     \"StorageAccount\": {\r                         \"name\": \"secondarydiagstorageaccount\",\r                         \"endpoint\": \"https://core.chinacloudapi.cn\"\r                     }\r                 }\r             ]\r         }\r     },\r     \"StorageAccount\": \"diagstorageaccount\",\r     \"StorageType\": \"TableAndBlob\"\r }\r ```\r \r ```json\r \"PrivateConfig\" {\r     \"storageAccountName\": \"diagstorageaccount\",\r     \"storageAccountKey\": \"{base64 encoded key}\",\r     \"storageAccountEndPoint\": \"https://core.chinacloudapi.cn\",\r     \"storageAccountSasToken\": \"{sas token}\",\r     \"EventHub\": {\r         \"Url\": \"https://myeventhub-ns.servicebus.chinacloudapi.cn/diageventhub\",\r         \"SharedAccessKeyName\": \"SendRule\",\r         \"SharedAccessKey\": \"{base64 encoded key}\"\r     },\r     \"SecondaryStorageAccounts\": {\r         \"StorageAccount\": [\r             {\r                 \"name\": \"secondarydiagstorageaccount\",\r                 \"key\": \"{base64 encoded key}\",\r                 \"endpoint\": \"https://core.chinacloudapi.cn\",\r                 \"sasToken\": \"{sas token}\"\r             }\r         ]\r     },\r     \"SecondaryEventHubs\": {\r         \"EventHub\": [\r             {\r                 \"Url\": \"https://myeventhub-ns.servicebus.chinacloudapi.cn/secondarydiageventhub\",\r                 \"SharedAccessKeyName\": \"SendRule\",\r                 \"SharedAccessKey\": \"{base64 encoded key}\"\r             }\r         ]\r     }\r }\r \r ```\r \r ## <a name=\"reading-this-page\"></a>阅读此页  \r  以下标记大致按上述示例中显示的顺序。  如果未看到预期的完整说明，请在页面中搜索元素或属性。  \r \r ## <a name=\"common-attribute-types\"></a>常见的属性类型  \r  **scheduledTransferPeriod** 属性显示在多个元素中。 它是到存储空间的计划传输之间的间隔，向上舍入为最接近的分钟数。 值是 [XML“持续时间数据类型。”](http://www.w3schools.com/schema/schema_dtypes_date.asp)\r \r \r ## <a name=\"diagnosticsconfiguration-element\"></a>DiagnosticsConfiguration 元素  \r  *树：根 - DiagnosticsConfiguration*\r \r 在版本 1.3 中添加。  \r \r 诊断配置文件的顶级元素。  \r \r **Attribute**  xmlns - 诊断配置文件的 XML 命名空间是：  \r http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration  \r \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**PublicConfig**|必需。 在此页的其他位置查看说明。|  \r |**PrivateConfig**|可选。 在此页的其他位置查看说明。|  \r |**IsEnabled**|布尔值。 在此页的其他位置查看说明。|  \r \r ## <a name=\"publicconfig-element\"></a>PublicConfig 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig*\r \r  描述公共诊断配置。  \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**WadCfg**|必需。 在此页的其他位置查看说明。|  \r |**StorageAccount**|用于存储数据的 Azure 存储帐户的名称。 执行 Set-AzureServiceDiagnosticsExtension cmdlet 时，还可能将其指定为参数。|  \r |**StorageType**|可以是 *Table*、*Blob* 或 *TableAndBlob*。 Table 是默认值。 当选择了 TableAndBlob 时，诊断数据将写入两次 -- 针对每种类型写入一次。|  \r |**LocalResourceDirectory**|Monitoring Agent 在其中存储事件数据的虚拟机上的目录。 如果不设置，则使用默认目录：<br /><br /> 对于辅助角色/Web 角色：`C:\\Resources\\<guid>\\directory\\<guid>.<RoleName.DiagnosticStore\\`<br /><br /> 对于虚拟机：`C:\\WindowsAzure\\Logs\\Plugins\\Microsoft.Azure.Diagnostics.IaaSDiagnostics\\<WADVersion>\\WAD<WADVersion>`<br /><br /> 必需属性：<br /><br /> - **path** - Azure 诊断将使用的系统上的目录。<br /><br /> - **expandEnvironment** - 控制是否在路径名称中扩展环境变量。|  \r \r ## <a name=\"wadcfg-element\"></a>WadCFG 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG*\r  \r  标识并配置要收集的遥测数据。  \r \r \r ## <a name=\"diagnosticmonitorconfiguration-element\"></a>DiagnosticMonitorConfiguration 元素 \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration*\r \r  必选 \r \r |属性|说明|  \r |----------------|-----------------|  \r | **overallQuotaInMB** | 由 Azure 诊断收集的各类诊断数据使用的最大本地磁盘空间量。 默认设置是 5120 MB。<br />\r |**useProxyServer** | 将 Azure 诊断配置为使用在 IE 设置中设置的代理服务器设置。|  \r \r <br /> <br />\r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**CrashDumps**|在此页的其他位置查看说明。|  \r |**DiagnosticInfrastructureLogs**|启用收集 Azure 诊断生成的日志。 诊断基础结构日志可用于解决诊断系统本身的故障。 可选属性：<br /><br /> - **scheduledTransferLogLevelFilter** - 配置收集的日志的最低严重级别。<br /><br /> - **scheduledTransferPeriod** - 到存储空间的计划传输之间的时间间隔，向上舍入为最接近的分钟数。 值是 [XML“持续时间数据类型。”](http://www.w3schools.com/schema/schema_dtypes_date.asp) |  \r |**Directories**|在此页的其他位置查看说明。|  \r |**EtwProviders**|在此页的其他位置查看说明。|  \r |**指标**|在此页的其他位置查看说明。|  \r |**PerformanceCounters**|在此页的其他位置查看说明。|  \r |**WindowsEventLog**|在此页的其他位置查看说明。| \r |**DockerSources**|在此页的其他位置查看说明。 | \r \r \r \r ## <a name=\"crashdumps-element\"></a>CrashDumps 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - CrashDumps*\r  \r  启用故障转储收集。  \r \r |属性|说明|  \r |----------------|-----------------|  \r |**containerName**|可选。 Azure 存储帐户中用于存储故障转储的 blob 容器的名称。|  \r |**crashDumpType**|可选。  将 Azure 诊断配置为收集少量或完整故障转储。|  \r |**directoryQuotaPercentage**|可选。  配置为 VM 上故障转储保留的 **overallQuotaInMB** 的百分比。|  \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**CrashDumpConfiguration**|必需。 定义每个进程的配置值。<br /><br /> 还必需以下属性：<br /><br /> **processName** - 希望 Azure 诊断为其收集故障转储的进程的名称。|  \r \r ## <a name=\"directories-element\"></a>Directories 元素 \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration -  Directories*\r \r  启用收集目录内容、IIS 失败的访问请求日志和/或 IIS 日志。  \r \r  可选的 **scheduledTransferPeriod** 属性。 请参阅前面的说明。  \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**IISLogs**|在配置中包括此元素可启用收集 IIS 日志：<br /><br /> **containerName** - Azure 存储帐户中用于存储 IIS 日志的 blob 容器的名称。|   \r |**FailedRequestLogs**|在配置中包括此元素可启用收集有关对 IIS 站点或应用程序的失败请求日志。 还必须在 **Web.config** 文件中的 **system.WebServer** 下启用跟踪选项。|  \r |**DataSources**|要监视的目录的列表。| \r \r \r \r \r ## <a name=\"datasources-element\"></a>DataSources 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - Directories - DataSources*\r \r  要监视的目录的列表。  \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**DirectoryConfiguration**|必需。 必需属性：<br /><br /> **containerName** - Azure 存储帐户中用于存储日志文件的 blob 容器的名称。|  \r \r \r \r \r \r ## <a name=\"directoryconfiguration-element\"></a>DirectoryConfiguration 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - Directories - DataSources - DirectoryConfiguration*\r \r  可能包括 **Absolute** 或 **LocalResource** 元素，但不能同时包含两者。  \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**Absolute**|要监视的目录的绝对路径。 需要以下属性：<br /><br /> - **Path** - 要监视的目录的绝对路径。<br /><br /> - **expandEnvironment** - 配置是否在路径中扩展环境变量。|  \r |**LocalResource**|要监视的本地资源的相对路径。 必需属性：<br /><br /> - **Name** - 包含要监视的目录的本地资源<br /><br /> - **relativePath** - 包含要监视的目录的名称的相对路径|  \r \r \r \r ## <a name=\"etwproviders-element\"></a>EtwProviders 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - EtwProviders*\r \r  配置从基于 EventSource 和/或 ETW 清单的提供程序收集 ETW 事件。  \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**EtwEventSourceProviderConfiguration**|配置收集从 [EventSource 类](http://msdn.microsoft.com/library/system.diagnostics.tracing.eventsource\\(v=vs.110\\).aspx)生成的事件。 必需属性：<br /><br /> **provider** - EventSource 事件的类名称。<br /><br /> 可选属性：<br /><br /> - **scheduledTransferLogLevelFilter** - 要传输到存储帐户的最低严重级别。<br /><br /> - **scheduledTransferPeriod** - 到存储空间的计划传输之间的时间间隔，向上舍入为最接近的分钟数。 值是 [XML“持续时间数据类型。”](http://www.w3schools.com/schema/schema_dtypes_date.asp) |  \r |**EtwManifestProviderConfiguration**|必需属性：<br /><br /> **provider** - 事件提供程序的 GUID<br /><br /> 可选属性：<br /><br /> - **scheduledTransferLogLevelFilter** - 要传输到存储帐户的最低严重级别。<br /><br /> - **scheduledTransferPeriod** - 到存储空间的计划传输之间的时间间隔，向上舍入为最接近的分钟数。 值是 [XML“持续时间数据类型。”](http://www.w3schools.com/schema/schema_dtypes_date.asp) |  \r \r \r \r ## <a name=\"etweventsourceproviderconfiguration-element\"></a>EtwEventSourceProviderConfiguration 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - EtwProviders- EtwEventSourceProviderConfiguration*\r \r  配置收集从 [EventSource 类](http://msdn.microsoft.com/library/system.diagnostics.tracing.eventsource\\(v=vs.110\\).aspx)生成的事件。  \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**DefaultEvents**|可选属性：<br/><br/> **eventDestination** -存储事件的表的名称|  \r |**Event**|必需属性：<br /><br /> **id** - 事件 ID。<br /><br /> 可选属性：<br /><br /> **eventDestination** -存储事件的表的名称|  \r \r \r \r ## <a name=\"etwmanifestproviderconfiguration-element\"></a>EtwManifestProviderConfiguration 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - EtwProviders - EtwManifestProviderConfiguration*\r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**DefaultEvents**|可选属性：<br /><br /> **eventDestination** -存储事件的表的名称|  \r |**Event**|必需属性：<br /><br /> **id** - 事件 ID。<br /><br /> 可选属性：<br /><br /> **eventDestination** -存储事件的表的名称|  \r \r \r \r ## <a name=\"metrics-element\"></a>Metrics 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - Metrics*\r \r  可以生成针对快速查询进行优化的性能计数器表。 在 **PerformanceCounters** 元素中定义的每个性能计数器除存储在性能计数器表内外，还存储在度量值表中。  \r \r  必需 **resourceId** 属性。  要在其中部署 Azure 诊断的虚拟机或虚拟机规模集的资源 ID。 从 [Azure 门户](https://portal.azure.cn)获取 **resourceID**。 选择“浏览” -> “资源组” -> “<名称\\>”。 单击“属性”磁贴，并从“ID”字段复制值。  \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**MetricAggregation**|必需属性：<br /><br /> **scheduledTransferPeriod** - 到存储空间的计划传输之间的时间间隔，向上舍入为最接近的分钟数。 值是 [XML“持续时间数据类型。”](http://www.w3schools.com/schema/schema_dtypes_date.asp) |  \r \r \r \r ## <a name=\"performancecounters-element\"></a>PerformanceCounters 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - PerformanceCounters*\r \r  启用性能计数器收集。  \r \r  可选属性：  \r \r  可选的 **scheduledTransferPeriod** 属性。 请参阅前面的说明。\r \r |子元素|说明|  \r |-------------------|-----------------|  \r |**PerformanceCounterConfiguration**|需要以下属性：<br /><br /> - **counterSpecifier** - 性能计数器的名称。 例如，`\\Processor(_Total)\\% Processor Time`。 若要获取性能计数器列表，请在主机上运行 `typeperf` 命令。<br /><br /> - **sampleRate** - 应对计数器进行采样的频率。<br /><br /> 可选属性：<br /><br /> **unit** - 计数器的度量单位。|  \r \r \r \r \r ## <a name=\"windowseventlog-element\"></a>WindowsEventLog 元素\r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - WindowsEventLog*\r  \r  启用收集 Windows 事件日志。  \r \r  可选的 **scheduledTransferPeriod** 属性。 请参阅前面的说明。  \r \r |子元素|说明|  \r |-------------------|-----------------|  \r |**DataSource**|要收集的 Windows 事件日志。 必需属性：<br /><br /> **name** - 描述要收集的 Windows 事件的 XPath 查询。 例如：<br /><br /> `Application!*[System[(Level <=3)]], System!*[System[(Level <=3)]], System!*[System[Provider[@Name='Microsoft Antimalware']]], Security!*[System[(Level <= 3)]`<br /><br /> 若要收集所有事件，请指定“*”|  \r \r \r \r \r ## <a name=\"logs-element\"></a>Logs 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - Logs*\r \r  在 1.0 和 1.1 版本中提供。 1.2 中不提供。 在 1.3 中重新添加。  \r \r  定义基本 Azure 日志的缓冲区配置。  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**bufferQuotaInMB**|**unsignedInt**|可选。 指定可用于存储指定数据的文件系统存储最大容量。<br /><br /> 默认值为 0。|  \r |**scheduledTransferLogLevelFilterr**|**string**|可选。 指定传输的日志条目的最低严重级别。 默认值是“未定义”，这会传输所有日志。 其他可能的值是（按信息严重级别从高到低排序）“详细”、“信息”、“警告”、“错误”和“严重”。|  \r |**scheduledTransferPeriod**|**duration**|可选。 指定计划的数据传输之间的时间间隔，向上舍入为最接近的分钟数。<br /><br /> 默认是 PT0S。|  \r |**sinks** 在 1.5 中添加|**string**|可选。 指向同时要发送诊断数据的接收器位置。 |  \r \r ## <a name=\"dockersources\"></a>DockerSources\r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - DiagnosticMonitorConfiguration - DockerSources*\r \r  在 1.9 中添加的。\r \r |元素名称|说明|  \r |------------------|-----------------|  \r |**Stats**|告诉系统收集 Docker 容器的统计信息|  \r \r ## <a name=\"sinksconfig-element\"></a>SinksConfig 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - SinksConfig*\r \r  向其中发送诊断数据的位置的列表以及与这些位置关联的配置。  \r \r |元素名称|说明|  \r |------------------|-----------------|  \r |**接收器**|在此页的其他位置查看说明。|  \r \r ## <a name=\"sink-element\"></a>Sink 元素\r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - SinksConfig - Sink*\r \r  在版本 1.5 中添加。  \r \r  定义向其中发送诊断数据的位置。  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**name**|字符串|标识 sinkname 的字符串。|  \r \r |元素|类型|说明|  \r |-------------|----------|-----------------|  \r |**通道**|字符串|每个对应一个流处理的其他筛选|  \r \r ## <a name=\"channels-element\"></a>Channels 元素  \r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - SinksConfig - Sink - Channels*\r \r  在版本 1.5 中添加。  \r \r  定义通过接收器的日志数据流的筛选器。  \r \r |元素|类型|说明|  \r |-------------|----------|-----------------|  \r |**Channel**|字符串|在此页的其他位置查看说明。|  \r \r ## <a name=\"channel-element\"></a>Channel 元素\r  *树：根 - DiagnosticsConfiguration - PublicConfig - WadCFG - SinksConfig - Sink - Channels - Channel*\r \r  在版本 1.5 中添加。  \r \r  定义向其中发送诊断数据的位置。\r \r |属性|类型|说明|  \r |----------------|----------|-----------------|  \r |**logLevel**|**string**|指定传输的日志条目的最低严重级别。 默认值是“未定义”，这会传输所有日志。 其他可能的值是（按信息严重级别从高到低排序）“详细”、“信息”、“警告”、“错误”和“严重”。|  \r |**name**|**string**|要引用的通道的唯一名称|  \r \r \r ## <a name=\"privateconfig-element\"></a>PrivateConfig 元素 \r  *树：根 - DiagnosticsConfiguration - PrivateConfig*\r \r  在版本 1.3 中添加。  \r \r  可选  \r \r  存储存储帐户的私有详细信息（名称、密钥和终结点）。 此信息发送到虚拟机，但不能从中检索。  \r \r |子元素|说明|  \r |--------------------|-----------------|  \r |**StorageAccount**|要使用的存储帐户。 需要以下属性<br /><br /> - **name** - 存储帐户的名称。<br /><br /> - **key** - 存储帐户的密钥。<br /><br /> - **endpoint** - 用于访问存储帐户的终结点。 <br /><br /> -**sasToken**（在 1.8.1 中添加）- 可以在专用配置中指定 SAS 令牌而非存储帐户密钥。如果提供了此项，则会忽略存储帐户密钥。 <br />对 SAS 令牌的要求： <br />- 仅支持帐户 SAS 令牌 <br />- *b*、*t* 服务类型是必需的。 <br /> - *a*、*c*、*u*、*w* 权限是必需的。 <br /> - *c*、*o* 资源类型是必需的。 <br /> - 仅支持 HTTPS 协议 <br /> - 起始时间和到期时间必须有效。|  \r \r \r ## <a name=\"isenabled-element\"></a>IsEnabled 元素  \r  *树：根 - DiagnosticsConfiguration - IsEnabled*\r \r  布尔值。 使用 `true` 启用诊断或使用 `false` 禁用诊断。\r "}