{"Title":"为 Azure 云服务中的角色启用远程桌面连接","Description":"如何配置 Azure 云服务应用程序以允许远程桌面连接","Content":"# <a name=\"enable-remote-desktop-connection-for-a-role-in-azure-cloud-services\"></a>为 Azure 云服务中的角色设置远程桌面连接\r > [!div class=\"op_single_selector\"]\r > * [Azure 门户](./cloud-services-role-enable-remote-desktop-new-portal.md)\r > * [PowerShell](./cloud-services-role-enable-remote-desktop-powershell.md)\r > * [Visual Studio](../vs-azure-tools-remote-desktop-roles.md)\r >\r >\r \r 可以通过远程桌面访问在 Azure 中运行的角色的桌面。 也可以使用远程桌面连接，在应用程序正在运行时排查和诊断其问题。\r \r 可以在开发过程中通过在服务定义中加入远程桌面模块来在角色中启用远程桌面连接，也可以通过远程桌面扩展选择启用远程桌面。 首选方法是使用远程桌面扩展，因为即使在部署应用程序后，也能启用远程桌面，而不必重新部署应用程序。\r \r ## <a name=\"configure-remote-desktop-from-the-azure-portal\"></a>从 Azure 门户配置远程桌面\r Azure 门户使用远程桌面扩展方法，即使在部署应用程序之后，也能启用远程桌面。 使用云服务的“远程桌面”边栏选项卡，可以启用远程桌面，更改用于连接虚拟机的本地 Administrator 帐户、身份验证使用的证书，以及设置到期日期。\r \r 1. 单击“云服务”，再单击云服务的名称，然后单击“远程桌面”。\r \r     ![云服务远程桌面](./media/cloud-services-role-enable-remote-desktop-new-portal/CloudServices_Remote_Desktop.png)\r \r 2. 选择希望为单个角色还是所有角色启用远程桌面，并将切换器的值更改为“已启用” 。\r \r 3. 填写所需的字段：用户名、密码、到期时间和证书。\r \r     ![云服务远程桌面](./media/cloud-services-role-enable-remote-desktop-new-portal/CloudServices_Remote_Desktop_Details.png)\r \r    > [!WARNING]\r    > 当首次启用远程桌面并单击“确定”（复选标记）时，所有角色实例会重新启动。 为避免重新启动，必须对于此角色安装用于对密码进行加密的证书。 如果要避免重新启动，请 [上传云服务的证书](cloud-services-configure-ssl-certificate-portal.md#step-3-upload-a-certificate) ，并返回到此对话框。\r    >\r    >\r 3. 在“**角色**”中，选择要更新的角色，或选择“**全部**”以选择所有角色。\r \r 4. 完成配置更新后，单击“保存”。 角色实例需要一些时间才能准备好接收连接。\r \r ## <a name=\"remote-into-role-instances\"></a>远程到角色实例\r 为角色启用远程桌面后，可以直接从 Azure 门户启动连接：\r \r 1. 单击“实例”，打开“实例”边栏选项卡。\r 2. 选择一个配置了远程桌面的角色实例。\r 3. 单击“连接”  下载角色实例的 RDP 文件。\r \r     ![云服务远程桌面](./media/cloud-services-role-enable-remote-desktop-new-portal/CloudServices_Remote_Desktop_Connect.png)\r \r 4. 依次单击“**打开**”和“**连接**”，以启动远程桌面连接。\r \r >[!NOTE]\r > 如果云服务位于 NSG 后，可能需要创建允许端口**3389** 和 **20000** 上的流量的规则。  远程桌面使用端口 **3389**。  云服务实例经过负载均衡，因此无法直接控制要连接到哪个实例。  RemoteForwarder 和 RemoteAccess 代理管理 RDP 流量，允许客户端发送 RDP cookie 和指定要连接到的单个实例。  RemoteForwarder 和 RemoteAccess 代理要求打开端口 **20000***（如果具有 NSG，此端口可能已被阻止）。\r \r ## <a name=\"additional-resources\"></a>其他资源\r \r [如何配置云服务](cloud-services-how-to-configure-portal.md)\r [云服务常见问题 - 远程桌面](cloud-services-faq.md)\r \r \r <!--Update_Description:update link references and wording-->"}