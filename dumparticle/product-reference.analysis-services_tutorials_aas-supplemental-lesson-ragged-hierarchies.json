{"Title":"Azure Analysis Services 教程补充课程：不规则层次结构","Description":"介绍如何在 Azure Analysis Services 教程中修复不规则层次结构。","Content":"# <a name=\"supplemental-lesson---ragged-hierarchies\"></a>补充课程 - 不规则层次结构\r \r [!INCLUDE[analysis-services-appliesto-aas-sql2017-later](../../../includes/analysis-services-appliesto-aas-sql2017-later.md)]\r \r 在本补充课程中，将解决对在不同级别包含空白值（成员）的层次结构进行透视时的一个常见问题。 例如，某个组织的高级经理同时具有部门经理和非经理作为直接下属。 或者，地理区域层次结构包含国家/地区-区域-城市，其中，某些城市没有父代“州”或“省”，例如“华盛顿特区”、“梵蒂冈城”。 当某个层次结构具有空白成员时，它通常降低到不同的（或不规则的）级别。\r \r ![aas-lesson-detail-ragged-hierarchies-table](../tutorials/media/aas-lesson-detail-ragged-hierarchies-table.png)\r \r 1400 兼容级别的表格模型有一个额外的针对层次结构的“隐藏成员”属性。 **默认**设置假定在任何级别都没有空白成员。 将层次结构添加到数据透视表或报表时，“隐藏空白成员”设置将从层次结构中排除空白成员。  \r \r 本课预计完成时间：**20 分钟**  \r \r ## <a name=\"prerequisites\"></a>先决条件  \r 本补充课程主题是表格建模教程的一部分。 在执行本补充课程中的任务之前，应当已完成了前面的所有课程，或者具有已完成的“Adventure Works Internet 销售”示例模型项目。 \r \r 如果已经将“AW Internet 销售”项目创建为教程的一部分，则模型中尚未包含任何不规则的数据或层次结构。 若要完成本补充课程，必须首先通过添加一些其他表并创建关系、计算列、度量值和新的 Organization 层次结构来制造问题。 该部分需要花费大约 15 分钟。 然后，需要花费几分钟时间来解决此问题。  \r \r ## <a name=\"add-tables-and-objects\"></a>添加表和对象\r \r ### <a name=\"to-add-new-tables-to-your-model\"></a>向模型中添加新表\r \r 1.  在表格模型资源管理器中，展开“数据源”，右键单击连接，并单击“导入新表”。\r \r 2.  在导航器中，选择“DimEmployee”和“FactResellerSales”，并单击“确定”。\r \r 3.  在查询编辑器中，单击“导入”。\r \r 4.  创建以下[关系](../tutorials/aas-lesson-4-create-relationships.md)：\r \r     | 表 1           | 列       | 筛选器方向   | 表 2     | 列      | 活动 |\r     |-------------------|--------------|--------------------|-------------|-------------|--------|\r     | FactResellerSales | OrderDateKey | 默认            | DimDate     | 日期        | 是    |\r     | FactResellerSales | DueDate      | 默认            | DimDate     | 日期        | 否     |\r     | FactResellerSales | ShipDateKey  | 默认            | DimDate     | 日期        | 否     |\r     | FactResellerSales | ProductKey   | 默认            | DimProduct  | ProductKey  | 是    |\r     | FactResellerSales | EmployeeKey  | 到两个表 | DimEmployee | EmployeeKey | 是    |\r \r 5. 在“DimEmployee”表中，创建以下[计算列](../tutorials/aas-lesson-5-create-calculated-columns.md)： \r \r     **路径** \r     ```\r     =PATH([EmployeeKey],[ParentEmployeeKey])\r     ```\r \r     **FullName** \r     ```\r     =[FirstName] & \" \" & [MiddleName] & \" \" & [LastName]\r     ```\r \r     **Level1** \r     ```\r     =LOOKUPVALUE(DimEmployee[FullName],DimEmployee[EmployeeKey],PATHITEM([Path],1,1)) \r     ```\r \r     **Level2** \r     ```\r     =LOOKUPVALUE(DimEmployee[FullName],DimEmployee[EmployeeKey],PATHITEM([Path],2,1)) \r     ```\r \r     **Level3** \r     ```\r     =LOOKUPVALUE(DimEmployee[FullName],DimEmployee[EmployeeKey],PATHITEM([Path],3,1)) \r     ```\r \r     **Level4** \r     ```\r     =LOOKUPVALUE(DimEmployee[FullName],DimEmployee[EmployeeKey],PATHITEM([Path],4,1)) \r     ```\r \r     **Level5** \r     ```\r     =LOOKUPVALUE(DimEmployee[FullName],DimEmployee[EmployeeKey],PATHITEM([Path],5,1)) \r     ```\r \r 6.  在“DimEmployee”表中，创建一个名为“Organization”的[层次结构](../tutorials/aas-lesson-9-create-hierarchies.md)。 按顺序添加以下列：“Level1”、“Level2”、“Level3”、“Level4”、“Level5”。\r \r 7.  在“FactResellerSales”表中，创建以下[度量值](../tutorials/aas-lesson-6-create-measures.md)：\r \r     ```\r     ResellerTotalSales:=SUM([SalesAmount])\r     ```\r \r 8.  使用[“在 Excel 中分析”](../tutorials/aas-lesson-12-analyze-in-excel.md)打开 Excel 并自动创建一个数据透视表。\r \r 9.  在“数据透视表字段”中，将“DimEmployee”表中的“Organization”层次结构添加到“行”，将“FactResellerSales”表中的“ResellerTotalSales”度量值添加到“值”。\r \r     ![aas-lesson-detail-ragged-hierarchies-pivottable](../tutorials/media/aas-lesson-detail-ragged-hierarchies-pivottable.png)\r \r     如数据透视表中所示，该层次结构显示了不规则的行。 许多行中显示了空白成员。\r \r ## <a name=\"to-fix-the-ragged-hierarchy-by-setting-the-hide-members-property\"></a>通过设置“隐藏成员”属性修复不规则层次结构\r \r 1.  在“表格模型资源管理器”中，展开“表” > “DimEmployee” > “层次结构” > “Organization”。\r \r 2.  在“属性” > “隐藏成员”中，选择“隐藏空白成员”。 \r \r     ![aas-lesson-detail-ragged-hierarchies-hidemembers](../tutorials/media/aas-lesson-detail-ragged-hierarchies-hidemembers.png)\r \r 3.  回到 Excel 中，刷新数据透视表。 \r \r     ![aas-lesson-detail-ragged-hierarchies-pivottable-refresh](../tutorials/media/aas-lesson-detail-ragged-hierarchies-pivottable-refresh.png)\r \r     现在看起来好多了！\r \r ## <a name=\"see-also\"></a>另请参阅   \r [第 9 课：创建层次结构](../tutorials/aas-lesson-9-create-hierarchies.md)  \r [补充课程 - 动态安全性](../tutorials/aas-supplemental-lesson-dynamic-security.md)  \r [补充课程 - 详细信息行](../tutorials/aas-supplemental-lesson-detail-rows.md)\r \r <!--Update_Description: update meta properties -->"}