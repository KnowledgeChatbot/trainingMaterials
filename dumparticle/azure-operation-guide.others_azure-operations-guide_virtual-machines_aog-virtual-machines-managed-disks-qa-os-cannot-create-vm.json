{"Title":"如何处理托管磁盘 OS 盘无法创建虚拟机的问题","Description":"如何处理托管磁盘 OS 盘无法创建虚拟机的问题","Content":"# 如何处理托管磁盘 OS 盘无法创建虚拟机的问题\r \r ## 适用场景\r \r 当客户删除使用托盘磁盘的虚拟机，尝试使用该 OS 磁盘再次创建虚拟机的时候，发现没有“ **创建 VM** ”的按钮。\r \r > [!NOTE]\r > 本文仅适用于使用托管磁盘的虚拟机\r \r ## 解决方案\r \r 1. 首先，我们需要通过 PowShell 来查看该托盘磁盘的信息。\r \r     ```PowerShell\r     #查询托盘磁盘信息\r     PS C:\\windows\\system32> Get-AzureRmDisk -ResourceGroupName \"<资源组名称>\" -DiskName \"<托盘磁盘名称>\"\r \r     ResourceGroupName  : 资源组名称\r     AccountType        : StandardLRS\r     TimeCreated        : 7/20/2017 12:30:31 PM\r     OsType             :        <-这里空白代表缺失了 OsType\r     CreationData       : Microsoft.Azure.Management.Compute.Models.CreationData\r     DiskSizeGB         : 磁盘大小\r     EncryptionSettings :\r     OwnerId            :\r     ProvisioningState  : Succeeded\r     Id                 : /subscriptions/订阅 ID/resourceGroups/资源组名称/providers/Microsoft.Compute/disks/托盘磁盘名称\r     Name               : 托盘磁盘名称\r     Type               : Microsoft.Compute/disks\r     Location           : chinaeast\r     Tags               : {}\r     ```\r \r     缺失 OsType 的托管磁盘会被视作是数据磁盘，所以在该磁盘页面下，没有 “**创建 VM**“ 的按钮。\r \r 2. 手动更新该托管磁盘的 OsType 来赋予正确的键值。\r \r     ```PowerShell\r     #将托盘磁盘信息赋予给变量\r     PS C:\\windows\\system32> $Disk = Get-AzureRmDisk -ResourceGroupName \"<资源组名称>\" -DiskName \"<托盘磁盘名称>\"\r     #查询托盘磁盘信息确认无误\r     PS C:\\windows\\system32> $Disk\r \r     ResourceGroupName  : 资源组名称\r     AccountType        : StandardLRS\r     TimeCreated        : 7/20/2017 12:30:31 PM\r     OsType             :        <-这里空白代表缺失了 OsType\r     CreationData       : Microsoft.Azure.Management.Compute.Models.CreationData\r     DiskSizeGB         : 磁盘大小\r     EncryptionSettings :\r     OwnerId            :\r     ProvisioningState  : Succeeded\r     Id                 : /subscriptions/订阅 ID/resourceGroups/资源组名称/providers/Microsoft.Compute/disks/托盘磁盘名称\r     Name               : 托盘磁盘名称\r     Type               : Microsoft.Compute/disks\r     Location           : chinaeast\r     Tags               : {}\r \r     #输入托盘磁盘的 OsType\r     PS C:\\windows\\system32> $Disk.OsType = \"Linux\" <-根据虚拟机 OS 类型选择 Windows 或者 Linux\r     #手动更新托盘磁盘的信息\r     PS C:\\windows\\system32> Update-AzureRmDisk -ResourceGroupName \"<资源组名称>\" -DiskName \"<托盘磁盘名称>\" -Disk $Disk\r \r     AccountType        : StandardLRS\r     TimeCreated        : 7/20/2017 8:30:31 PM\r     OsType             : Linux\r     CreationData       : Microsoft.Azure.Management.Compute.Models.CreationData\r     DiskSizeGB         : 磁盘大小\r     EncryptionSettings :\r     OwnerId            :\r     ProvisioningState  : Succeeded\r     Id                 : /subscriptions/订阅 ID/resourceGroups/资源组名称/providers/Microsoft.Compute/disks/托盘磁盘名称\r     Name               : 托盘磁盘名称\r     Type               : Microsoft.Compute/disks\r     Location           : chinaeast\r     Tags               :\r     ```\r \r 3.\t在 [Azure 门户](https://portal.azure.cn) 上重新查看该托盘磁盘的信息，可以看到 “**创建 VM**” 的按钮了\r  \r     ![portal](media/aog-virtual-machines-managed-disks-qa-os-cannot-create-vm/portal.png)"}