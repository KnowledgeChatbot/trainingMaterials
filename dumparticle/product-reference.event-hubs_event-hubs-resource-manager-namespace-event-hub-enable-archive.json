{"Title":"使用模板创建 Azure 事件中心命名空间并启用存档","Description":"使用 Azure Resource Manager 模板创建包含一个事件中心的 Azure 事件中心命名空间并启用存档","Content":"# 使用 Azure Resource Manager 模板创建包含事件中心的事件中心命名空间并启用存档\r <a name=\"create-an-event-hubs-namespace-with-an-event-hub-and-enable-archive-using-an-azure-resource-manager-template\" ></a>\r 本文介绍如何使用 Azure Resource Manager 模板创建包含一个事件中心实例的事件中心类型的命名空间，并在事件中心上启用存档功能。 本文介绍如何定义要部署的资源以及如何定义执行部署时指定的参数。 可将此模板用于自己的部署，或自定义此模板以满足要求\r \r 有关创建模板的详细信息，请参阅 [创作 Azure Resource Manager 模板][Authoring Azure Resource Manager templates]。\r \r <!-- Not Available for [Azure Resources Naming Conventions][Azure Resources Naming Conventions] -->\r 有关完整的模板，请参阅 GitHub 上的 [事件中心和启用存档模板][Event Hub and enable Archive template] 。\r \r > [!NOTE]\r > 若要检查最新模板，请访问 [Azure 快速启动模板][Azure Quickstart Templates] 库并搜索事件中心。\r > \r > \r \r ## 你将部署什么内容？\r <a name=\"what-will-you-deploy\" ></a>\r 借助此模板，可以部署包含事件中心的事件中心命名空间并启用事件中心存档。\r \r [事件中心](event-hubs-what-is-event-hubs.md)是一种事件处理服务，用于向 Azure 提供大规模的事件与遥测数据入口，并且具有较低的延迟和较高的可靠性。 使用事件中心存档，可以按照所选指定时间或大小间隔将事件中心中的流数据自动传送到所选的 Azure Blob 存储。\r \r 若要自动运行部署，请单击以下按钮：\r \r [![部署到 Azure](./media/event-hubs-resource-manager-namespace-event-hub/deploybutton.png)](https://portal.azure.cn/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2F201-eventhubs-create-namespace-and-enable-archive%2Fazuredeploy.json)\r \r ## Parameters\r <a name=\"parameters\" ></a>\r \r 使用 Azure Resource Manager，可以定义在部署模板时想要指定的值的参数。 该模板具有一个名为 `Parameters` 的部分，其中包含所有参数值。 你应该为随着要部署的项目或要部署到的环境而变化的值定义参数。 不要为永远保持不变的值定义参数。 每个参数值可在模板中用来定义所部署的资源。\r \r 模板定义以下参数。\r \r ### eventHubNamespaceName\r <a name=\"eventhubnamespacename\" ></a>\r \r 要创建的事件中心命名空间的名称。\r \r ```json\r \"eventHubNamespaceName\":{  \r      \"type\":\"string\",\r      \"metadata\":{  \r          \"description\":\"Name of the EventHub namespace\"\r       }\r }\r ```\r \r ### eventHubName\r <a name=\"eventhubname\" ></a>\r \r 在事件中心命名空间中创建的事件中心的名称。\r \r ```json\r \"eventHubName\":{  \r     \"type\":\"string\",\r     \"metadata\":{  \r         \"description\":\"Name of the event hub\"\r     }\r }\r ```\r \r ### messageRetentionInDays\r <a name=\"messageretentionindays\" ></a>\r \r 要在事件中心内保留消息的天数。 \r \r ```json\r \"messageRetentionInDays\":{\r     \"type\":\"int\",\r     \"defaultValue\": 1,\r     \"minValue\":\"1\",\r     \"maxValue\":\"7\",\r     \"metadata\":{\r        \"description\":\"How long to retain the data in event hub\"\r      }\r  }\r ```\r \r ### partitionCount\r <a name=\"partitioncount\" ></a>\r \r 要在事件中心内创建的分区数。\r \r ```json\r \"partitionCount\":{\r     \"type\":\"int\",\r     \"defaultValue\":2,\r     \"minValue\":2,\r     \"maxValue\":32,\r     \"metadata\":{\r         \"description\":\"Number of partitions chosen\"\r     }\r  }\r ```\r \r ### archiveEnabled\r <a name=\"archiveenabled\" ></a>\r 在事件中心上启用存档。\r \r ```json\r \"archiveEnabled\":{\r     \"type\":\"string\",\r     \"defaultValue\":\"true\",\r     \"allowedValues\": [\r     \"false\",\r     \"true\"],\r     \"metadata\":{\r         \"description\":\"Enable or disable the Archive for your event hub\"\r     }\r  }\r ```\r \r ### archiveEncodingFormat\r <a name=\"archiveencodingformat\" ></a>\r \r 指定用于序列化事件数据的编码格式。\r \r ```json\r \"archiveEncodingFormat\":{\r     \"type\":\"string\",\r     \"defaultValue\":\"Avro\",\r     \"allowedValues\":[\r     \"Avro\"],\r     \"metadata\":{\r         \"description\":\"The encoding format Archive serializes the EventData\"\r     }\r }\r ```\r \r ### archiveTime\r <a name=\"archivetime\" ></a>\r 事件中心存档开始将数据存档在 Azure Blob 存储中的时间间隔。\r \r ```json\r \"archiveTime\":{\r     \"type\":\"int\",\r     \"defaultValue\":300,\r     \"minValue\":60,\r     \"maxValue\":900,\r     \"metadata\":{\r          \"description\":\"the time window in seconds for the archival\"\r     }\r }\r ```\r \r ### archiveSize\r <a name=\"archivesize\" ></a>\r 存档开始将数据存档在 Azure blob 存储中的大小间隔。\r \r ```json\r \"archiveSize\":{\r     \"type\":\"int\",\r     \"defaultValue\":314572800,\r     \"minValue\":10485760,\r     \"maxValue\":524288000,\r     \"metadata\":{\r         \"description\":\"the size window in bytes for archival\"\r     }\r }\r ```\r \r ### destinationStorageAccountResourceId\r <a name=\"destinationstorageaccountresourceid\" ></a>\r 存档需要 Azure 存储帐户资源 ID，以启用到所需存储帐户的存档。\r \r ```json\r  \"destinationStorageAccountResourceId\":{\r     \"type\":\"string\",\r     \"metadata\":{\r         \"description\":\"Your existing storage Account resource id where you want the blobs be archived\"\r     }\r  }\r ```\r \r ### blobContainerName\r <a name=\"blobcontainername\" ></a>\r 用于存档事件数据的 blob 容器。\r \r ```json\r  \"blobContainerName\":{\r     \"type\":\"string\",\r     \"metadata\":{\r         \"description\":\"Your existing storage container that you want the blobs archived in\"\r     }\r }\r ```\r \r ### apiVersion\r <a name=\"apiversion\" ></a>\r \r 模板的 API 版本。\r \r ```json\r  \"apiVersion\":{  \r     \"type\":\"string\",\r     \"defaultValue\":\"2015-08-01\",\r     \"metadata\":{  \r         \"description\":\"ApiVersion used by the template\"\r     }\r  }\r ```\r \r ## 要部署的资源\r <a name=\"resources-to-deploy\" ></a>\r 创建包含一个事件中心的 **EventHubs** 类型的命名空间并启用存档。\r \r ```json\r \"resources\":[  \r       {  \r          \"apiVersion\":\"[variables('ehVersion')]\",\r          \"name\":\"[parameters('eventHubNamespaceName')]\",\r          \"type\":\"Microsoft.EventHub/Namespaces\",\r          \"location\":\"[variables('location')]\",\r          \"sku\":{  \r             \"name\":\"Standard\",\r             \"tier\":\"Standard\"\r          },\r          \"resources\":[  \r             {  \r                \"apiVersion\":\"[variables('ehVersion')]\",\r                \"name\":\"[parameters('eventHubName')]\",\r                \"type\":\"EventHubs\",\r                \"dependsOn\":[  \r                   \"[concat('Microsoft.EventHub/namespaces/', parameters('eventHubNamespaceName'))]\"\r                ],\r                \"properties\":{  \r                   \"path\":\"[parameters('eventHubName')]\",\r                   \"MessageRetentionInDays\":\"[parameters('messageRetentionInDays')]\",\r                   \"PartitionCount\":\"[parameters('partitionCount')]\",\r                   \"ArchiveDescription\":{\r                         \"enabled\":\"[parameters('archiveEnabled')]\",\r                         \"encoding\":\"[parameters('archiveEncodingFormat')]\",\r                         \"intervalInSeconds\":\"[parameters('archiveTime')]\",\r                         \"sizeLimitInBytes\":\"[parameters('archiveSize')]\",\r                         \"destination\":{\r                             \"name\":\"EventHubArchive.AzureBlockBlob\",\r                             \"properties\":{\r                                 \"StorageAccountResourceId\":\"[parameters('destinationStorageAccountResourceId')]\",\r                                 \"BlobContainer\":\"[parameters('blobContainerName')]\"\r                             }\r                         } \r                   }\r \r                }\r \r             }\r          ]\r       }\r    ]\r ```\r \r ## 运行部署的命令\r <a name=\"commands-to-run-deployment\" ></a>\r \r [!INCLUDE [app-service-deploy-commands](../../includes/app-service-deploy-commands.md)]\r \r ## PowerShell\r <a name=\"powershell\" ></a>\r \r ```powershell\r New-AzureRmResourceGroupDeployment -ResourceGroupName \\<resource-group-name\\> -TemplateFile https://raw.githubusercontent.com/azure/azure-quickstart-templates/master/201-eventhubs-create-namespace-and-enable-archive/azuredeploy.json\r ```\r \r ## Azure CLI\r <a name=\"azure-cli\" ></a>\r \r ```cli\r azure config mode arm\r \r azure group deployment create \\<my-resource-group\\> \\<my-deployment-name\\> --template-uri [https://raw.githubusercontent.com/azure/azure-quickstart-templates/master/201-eventhubs-create-namespace-and-enable-archive/azuredeploy.json][]\r ```\r \r ## 后续步骤\r <a name=\"next-steps\" ></a>\r 访问以下链接可以了解有关事件中心的详细信息：\r \r * [事件中心概述](event-hubs-what-is-event-hubs.md)\r * [创建事件中心](event-hubs-create.md)\r * [事件中心常见问题](event-hubs-faq.md)\r \r [Authoring Azure Resource Manager templates]: ../azure-resource-manager/resource-group-authoring-templates.md\r [Azure Quickstart Templates]:  https://github.com/Azure/azure-quickstart-templates/?term=event+hubs\r [Using Azure PowerShell with Azure Resource Manager]: ../powershell-azure-resource-manager.md\r [Using the Azure CLI for Mac, Linux, and Windows with Azure Resource Management]: ../azure-resource-manager/xplat-cli-azure-resource-manager.md\r [Event hub and consumer group template]: https://github.com/Azure/azure-quickstart-templates/blob/master/201-eventhubs-create-namespace-and-enable-archive/\r <!-- Not Available [Azure Resources Naming Conventions]: ../guidance-naming-conventions.md-->\r [Event hub and enable Archive template]:https://github.com/Azure/azure-quickstart-templates/tree/master/201-eventhubs-create-namespace-and-enable-archive"}