{"Title":"为 Azure 云服务启用远程桌面","Description":"如何配置 Azure 云服务应用程序以允许远程桌面连接","Content":"# <a name=\"enable-remote-desktop-connection-for-a-role-in-azure-cloud-services\"></a>为 Azure 云服务中的角色设置远程桌面连接\r \r >[!div class=\"op_single_selector\"]\r > * [Azure 门户](./cloud-services-role-enable-remote-desktop-new-portal.md)\r > * [Azure 经典门户](./cloud-services-role-enable-remote-desktop.md)\r > * [PowerShell](./cloud-services-role-enable-remote-desktop-powershell.md)\r > * [Visual Studio](../vs-azure-tools-remote-desktop-roles.md)\r \r 你可以在开发过程中通过在服务定义中加入远程桌面模块来在角色中启用远程桌面连接，也可以通过远程桌面扩展选择启用远程桌面。 首选方法是使用远程桌面扩展，因为即使在部署应用程序后，也能启用远程桌面，而不必重新部署应用程序。 \r \r ## <a name=\"configure-remote-desktop-from-the-azure-classic-portal\"></a>从 Azure 经典门户配置远程桌面\r Azure 经典门户使用远程桌面扩展方法，即使在部署应用程序之后，也能启用远程桌面。 使用云服务的“配置”页，可以启用远程桌面、更改用于连接虚拟机的本地 Administrator 帐户、身份验证使用的证书，以及设置到期日期  。\r \r 1. 单击“云服务”，单击云服务的名称，然后单击“配置”。\r 2. 单击底部的“远程”  按钮。\r \r     ![云服务远程](./media/cloud-services-role-enable-remote-desktop/CloudServices_Remote.png)\r \r    > [!WARNING]\r    > 当首次启用远程桌面并单击“确定”（复选标记）时，所有角色实例会重新启动。 为避免重新启动，必须对于此角色安装用于对密码进行加密的证书。 若要避免重新启动，请[上传云服务的证书](cloud-services-configure-ssl-certificate.md#step-3-upload-a-certificate)，然后返回到此对话框。\r \r 3. 在“**角色**”中，选择要更新的角色，或选择“**全部**”以选择所有角色。\r \r 4. 进行以下任何更改：\r \r     - 若要启用远程桌面，请选中“启用远程桌面”复选框  。 若要禁用远程桌面，请清除该复选框。\r \r     - 创建一个要在角色实例的远程桌面连接中使用的帐户。\r \r     - 更新现有帐户的密码。\r \r     - 选择要用于身份验证的已上传证书（使用“证书”页上的“上传”上传证书），或者创建新证书。 \r \r     - 更改远程桌面配置的到期日期。\r \r 5. 完成配置更新后，请单击“确定”（复选标记）。\r \r ## <a name=\"remote-into-role-instances\"></a>远程到角色实例\r 对角色启用远程桌面后，可以通过各种工具远程连接到角色实例。\r \r 若要从 Azure 经典门户连接到角色实例，请执行以下操作：\r \r 1. 单击“实例”，打开“实例”页。\r 2. 选择一个配置了远程桌面的角色实例。\r 3. 单击“连接”，并按照说明打开桌面 。\r 4. 依次单击“**打开**”和“**连接**”，以启动远程桌面连接。\r \r ### <a name=\"use-visual-studio-to-remote-into-a-role-instance\"></a>使用 Visual Studio 远程连接到角色实例\r \r 在 Visual Studio 的“服务器资源管理器”中：\r \r 1. 展开“Azure” > “云服务” > “云服务名称”节点。\r 2. 展开“过渡”或“生产”。\r 3. 展开各个角色。\r 4. 右键单击某一角色实例，单击“使用远程桌面连接...” ，然后输入用户名和密码。 \r \r ![服务器资源管理器远程桌面](./media/cloud-services-role-enable-remote-desktop/ServerExplorer_RemoteDesktop.png)\r \r ### <a name=\"use-powershell-to-get-the-rdp-file\"></a>使用 PowerShell 获取 RDP 文件\r 可以使用 [Get-AzureRemoteDesktopFile](https://msdn.microsoft.com/zh-cn/library/azure/dn495261.aspx) cmdlet 检索 RDP 文件。 然后可以使用具有远程桌面连接的 RDP 文件来访问云服务。\r \r ### <a name=\"programmatically-download-the-rdp-file-through-the-service-management-rest-api\"></a>通过服务管理 REST API 以编程方式下载 RDP 文件\r 可以使用 [下载 RDP 文件](https://msdn.microsoft.com/zh-cn/library/jj157183.aspx) REST 操作下载 RDP 文件。 \r \r ## <a name=\"to-configure-remote-desktop-in-the-service-definition-file\"></a>在服务定义文件中配置远程访问\r \r 此方法允许你在开发过程中为应用程序启用远程桌面。 此方法需要将加密的密码存储在服务配置文件中，并且如果对远程桌面配置进行了任何更新，都需要重新部署应用程序。 如果想要避免这些弊端，应使用上面所述的基于远程桌面扩展的方法。  \r \r 可以通过服务定义文件方法使用 Visual Studio [启用远程桌面连接](../vs-azure-tools-remote-desktop-roles.md)。  \r 下面的步骤介绍了启用远程桌面需要对服务模型文件进行的更改。 发布时，Visual Studio 会自动进行这些更改。\r \r ### <a name=\"set-up-the-connection-in-the-service-model\"></a>在服务模型中设置连接 \r 使用 **Imports** 元素将 **RemoteAccess** 模块和 **RemoteForwarder** 模块导入到 [ServiceDefinition.csdef](./cloud-services-model-and-package.md#csdef) 文件中。\r \r 服务定义文件应类似于下面的示例，并添加 `<Imports>` 元素。\r \r ```xml\r <ServiceDefinition name=\"<name-of-cloud-service>\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2008/10/ServiceDefinition\" schemaVersion=\"2013-03.2.0\">\r     <WebRole name=\"WebRole1\" vmsize=\"Small\">\r         <Sites>\r             <Site name=\"Web\">\r                 <Bindings>\r                     <Binding name=\"Endpoint1\" endpointName=\"Endpoint1\" />\r                 </Bindings>\r             </Site>\r         </Sites>\r         <Endpoints>\r             <InputEndpoint name=\"Endpoint1\" protocol=\"http\" port=\"80\" />\r         </Endpoints>\r         <Imports>\r             <Import moduleName=\"Diagnostics\" />\r             <Import moduleName=\"RemoteAccess\" />\r             <Import moduleName=\"RemoteForwarder\" />\r         </Imports>\r     </WebRole>\r </ServiceDefinition>\r ```\r [ServiceConfiguration.cscfg](./cloud-services-model-and-package.md#cscfg) 文件应类似于下面的示例，请注意 `<ConfigurationSettings>` 和 `<Certificates>` 元素。 指定的证书必须[已上传到云服务](./cloud-services-how-to-create-deploy.md#how-to-upload-a-certificate-for-a-cloud-service)。\r \r ```xml\r <?xml version=\"1.0\" encoding=\"utf-8\"?>\r <ServiceConfiguration serviceName=\"<name-of-cloud-service>\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2008/10/ServiceConfiguration\" osFamily=\"3\" osVersion=\"*\" schemaVersion=\"2013-03.2.0\">\r     <Role name=\"WebRole1\">\r         <Instances count=\"2\" />\r         <ConfigurationSettings>\r             <Setting name=\"Microsoft.WindowsAzure.Plugins.RemoteAccess.Enabled\" value=\"true\" />\r             <Setting name=\"Microsoft.WindowsAzure.Plugins.RemoteAccess.AccountUsername\" value=\"[name-of-user-account]\" />\r             <Setting name=\"Microsoft.WindowsAzure.Plugins.RemoteAccess.AccountEncryptedPassword\" value=\"[base-64-encrypted-user-password]\" />\r             <Setting name=\"Microsoft.WindowsAzure.Plugins.RemoteAccess.AccountExpiration\" value=\"[certificate-expiration]\" />\r             <Setting name=\"Microsoft.WindowsAzure.Plugins.RemoteForwarder.Enabled\" value=\"true\" />\r         </ConfigurationSettings>\r         <Certificates>\r             <Certificate name=\"Microsoft.WindowsAzure.Plugins.RemoteAccess.PasswordEncryption\" thumbprint=\"[certificate-thumbprint]\" thumbprintAlgorithm=\"sha1\" />\r         </Certificates>\r     </Role>\r </ServiceConfiguration>\r ```\r \r ## <a name=\"additional-resources\"></a>其他资源\r [如何配置云服务](./cloud-services-how-to-configure.md)\r [云服务常见问题 - 远程桌面](./cloud-services-faq.md#remote-desktop)\r \r <!--Update_Description:update wording and link references-->\r "}