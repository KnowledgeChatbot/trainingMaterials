{"Title":"监视 XTP 内存中存储","Description":"估算和监视 XTP 内存中存储用量与容量；解决容量错误 41823","Content":"# <a name=\"monitor-in-memory-oltp-storage\"></a>监视内存中 OLTP 存储\r 使用[内存中 OLTP](sql-database-in-memory.md) 时，内存优化表中的数据和表变量将驻留在内存中 OLTP 存储内。 每个高级服务层都有最大的内存中 OLTP 存储大小，详见文档[单一数据库资源限制](sql-database-resource-limits.md#single-database-storage-sizes-and-performance-levels)和[弹性池资源限制](sql-database-resource-limits.md#elastic-pool-change-storage-size)。 超过此限制后，插入和更新操作可能会开始失败（错误 41823）。 到时，需要删除数据以回收内存，或升级数据库的性能层。\r \r ## <a name=\"determine-whether-data-will-fit-within-the-in-memory-storage-cap\"></a>确定数据是否在内存中存储容量限制范围内\r 确定不同高级服务层的存储限制。 请参阅[单一数据库资源限制](sql-database-resource-limits.md#single-database-storage-sizes-and-performance-levels)和[弹性池资源限制](sql-database-resource-limits.md#elastic-pool-change-storage-size)。\r \r 估计内存优化表的内存要求，如同在 Azure SQL 数据库中估计 SQL Server 的内存要求一样。 花几分钟时间查看 [MSDN](https://msdn.microsoft.com/library/dn282389.aspx) 上的相关主题。\r \r 请注意，表和表变量行以及索引都会计入最大用户数据大小。 此外，ALTER TABLE 需要足够的空间来创建新版的完整表及其索引。\r \r ## <a name=\"monitoring-and-alerting\"></a>监视和警报\r 可以在 [Azure 门户](https://portal.azure.cn/)中，通过性能层的存储限制百分比来监视内存中存储用量： \r \r 1. 在“数据库”边栏选项卡上，找出“资源使用率”框并单击“编辑”。\r 2. 选择指标 `In-Memory OLTP Storage percentage`。\r 3. 如果要添加警报，请单击“资源使用率”框以打开“度量值”边栏选项卡，并单击“添加警报”。\r \r 或者，使用以下查询来显示内存中存储的使用率：\r \r ```\r SELECT xtp_storage_percent FROM sys.dm_db_resource_stats\r ```\r \r ## <a name=\"correct-out-of-memory-situations---error-41823\"></a>更正内存不足情况 - 错误 41823\r 内存不足会导致插入、更新和创建操作失败，并出现错误消息 41823。\r \r 错误消息 41823 指示内存优化表和表变量已超过大小上限。\r \r 若要解决此错误，请执行以下操作之一：\r \r * 从内存优化表中删除数据，为此，可以将数据卸载到传统的基于磁盘的表；或者，\r * 将服务层升级到具有足够内存中存储的服务层，使保存需要保留在内存优化表中的数据。\r \r ## <a name=\"next-steps\"></a>后续步骤\r 有关监视指南，请参阅[使用动态管理视图监视 Azure SQL 数据库](sql-database-monitoring-with-dmvs.md)。\r <!--Update_Description: update links-->"}