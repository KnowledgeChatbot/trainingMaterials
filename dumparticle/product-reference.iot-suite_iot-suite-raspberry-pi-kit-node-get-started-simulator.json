{"Title":"使用 Node.js 与模拟遥测将 Raspberry Pi 连接到 Azure IoT 套件","Description":"使用适用于 Raspberry Pi 3 的 Microsoft Azure IoT 初学者工具包和 Azure IoT 套件。 使用 Node.js 将 Raspberry Pi 连接到远程监控解决方案，将模拟遥测数据发送到云，并响应从解决方案仪表板调用的方法。","Content":"# <a name=\"connect-your-raspberry-pi-3-to-the-remote-monitoring-solution-and-send-simulated-telemetry-using-nodejs\"></a>使用 Node.js 将 Raspberry Pi 3 连接到远程监控解决方案，并发送模拟遥测数据\r \r [!INCLUDE [iot-suite-raspberry-pi-kit-selector](../../includes/iot-suite-raspberry-pi-kit-selector.md)]\r \r 本教程演示如何使用 Raspberry Pi 3 模拟要发送到云的温度和湿度数据。 本教程使用：\r \r - Raspbian OS、Node.js 编程语言和 Azure IoT SDK for Node.js 实现示例设备。\r - IoT 套件远程监控预配置解决方案作为基于云的后端。\r \r [!INCLUDE [iot-suite-raspberry-pi-kit-overview-simulator](../../includes/iot-suite-raspberry-pi-kit-overview-simulator.md)]\r \r [!INCLUDE [iot-suite-provision-remote-monitoring](../../includes/iot-suite-provision-remote-monitoring.md)]\r \r > [!WARNING]\r > 远程监控解决方案在 Azure 订阅中预配一组 Azure 服务。 部署反映实际企业体系结构。 要避免产生不必要的 Azure 使用费用，请在使用完预配置解决方案的实例后，在 azureiotsuite.cn 上将其删除。 如果再次需要预配置解决方案，可以轻松地重新创建它。 若要详细了解如何在远程监控解决方案运行时减少消耗，请参阅[出于演示目的配置 Azure IoT 套件预配置解决方案][lnk-demo-config]。\r \r [!INCLUDE [iot-suite-raspberry-pi-kit-view-solution](../../includes/iot-suite-raspberry-pi-kit-view-solution.md)]\r \r [!INCLUDE [iot-suite-raspberry-pi-kit-prepare-pi-simulator](../../includes/iot-suite-raspberry-pi-kit-prepare-pi-simulator.md)]\r \r ## <a name=\"download-and-configure-the-sample\"></a>下载并配置示例\r \r 现在，可以在 Raspberry Pi 上下载并配置远程监控客户端应用程序。\r \r ### <a name=\"install-nodejs\"></a>安装 Node.js\r \r 如果尚未这样做，请在 Raspberry Pi 上安装 Node.js。 IoT SDK for Node.js 需要版本 0.11.5 或更高版本的 Node.js。 以下步骤演示如何在 Raspberry Pi 上安装 Node.js v6.10.2：\r \r 1. 使用以下命令更新 Raspberry Pi：\r \r     ```sh\r     sudo apt-get update\r     ```\r \r 1. 使用以下命令将 Node.js 二进制文件下载到 Raspberry Pi 上：\r \r     ```sh\r     wget https://nodejs.org/dist/v6.10.2/node-v6.10.2-linux-armv7l.tar.gz\r     ```\r \r 1. 使用以下命令安装二进制文件：\r \r     ```sh\r     sudo tar -C /usr/local --strip-components 1 -xzf node-v6.10.2-linux-armv7l.tar.gz\r     ```\r \r 1. 使用以下命令验证是否已成功安装 Node.js v6.10.2：\r \r     ```sh\r     node --version\r     ```\r \r ### <a name=\"clone-the-repositories\"></a>克隆存储库\r \r 如果尚未这样做，请通过在 Pi 上的终端中运行以下命令，克隆所需的存储库：\r \r ```sh\r cd ~\r git clone --recursive https://github.com/Azure-Samples/iot-remote-monitoring-node-raspberrypi-getstartedkit.git\r ```\r \r ### <a name=\"update-the-device-connection-string\"></a>更新设备连接字符串\r \r 使用以下命令在 **nano** 编辑器中打开示例源文件：\r \r ```sh\r nano ~/iot-remote-monitoring-node-raspberrypi-getstartedkit/simulator/remote_monitoring.js\r ```\r \r 查找行：\r \r ```javascript\r var connectionString = 'HostName=[Your IoT hub name].azure-devices.cn;DeviceId=[Your device id];SharedAccessKey=[Your device key]';\r ```\r \r 将占位符值替换为在本教程开始时创建并保存的设备和 IoT 中心信息。 保存所做的更改（按 **Ctrl-O**，并按 **Enter**），退出编辑器（按 **Ctrl-X**）。\r \r ## <a name=\"run-the-sample\"></a>运行示例\r \r 运行以下命令以安装示例的必备组件包：\r \r ```sh\r cd ~/iot-remote-monitoring-node-raspberrypi-getstartedkit/simulator\r npm install\r ```\r \r 现在可以在 Raspberry Pi 上运行示例程序。 输入以下命令：\r \r ```sh\r sudo node ~/iot-remote-monitoring-node-raspberrypi-getstartedkit/simulator/remote_monitoring.js\r ```\r \r 以下示例输出是在 Raspberry Pi 的命令提示符下看到的输出示例：\r \r ![Raspberry Pi 应用的输出][img-raspberry-output]\r \r 随时都可按 **Ctrl-C** 退出程序。\r \r [!INCLUDE [iot-suite-raspberry-pi-kit-view-telemetry-simulator](../../includes/iot-suite-raspberry-pi-kit-view-telemetry-simulator.md)]\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 有关 Azure IoT 的更多示例和文档，请访问 [Azure IoT 开发人员中心](https://www.azure.cn/develop/iot/)。\r \r \r [img-raspberry-output]: ./media/iot-suite-raspberry-pi-kit-node-get-started-simulator/app-output.png\r \r [lnk-demo-config]: https://github.com/Azure/azure-iot-remote-monitoring/blob/master/Docs/configure-preconfigured-demo.md\r \r <!--Update_Description: update wording-->\r "}