{"Title":"Hadoop、Spark 或 HBase 的群集设置 - Azure HDInsight","Description":"通过浏览器、Azure CLI、Azure PowerShell、REST 或 SDK 设置适用于 HDInsight 的 Hadoop、Spark、HBase 或 Storm 群集。","Content":"# <a name=\"set-up-clusters-in-hdinsight-with-hadoop-spark-kafka-and-more\"></a>使用 Hadoop、Spark、Kafka 等等在 HDInsight 中设置群集\r \r [!INCLUDE [selector](../../includes/hdinsight-create-linux-cluster-selector.md)]\r \r 了解如何使用 Hadoop、Spark、Kafka、交互式查询、HBase、R Server 或 Storm 在 HDInsight 中设置和配置群集。 另外，了解如何自定义群集，并将它们加入域以提高安全性。\r \r Hadoop 群集由用于对任务进行分布式处理的多个虚拟机（节点）组成。 Azure HDInsight 对各个节点的安装和配置的实现细节进行处理，因此你只需提供常规配置信息。 \r \r > [!IMPORTANT]\r >HDInsight 群集计费在创建群集之后便会开始，删除群集后才会停止。 群集以每分钟按比例收费，因此无需再使用群集时，应始终将其删除。 了解如何[删除群集](hdinsight-delete-cluster.md)。\r >\r \r ## <a name=\"cluster-setup-methods\"></a>群集设置方法\r 下表显示了可用于设置 HDInsight 群集的不同方法。\r \r | 群集创建方法 | Web 浏览器 | 命令行 | REST API | SDK | \r | --- |:---:|:---:|:---:|:---:|\r | [Azure 门户](hdinsight-hadoop-create-linux-clusters-portal.md) |✔ |&nbsp; |&nbsp; |&nbsp; |\r | [Azure CLI](hdinsight-hadoop-create-linux-clusters-azure-cli.md) |&nbsp; |✔ |&nbsp; |&nbsp; |\r | [Azure PowerShell](hdinsight-hadoop-create-linux-clusters-azure-powershell.md) |&nbsp; |✔ |&nbsp; |&nbsp; |\r | [cURL](hdinsight-hadoop-create-linux-clusters-curl-rest.md) |&nbsp; |✔ |✔ |&nbsp; |\r | [.NET SDK](hdinsight-hadoop-create-linux-clusters-dotnet-sdk.md) |&nbsp; |&nbsp; |&nbsp; |✔ |\r | [Azure Resource Manager 模板](hdinsight-hadoop-create-linux-clusters-arm-templates.md) |&nbsp; |✔ |&nbsp; |&nbsp; |\r \r ## <a name=\"quick-create-basic-cluster-setup\"></a>快速创建：基本群集设置\r 本文逐步讲解如何通过 [Azure 门户](https://portal.azure.cn)进行设置：在门户中使用“快速创建”或“自定义”选项创建 HDInsight 群集。 \r \r 遵照屏幕上的说明执行基本的群集设置。 下面提供了各项设置的详细信息：\r \r * [资源组名称](#resource-group-name)\r * [群集类型和配置](#cluster-types) \r * [群集登录名和 SSH 用户名](#cluster-login-and-ssh-username)\r * [位置](#location)\r \r > [!IMPORTANT]\r > Linux 是在 HDInsight 3.4 版或更高版本上使用的唯一操作系统。 有关详细信息，请参阅 [HDInsight 3.3 停用](hdinsight-component-versioning.md#hdinsight-windows-retirement)。\r >\r \r ## <a name=\"resource-group-name\"></a>资源组名称 \r \r 可以借助 [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) 以组（称为 Azure 资源组）的形式处理应用程序中的资源。 可以通过单个协调的操作来部署、更新、监视或删除应用程序的所有资源。\r \r ## <a name=\"cluster-types\"></a>群集类型和配置\r Azure HDInsight 目前提供以下群集类型，每种类型都具有一组用于提供特定功能的组件。\r \r > [!IMPORTANT]\r > HDInsight 群集以多种类型提供，每种类型适用于单个工作负荷或技术。 没有任何方法支持创建组合多种类型的群集，如一个群集同时具有 Storm 和 HBase 类型。 如果解决方案需要分布在多种 HDInsight 群集类型上的技术，可以使用 [Azure 虚拟网络](/virtual-network)连接所需的群集类型。 \r >\r >\r \r | 群集类型 | 功能 |\r | --- | --- |\r | [Hadoop](hadoop/apache-hadoop-introduction.md) |Batch 查询和存储数据的分析 |\r | [HBase](hbase/apache-hbase-overview.md) |大量无架构 NoSQL 数据的处理 |\r | [Storm](storm/apache-storm-overview.md) |实时事件处理 |\r | [Spark](spark/apache-spark-overview.md) |内存中处理、交互式查询、微批流处理 |\r | [Kafka（预览版）](kafka/apache-kafka-introduction.md) | 分布式流式处理平台，可用于构建实时流数据管道和应用程序 |\r | [交互式查询](./interactive-query/apache-interactive-query-get-started.md) |更快的交互式 Hive 查询的内存中缓存 |\r \r ### <a name=\"number-of-nodes-for-each-cluster-type\"></a>每个群集类型的节点数\r 每个群集类型有自身的节点数目、节点术语和默认的 VM 大小。 下表中的括号内列出了每个节点类型的节点数目。\r \r | 类型 | Nodes | 图表 |\r | --- | --- | --- |\r | Hadoop |头节点 (2)，数据节点 (1+) |![HDInsight Hadoop 群集节点](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-hadoop-cluster-type-nodes.png) |\r | HBase |头服务器 (2)，区域服务器 (1+)，主控/ZooKeeper 节点 (3) |![HDInsight HBase 群集节点](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-hbase-cluster-type-setup.png) |\r | Storm |Nimbus 节点 (2)，监督程序服务器 (1+)，ZooKeeper 节点 (3) |![HDInsight Storm 群集节点](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-storm-cluster-type-setup.png) |\r | Spark |头节点 (2)，辅助角色节点 (1+)，ZooKeeper 节点 (3)（对于 A1 ZooKeeper VM 大小免费） |![HDInsight Spark 群集节点](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-spark-cluster-type-setup.png) |\r \r 有关详细信息，请参阅“HDInsight 中的 Hadoop 组件和版本是什么？”中的[群集的默认节点配置和虚拟机大小](hdinsight-component-versioning.md#default-node-configuration-and-virtual-machine-sizes-for-clusters)\r \r ### <a name=\"hdinsight-version\"></a>HDInsight 版本\r 选择此群集的 HDInsight 版本。 有关详细信息，请参阅[支持的 HDInsight 版本](hdinsight-component-versioning.md#supported-hdinsight-versions)。\r \r ### <a name=\"cluster-tiers\"></a>群集层：HDInsight 服务层\r \r Azure HDInsight 提供两个服务层的大数据云产品/服务：标准版和高级版。  但目前在中国，只支持标准层。 \r \r 以下屏幕截图显示了在 Azure 门户中选择群集类型的信息。\r \r ![HDInsight 高级版配置](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-cluster-type-configuration.png)\r \r \r ## <a name=\"cluster-login-and-ssh-user-name\"></a>群集登录和 SSH 用户名\r 使用 HDInsight 群集时，可以在群集创建期间配置两个用户帐户：\r \r * HTTP 用户：默认用户名为 *admin*。它使用 Azure 门户上的基本配置。 有时称为“群集用户”。\r * SSH 用户（Linux 群集）：用于通过 SSH 连接到群集。 有关详细信息，请参阅 [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md)（对 HDInsight 使用 SSH）。\r \r ## <a name=\"location\"></a>群集和存储的位置（区域）\r \r 无需显式指定群集位置：群集位于默认存储所在的位置。 有关受支持区域的列表，请单击 [HDInsight 定价](https://go.microsoft.com/fwLink/?LinkID=282635&clcid=0x409)中的“区域”下拉列表。\r \r ## <a name=\"storage-endpoints-for-clusters\"></a>群集的存储终结点\r \r Hadoop 的本地安装对群集上的存储使用 Hadoop 分布式文件系统 (HDFS)，而在云中，需使用已连接到群集的存储终结点。 HDInsight 群集使用 [Azure 存储中的 Blob](hdinsight-hadoop-use-blob-storage.md)。 使用 Azure 存储意味着可以安全删除用于计算的 HDInsight 群集，同时仍可保留数据。 \r \r > [!WARNING]\r > 不支持在 HDInsight 群集之外的其他位置使用其他存储帐户。\r \r 在配置期间，请为默认存储终结点指定 Azure 存储帐户的某个 Blob 容器。 默认存储包含应用程序日志和系统日志。 也可以选择指定群集可访问的其他 Azure 存储链接帐户。 HDInsight 群集和相关的存储帐户必须在同一个 Azure 位置。\r \r ![群集存储设置：HDFS 兼容的存储终结点](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-cluster-creation-storage.png)\r \r [!INCLUDE [secure-transfer-enabled-storage-account](../../includes/hdinsight-secure-transfer.md)]\r \r ### <a name=\"optional-metastores\"></a>可选元存储\r 可创建可选的 Hive 或 Oozie 元存储。 但是，并非所有群集类型都支持元存储，并且 Azure SQL 数据仓库与元存储不兼容。 \r \r > [!IMPORTANT]\r > 创建自定义元存储时，请不要在数据库名称中使用破折号、连字符或空格。 否则可能导致群集创建过程失败。\r \r ### <a name=\"use-hiveoozie-metastore\"></a>Hive 元存储\r \r 如果希望在删除 HDInsight 群集后保留 Hive 表，请使用自定义元存储。 这样，便可以将该元存储附加到另一个 HDInsight 群集。\r \r 为一个 HDInsight 群集版本创建的 HDInsight 元存储不能在不同的 HDInsight 群集版本之间共享。 有关 HDInsight 版本的列表，请参阅[支持的 HDInsight 版本](hdinsight-component-versioning.md#supported-hdinsight-versions)。\r \r ### <a name=\"oozie-metastore\"></a>Oozie 元存储\r \r 在使用 Oozie 时若要提高性能，请使用自定义元存储。 删除群集后，元存储也可提供对 Oozie 作业数据的访问权限。 \r \r > [!IMPORTANT]\r > 无法重用自定义 Oozie 元存储。 若要使用自定义 Oozie 元存储，必须在创建 HDInsight 群集时提供一个空的 Azure SQL 数据库。\r \r ## <a name=\"configure-cluster-size\"></a>配置群集大小\r \r 只要群集存在，就会产生节点使用费。 创建群集后便开始计费，删除群集后停止计费。 无法取消分配群集或将其置于暂停状态。\r \r HDInsight 群集的成本取决于节点数和节点的虚拟机大小。 \r \r 不同群集类型具有不同的节点类型、节点数和节点大小：\r * Hadoop 群集类型的默认配置： \r     * 两个头节点  \r     * 四个数据节点\r * Storm 群集类型的默认配置： \r     * 两个 Nimbus 节点\r     * 三个 ZooKeeper 节点\r     * 四个监督器节点 \r \r 如果你只是想要试用 HDInsight，我们建议使用一个数据节点。 有关 HDInsight 定价的详细信息，请参阅 [HDInsight 定价](https://www.azure.cn/pricing/details/hdinsight/)。\r \r 使用 Azure 门户配置群集时，可通过“节点定价层”边栏选项卡查看节点大小。 在门户中，还可以查看不同节点大小的相关费用。 \r \r ![HDInsight VM 节点大小](./media/hdinsight-hadoop-provision-linux-clusters/hdinsight-node-sizes.png)\r \r ### <a name=\"virtual-machine-sizes\"></a>虚拟机大小 \r 部署群集时，请根据要部署的解决方案选择计算资源。 以下 VM 用于 HDInsight 群集：\r * A 和 D1-4 系列 VM：[常规用途 Linux VM 的大小](/virtual-machines/linux/sizes-general)\r * D11-14 系列 VM：[内存优化的 Linux VM 大小](/virtual-machines/linux/sizes-memory)\r \r 使用不同的 SDK 或使用 Azure PowerShell 创建群集时，若要确定应该使用哪个值来指定 VM 大小，请参阅[用于 HDInsight 群集的 VM 大小](../cloud-services/cloud-services-sizes-specs.md#size-tables)。 请使用此链接本章的“大小”列中的值。\r \r > [!IMPORTANT]\r > 如果需要在群集中使用 32 个以上的辅助角色节点，则必须选择至少具有 8 个核心和 14 GB RAM 的头节点大小。\r >\r >\r \r 有关详细信息，请参阅[虚拟机的大小](../virtual-machines/windows/sizes.md)。 有关不同大小的定价信息，请参阅 [HDInsight 定价](https://www.azure.cn/pricing/details/hdinsight/)。   \r \r ## <a name=\"custom-cluster-setup\"></a>自定义群集设置\r “自定义群集设置”是在“快速创建”设置的基础之上实现的，其中添加了以下选项：\r - [HDInsight 应用程序](#hdinsight-applications)\r - [群集大小](#cluster-size)\r - 高级设置\r   - [脚本操作](#customize-clusters-using-script-action)\r   - [虚拟网络](#use-virtual-network)\r \r ## <a name=\"install-hdinsight-applications-on-clusters\"></a>在群集上安装 HDInsight 应用程序\r \r HDInsight 应用程序是用户可以在基于 Linux 的 HDInsight 群集上安装的应用程序。 可以使用 Microsoft、第三方提供的或你自己开发的应用程序。 有关详细信息，请参阅[在 Azure HDInsight 上安装第三方 Hadoop 应用程序](hdinsight-apps-install-applications.md)。\r \r 大多数 HDInsight 应用程序安装在空边缘节点上。  空边缘节点是安装并配置了与头节点中相同的客户端工具的 Linux 虚拟机。 可以使用该边缘节点来访问群集、测试客户端应用程序和托管客户端应用程序。 有关详细信息，请参阅[在 HDInsight 中使用空边缘节点](hdinsight-apps-use-edge-node.md)。\r \r ## <a name=\"advanced-settings-script-actions\"></a>高级设置：脚本操作\r \r 可以在创建期间通过使用脚本安装其他组件或自定义群集配置。 此类脚本可通过 **脚本操作**调用，脚本操作是一种配置选项，可通过 Azure 门户、HDInsight Windows PowerShell cmdlet 或 HDInsight .NET SDK 使用。 有关详细信息，请参阅[使用脚本操作自定义 HDInsight 群集](hdinsight-hadoop-customize-cluster-linux.md)。\r \r 某些本机 Java 组件（如 Mahout 和 Cascading）可以在群集上作为 Java 存档 (JAR) 文件运行。 可以使用 Hadoop 作业提交机制将这些 JAR 文件分发到 Azure 存储，然后提交到 HDInsight 群集。 有关详细信息，请参阅[以编程方式提交 Hadoop 作业](hadoop/submit-apache-hadoop-jobs-programmatically.md)。\r \r > [!NOTE]\r > 如果在将 JAR 文件部署到 HDInsight 群集或调用 HDInsight 群集上的 JAR 文件时遇到问题，请联系 [Azure 支持](https://www.azure.cn/support/contact/)。\r >\r > HDInsight 不支持级联，因此不符合 Azure 技术支持的条件。 有关支持的组件的列表，请参阅 [HDInsight 提供的群集版本有哪些新功能？](hdinsight-component-versioning.md)。\r >\r >\r \r 在创建过程中，有时需要配置以下配置文件：\r \r * clusterIdentity.xml\r * core-site.xml\r * gateway.xml\r * hbase-env.xml\r * hbase-site.xml\r * hdfs-site.xml\r * hive-env.xml\r * hive-site.xml\r * mapred-site\r * oozie-site.xml\r * oozie-env.xml\r * storm-site.xml\r * tez-site.xml\r * webhcat-site.xml\r * yarn-site.xml\r \r 有关详细信息，请参阅[使用 Bootstrap 自定义 HDInsight 群集](hdinsight-hadoop-customize-cluster-bootstrap.md)。\r \r ## <a name=\"advanced-settings-extend-clusters-with-a-virtual-network\"></a>高级设置：使用虚拟网络扩展群集\r 如果解决方案需要分布在多种 HDInsight 群集类型上的技术，可以使用 [Azure 虚拟网络](/virtual-network)连接所需的群集类型。 此配置允许群集以及部署到群集的任何代码直接相互通信。\r \r 有关将 Azure 虚拟网络与 HDInsight 配合使用的详细信息，请参阅[使用 Azure 虚拟网络扩展 HDInsight](hdinsight-extend-hadoop-virtual-network.md)。\r \r 有关在一个 Azure 虚拟网络中使用两种群集类型的示例，请参阅[使用 Storm 和 HBase 分析传感器数据](storm/apache-storm-sensor-data-analysis.md)。 有关将 HDInsight 与虚拟网络配合使用的详细信息（包括虚拟网络的特定配置要求），请参阅[使用 Azure 虚拟网络扩展 HDInsight 功能](hdinsight-extend-hadoop-virtual-network.md)。\r \r ## <a name=\"troubleshoot-access-control-issues\"></a>排查访问控制问题\r \r 如果在创建 HDInsight 群集时遇到问题，请参阅[访问控制要求](hdinsight-administer-use-portal-linux.md#create-clusters)。\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r - [HDInsight、Hadoop 生态系统和 Hadoop 群集是什么？](hadoop/apache-hadoop-introduction.md)\r - [开始在 HDInsight 中使用 Hadoop](hadoop/apache-hadoop-linux-tutorial-get-started.md)\r - [在 Windows 电脑中操作 Hadoop on HDInsight](hdinsight-hadoop-windows-tools.md)\r <!--Update_Description: update wording and link references-->"}