{"Title":"将 Excel 连接到 SQL 数据库","Description":"了解如何将 Microsoft Excel 连接到在云中的 Azure SQL 数据库。 将数据导入 Excel 以进行报告和数据探索。","Content":"# <a name=\"connect-excel-to-an-azure-sql-database-and-create-a-report\"></a>将 Excel 连接到 Azure SQL 数据库并创建报表\r \r 将 Excel 连接到云中的 SQL 数据库，导入数据并根据数据库中的值来创建表和图表。 在本教程中，用户将设置 Excel 与数据库表之间的连接，保存用于存储 Excel 的数据和连接信息的文件，并根据数据库值创建分析数据透视图。\r \r 在开始之前，需要在 Azure 中创建一个 SQL 数据库。 如果没有，请参阅[创建第一个 SQL 数据库](sql-database-get-started-portal.md)，以在几分钟内获取数据库，并让其中的示例数据正常运行。 在本文中，会将该文章中的示例数据导入 Excel，但可以使用自己的数据执行类似的步骤。\r \r 还需要 Excel 的副本。 本文使用 [Microsoft Excel 2016](https://products.office.com/)。\r \r ## <a name=\"connect-excel-to-a-sql-database-and-create-an-odc-file\"></a>将 Excel 连接到 SQL 数据库并创建 odc 文件\r 1. 如果要将 Excel 连接到 SQL 数据库，请打开 Excel，并创建新的工作簿或打开现有的 Excel 工作簿。\r 2. 在页面顶部的菜单栏中单击“数据”，单击“从其他源”，并单击“从 SQL Server”。\r    \r    ![选择数据源：将 Excel 连接到 SQL 数据库。](./media/sql-database-connect-excel/excel_data_source.png)\r    \r    “数据连接”向导打开。\r 3. 在“连接到数据库服务器”对话框中，以格式 <*服务器名称*>**.database.chinacloudapi.cn** 键入要连接到的 SQL 数据库的**服务器名称**。 例如 **adworkserver.database.chinacloudapi.cn**。\r 4. 在“登录凭据”下，单击“使用以下用户名和密码”，键入在创建 SQL 数据库服务器时为其设置的**用户名**和**密码**，并单击“下一步”。\r    \r    ![键入服务器名称和登录凭据](./media/sql-database-connect-excel/connect-to-server.png)\r    \r    > [!TIP]\r    > 根据网络环境，可能无法连接；如果 SQL 数据库服务器不允许来自客户端 IP 地址的流量，可能会断开连接。 转到 [Azure 门户](https://portal.azure.cn/)，依次单击“SQL 服务器”、你的服务器、“设置”下面的“防火墙”，然后添加客户端 IP 地址。 有关详细信息，请参阅 [如何配置防火墙设置](sql-database-configure-firewall-settings.md) 。\r    > \r    > \r 5. 在“选择数据库和表”对话框中，从列表中选择要使用的数据库，并单击要使用的表或视图（我们选择了 **vGetAllCategories**），单击“下一步”。\r    \r     ![选择数据库和表。](./media/sql-database-connect-excel/select-database-and-table.png)\r    \r     此时会打开“保存数据连接文件并完成”对话框，请在其中提供 Excel 使用的 Office 数据库连接 (*.odc) 文件的相关信息。 可以保留默认值，或自定义选择项。\r 6. 可以保留默认值，但要特意记下“文件名”。 “说明”、“友好名称”和“搜索关键字”可帮助你和其他用户记住所要连接到的目标，以及查找连接。 如果用户希望将连接信息存储在 odc 文件中以便在连接时进行更新，请单击“始终尝试使用此文件来刷新数据”，并单击“完成”。\r    \r     ![保存 odc 文件](./media/sql-database-connect-excel/save-odc-file.png)\r    \r     此时显示“导入数据”对话框。\r \r ## <a name=\"import-the-data-into-excel-and-create-a-pivot-chart\"></a>将数据导入 Excel 并创建数据透视图\r 创建连接并创建包含数据与连接信息的文件后，便可以导入数据。\r \r 1. 在“导入数据”对话框中，单击要在工作表中呈现数据的选项，并单击“确定”。 **将此数据添加到数据模型**。 也可以选择创建**新工作表**或**将此数据添加到数据模型**。 有关数据模型的详细信息，请参阅[在 Excel 中创建数据模型](https://support.office.com/article/Create-a-Data-Model-in-Excel-87E7A54C-87DC-488E-9410-5C75DBCB0F7B)。 单击**“属性”**浏览在上一个步骤中创建的 odc 文件的相关信息，并选择用于刷新数据的选项。\r    \r     ![选择 Excel 中数据的格式](./media/sql-database-connect-excel/import-data.png)\r    \r     工作表现在包含空白的数据透视表和图表。\r 2. 在“数据透视表字段”下，选中要查看的所有字段的复选框。\r    \r     ![配置数据库的报表。](./media/sql-database-connect-excel/power-pivot-results.png)\r \r > [!TIP]\r > 如果要将其他 Excel 工作簿和工作表连接到数据库，请依次单击“数据”、“连接”、“添加”，从列表中选择用户创建的连接，并单击“打开”。\r > ![从另一个工作簿打开连接](./media/sql-database-connect-excel/open-from-another-workbook.png)\r > \r > \r \r ## <a name=\"next-steps\"></a>后续步骤\r * 了解如何 [使用 SQL Server Management Studio 连接到 SQL 数据库](sql-database-connect-query-ssms.md) ，以便进行高级查询和分析。\r * 了解 [弹性池](sql-database-elastic-pool.md)的优点。\r * 了解如何 [创建与后端 SQL 数据库连接的 Web 应用程序](../app-service/app-service-web-tutorial-dotnet-sqldatabase.md)。\r \r "}