{"Title":"Eclipse 使用认证文件登录 Azure","Description":"本主要介绍如何在 Eclipse 中使用认证文件的方式登录 Azure","Content":"\r # Eclipse 使用认证文件登录 Azure\r \r Azure 很多服务都支持 Java，而且为了更方便 Java 开发者，我们提供了适用于在 Eclipse 上安装的 Azure 插件。不过目前该插件不能直接使用交互方式（用户名和密码）来登陆中国区 Azure，但是可以使用认证文件的方式来登陆。本文将详细介绍相关操作。\r \r ## 操作步骤\r \r 1. Eclipse 安装 Azure 插件：\r \r     安装 [Azure Toolkit for Eclipse](https://docs.azure.cn/zh-cn/azure-toolkit-for-eclipse-installation)\r \r 2. 创建 AAD 认证服务凭证：\r \r     下面分别介绍使用 Azure PowerShell 和 Azure Cli 两种方式创建认证凭据信息：\r \r     - PowerShell 创建凭据\r \r         Azure PowerShell 下载地址：[https://github.com/Azure/azure-powershell/releases](https://github.com/Azure/azure-powershell/releases)\r         Azure PowerShell 入门：[https://docs.microsoft.com/zh-cn/powershell/azure/get-started-azureps?view=azurermps-4.4.1](https://docs.microsoft.com/zh-cn/powershell/azure/get-started-azureps?view=azurermps-4.4.1)\r \r         1. 在 PowerShell 中，登录 Azure 账户：\r \r             ```PowerShell\r             Login-AzureRmAccount -EnvironmentName AzureChinaCloud\r             ```\r \r             ![01](media/aog-portal-management-qa-eclipse-login/01.png)\r \r         2. 选择当前订阅 ID（注意此处使用的 SubscriptionId 也对应配置文件的 subscriptionId）：\r \r             ```PowerShell\r             Set-AzureRmContext -SubscriptionId \"SubscriptionId\"\r             ```\r \r         3. 创建 AD Application（注意此处设置的 Password 对应配置文件的 clientSecret）：\r \r             ```PowerShell\r             $azureAdApplication = New-AzureRmADApplication -DisplayName \"<yourAppDisplayName>\" -HomePage \"<yourAppHomePageURL>\" -IdentifierUris \"<yourAppIdentifyURIs>\" -Password \"<yourPassword>\"\r \r             $azureAdApplication\r             ```\r \r             ![02](media/aog-portal-management-qa-eclipse-login/02.png)\r \r             > [!NOTE]\r             > 命令中的参数根据您的实际情况进行替换。\r \r         4. 为您的 AD 应用创建服务凭证：\r \r             ```PowerShell\r             New-AzureRmADServicePrincipal -ApplicationId $azureAdApplication.ApplicationId\r             ```\r \r         5. 为服务凭证授权。如果想了解更多内容，请参考：[Azure 门户中基于角色的访问控制入门](https://azure.microsoft.com/en-us/documentation/articles/role-based-access-control-what-is/)。\r \r             > [!NOTE]\r             > 注意在执行上一步后请稍等片刻（约 1 一分钟后）再执行以下步骤，不然 AD 凭据如果没有创建成功会报找不到的错误。\r \r             ```PowerShell\r             New-AzureRmRoleAssignment -RoleDefinitionName Contributor -ServicePrincipalName $azureAdApplication.ApplicationId \r             ```\r             ![03](media/aog-portal-management-qa-eclipse-login/03.png)\r \r     - Azure-Cli 创建凭据：\r \r         安装 Azure CLI 2.0：[https://docs.azure.cn/zh-cn/cli/install-azure-cli?view=azure-cli-latest](https://docs.azure.cn/zh-cn/cli/install-azure-cli?view=azure-cli-latest)\r         通过 Azure CLI 登录 Azure：[https://docs.azure.cn/zh-cn/xplat-cli-connect](https://docs.azure.cn/zh-cn/xplat-cli-connect)\r \r         1. 在 Azure_Cli 中，登录 Azure 账户：\r \r             ```\r             azure login -e AzureChinaCloud -u {your-username}\r             ```\r \r             ![04](media/aog-portal-management-qa-eclipse-login/04.png)\r \r         2.\t获取 Tenant_Id 及 Subscription Id：\r \r             ```\r             azure account show\r             ```\r \r             ![05](media/aog-portal-management-qa-eclipse-login/05.png)\r \r         3.\t创建应用标识，请提供应用名称和密码，如以下命令所示：\r \r             ```\r             azure ad sp create -n exampleapp -p {your-password}\r             ```\r \r             ![06](media/aog-portal-management-qa-eclipse-login/06.png)\r \r         4.\t向服务主体授予对订阅的权限：\r \r             ```\r             azure role assignment create --objectId {Object Id} -o Owner -c /subscriptions/{subscriptionId}\r             ```\r \r             ![07](media/aog-portal-management-qa-eclipse-login/07.png)\r \r 3. 构造认证文件：\r \r     配置文件模板如下：\r \r     ```Json\r     {\r         \"clientId\": \"0675a148-8425-4cc4-8747-186831170476\",\r         \"clientSecret\": \"123456\",\r         \"subscriptionId\": \"e0fbea86-6cf2-4b2d-81e2-9119f4f96bcb\",\r         \"tenantId\": \"b388b808-0ec9-4a09-a414-a7cbb11b7e9b\",\r         \"activeDirectoryResourceId\": \"https://management.core.chinacloudapi.cn/\",\r         \"activeDirectoryEndpointUrl\": \"https://login.chinacloudapi.cn\",\r         \"resourceManagerEndpointUrl\": \"https://management.chinacloudapi.cn\",\r         \"activeDirectoryGraphResourceId\": \"https://graph.chinacloudapi.cn/\",\r         \"sqlManagementEndpointUrl\": \"https://management.core.chinacloudapi.cn:8443/\",\r         \"galleryEndpointUrl\": \"https://gallery.chinacloudapi.cn/\",\r         \"managementEndpointUrl\": \"https://management.core.chinacloudapi.cn/\"\r     }\r     ```\r \r     根据第二步获取的四个参数替换配置文件的前四个参数即可，文件保存为：名称.azureauth 。\r \r 4. Eclipse 登陆 Azure：\r \r     ![08](media/aog-portal-management-qa-eclipse-login/08.png)\r     ![09](media/aog-portal-management-qa-eclipse-login/09.png)\r \r     登陆成功显示资源情况:\r     \r     ![10](media/aog-portal-management-qa-eclipse-login/10.png)\r \r     > [!NOTE]\r     > 目前只能显示 Azure 门户的部分资源。\r \r ## 使用示例\r \r 使用 Eclipse 发布 Azure Web 应用：\r \r ![11](media/aog-portal-management-qa-eclipse-login/11.png)\r \r 关于更多 Web 应用的演示，请参考[在 Azure 中创建第一个 Java Web 应用](https://docs.azure.cn/zh-cn/app-service/app-service-web-get-started-java)。\r \r ## 参考文档\r \r - [使用 Azure CLI 创建服务主体来访问资源](https://docs.azure.cn/zh-cn/azure-resource-manager/resource-group-authenticate-service-principal-cli)\r - [使用门户创建可访问资源的 Azure Active Directory 应用程序和服务主体](https://docs.azure.cn/zh-cn/azure-resource-manager/resource-group-create-service-principal-portal)\r - [在 Azure 中创建第一个 Java Web 应用](https://docs.azure.cn/zh-cn/app-service/app-service-web-get-started-java)\r - [通过 Azure CLI 登录 Azure](https://docs.azure.cn/zh-cn/xplat-cli-connect)"}