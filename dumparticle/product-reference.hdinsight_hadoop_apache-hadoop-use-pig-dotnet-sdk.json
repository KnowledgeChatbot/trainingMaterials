{"Title":"使用 .NET SDK for Hadoop 运行 Apache Pig 作业 - Azure HDInsight","Description":"了解如何使用 .NET SDK for Hadoop 将 Pig 作业提交到 HDInsight 上的 Hadoop。","Content":"# <a name=\"run-pig-jobs-using-the-net-sdk-for-hadoop-in-hdinsight\"></a>使用 HDInsight 中的 .NET SDK for Hadoop 运行 Pig 作业\r \r [!INCLUDE [pig-selector](../../../includes/hdinsight-selector-use-pig.md)]\r \r 了解如何使用 .NET SDK for Hadoop 将 Apache Pig 作业提交到 Azure HDInsight 上的 Hadoop。\r \r HDInsight .NET SDK 提供 .NET 客户端库，可简化从 .NET 中使用 HDInsight 群集的操作。 Pig 可让你通过为一系列数据转换建模，来创建 MapReduce 操作。 本文档介绍如何使用基本 C# 应用程序将 Pig 作业提交到 HDInsight 群集。\r \r ## <a name=\"prerequisites\"></a>先决条件\r \r 若要完成本文中的步骤，需要以下项。\r \r * Azure HDInsight (Hadoop on HDInsight) 群集（基于 Windows 或 Linux）。\r \r   > [!IMPORTANT]\r   > Linux 是在 HDInsight 3.4 版或更高版本上使用的唯一操作系统。 有关详细信息，请参阅 [HDInsight 在 Windows 上停用](../hdinsight-component-versioning.md#hdinsight-windows-retirement)。\r \r * Visual Studio 2012、2013、2015 或 2017。\r \r ## <a name=\"create-the-application\"></a>创建应用程序\r \r HDInsight .NET SDK 提供 .NET 客户端库，可简化从 .NET 中使用 HDInsight 群集的操作。\r \r 1. 在 Visual Studio 的“文件”菜单中，选择“新建”，然后选择“项目”。\r \r 2. 对于新项目，请键入或选择以下值：\r \r    | 属性 | 值 |\r    | ------ | ------ |\r    | 类别 | 模板/Visual C#/Windows |\r    | 模板 | 控制台应用程序 |\r    | 名称 | SubmitPigJob |\r \r 3. 单击“确定”以创建该项目  。\r \r 4. 从“工具”菜单中选择“库包管理器”或“Nuget 包管理器”，然后选择“包管理器控制台”。\r \r 5. 若要安装 .NET SDK 包，请使用以下命令：\r \r         Install-Package Microsoft.Azure.Management.HDInsight.Job\r \r 6. 在“解决方案资源管理器”中，双击“Program.cs”将其打开。 将现有代码替换为以下内容。\r \r     ```csharp\r     using Microsoft.Azure.Management.HDInsight.Job;\r     using Microsoft.Azure.Management.HDInsight.Job.Models;\r     using Hyak.Common;\r \r     namespace SubmitHDInsightJobDotNet\r     {\r         class Program\r         {\r             private static HDInsightJobManagementClient _hdiJobManagementClient;\r \r             private const string ExistingClusterName = \"<Your HDInsight Cluster Name>\";\r             private const string ExistingClusterUri = ExistingClusterName + \".azurehdinsight.cn\";\r             private const string ExistingClusterUsername = \"<Cluster Username>\";\r             private const string ExistingClusterPassword = \"<Cluster User Password>\";\r \r             static void Main(string[] args)\r             {\r                 System.Console.WriteLine(\"The application is running ...\");\r \r                 var clusterCredentials = new BasicAuthenticationCloudCredentials { Username = ExistingClusterUsername, Password = ExistingClusterPassword };\r                 _hdiJobManagementClient = new HDInsightJobManagementClient(ExistingClusterUri, clusterCredentials);\r \r                 SubmitPigJob();\r \r                 System.Console.WriteLine(\"Press ENTER to continue ...\");\r                 System.Console.ReadLine();\r             }\r \r             private static void SubmitPigJob()\r             {\r                 var parameters = new PigJobSubmissionParameters\r                 {\r                     Query = @\"LOGS = LOAD '/example/data/sample.log';\r                                 LEVELS = foreach LOGS generate REGEX_EXTRACT($0, '(TRACE|DEBUG|INFO|WARN|ERROR|FATAL)', 1)  as LOGLEVEL;\r                                 FILTEREDLEVELS = FILTER LEVELS by LOGLEVEL is not null;\r                                 GROUPEDLEVELS = GROUP FILTEREDLEVELS by LOGLEVEL;\r                                 FREQUENCIES = foreach GROUPEDLEVELS generate group as LOGLEVEL, COUNT(FILTEREDLEVELS.LOGLEVEL) as COUNT;\r                                 RESULT = order FREQUENCIES by COUNT desc;\r                                 DUMP RESULT;\"\r                 };\r \r                 System.Console.WriteLine(\"Submitting the Pig job to the cluster...\");\r                 var response = _hdiJobManagementClient.JobManagement.SubmitPigJob(parameters);\r                 System.Console.WriteLine(\"Validating that the response is as expected...\");\r                 System.Console.WriteLine(\"Response status code is \" + response.StatusCode);\r                 System.Console.WriteLine(\"Validating the response object...\");\r                 System.Console.WriteLine(\"JobId is \" + response.JobSubmissionJsonResponse.Id);\r             }\r         }\r     }\r     ```\r \r 7. 若要启动应用程序，请按 **F5**。\r \r 8. 若要退出应用程序，请按 **ENTER**。\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 有关 HDInsight 中的 Pig 的信息，请参阅[将 Pig 与 Hadoop on HDInsight 配合使用](hdinsight-use-pig.md)。\r \r 有关如何使用 HDInsight 上的 Hadoop 的详细信息，请参阅以下文档：\r \r * [将 Hive 与 Hadoop on HDInsight 配合使用](hdinsight-use-hive.md)\r * [将 MapReduce 与 HDInsight 上的 Hadoop 配合使用](hdinsight-use-mapreduce.md)\r \r [preview-portal]: https://portal.azure.cn/\r \r \r \r <!--Update_Description: update wording and link references-->"}