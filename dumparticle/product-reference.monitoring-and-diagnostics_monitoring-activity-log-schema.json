{"Title":"Azure 活动日志事件架构","Description":"了解发送到活动日志中的数据的事件架构","Content":"# <a name=\"azure-activity-log-event-schema\"></a>Azure 活动日志事件架构\r 通过 Azure 活动日志，可以深入了解 Azure 中发生的任何订阅级别事件。 本文介绍了每种数据类别的事件架构。\r \r ## <a name=\"administrative\"></a>管理\r 此类别包含对通过资源管理器执行的所有创建、更新、删除和操作的记录。 此类别中的事件类型的示例包括“创建虚拟机”和“删除网络安全组”。用户或应用程序通过资源管理器所进行的每一个操作都会作为特定资源类型上的操作建模。 如果操作类型为“写入”、“删除”或“操作”，则该操作的开始、成功或失败记录都会记录在管理类别中。 管理类别还包括任何对订阅中基于角色的访问控制进行的更改。\r \r ### <a name=\"sample-event\"></a>示例事件\r ```json\r {\r   \"authorization\": {\r     \"action\": \"microsoft.support/supporttickets/write\",\r     \"role\": \"Subscription Admin\",\r     \"scope\": \"/subscriptions/s1/resourceGroups/MSSupportGroup/providers/microsoft.support/supporttickets/115012112305841\"\r   },\r   \"caller\": \"admin@contoso.com\",\r   \"channels\": \"Operation\",\r   \"claims\": {\r     \"aud\": \"https://management.core.chinacloudapi.cn/\",\r     \"iss\": \"https://sts.chinacloudapi.cn/72f988bf-86f1-41af-91ab-2d7cd011db47/\",\r     \"iat\": \"1421876371\",\r     \"nbf\": \"1421876371\",\r     \"exp\": \"1421880271\",\r     \"ver\": \"1.0\",\r     \"http://schemas.microsoft.com/identity/claims/tenantid\": \"1e8d8218-c5e7-4578-9acc-9abbd5d23315 \",\r     \"http://schemas.microsoft.com/claims/authnmethodsreferences\": \"pwd\",\r     \"http://schemas.microsoft.com/identity/claims/objectidentifier\": \"2468adf0-8211-44e3-95xq-85137af64708\",\r     \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn\": \"admin@contoso.com\",\r     \"puid\": \"20030000801A118C\",\r     \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier\": \"9vckmEGF7zDKk1YzIY8k0t1_EAPaXoeHyPRn6f413zM\",\r     \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\": \"John\",\r     \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\": \"Smith\",\r     \"name\": \"John Smith\",\r     \"groups\": \"cacfe77c-e058-4712-83qw-f9b08849fd60,7f71d11d-4c41-4b23-99d2-d32ce7aa621c,31522864-0578-4ea0-9gdc-e66cc564d18c\",\r     \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\": \" admin@contoso.com\",\r     \"appid\": \"c44b4083-3bq0-49c1-b47d-974e53cbdf3c\",\r     \"appidacr\": \"2\",\r     \"http://schemas.microsoft.com/identity/claims/scope\": \"user_impersonation\",\r     \"http://schemas.microsoft.com/claims/authnclassreference\": \"1\"\r   },\r   \"correlationId\": \"1e121103-0ba6-4300-ac9d-952bb5d0c80f\",\r   \"description\": \"\",\r   \"eventDataId\": \"44ade6b4-3813-45e6-ae27-7420a95fa2f8\",\r   \"eventName\": {\r     \"value\": \"EndRequest\",\r     \"localizedValue\": \"End request\"\r   },\r   \"httpRequest\": {\r     \"clientRequestId\": \"27003b25-91d3-418f-8eb1-29e537dcb249\",\r     \"clientIpAddress\": \"192.168.35.115\",\r     \"method\": \"PUT\"\r   },\r   \"id\": \"/subscriptions/s1/resourceGroups/MSSupportGroup/providers/microsoft.support/supporttickets/115012112305841/events/44ade6b4-3813-45e6-ae27-7420a95fa2f8/ticks/635574752669792776\",\r   \"level\": \"Informational\",\r   \"resourceGroupName\": \"MSSupportGroup\",\r   \"resourceProviderName\": {\r     \"value\": \"microsoft.support\",\r     \"localizedValue\": \"microsoft.support\"\r   },\r   \"resourceUri\": \"/subscriptions/s1/resourceGroups/MSSupportGroup/providers/microsoft.support/supporttickets/115012112305841\",\r   \"operationId\": \"1e121103-0ba6-4300-ac9d-952bb5d0c80f\",\r   \"operationName\": {\r     \"value\": \"microsoft.support/supporttickets/write\",\r     \"localizedValue\": \"microsoft.support/supporttickets/write\"\r   },\r   \"properties\": {\r     \"statusCode\": \"Created\"\r   },\r   \"status\": {\r     \"value\": \"Succeeded\",\r     \"localizedValue\": \"Succeeded\"\r   },\r   \"subStatus\": {\r     \"value\": \"Created\",\r     \"localizedValue\": \"Created (HTTP Status Code: 201)\"\r   },\r   \"eventTimestamp\": \"2015-01-21T22:14:26.9792776Z\",\r   \"submissionTimestamp\": \"2015-01-21T22:14:39.9936304Z\",\r   \"subscriptionId\": \"s1\"\r }\r ```\r \r ### <a name=\"property-descriptions\"></a>属性说明\r | 元素名称 | 说明 |\r | --- | --- |\r | authorization |包含事件的 RBAC 属性的 Blob。 通常包括“action”、“role”和“scope”属性。 |\r | caller |执行操作（UPN 声明或 SPN 声明，具体取决于可用性）的用户的电子邮件地址。 |\r | channels |以下值之一：“Admin”、“Operation” |\r | 声明 |Active Directory 使用 JWT 令牌来验证用户或应用程序，以在资源管理器中执行此操作。 |\r | correlationId |通常为字符串格式的 GUID。 共享 correlationId 的事件属于同一 uber 操作。 |\r | 说明 |事件的静态文本说明。 |\r | eventDataId |事件的唯一标识符。 |\r | httpRequest |描述 Http 请求的 Blob。 通常包括 \"clientRequestId\"、\"clientIpAddress\" 和 \"method\"（HTTP 方法， 例如 PUT）。 |\r | 级别 |事件的级别。 以下值之一：“Critical”、“Error”、“Warning”、“Informational”和“Verbose” |\r | resourceGroupName |受影响资源的资源组的名称。 |\r | resourceProviderName |受影响资源的资源提供程序的名称 |\r | resourceId |受影响资源的资源 ID。 |\r | operationId |在多个事件（对应于单个操作）之间共享的 GUID。 |\r | operationName |操作的名称。 |\r | 属性 |`<Key, Value>` 对集合（即字典），描述事件的详细信息。 |\r | 状态 |描述操作状态的字符串。 部分常用值包括：Started、In Progress、Succeeded、Failed、Active、Resolved。 |\r | subStatus |通常为相应 REST 调用的 HTTP 状态代码，但也可能包括用于描述子状态的其他字符串，例如以下常用值：OK（HTTP 状态代码：200）、Created（HTTP 状态代码：201）、Accepted（HTTP 状态代码：202）、No Content（HTTP 状态代码：204）、Bad Request（HTTP 状态代码：400）、Not Found（HTTP 状态代码：404）、Conflict（HTTP 状态代码：409）、Internal Server Error（HTTP 状态代码：500）、Service Unavailable（HTTP 状态代码：503）、Gateway Timeout（HTTP 状态代码：504）。 |\r | eventTimestamp |处理与事件对应的请求的 Azure 服务生成事件时的时间戳。 |\r | submissionTimestamp |事件可供查询的时间戳。 |\r | subscriptionId |Azure 订阅 ID。 |\r \r \r ## <a name=\"autoscale\"></a>自动缩放\r 此类别包含基于在订阅中定义的任何自动缩放设置的自动缩放引擎操作相关的事件记录。 可在此类别中看到的事件类型示例如“自动缩放扩展操作失败”。 使用自动缩放，可在支持的资源类型中，通过自动缩放设置基于日期和/或负载（指标）数据来自动增加或减少实例的数量。 满足纵向扩展或缩减条件时，开始、成功或失败的事件将记录到此类别中。\r \r ### <a name=\"sample-event\"></a>示例事件\r ```json\r {\r   \"caller\": \"Microsoft.Insights/autoscaleSettings\",\r   \"channels\": \"Admin, Operation\",\r   \"claims\": {\r     \"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/spn\": \"Microsoft.Insights/autoscaleSettings\"\r   },\r   \"correlationId\": \"fc6a7ff5-ff68-4bb7-81b4-3629212d03d0\",\r   \"description\": \"The autoscale engine attempting to scale resource '/subscriptions/mySubscriptionID/resourceGroups/myResourceGroup/providers/Microsoft.ClassicCompute/domainNames/myResourceGroup/slots/Production/roles/myResource' from 3 instances count to 2 instances count.\",\r   \"eventDataId\": \"a5b92075-1de9-42f1-b52e-6f3e4945a7c7\",\r   \"eventName\": {\r     \"value\": \"AutoscaleAction\",\r     \"localizedValue\": \"AutoscaleAction\"\r   },\r   \"category\": {\r     \"value\": \"Autoscale\",\r     \"localizedValue\": \"Autoscale\"\r   },\r   \"id\": \"/subscriptions/mySubscriptionID/resourceGroups/myResourceGroup/providers/microsoft.insights/autoscalesettings/myResourceGroup-Production-myResource-myResourceGroup/events/a5b92075-1de9-42f1-b52e-6f3e4945a7c7/ticks/636361956518681572\",\r   \"level\": \"Informational\",\r   \"resourceGroupName\": \"myResourceGroup\",\r   \"resourceProviderName\": {\r     \"value\": \"microsoft.insights\",\r     \"localizedValue\": \"microsoft.insights\"\r   },\r   \"resourceId\": \"/subscriptions/mySubscriptionID/resourceGroups/myResourceGroup/providers/microsoft.insights/autoscalesettings/myResourceGroup-Production-myResource-myResourceGroup\",\r   \"resourceType\": {\r     \"value\": \"microsoft.insights/autoscalesettings\",\r     \"localizedValue\": \"microsoft.insights/autoscalesettings\"\r   },\r   \"operationId\": \"fc6a7ff5-ff68-4bb7-81b4-3629212d03d0\",\r   \"operationName\": {\r     \"value\": \"Microsoft.Insights/AutoscaleSettings/Scaledown/Action\",\r     \"localizedValue\": \"Microsoft.Insights/AutoscaleSettings/Scaledown/Action\"\r   },\r   \"properties\": {\r     \"Description\": \"The autoscale engine attempting to scale resource '/subscriptions/mySubscriptionID/resourceGroups/myResourceGroup/providers/Microsoft.ClassicCompute/domainNames/myResourceGroup/slots/Production/roles/myResource' from 3 instances count to 2 instances count.\",\r     \"ResourceName\": \"/subscriptions/mySubscriptionID/resourceGroups/myResourceGroup/providers/Microsoft.ClassicCompute/domainNames/myResourceGroup/slots/Production/roles/myResource\",\r     \"OldInstancesCount\": \"3\",\r     \"NewInstancesCount\": \"2\",\r     \"LastScaleActionTime\": \"Fri, 21 Jul 2017 01:00:51 GMT\"\r   },\r   \"status\": {\r     \"value\": \"Succeeded\",\r     \"localizedValue\": \"Succeeded\"\r   },\r   \"subStatus\": {\r     \"value\": null\r   },\r   \"eventTimestamp\": \"2017-07-21T01:00:51.8681572Z\",\r   \"submissionTimestamp\": \"2017-07-21T01:00:52.3008754Z\",\r   \"subscriptionId\": \"mySubscriptionID\"\r }\r \r ```\r \r ### <a name=\"property-descriptions\"></a>属性说明\r | 元素名称 | 说明 |\r | --- | --- |\r | caller | 始终是 Microsoft.Insights/autoscaleSettings |\r | channels | 始终是“Admin, Operation” |\r | 声明 | 具有 SPN（服务主体名称）的 JSON blob，或自动缩放引擎资源类型。 |\r | correlationId | 字符串格式的 GUID。 |\r | description |自动缩放事件的静态文本说明。 |\r | eventDataId |自动缩放事件的唯一标识符。 |\r | 级别 |事件的级别。 以下值之一：“Critical”、“Error”、“Warning”、“Informational”和“Verbose” |\r | resourceGroupName |自动缩放设置的资源组名称。 |\r | resourceProviderName |自动缩放设置的资源提供程序名称。 |\r | resourceId |自动缩放设置的资源 ID。 |\r | operationId |在多个事件（对应于单个操作）之间共享的 GUID。 |\r | operationName |操作的名称。 |\r | 属性 |`<Key, Value>` 对集合（即字典），描述事件的详细信息。 |\r | properties.Description | 有关自动缩放引擎执行的操作的详细说明。 |\r | properties.ResourceName | 受影响资源（正在执行缩放操作的资源）的资源 ID |\r | properties.OldInstancesCount | 自动缩放操作生效前的实例数量。 |\r | properties.NewInstancesCount | 自动缩放操作生效后的实例数量。 |\r | properties.LastScaleActionTime | 自动缩放操作发生时的时间戳。 |\r | status |描述操作状态的字符串。 部分常用值包括：Started、In Progress、Succeeded、Failed、Active、Resolved。 |\r | subStatus | 对自动缩放而言通常为 NULL。 |\r | eventTimestamp |处理与事件对应的请求的 Azure 服务生成事件时的时间戳。 |\r | submissionTimestamp |事件可供查询的时间戳。 |\r | subscriptionId |Azure 订阅 ID。 |\r \r ## <a name=\"security\"></a>“安全”\r 此类别包含 Azure 安全中心生成的任何警报记录。 可在此类别中看到的事件类型示例为“执行了可疑的双扩展名文件”。\r \r ### <a name=\"sample-event\"></a>示例事件\r ```json\r {\r     \"channels\": \"Operation\",\r     \"correlationId\": \"965d6c6a-a790-4a7e-8e9a-41771b3fbc38\",\r     \"description\": \"Suspicious double extension file executed. Machine logs indicate an execution of a process with a suspicious double extension.\\r\\nThis extension may trick users into thinking files are safe to be opened and might indicate the presence of malware on the system.\",\r     \"eventDataId\": \"965d6c6a-a790-4a7e-8e9a-41771b3fbc38\",\r     \"eventName\": {\r         \"value\": \"Suspicious double extension file executed\",\r         \"localizedValue\": \"Suspicious double extension file executed\"\r     },\r     \"category\": {\r         \"value\": \"Security\",\r         \"localizedValue\": \"Security\"\r     },\r     \"eventTimestamp\": \"2017-10-18T06:02:18.6179339Z\",\r     \"id\": \"/subscriptions/d4742bb8-c279-4903-9653-9858b17d0c2e/providers/Microsoft.Security/locations/centralus/alerts/965d6c6a-a790-4a7e-8e9a-41771b3fbc38/events/965d6c6a-a790-4a7e-8e9a-41771b3fbc38/ticks/636439033386179339\",\r     \"level\": \"Informational\",\r     \"operationId\": \"965d6c6a-a790-4a7e-8e9a-41771b3fbc38\",\r     \"operationName\": {\r         \"value\": \"Microsoft.Security/locations/alerts/activate/action\",\r         \"localizedValue\": \"Microsoft.Security/locations/alerts/activate/action\"\r     },\r     \"resourceGroupName\": \"myResourceGroup\",\r     \"resourceProviderName\": {\r         \"value\": \"Microsoft.Security\",\r         \"localizedValue\": \"Microsoft.Security\"\r     },\r     \"resourceType\": {\r         \"value\": \"Microsoft.Security/locations/alerts\",\r         \"localizedValue\": \"Microsoft.Security/locations/alerts\"\r     },\r     \"resourceId\": \"/subscriptions/d4742bb8-c279-4903-9653-9858b17d0c2e/providers/Microsoft.Security/locations/centralus/alerts/2518939942613820660_a48f8653-3fc6-4166-9f19-914f030a13d3\",\r     \"status\": {\r         \"value\": \"Active\",\r         \"localizedValue\": \"Active\"\r     },\r     \"subStatus\": {\r         \"value\": null\r     },\r     \"submissionTimestamp\": \"2017-10-18T06:02:52.2176969Z\",\r     \"subscriptionId\": \"d4742bb8-c279-4903-9653-9858b17d0c2e\",\r     \"properties\": {\r         \"accountLogonId\": \"0x2r4\",\r         \"commandLine\": \"c:\\\\mydirectory\\\\doubleetension.pdf.exe\",\r         \"domainName\": \"hpc\",\r         \"parentProcess\": \"unknown\",\r         \"parentProcess id\": \"0\",\r         \"processId\": \"6988\",\r         \"processName\": \"c:\\\\mydirectory\\\\doubleetension.pdf.exe\",\r         \"userName\": \"myUser\",\r         \"UserSID\": \"S-3-2-12\",\r         \"ActionTaken\": \"Detected\",\r         \"Severity\": \"High\"\r     },\r     \"relatedEvents\": []\r }\r \r ```\r \r ### <a name=\"property-descriptions\"></a>属性说明\r | 元素名称 | 说明 |\r | --- | --- |\r | channels | 始终为“运行” |\r | correlationId | 字符串格式的 GUID。 |\r | description |安全事件的静态文本说明。 |\r | eventDataId |安全事件的唯一标识符。 |\r | eventName |安全事件的友好名称。 |\r | id |安全事件的唯一资源标识符。 |\r | 级别 |事件的级别。 以下值之一：“Critical”、“Error”、“Warning”、“Informational”或“Verbose” |\r | resourceGroupName |资源的资源组名称。 |\r | resourceProviderName |Azure 安全中心的资源提供程序名称。 始终为“Microsoft.Security”。 |\r | resourceType |生成安全事件的资源的类型，如“Microsoft.Security/locations/alerts” |\r | resourceId |安全警报的资源 ID。 |\r | operationId |在多个事件（对应于单个操作）之间共享的 GUID。 |\r | operationName |操作的名称。 |\r | 属性 |`<Key, Value>` 对集合（即字典），描述事件的详细信息。 这些属性将因安全警报的类型而异。  |\r | properties.Severity |严重性级别。 可能的值为“High”、“Medium”或“Low”。 |\r | 状态 |描述操作状态的字符串。 部分常用值包括：Started、In Progress、Succeeded、Failed、Active、Resolved。 |\r | subStatus | 对于安全事件通常为 null。 |\r | eventTimestamp |处理与事件对应的请求的 Azure 服务生成事件时的时间戳。 |\r | submissionTimestamp |事件可供查询的时间戳。 |\r | subscriptionId |Azure 订阅 ID。 |\r \r ## <a name=\"next-steps\"></a>后续步骤\r * [详细了解活动日志（以前称为审核日志）](monitoring-overview-activity-logs.md)\r * [将 Azure 活动日志流式传输到事件中心](monitoring-stream-activity-logs-event-hubs.md)\r "}