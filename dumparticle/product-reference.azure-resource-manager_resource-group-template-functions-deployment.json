{"Title":"Azure Resource Manager 模板函数 - 部署","Description":"介绍可在 Azure Resource Manager 模板中使用的用于检索部署信息的函数。","Content":"# <a name=\"deployment-functions-for-azure-resource-manager-templates\"></a>用于 Azure Resource Manager 模板的部署函数 \r \r Resource Manager 提供以下函数，用于从与部署相关的模板和值部分获取值：\r \r * [部署](#deployment)\r * [参数](#parameters)\r * [variables](#variables)\r \r 若要从资源、资源组或订阅获取值，请参阅 [Resource functions](resource-group-template-functions-resource.md)（资源函数）。\r \r <a id=\"deployment\" />\r \r ## <a name=\"deployment\"></a>部署\r `deployment()`\r \r 返回有关当前部署操作的信息。\r \r ### <a name=\"return-value\"></a>返回值\r \r 此函数返回部署期间传递的对象。 根据部署对象是作为链接还是内联对象传递，所返回对象中的属性将有所不同。 如果部署对象是以内联形式传递的（例如使用 Azure PowerShell 中的 **-TemplateFile** 参数指向本地文件时），所返回的对象采用以下格式：\r \r ```json\r {\r     \"name\": \"\",\r     \"properties\": {\r         \"template\": {\r             \"$schema\": \"\",\r             \"contentVersion\": \"\",\r             \"parameters\": {},\r             \"variables\": {},\r             \"resources\": [\r             ],\r             \"outputs\": {}\r         },\r         \"parameters\": {},\r         \"mode\": \"\",\r         \"provisioningState\": \"\"\r     }\r }\r ```\r \r 如果对象是以链接形式传递的（例如使用 **-TemplateUri** 参数指向远程文件时），所返回的对象采用以下格式： \r \r ```json\r {\r     \"name\": \"\",\r     \"properties\": {\r         \"templateLink\": {\r             \"uri\": \"\"\r         },\r         \"template\": {\r             \"$schema\": \"\",\r             \"contentVersion\": \"\",\r             \"parameters\": {},\r             \"variables\": {},\r             \"resources\": [],\r             \"outputs\": {}\r         },\r         \"parameters\": {},\r         \"mode\": \"\",\r         \"provisioningState\": \"\"\r     }\r }\r ```\r \r ### <a name=\"remarks\"></a>备注\r \r 如何根据父模板的 URI，使用 deployment() 链接到另一个模板。\r \r ```json\r \"variables\": {  \r     \"sharedTemplateUrl\": \"[uri(deployment().properties.templateLink.uri, 'shared-resources.json')]\"  \r }\r ```  \r \r ### <a name=\"example\"></a>示例\r \r 下面的[示例模板](https://github.com/Azure/azure-docs-json-samples/blob/master/azure-resource-manager/functions/deployment.json)返回部署对象：\r \r ```json\r {\r     \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r     \"contentVersion\": \"1.0.0.0\",\r     \"resources\": [],\r     \"outputs\": {\r         \"subscriptionOutput\": {\r             \"value\": \"[deployment()]\",\r             \"type\" : \"object\"\r         }\r     }\r }\r ```\r \r 前面的示例返回以下对象：\r \r ```json\r {\r   \"name\": \"deployment\",\r   \"properties\": {\r     \"template\": {\r       \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r       \"contentVersion\": \"1.0.0.0\",\r       \"resources\": [],\r       \"outputs\": {\r         \"subscriptionOutput\": {\r           \"type\": \"Object\",\r           \"value\": \"[deployment()]\"\r         }\r       }\r     },\r     \"parameters\": {},\r     \"mode\": \"Incremental\",\r     \"provisioningState\": \"Accepted\"\r   }\r }\r ```\r \r 要使用 Azure CLI 部署此示例模板，请使用：\r \r ```azurecli\r az group deployment create -g functionexamplegroup --template-uri https://raw.githubusercontent.com/Azure/azure-docs-json-samples/master/azure-resource-manager/functions/deployment.json\r ```\r \r 要使用 PowerShell 部署此示例模板，请使用：\r \r ```powershell\r New-AzureRmResourceGroupDeployment -ResourceGroupName functionexamplegroup -TemplateUri https://raw.githubusercontent.com/Azure/azure-docs-json-samples/master/azure-resource-manager/functions/deployment.json\r ```\r \r <a id=\"parameters\" />\r \r ## <a name=\"parameters\"></a>参数\r `parameters(parameterName)`\r \r 返回一个参数值。 指定的参数名称必须已在模板的 parameters 节中定义。\r \r ### <a name=\"parameters\"></a>Parameters\r \r | 参数 | 必选 | 类型 | 说明 |\r |:--- |:--- |:--- |:--- |\r | parameterName |是 |字符串 |要返回的参数名称。 |\r \r ### <a name=\"return-value\"></a>返回值\r \r 指定的参数的值。\r \r ### <a name=\"remarks\"></a>备注\r \r 通常，使用参数设置资源值。 以下示例将 Web 站点的名称设置为在部署过程中传递的参数值。\r \r ```json\r \"parameters\": { \r   \"siteName\": {\r       \"type\": \"string\"\r   }\r },\r \"resources\": [\r    {\r       \"apiVersion\": \"2016-08-01\",\r       \"name\": \"[parameters('siteName')]\",\r       \"type\": \"Microsoft.Web/Sites\",\r       ...\r    }\r ]\r ```\r \r ### <a name=\"example\"></a>示例\r \r 以下[示例模板](https://github.com/Azure/azure-docs-json-samples/blob/master/azure-resource-manager/functions/parameters.json)演示了 parameters 函数的简化用法。\r \r ```json\r {\r     \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r     \"contentVersion\": \"1.0.0.0\",\r     \"parameters\": {\r         \"stringParameter\": {\r             \"type\" : \"string\",\r             \"defaultValue\": \"option 1\"\r         },\r         \"intParameter\": {\r             \"type\": \"int\",\r             \"defaultValue\": 1\r         },\r         \"objectParameter\": {\r             \"type\": \"object\",\r             \"defaultValue\": {\"one\": \"a\", \"two\": \"b\"}\r         },\r         \"arrayParameter\": {\r             \"type\": \"array\",\r             \"defaultValue\": [1, 2, 3]\r         },\r         \"crossParameter\": {\r             \"type\": \"string\",\r             \"defaultValue\": \"[parameters('stringParameter')]\"\r         }\r     },\r     \"variables\": {},\r     \"resources\": [],\r     \"outputs\": {\r         \"stringOutput\": {\r             \"value\": \"[parameters('stringParameter')]\",\r             \"type\" : \"string\"\r         },\r         \"intOutput\": {\r             \"value\": \"[parameters('intParameter')]\",\r             \"type\" : \"int\"\r         },\r         \"objectOutput\": {\r             \"value\": \"[parameters('objectParameter')]\",\r             \"type\" : \"object\"\r         },\r         \"arrayOutput\": {\r             \"value\": \"[parameters('arrayParameter')]\",\r             \"type\" : \"array\"\r         },\r         \"crossOutput\": {\r             \"value\": \"[parameters('crossParameter')]\",\r             \"type\" : \"string\"\r         }\r     }\r }\r ```\r \r 上述示例中使用默认值的输出为：\r \r | 名称 | 类型 | 值 |\r | ---- | ---- | ----- |\r | stringOutput | String | 选项 1 |\r | intOutput | int | 1 |\r | objectOutput | 对象 | {\"one\": \"a\", \"two\": \"b\"} |\r | arrayOutput | Array | [1, 2, 3] |\r | crossOutput | String | 选项 1 |\r \r 要使用 Azure CLI 部署此示例模板，请使用：\r \r ```azurecli\r az group deployment create -g functionexamplegroup --template-uri https://raw.githubusercontent.com/Azure/azure-docs-json-samples/master/azure-resource-manager/functions/parameters.json\r ```\r \r 要使用 PowerShell 部署此示例模板，请使用：\r \r ```powershell\r New-AzureRmResourceGroupDeployment -ResourceGroupName functionexamplegroup -TemplateUri https://raw.githubusercontent.com/Azure/azure-docs-json-samples/master/azure-resource-manager/functions/parameters.json\r ```\r \r <a id=\"variables\" />\r \r ## <a name=\"variables\"></a>variables\r `variables(variableName)`\r \r 返回变量的值。 指定的变量名称必须已在模板的 variables 节中定义。\r \r ### <a name=\"parameters\"></a>Parameters\r \r | 参数 | 必选 | 类型 | 说明 |\r |:--- |:--- |:--- |:--- |\r | variableName |是 |字符串 |要返回的变量名称。 |\r \r ### <a name=\"return-value\"></a>返回值\r \r 指定的变量的值。\r \r ### <a name=\"remarks\"></a>备注\r \r 通常，使用变量通过只构造一次复杂值来简化模板。 以下示例构造存储帐户的唯一名称。\r \r ```json\r \"variables\": {\r     \"storageName\": \"[concat('storage', uniqueString(resourceGroup().id))]\"\r },\r \"resources\": [\r     {\r         \"type\": \"Microsoft.Storage/storageAccounts\",\r         \"name\": \"[variables('storageName')]\",\r         ...\r     },\r     {\r         \"type\": \"Microsoft.Compute/virtualMachines\",\r         \"dependsOn\": [\r             \"[variables('storageName')]\"\r         ],\r         ...\r     }\r ],\r ```\r \r ### <a name=\"example\"></a>示例\r \r 以下[示例模板](https://github.com/Azure/azure-docs-json-samples/blob/master/azure-resource-manager/functions/variables.json)返回了不同的变量值。\r \r ```json\r {\r     \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r     \"contentVersion\": \"1.0.0.0\",\r     \"parameters\": {},\r     \"variables\": {\r         \"var1\": \"myVariable\",\r         \"var2\": [ 1,2,3,4 ],\r         \"var3\": \"[ variables('var1') ]\",\r         \"var4\": {\r             \"property1\": \"value1\",\r             \"property2\": \"value2\"\r         }\r     },\r     \"resources\": [],\r     \"outputs\": {\r         \"exampleOutput1\": {\r             \"value\": \"[variables('var1')]\",\r             \"type\" : \"string\"\r         },\r         \"exampleOutput2\": {\r             \"value\": \"[variables('var2')]\",\r             \"type\" : \"array\"\r         },\r         \"exampleOutput3\": {\r             \"value\": \"[variables('var3')]\",\r             \"type\" : \"string\"\r         },\r         \"exampleOutput4\": {\r             \"value\": \"[variables('var4')]\",\r             \"type\" : \"object\"\r         }\r     }\r }\r ```\r \r 上述示例中使用默认值的输出为：\r \r | 名称 | 类型 | 值 |\r | ---- | ---- | ----- |\r | exampleOutput1 | String | myVariable |\r | exampleOutput2 | Array | [1, 2, 3, 4] |\r | exampleOutput3 | String | myVariable |\r | exampleOutput4 |  对象 | {\"property1\": \"value1\", \"property2\": \"value2\"} |\r \r 要使用 Azure CLI 部署此示例模板，请使用：\r \r ```azurecli\r az group deployment create -g functionexamplegroup --template-uri https://raw.githubusercontent.com/Azure/azure-docs-json-samples/master/azure-resource-manager/functions/variables.json\r ```\r \r 要使用 PowerShell 部署此示例模板，请使用：\r \r ```powershell\r New-AzureRmResourceGroupDeployment -ResourceGroupName functionexamplegroup -TemplateUri https://raw.githubusercontent.com/Azure/azure-docs-json-samples/master/azure-resource-manager/functions/variables.json\r ```\r \r ## <a name=\"next-steps\"></a>后续步骤\r * 有关 Azure Resource Manager 模板中各部分的说明，请参阅 [Authoring Azure Resource Manager templates](resource-group-authoring-templates.md)（创作 Azure Resource Manager 模板）。\r * 若要合并多个模板，请参阅[将链接的模板与 Azure Resource Manager 配合使用](resource-group-linked-templates.md)。\r * 若要在创建资源类型时迭代指定的次数，请参阅[在 Azure Resource Manager 中创建多个资源实例](resource-group-create-multiple.md)。\r * 若要查看如何部署已创建的模板，请参阅[使用 Azure Resource Manager 模板部署应用程序](resource-group-template-deploy.md)。\r \r <!--Update_Description: update meta properties, add azure cli and powershell command example block-->"}