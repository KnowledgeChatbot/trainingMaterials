{"Title":"Azure Analysis Services 教程第 6 课：创建度量值","Description":"介绍如何在 Azure Analysis Services 教程项目中创建度量值。","Content":"# <a name=\"lesson-6-create-measures\"></a>第 6 课：创建度量值\r \r [!INCLUDE[analysis-services-appliesto-aas-sql2017-later](../../../includes/analysis-services-appliesto-aas-sql2017-later.md)]\r \r 在本课中，将创建要在模型中包括的度量值。 类似于创建的计算列，度量是使用 DAX 公式创建的计算。 但与计算列不同，度量值基于用户所选筛选器进行计算。 例如，添加到数据透视表中“行标签”字段的特定一列或切片器。 然后，所应用的度量值会计算筛选器中每个单元格的值。 度量值是强大而灵活的计算，在几乎所有表格模型中都希望包括这类计算来对数值数据执行动态计算。 若要了解详细信息，请参阅[度量值](https://docs.microsoft.com/sql/analysis-services/tabular-models/measures-ssas-tabular)。\r \r 若要创建度量值，需要使用度量值网格。 默认情况下，每个表都有一个空的度量值网格；不过，通常不会为每个表都创建度量值。 在模型设计器的“数据视图”中，度量值网格显示在表下方。 要隐藏或显示表的度量值网格，请单击“表”菜单，并单击“显示度量值网格”。  \r \r 可以通过以下方式创建度量值：单击度量值网格中的某个空单元格，并在公式栏中键入一个 DAX 公式。 单击 Enter 完成公式时，度量值会显示在单元格中。 还可以通过以下方式使用标准聚合函数创建度量值：单击某个列，并单击工具栏上的“自动求和”按钮 (**∑**)。 使用“自动求和”功能创建的度量值显示在该列正下方的度量值网格单元格中，但可以移动。  \r \r 在本课中，通过在公式栏中输入 DAX 公式和使用“自动求和”功能这两种方式创建度量值。  \r \r 本课程预计完成时间：**30 分钟**  \r \r ## <a name=\"prerequisites\"></a>先决条件  \r 本主题是表格建模教程的一部分，应当按顺序完成。 在执行本课中的任务之前，应当已完成上一课：[第 5 课：创建计算列](../tutorials/aas-lesson-5-create-calculated-columns.md)。  \r \r ## <a name=\"create-measures\"></a>创建度量值  \r \r #### <a name=\"to-create-a-dayscurrentquartertodate-measure-in-the-dimdate-table\"></a>在 DimDate 表中创建 DaysCurrentQuarterToDate 度量值  \r \r 1.  在模型设计器中，单击“DimDate”表。  \r \r 2.  在度量值网格中，单击左上角的空单元格。  \r \r 3.  在公式栏中，键入以下公式：  \r \r     ```\r     DaysCurrentQuarterToDate:=COUNTROWS( DATESQTD( 'DimDate'[Date])) \r     ```\r \r     请注意，左上角的单元格现在包含度量值名称“DaysCurrentQuarterToDate”，后面跟有结果 **92**。 此时的结果不相关，因为尚未应用用户筛选器。\r \r     ![aas-lesson6-newmeasure](../tutorials/media/aas-lesson6-newmeasure.png) \r \r     与计算列不同，使用度量值公式时，可以依次键入度量值名称、一个冒号和公式表达式。\r \r #### <a name=\"to-create-a-daysincurrentquarter-measure-in-the-dimdate-table\"></a>在 DimDate 表中创建 DaysInCurrentQuarter 度量值  \r \r 1.  “DimDate”表仍然在模型设计器中处于活动状态时，在度量值网格中，单击创建的度量值下方的空单元格。  \r \r 2.  在公式栏中，键入以下公式：  \r \r     ```\r     DaysInCurrentQuarter:=COUNTROWS( DATESBETWEEN( 'DimDate'[Date], STARTOFQUARTER( LASTDATE('DimDate'[Date])), ENDOFQUARTER('DimDate'[Date])))\r     ```\r \r     在不完整时段和前一时段之间创建一个对比比率时， 该公式必须计算已过时段的比例，将其与前一时段中相同的比例进行比较。 在本例中，[DaysCurrentQuarterToDate]/[DaysInCurrentQuarter] 给出了当前期间中已过去时间的比例。  \r \r #### <a name=\"to-create-an-internetdistinctcountsalesorder-measure-in-the-factinternetsales-table\"></a>在 FactInternetSales 表中创建 InternetDistinctCountSalesOrder 度量值  \r \r 1.  单击“FactInternetSales”表。   \r \r 2.  单击“SalesOrderNumber”列标题。  \r \r 3.  在工具栏上，单击“自动求和”按钮 (**∑**) 旁边的向下箭头，并选择“DistinctCount”。  \r \r     “自动求和”功能会自动使用 DistinctCount 标准聚合公式为所选的列创建一个度量值。  \r \r     ![aas-lesson6-newmeasure2](../tutorials/media/aas-lesson6-newmeasure2.png)\r \r 4.  在度量值网格中，单击新的度量值，并在“属性”窗口中，在“度量值名称”中将度量值重命名为 **InternetDistinctCountSalesOrder**。 \r \r #### <a name=\"to-create-additional-measures-in-the-factinternetsales-table\"></a>在 FactInternetSales 表中创建其他度量值  \r \r 1.  使用“自动求和”功能创建并命名以下度量值：  \r \r     |列|度量值名称|自动求和 (∑)|公式|  \r     |----------------|----------|-----------------|-----------|  \r     |SalesOrderLineNumber|InternetOrderLinesCount|计数|=COUNTA([SalesOrderLineNumber])|  \r     |OrderQuantity|InternetTotalUnits|Sum|=SUM([OrderQuantity])|  \r     |DiscountAmount|InternetTotalDiscountAmount|Sum|=SUM([DiscountAmount])|  \r     |TotalProductCost|InternetTotalProductCost|Sum|=SUM([TotalProductCost])|  \r     |SalesAmount|InternetTotalSales|Sum|=SUM([SalesAmount])|  \r     |Margin|InternetTotalMargin|Sum|=SUM([Margin])|  \r     |TaxAmt|InternetTotalTaxAmt|Sum|=SUM([TaxAmt])|  \r     |Freight|InternetTotalFreight|Sum|=SUM([Freight])|  \r \r 2.  通过单击度量值网格中的某个空单元格并使用公式栏，按顺序创建以下自定义度量值：  \r \r     ```\r     InternetPreviousQuarterMargin:=CALCULATE([InternetTotalMargin],PREVIOUSQUARTER('DimDate'[Date]))\r     ```\r \r     ```\r     InternetCurrentQuarterMargin:=TOTALQTD([InternetTotalMargin],'DimDate'[Date])\r     ```\r \r     ```\r     InternetPreviousQuarterMarginProportionToQTD:=[InternetPreviousQuarterMargin]*([DaysCurrentQuarterToDate]/[DaysInCurrentQuarter])\r     ```\r \r     ```\r     InternetPreviousQuarterSales:=CALCULATE([InternetTotalSales],PREVIOUSQUARTER('DimDate'[Date]))\r     ```\r \r     ```\r     InternetCurrentQuarterSales:=TOTALQTD([InternetTotalSales],'DimDate'[Date])\r     ```\r \r     ```\r     InternetPreviousQuarterSalesProportionToQTD:=[InternetPreviousQuarterSales]*([DaysCurrentQuarterToDate]/[DaysInCurrentQuarter])\r     ```\r \r 为 FactInternetSales 表创建的度量值可以用来为由用户选择的筛选器定义的项分析关键财务数据，例如销售额、成本和利润率。  \r \r ## <a name=\"whats-next\"></a>后续步骤\r [第 7 课：创建关键绩效指标](../tutorials/aas-lesson-7-create-key-performance-indicators.md)。\r \r <!--Update_Description: update meta properties -->"}