{"Title":"Azure AD Connect：版本发布历史记录","Description":"本文列出 Azure AD Connect 和 Azure AD Sync 的所有版本","Content":"# <a name=\"azure-ad-connect-version-release-history\"></a>Azure AD Connect：版本发布历史记录\r Azure Active Directory (Azure AD) 团队会定期更新 Azure AD Sync 的新特性和功能。 并非所有的新增内容都适用于所有受众。\r \r 本文旨在帮助跟踪已发布的版本，并了解是否需要更新为最新版本。\r \r 下面是相关主题的列表：\r \r \r 主题 |  详细信息\r --------- | --------- |\r 从 Azure AD Connect 升级的步骤 | [从旧版升级到最新版](active-directory-aadconnect-upgrade-previous-version.md) Azure AD Connect 的不同方法。\r 所需的权限 | 有关应用更新时所需的权限，请参阅[帐户和权限](./active-directory-aadconnect-accounts-permissions.md#upgrade)。\r 下载| [下载 Azure AD Connect](http://go.microsoft.com/fwlink/?LinkId=615771)。\r \r \r ## <a name=\"116490\"></a>1.1.649.0\r 状态：2017 年 10 月 27 日\r \r >[!NOTE]\r >不通过 Azure AD Connect 自动升级功能向客户提供此内部版本。\r \r ### <a name=\"azure-ad-connect\"></a>具有 Azure AD Connect\r #### <a name=\"fixed-issue\"></a>修复的问题\r - 修复了 Azure AD Connect 与 Azure AD Connect Health 代理（用于同步）之间存在的版本兼容性问题。 此问题会影响要执行 Azure AD Connect 就地升级到版本 1.1.647.0，但当前 Health 代理版本为 3.0.127.0 的用户。 升级之后，Health 代理不再能够将有关 Azure AD Connect 同步服务的运行状况数据发送到 Azure AD Health 服务。 通过此修复，在 Azure AD Connect 就地升级过程中将安装 Health 代理版本 3.0.129.0。 Health 代理版本 3.0.129.0 与 Azure AD Connect 版本 1.1.649.0 没有兼容性问题。\r \r \r ## <a name=\"116470\"></a>1.1.647.0\r 状态：2017 年 10 月 19 日\r \r > [!IMPORTANT]\r > Azure AD Connect 版本 1.1.647.0 与 Azure AD Connect Health 代理（用于同步）版本 3.0.127.0 之间存在已知的兼容性问题。 此问题会阻止 Health 代理向 Azure AD Health 服务发送有关 Azure AD Connect 同步服务的运行状况数据（包括对象同步错误和运行历史记录数据）。 将 Azure AD Connect 部署手动升级到版本 1.1.647.0 之前，请验证 Azure AD Connect 服务器上是否安装了最新版本的 Azure AD Connect Health 代理。 为此，可以转到“控制面板”→“添加/删除程序”，并查找应用程序“用于同步的 Azure AD Connect Health 代理”。如果其版本为 3.0.127.0，我们建议等到推出了下一个 Azure AD Connect 版本再升级。 如果 Health 代理版本不是 3.0.127.0，则可以继续进行手动就地升级。 请注意，此问题不会影响交叉升级，也不影响执行 Azure AD Connect 全新安装的客户。\r >\r >\r \r ### <a name=\"azure-ad-connect\"></a>具有 Azure AD Connect\r #### <a name=\"fixed-issues\"></a>修复的问题\r - 修复了 Azure AD Connect 向导中的“更改用户登录”任务：\r \r   - 如果存在一个**已启用**密码同步的现有 Azure AD Connect 部署，并尝试将用户登录方法设置为“直通身份验证”，则会发生此问题。 在应用更改之前，向导会错误地显示“禁用密码同步”提示。 但是，在应用更改之后，密码同步仍保持启用状态。 通过这项修复，向导不再会显示该提示。\r \r   - 根据设计，在使用“更改用户登录”任务更新用户登录方法时，向导不会禁用密码同步。 这是为了避免干扰想要保留密码同步的客户，即使他们启用直通身份验证或联合身份验证作为其主要用户登录方法。\r   \r   - 如果想要在更新用户登录方法后禁用密码同步，必须执行向导中的“自定义同步配置”任务。 导航到“可选功能”页后，取消选中“密码同步”选项。\r   \r   - 请注意，如果尝试启用/禁用无缝单一登录，也会发生同样的问题。 具体而言，此时某个现有的 Azure AD Connect 部署启用了密码同步，同时用户登录方法已配置为“直通身份验证”。 使用“更改用户登录”任务尝试选中/取消选中“启用无缝单一登录”选项，同时将用户登录方法保持配置为“直通身份验证”。 在应用更改之前，向导会错误地显示“禁用密码同步”提示。 但是，在应用更改之后，密码同步仍保持启用状态。 通过这项修复，向导不再显示该提示。\r \r - 修复了 Azure AD Connect 向导中的“更改用户登录”任务：\r \r    - 如果存在一个**已禁用**密码同步的现有 Azure AD Connect 部署，并尝试将用户登录方法设置为“直通身份验证”，则会发生此问题。 在应用更改后，向导会同时启用直通身份验证和密码同步。 通过这项修复，向导不再启用密码同步。\r \r   - 过去，密码同步是启用直通身份验证的先决条件。 将用户登录方法设置为“直通身份验证”时，向导会同时启用直通身份验证和密码同步。 最近，已去除“密码同步”这项先决条件。 Azure AD Connect 版本 1.1.557.0 中对 Azure AD Connect 做了更改，在将用户登录方法设置为“直通身份验证”时，不会启用密码同步。 但是，该项更改只会应用到 Azure AD Connect 安装。 通过这项修复，相同的更改也会应用到“更改用户登录”任务。\r   \r   - 请注意，如果尝试启用/禁用无缝单一登录，也会发生同样的问题。 具体而言，此时某个现有的 Azure AD Connect 部署禁用了密码同步，同时用户登录方法已配置为“直通身份验证”。 使用“更改用户登录”任务尝试选中/取消选中“启用无缝单一登录”选项，同时将用户登录方法保持配置为“直通身份验证”。 应用这项更改后，向导会启用密码同步。 通过这项修复，向导不再启用密码同步。 \r \r - 修复了一个导致 Azure AD Connect 升级失败并出现错误“无法升级同步服务”的问题。 此外，在出现事件错误“服务无法启动，因为数据库的版本比所安装的二进制文件的版本更新”时，同步服务不再能够启动。 当执行升级的管理员对 Azure AD Connect 所用的 SQL 服务器没有 sysadmin 特权时，将会出现此问题。 通过这项修复，Azure AD Connect 只要求管理员在升级期间对 ADSync 数据库拥有 db_owner 特权。\r \r - 修复了一个会对已启用“无缝单一登录”的客户造成影响的 Azure AD Connect 升级问题。 升级 Azure AD Connect 之后，Azure AD Connect 向导中会错误地将无缝单一登录显示为已禁用，即使该功能保持已启用状态且完全正常。 通过这项修复，该功能现在会正确地在向导中显示为已启用。\r \r - 修复了一个导致 Azure AD Connect 向导始终在“已准备好配置”页上显示“配置源定位点”提示（即使未做出与源定位点相关的任何更改）的问题。\r \r - 在执行 Azure AD Connect 的手动就地升级时，客户必须提供相应 Azure AD 租户的全局管理员凭据。 过去，即使提供的全局管理员凭据属于不同的 Azure AD 租户，也能继续升级。 尽管升级看上去已成功完成，但某些配置不会在升级时正确保留。 通过这项更改，如果提供的凭据与 Azure AD 租户不匹配，则向导不允许继续升级。\r \r - 删除了在开始手动升级时不必要地重启 Azure AD Connect Health 服务的多余逻辑。\r \r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r - 添加了逻辑来简化在 Microsoft 德国云中设置 Azure AD Connect 所要执行的步骤。 过去，我们必须按此文中所述更新 Azure AD Connect 服务器上的特定注册表项，才能让 Azure AD Connect 在 Microsoft 德国云中正常工作。 现在，Azure AD Connect 可以根据安装期间提供的全局管理员凭据，自动检测租户是否在 Microsoft 德国云中。\r \r ### <a name=\"azure-ad-connect-sync\"></a>Azure AD Connect Sync\r >[!NOTE]\r > 注意：同步服务提供一个 WMI 接口让客户开发自己的自定义计划程序。 此接口现已弃用，并会从 2018 年 6 月 30 日之后交付的后续 Azure AD Connect 版本中删除。 想要自定义同步计划的客户应使用 [内置计划程序 (/active-directory/connect/active-directory-aadconnectsync-feature-scheduler)。\r \r #### <a name=\"fixed-issues\"></a>修复的问题\r - 当 Azure AD Connect 向导创建从本地 Active Directory 同步更改所需的 AD 连接器帐户时，不会正确地向该帐户分配读取 PublicFolder 对象所需的权限。 此问题会影响“快速”安装和“自定义”安装。 此项更改修复了该问题。\r \r - 修复了一个导致通过 Windows Server 2016 运行 Azure AD Connect 向导的管理员无法正常查看其故障排除页的问题。\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r - 使用 Azure AD Connect 向导故障排除页排查密码同步问题时，故障排除页现在会返回特定于域的状态。\r \r - 过去，如果尝试启用密码哈希同步，Azure AD Connect 不会验证 AD 连接器帐户是否拥有从本地 AD 同步密码哈希所需的权限。 现在，Azure AD Connect 向导会验证权限，并在 AD 连接器帐户没有足够的权限时发出警告。\r \r ### <a name=\"ad-fs-management\"></a>AD FS 管理\r #### <a name=\"fixed-issue\"></a>修复的问题\r - 修复了与 [msDS-ConsistencyGuid 用作源定位点](/active-directory/connect/active-directory-aadconnect-design-concepts#using-msds-consistencyguid-as-sourceanchor)功能的用法相关的问题。 此问题会影响已将“使用 AD FS 进行联合身份验证”配置为用户登录方法的客户。 执行向导中的“配置源定位点”任务时，Azure AD Connect 会改用 *ms-DS-ConsistencyGuid 作为 immutableId 的源属性。 在应用此项更改的过程中，Azure AD Connect 会尝试更新 AD FS 中 ImmutableId 的声明规则。 但是，由于 Azure AD Connect 无法提供配置 AD FS 所需的管理员凭据，此步骤失败。 通过这项修复，在执行“配置源定位点”任务时，Azure AD Connect 现在会提示输入 AD FS 的管理员凭据。\r \r \r \r ## <a name=\"116140\"></a>1.1.614.0\r 状态：2017 年 9 月 5 日\r \r ### <a name=\"azure-ad-connect\"></a>具有 Azure AD Connect\r \r #### <a name=\"known-issues\"></a>已知问题\r - 有个已知问题会导致 Azure AD Connect 升级失败并出现错误“无法升级同步服务”的问题。 此外，在出现事件错误“服务无法启动，因为数据库的版本比所安装的二进制文件的版本更新”时，同步服务不再能够启动。 当执行升级的管理员对 Azure AD Connect 所用的 SQL 服务器没有 sysadmin 特权时，将会出现此问题。 Dbo 权限是不够的。\r \r - Azure AD Connect 升级存在已知问题，会对已启用无缝单一登录的客户造成影响。 升级 Azure AD Connect 后，功能会在向导中显示为已禁用，即使功能为启用状态也是如此。 未来的发布中将提供对此问题的修复。 担心此显示问题的客户可以手动修复此问题，方法是在向导中启用无缝单一登录。\r \r #### <a name=\"fixed-issues\"></a>修复的问题\r - 修复了启用[作为源定位点的 msDS-ConsistencyGuid](/active-directory/connect/active-directory-aadconnect-design-concepts#using-msds-consistencyguid-as-sourceanchor) 功能时阻止 Azure AD Connect 更新本地 ADFS 中的声明规则的问题。 如果尝试为现有 Azure AD Connect 部署启用将 ADFS 配置为登录方法的功能，则会发生此问题。 之所以会发生此问题是因为，向导在尝试更新 ADFS 中的声明规则之前不提示输入 ADFS 凭据。\r - 修复了本地 AD 林禁用 NTLM 后导致 Azure AD Connect 无法安装的问题。 此问题的起因是：创建 Kerberos 身份验证所需的安全上下文时，Azure AD Connect 向导未提供完全限定的凭据。 这将导致 Kerberos 身份验证失败并且 Azure AD Connect 向导将回退到使用 NTLM。\r \r ### <a name=\"azure-ad-connect-sync\"></a>Azure AD Connect Sync\r #### <a name=\"fixed-issues\"></a>修复的问题\r - 修复了未填充标记属性时无法创建新同步规则的问题。\r - 修复了即使 Kerberos 可用时，仍导致 Azure AD Connect 使用 NTLM 连接到本地 AD 进行密码同步的问题。 如果本地 AD 拓扑具有一个或多个从备份还原的域控制器，则会出现此问题。\r - 修复了导致升级后出现不必要完整同步步骤的问题。 一般情况下，如果现成的同步规则发生了更改，则升级后需要运行完整同步步骤。 此问题的起因是：更改检测逻辑中出现错误，当遇到具有换行字符的同步规则表达式时，此错误导致错误地检测到更改。 已向同步规则表达式中插入了换行符来提升可读性。\r - 修复了可能导致自动升级后 Azure AD Connect 服务器无法正常工作的问题。 此问题会影响 1.1.443.0 版本（或更早版本）的 Azure AD Connect 服务器。 有关此问题的详细信息，请参阅文章[自动升级后 Azure AD Connect 无法正常工作](https://support.microsoft.com/help/4038479/azure-ad-connect-is-not-working-correctly-after-an-automatic-upgrade)。\r - 修复了遇到错误后导致每 5 分钟重试自动升级的问题。 通过此次修复，遇到错误时，自动升级重试次数将指数式下降。\r - 修复了密码同步事件 611 在 Windows 应用程序事件日志中显示不正确（显示为“信息”而不是“错误”）的问题。 只要密码同步出现问题，便会生成事件 611。 \r - 修复了 Azure AD Connect 向导中允许在未选择组写回所需的 OU 的情况下启用组写回功能的问题。\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r - 在 Azure AD Connect 向导中的其他任务下添加了故障排除任务。 客户可以利用此任务解决与密码同步相关的问题并收集常规诊断信息。 未来，故障排除任务将扩展到能处理与目录同步相关的其他问题。\r - Azure AD Connect 现在支持名为“使用现有数据库”的新安装模式。 在此安装模式下，客户可以安装指定现有 ADSync 数据库的 Azure AD Connect。 有关此功能的详细信息，请参阅文章[使用现有数据库](active-directory-aadconnect-existing-database.md)。\r - 为了提高安全性，Azure AD Connect 现在默认为使用 TLS1.2 连接到 Azure AD 进行目录同步。 以前默认使用 TLS1.0。\r - Azure AD Connect 密码同步代理启动时，它将尝试连接到 Azure AD 的已知终结点进行密码同步。 成功连接后，它会重定向到特定于区域的终结点。 以前，除非重新启动，否则密码同步代理将一直缓存区域特定的终结点。 现在，当遇到特定于区域的终结点的连接问题时，代理将清除缓存并重试连接已知终结点。 此更改可确保已缓存的区域特定的终结点不再可用时，密码同步可以故障转移到其他区域特定的终结点。\r - 若要同步本地 AD 林中的更改，需要 AD DS 帐户。 可以 (i) 自行创建 AD DS 帐户并将其凭据提供给 Azure AD Connect，或者 (ii) 提供企业管理员凭据，让 Azure AD Connect 为你创建 AD DS 帐户。 以前，(i) 是 Azure AD Connect 向导中的默认选项。 现在，(ii) 是默认选项。\r \r ### <a name=\"azure-ad-connect-health\"></a>Azure AD Connect Health\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r - 添加了对 Azure 政府云和 Microsoft 云德国的支持。\r \r ### <a name=\"ad-fs-management\"></a>AD FS 管理\r #### <a name=\"fixed-issues\"></a>修复的问题\r - AD 准备 powershell 模块中的 Initialize-ADSyncNGCKeysWriteBack cmdlet 对设备注册容器错误地执行了 ACL，因此只会继承现有权限。  已对此情况进行更新，以便同步服务帐户具有正确的权限。\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r - 已更新 AAD Connect 验证 ADFS 登录任务，以便它能验证针对 Microsoft Online 的登录名而不只是验证从 ADFS 检索到的令牌。\r - 使用 AAD Connect 设置新 ADFS 场时，请求 ADFS 凭据的页面已经移动，现在此页面在要求用户提供 ADFS 和 WAP 服务器之前出现。  通过此更改，AAD Connect 可以检查指定帐户是否具有正确的权限。\r - AAD Connect 升级期间，如果 ADFS AAD 信任无法更新，升级将不会失败。  如果发生此情况，用户将看到相应警告消息，并应通过其他 AAD Connect 任务继续重置信任。\r \r ### <a name=\"seamless-single-sign-on\"></a>无缝单一登录\r #### <a name=\"fixed-issues\"></a>修复的问题\r - 修复了尝试启用无缝单一登录导致 Azure AD Connect 向导返回错误的问题。 错误消息为“Azure AD Connect 身份验证代理的配置失败”。\r \r ## <a name=\"115610\"></a>1.1.561.0\r 状态：2017 年 7 月 23 日\r \r ### <a name=\"azure-ad-connect\"></a>Azure AD Connect\r \r #### <a name=\"fixed-issue\"></a>修复的问题\r \r - 修复了导致现成的同步规则“Out to AD - User ImmutableId”被删除的一个问题：\r \r   - 当升级 Azure AD Connect 时，或使用 Azure AD Connect 向导中的任务选项“更新同步配置”来更新 Azure AD Connect 同步配置时，会出现此问题。\r   \r   - 此同步规则适用于已启用了[将 msDS-ConsistencyGuid 用作源锚点](active-directory-aadconnect-design-concepts.md#using-msds-consistencyguid-as-sourceanchor)功能的客户。 版本 1.1.524.0 及更高版本中引入了此功能。 当删除此同步规则后，Azure AD Connect 无法再使用 ObjectGuid 属性值填充本地 AD ms-DS-ConsistencyGuid 属性。 它不会阻止将新用户预配到 Azure AD 中。\r   \r   - 此修复可以确保在启用了该功能的情况下，在升级期间或者在更改配置期间不再会删除此功能。 对于已受此问题影响的现有客户，此修复还可以确保在升级到此版本的 Azure AD Connect 之后将同步规则添加回来。\r \r - 修复了一个导致现成的同步规则的优先级值小于 100 的问题：\r \r   - 通常，优先级值 0 - 99 是为自定义同步规则保留的。 在升级期间，现成的同步规则的优先级值进行了更新以适应同步规则更改。 由于此问题，可能会为现成的同步规则分配一个小于 100 的优先级值。\r   \r   - 此修复可以防止升级期间发生此问题。 不过，对于已受此问题影响的现有客户，它不会还原优先级值。 将来会提供一个单独的修复来帮助进行还原。\r \r - 修复了即使在启用了基于 OU 的筛选的情况下，Azure AD Connect 向导中的“[域和 OU 筛选](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering)”屏幕也将“同步所有域和 OU”选项显示为已选中的问题。\r \r *   修复了单击“刷新”按钮导致 Synchronization Service Manager 中的[“配置目录分区”屏幕](active-directory-aadconnectsync-configure-filtering.md#organizational-unitbased-filtering)返回错误的问题。 错误消息为：“刷新域时遇到错误: 无法将 System.Collections.ArrayList 类型的对象强制转换为 Microsoft.DirectoryServices.MetadirectoryServices.UI.PropertySheetBase.MaPropertyPages.PartitionObject 类型。” 将新的 AD 域添加到现有 AD 林并尝试使用“刷新”按钮更新 Azure AD Connect 时出错。\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r \r - [自动升级功能](active-directory-aadconnect-feature-automatic-upgrade.md)已经过扩展，为使用以下配置的客户提供支持：\r   - 已启用设备写回功能。\r   - 已启用组写回功能。\r   - 安装不是快速设置或 DirSync 升级。\r   - Metaverse 中的对象超过 100,000 个。\r   - 正在连接到多个林。 快速安装只会连接到一个林。\r   - AD 连接器帐户不再是默认的 MSOL_ 帐户。\r   - 服务器已设置为过渡模式。\r   - 已启用用户写回功能。\r   \r   >[!NOTE]\r   >自动升级功能的范围扩展会影响使用 Azure AD Connect 1.1.105.0 和更高版本的客户。 如果不希望自动升级 Azure AD Connect 服务器，必须在 Azure AD Connect 服务器上运行以下 cmdlet：`Set-ADSyncAutoUpgrade -AutoUpgradeState disabled`。 有关启用/禁用自动升级的详细信息，请参阅 [Azure AD Connect：自动升级](active-directory-aadconnect-feature-automatic-upgrade.md)一文。\r \r ## <a name=\"115580\"></a>1.1.558.0\r 状态：不会发行。 版本 1.1.561.0 中包括了此内部版本中的更改。\r \r ### <a name=\"azure-ad-connect\"></a>Azure AD Connect\r \r #### <a name=\"fixed-issue\"></a>修复的问题\r \r - 修复了在更新基于 OU 的筛选配置时，导致需要删除“Out to AD - User ImmutableId”现成同步规则的问题。 [“msDS-ConsistencyGuid 用作源定位点”功能](active-directory-aadconnect-design-concepts.md#using-msds-consistencyguid-as-sourceanchor)需要此同步规则。\r \r - 修复了即使在启用基于 OU 的筛选的情况下，Azure AD Connect 向导中的[“域和 OU 筛选”屏幕](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering)也将“同步所有域和 OU”选项显示为选中状态的问题。\r \r *   修复了单击“刷新”按钮导致 Synchronization Service Manager 中的[“配置目录分区”屏幕](active-directory-aadconnectsync-configure-filtering.md#organizational-unitbased-filtering)返回错误的问题。 错误消息为：“刷新域时遇到错误: 无法将 System.Collections.ArrayList 类型的对象强制转换为 Microsoft.DirectoryServices.MetadirectoryServices.UI.PropertySheetBase.MaPropertyPages.PartitionObject 类型。” 将新的 AD 域添加到现有 AD 林并尝试使用“刷新”按钮更新 Azure AD Connect 时出错。\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r \r - [自动升级功能](active-directory-aadconnect-feature-automatic-upgrade.md)已经过扩展，为使用以下配置的客户提供支持：\r   - 已启用设备写回功能。\r   - 已启用组写回功能。\r   - 安装不是快速设置或 DirSync 升级。\r   - Metaverse 中的对象超过 100,000 个。\r   - 正在连接到多个林。 快速安装只会连接到一个林。\r   - AD 连接器帐户不再是默认的 MSOL_ 帐户。\r   - 服务器已设置为过渡模式。\r   - 已启用用户写回功能。\r   \r   >[!NOTE]\r   >自动升级功能的范围扩展会影响使用 Azure AD Connect 1.1.105.0 和更高版本的客户。 如果不希望自动升级 Azure AD Connect 服务器，必须在 Azure AD Connect 服务器上运行以下 cmdlet：`Set-ADSyncAutoUpgrade -AutoUpgradeState disabled`。 有关启用/禁用自动升级的详细信息，请参阅 [Azure AD Connect：自动升级](active-directory-aadconnect-feature-automatic-upgrade.md)一文。\r \r ## <a name=\"115570\"></a>1.1.557.0\r 状态：2017 年 7 月\r \r >[!NOTE]\r >不通过 Azure AD Connect 自动升级功能向客户提供此内部版本。\r \r ### <a name=\"azure-ad-connect\"></a>具有 Azure AD Connect\r \r #### <a name=\"fixed-issue\"></a>修复的问题\r - 修复了 Initialize-ADSyncDomainJoinedComputerSync cmdlet 导致现有服务连接点对象上配置的已验证域发生变化的问题（即使该域仍是有效域）。 当 Azure AD 租户中包含多个可用于配置服务连接点的已验证域时，会出现此问题。\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r - 现已推出适用于 Azure 政府云与 Microsoft 云德语版的密码写回预览版。 有关 Azure AD Connect 对不同服务实例的支持的详细信息，请参阅 [Azure AD Connect：有关实例的特殊注意事项](active-directory-aadconnect-instances.md)一文。\r \r - Initialize-ADSyncDomainJoinedComputerSync cmdlet 现在有一个名为 AzureADDomain 的新可选参数。 此参数可以指定要将哪个已验证域用于配置服务连接点。\r \r ### <a name=\"pass-through-authentication\"></a>直通身份验证\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r - 直通身份验证所需的代理名称已从“Azure AD 应用程序代理连接器”更改为“Azure AD Connect 身份验证代理”。\r \r - 默认情况下，启用直通身份验证不再会启用密码哈希同步。\r \r \r ## <a name=\"115530\"></a>1.1.553.0\r 状态：2017 年 6 月\r \r > [!IMPORTANT]\r > 此版本引入了架构和同步规则更改。 Azure AD Connect 同步服务在升级后会触发完全导入和完全同步步骤。 下面介绍了更改详细信息。 若要在升级后暂时推迟完全导入和完全同步步骤，请参阅[如何在升级后推迟完全同步](active-directory-aadconnect-upgrade-previous-version.md#how-to-defer-full-synchronization-after-upgrade)一文。\r >\r >\r \r ### <a name=\"azure-ad-connect-sync\"></a>Azure AD Connect Sync\r \r #### <a name=\"known-issue\"></a>已知问题\r - 有一个问题会影响将[基于 OU 的筛选](active-directory-aadconnectsync-configure-filtering.md#organizational-unitbased-filtering)与 Azure AD Connect 同步配合使用的客户。在 Azure AD Connect 向导中导航到[“域和 OU 筛选”页](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering)时，预期会出现以下行为：\r   - 如果启用了基于 OU 的筛选，“同步选定的域和 OU”选项会处于选中状态。\r   - 否则，“同步所有域和 OU”选项处于选中状态。\r \r 发生的问题是，运行向导时始终会选择“同步所有域和 OU”选项。  即使之前已配置基于 OU 的筛选，也会发生此问题。 在保存任何 AAD Connect 配置更改之前，请确保**已选择“同步选定的域和 OU”选项**，并确认所有需要同步的 OU 已重新启用。 否则，会禁用基于 OU 的筛选。\r \r #### <a name=\"fixed-issues\"></a>修复的问题\r \r - 修复了密码写回允许 Azure AD 管理员重置本地 AD 特权用户帐户的密码的问题。 通过特权帐户向 Azure AD Connect 授予“重置密码”权限时，会出现此问题。 此 Azure AD Connect 版本已解决此问题：不再允许 Azure AD 管理员重置任意本地 AD 特权用户帐户的密码，除非该管理员是该帐户的所有者。 有关详细信息，请参阅[安全公告 4033453](https://technet.microsoft.com/library/security/4033453)。\r \r - 修复了 [msDS-ConsistencyGuid 用作源定位点](/active-directory/connect/active-directory-aadconnect-design-concepts#using-msds-consistencyguid-as-sourceanchor)功能相关的以下问题：Azure AD Connect 不写回到本地 AD msDS-ConsistencyGuid 属性。 如果已将多个本地 AD 林添加到 Azure AD Connect 并且已选择“用户标识跨多个目录存在”选项，则会出现此问题。 使用此类配置时，生成的同步规则不会填充 Metaverse 中的 sourceAnchorBinary 属性。 sourceAnchorBinary 属性用作 msDS-ConsistencyGuid 属性的源属性。 因此，不会写回到 ms-DSConsistencyGuid 属性。 为了修复此问题，我们已更新以下同步规则，以确保始终填充 Metaverse 中的 sourceAnchorBinary 属性：\r   - In from AD - InetOrgPerson AccountEnabled.xml\r   - In from AD - InetOrgPerson Common.xml\r   - In from AD - User AccountEnabled.xml\r   - In from AD - User Common.xml\r   - In from AD - User Join SOAInAAD.xml\r \r - 以前，即使未启用 [msDS-ConsistencyGuid 用作源定位点](/active-directory/connect/active-directory-aadconnect-design-concepts#using-msds-consistencyguid-as-sourceanchor)功能，也仍会将“Out to AD - User ImmutableId”同步规则添加到 Azure AD Connect。 这种影响是良性的，不会导致发生 msDS-ConsistencyGuid 属性写回。 为避免混淆，我们添加了逻辑来确保仅当已启用该功能时才添加该同步规则。\r \r - 修复了导致密码哈希同步失败并出现错误事件 611 的问题。 从本地 AD 中删除一个或多个域控制器后，会出现此问题。 在每个密码同步周期结束时，本地 AD 发出的同步 Cookie 包含已删除的域控制器的调用 ID，其 USN（更新序列号）值为 0。 密码同步管理器无法保存包含 0 值 USN 的同步 Cookie，同时会失败并出现错误事件 611。 在下一个同步周期，密码同步管理器会重复使用上次保存的、不包含 0 值 USN 的同步 Cookie。 这将导致重新同步相同的密码更改。 应用此项修复后，密码同步管理器可正确保存同步 Cookie。\r \r - 以前，即使已使用 Set-ADSyncAutoUpgrade cmdlet 禁用自动升级，自动升级过程也仍会定期检查升级，并依赖于下载的安装程序来遵循禁用指令。 应用此项修复后，自动升级过程不再会定期检查升级。 执行此 Azure AD Connect 版本的升级安装程序一次，即可自动应用此项修复。\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r \r - 以前，[msDS-ConsistencyGuid 用作源定位点](/active-directory/connect/active-directory-aadconnect-design-concepts#using-msds-consistencyguid-as-sourceanchor)功能仅适用于新部署。 现在，该功能适用于现有部署。 更具体地说：\r   - 若要访问该功能，请启动 Azure AD Connect 向导并选择“更新源定位点”选项。\r   - 只有使用 objectGuid 作为 sourceAnchor 属性的现有部署才会显示此选项。\r   - 配置该选项时，向导会验证本地 Active Directory 中 msDS-ConsistencyGuid 属性的状态。 如果未在目录中的任何用户对象上配置该属性，向导会将 msDS-ConsistencyGuid 用作 sourceAnchor 属性。 如果已在目录中的一个或多个用户对象上配置该属性，向导就会认为该属性正由其他应用程序使用，不适合用作 sourceAnchor 属性，并且不允许源定位点更改继续进行。 如果确定该属性未由现有应用程序使用，则需联系支持部门，了解如何取消显示该错误。\r \r - 对于设备对象上的 **userCertificate** 属性，Azure AD Connect 现在会查找将已加入域的设备连接到 Azure AD for Windows 10 体验所需的证书值，并在同步到 Azure AD 之前筛选掉其他证书值。 为了启用此行为，我们已更新现成的同步规则“Out to AAD - Device Join SOAInAD”。\r \r - Azure AD Connect 现在支持将 Exchange Online **cloudPublicDelegates** 属性写回到本地 AD **publicDelegates** 属性。 这样，就可以实现向使用本地 Exchange Online 邮箱的用户授予 SendOnBehalfTo 权限的方案。 为了支持此功能，我们添加了新的现成同步规则“Out to AD - User Exchange Hybrid PublicDelegates writeback”。 仅当已启用 Exchange 混合功能时，才会将此同步规则添加到 Azure AD Connect。\r \r * Azure AD Connect 现在支持从 Azure AD 同步 **altRecipient** 属性。 为了支持此项更改，我们已更新以下现成同步规则，并在其中包含所需的属性流：\r   - In from AD - User Exchange\r   - Out to AAD - User ExchangeOnline\r   \r - Metaverse 中的 **cloudSOAExchMailbox** 属性指示给定的用户是否具有 Exchange Online 邮箱。 其定义已更新，现在包含设备和会议室邮箱等的其他 Exchange Online RecipientDisplayTypes。 为了启用此项更改，现成同步规则“In from AAD - User Exchange Hybrid”下的 cloudSOAExchMailbox 属性定义已从：\r \r   ```\r   CBool(IIF(IsNullOrEmpty([cloudMSExchRecipientDisplayType]),NULL,BitAnd([cloudMSExchRecipientDisplayType],&amp;HFF) = 0))\r   ```\r \r   ... 更新为：\r \r   ```\r   CBool(\r     IIF(IsPresent([cloudMSExchRecipientDisplayType]),(\r       IIF([cloudMSExchRecipientDisplayType]=0,True,(\r         IIF([cloudMSExchRecipientDisplayType]=2,True,(\r           IIF([cloudMSExchRecipientDisplayType]=7,True,(\r             IIF([cloudMSExchRecipientDisplayType]=8,True,(\r               IIF([cloudMSExchRecipientDisplayType]=10,True,(\r                 IIF([cloudMSExchRecipientDisplayType]=16,True,(\r                   IIF([cloudMSExchRecipientDisplayType]=17,True,(\r                     IIF([cloudMSExchRecipientDisplayType]=18,True,(\r                       IIF([cloudMSExchRecipientDisplayType]=1073741824,True,(\r                         IF([cloudMSExchRecipientDisplayType]=1073741840,True,False)))))))))))))))))))),False))\r \r   ```\r \r - 添加了以下 X509Certificate2 兼容函数集，用于创建同步规则表达式来处理 userCertificate 属性中的证书值：\r \r     ||||\r     | --- | --- | --- |\r     |CertSubject|CertIssuer|CertKeyAlgorithm|\r     |CertSubjectNameDN|CertIssuerOid|CertNameInfo|\r     |CertSubjectNameOid|CertIssuerDN|IsCert|\r     |CertFriendlyName|CertThumbprint|CertExtensionOids|\r     |CertFormat|CertNotAfter|CertPublicKeyOid|\r     |CertSerialNumber|CertNotBefore|CertPublicKeyParametersOid|\r     |CertVersion|CertSignatureAlgorithmOid|选择|\r     |CertKeyAlgorithmParams|CertHashString|Where|\r     |||With|\r \r - 引入了以下架构更改，使客户能够创建自定义同步规则来传送组对象的 sAMAccountName、domainNetBios 和 domainFQDN，以及用户对象的 distinguishedName：\r \r   - 已将以下属性添加到 MV 架构：\r     - 组：AccountName\r     - 组：domainNetBios\r     - 组：domainFQDN\r     - 用户：distinguishedName\r \r   - 已将以下属性添加到 Azure AD 连接器架构：\r     - 组：OnPremisesSamAccountName\r     - 组：NetBiosName\r     - 组：DnsDomainName\r     - 用户：OnPremisesDistinguishedName\r \r - ADSyncDomainJoinedComputerSync cmdlet 脚本现在有一个名为 AzureEnvironment 的新可选参数。 该参数用于指定相应的 Azure Active Directory 租户托管在哪个区域。 有效值包括：\r   - AzureCloud（默认值）\r   - AzureChinaCloud\r   - AzureGermanyCloud\r   - USGovernment\r  \r - 已将同步规则编辑器更新为在创建同步规则期间使用 Join（而不是 Provision）作为链接类型的默认值。\r \r ### <a name=\"ad-fs-management\"></a>AD FS 管理\r \r #### <a name=\"issues-fixed\"></a>修复的问题\r \r - 以下 URL 是 Azure AD 引入的新 WS 联合身份验证终结点，旨在提高发生身份验证中断后的复原能力；这些 URL 将添加到本地 AD FS 信赖方信任配置：\r   - https://ests.login.partner.microsoftonline.cn/login.srf\r   - https://stamp2.login.partner.microsoftonline.cn/login.srf\r   - https://ccs.login.partner.microsoftonline.cn/login.srf\r   - https://ccs-sdf.login.partner.microsoftonline.cn/login.srf\r   \r - 修复了导致 AD FS 为 IssuerID 生成错误声明值的问题。 如果 Azure AD 租户中存在多个已验证的域，并且用于生成 IssuerID 声明的 userPrincipalName 属性的域后缀深度至少为 3 级（例如 johndoe@us.contoso.com），则会出现此问题。 此问题已通过更新声明规则使用的正则表达式得到解决。\r \r #### <a name=\"new-features-and-improvements\"></a>新增功能和改进\r - 以前，Azure AD connect 提供的 ADFS 证书管理功能仅适用于通过 Azure AD Connect 管理的 ADFS 场。 现在，此功能也适用于不是使用 Azure AD Connect 管理的 ADFS 场。\r \r ## <a name=\"115240\"></a>1.1.524.0\r 发布日期：2017 年 5 月\r \r > [!IMPORTANT]\r > 此版本引入了架构和同步规则更改。 Azure AD Connect 同步服务在升级后将触发完全导入和完全同步步骤。 下面介绍了更改详细信息。\r >\r >\r \r **已解决的问题：**\r \r Azure AD Connect 同步\r \r - 修复了导致自动升级的问题，即使客户已禁用使用 Set-ADSyncAutoUpgrade cmdlet 的功能在 Azure AD Connect 服务器上发生。 使用此修复后，服务器上的自动升级进程仍升级会定期检查，但下载安装程序自动升级的配置。\r - 在 DirSync 就地升级时，Azure AD Connect 创建由 Azure AD 连接器用于与 Azure AD 同步的 Azure AD 服务帐户。 创建帐户后，Azure AD Connect 使用该帐户在 Azure AD 中进行身份验证。 有时，身份验证由于暂时性问题失败，而这又会导致 DirSync 就地升级失败，并出现错误“执行配置 AAD 同步任务时出错: AADSTS50034: 要登录到此应用程序，必须将帐户添加到 xxx.partner.onmschina.cn 目录。” 为了提高 DirSync 升级的复原能力，Azure AD Connect 现在会重试身份验证步骤。\r - 版本 443 中的某个问题会导致 DirSync 就地升级成功，但不会创建目录同步所需的运行配置文件。 此 Azure AD Connect 版本中包含修复逻辑。 客户升级到此版本时，Azure AD Connect 会检测缺少的运行配置文件并予以创建。\r - 修复了导致无法启动密码同步过程并出现事件 ID 6900 和错误“已添加具有相同键的项”的问题。 如果更新 OU 筛选配置以包含 AD 配置分区，则会出现此问题。 为了修复此问题，密码同步过程现在只会从 AD 域分区同步密码更改。 将跳过非域分区，例如配置分区。\r - 在快速安装期间，Azure AD Connect 会创建一个本地 AD DS 帐户，AD 连接器可使用该帐户来与本地 AD 通信。 以前，创建的帐户在 user-Account-Control 属性中设置了 PASSWD_NOTREQD 标志，并在帐户中设置随机密码。 现在，在帐户中设置密码后，Azure AD Connect 会显式删除 PASSWD_NOTREQD 标志。\r - 修复了当 mailNickname 属性出现在本地 AD 架构中但未绑定到 AD 用户对象类时，导致 DirSync 升级失败并出现错误“尝试获取应用程序锁时，SQL Server 中发生死锁”错误的问题。\r - 修复了当管理员使用 Azure AD Connect 向导更新 Azure AD Connect 同步配置时自动禁用设备写回功能的问题。 出现此问题的原因是向导针对本地 AD 中现有的设备写回配置执行先决条件检查失败。 修复方法是跳过检查以前是否已启用设备写回。\r - 若要配置 OU 筛选，可以使用 Azure AD Connect 向导或 Synchronization Service Manager。 以前，如果使用 Azure AD Connect 向导配置 OU 筛选，则会包含以后新建的 OU 用于目录同步。 如果不想要包含新 OU，则必须使用 Synchronization Service Manager 配置 OU 筛选。 现在，可以获得相同的行为使用 Azure AD Connect 向导。\r - 修复了导致在安装管理架构而不是 dbo 架构下创建 Azure AD Connect 所需存储过程的问题。\r - 修复了导致在 AAD Connect 服务器事件日志中省略 Azure AD 返回的 TrackingId 属性的问题。 如果 Azure AD Connect 从 Azure AD 收到了重定向消息，并且 Azure AD Connect 无法连接到提供的终结点，则会发生此问题。 在故障排除期间，支持工程师使用 TrackingId 来关联服务端日志。\r - Azure AD Connect 从 Azure AD 收到 LargeObject 错误时，会生成 EventID 为 6941 的事件，并返回消息“预配的对象太大。请减少此对象上属性值的数目。” 同时，Azure AD Connect 还会生成 EventID 为 6900 的误导性事件和消息“Microsoft.Online.Coexistence.ProvisionRetryException: 无法与 Azure Active Directory 服务通信。” 为了尽量减少混淆，在收到 LargeObject 错误时，Azure AD Connect 不再生成后一种事件。\r - 修复了当尝试更新通用 LDAP 连接器的配置时，Synchronization Service Manager 无法响应的问题。\r \r **新功能/改进：**\r \r Azure AD Connect 同步\r - 同步规则更改 – 实现了以下同步规则更改：\r   - 如果属性有 15 个以上的值，更新的默认同步规则设置为不导出属性 **userCertificate** 和 **userSMIMECertificate**。\r   - AD 属性 **employeeID** 和 **msExchBypassModerationLink** 现在包含在默认同步规则集中。\r   - AD 属性 **photo** 已从默认同步规则集中删除。\r   - 已将 **preferredDataLocation** 添加到 Metaverse 架构和 AAD 连接器架构。 想要在 Azure AD 中更新任一属性的客户可以实现自定义同步规则。 若要了解有关该属性的详细信息，请参阅文章部分 [Azure AD Connect 同步：如何更改默认配置 - 启用 PreferredDataLocation 同步](active-directory-aadconnectsync-change-the-configuration.md#enable-synchronization-of-preferreddatalocation)。\r   - 已将 **userType** 添加到 Metaverse 架构和 AAD 连接器架构。 想要在 Azure AD 中更新任一属性的客户可以实现自定义同步规则。\r \r - Azure AD Connect 现在会自动启用 ConsistencyGuid 属性作为本地 AD 对象的源定位点属性。 此外，Azure AD Connect 会使用 objectGuid 属性值填充 ConsistencyGuid 属性（如果为空）。 此功能仅适用于新部署。 若要了解有关此功能的详细信息，请参阅文章部分 [Azure AD Connect：设计概念 - 将 msDS-ConsistencyGuid 用作 sourceAnchor](active-directory-aadconnect-design-concepts.md#using-msds-consistencyguid-as-sourceanchor)。\r - 已添加新的故障排除 cmdlet Invoke-ADSyncDiagnostics，以帮助诊断密码哈希同步相关的问题。 有关使用该 cmdlet 的信息，请参阅[排查 Azure AD Connect 同步的密码同步问题](/active-directory/connect/active-directory-aadconnectsync-troubleshoot-password-synchronization)一文。\r - Azure AD Connect 现在支持将启用邮件的公共文件夹对象从本地 AD 同步到 Azure AD。 可以使用 Azure AD Connect 向导中的“可选功能”启用该功能。 若要了解有关此功能的详细信息，请参阅[基于 Office 365 目录的边缘阻止对启用邮件的本地公共文件夹的支持](https://blogs.technet.microsoft.com/exchange/2017/05/19/office-365-directory-based-edge-blocking-support-for-on-premises-mail-enabled-public-folders)一文。\r - Azure AD Connect 要求从本地 AD 同步 AD DS 帐户。 以前，如果使用“快速”模式安装了 Azure AD Connect，则可以提供企业管理员帐户的凭据，Azure AD Connect 会创建所需的 AD DS 帐户。 但是，对于自定义安装以及要将林添加到现有部署的情况，必须提供 AD DS 帐户。 现在，还可以在自定义安装过程中选择提供企业管理员帐户的凭据，并让 Azure AD Connect 创建所需的 AD DS 帐户。\r - Azure AD Connect 现在支持 SQL AOA。 安装 Azure AD Connect 之前，必须启用 SQL AOA。 在安装期间，Azure AD Connect 检测或不是否提供的 SQL 实例已启用 SQL AOA。 如果启用了 SQL AOA，Azure AD Connect 会进一步判断 SQL AOA 是配置为使用同步复制还是异步复制。 设置可用性组侦听器时，我们建议将 RegisterAllProvidersIP 属性设置为 0。 这是因为，Azure AD Connect 目前使用 SQL Native Client 连接到 SQL，而 SQL Native Client 不支持使用 MultiSubNetFailover 属性。\r - 如果将 LocalDB 用作 Azure AD Connect 的数据库并且已达到该数据库的 10-GB 限制，同步服务不再启动。 以前，需要对 LocalDB 执行 ShrinkDatabase 操作，以回收足够的数据库空间来启动同步服务。 后来，可以使用 Synchronization Service Manager 来删除运行历史记录，以回收更多的数据库空间。 现在，可以使用 Start-ADSyncPurgeRunHistory cmdlet 从 LocalDB 中清除运行历史记录数据，以回收数据库空间。 此外，此 cmdlet 支持脱机模式（通过指定 -offline 参数），同步服务未运行时可以使用该模式。 注意：仅当同步服务未运行，并且使用的数据库为 LocalDB 时，才能使用脱机模式。\r - 为了减少所需的存储空间量，Azure AD Connect 现在会先压缩同步错误详细信息，并将它们存储在 LocalDB/SQL 数据库中。 从旧版 Azure AD Connect 升级到此版本时，Azure AD Connect 会针对现有的同步错误详细信息执行一次性压缩。\r - 以前，在更新 OU 筛选配置后，必须手动运行完全导入才能确保在目录同步中正确包含/排除现有对象。 现在，Azure AD Connect 会在下一个同步周期自动触发完全导入。 此外，完全导入仅应用到受更新影响的 AD 连接器。 注意：此项改进仅适用于使用 Azure AD Connect 向导所做的 OU 筛选更新， 而不适用于使用 Synchronization Service Manager 所做的 OU 筛选更新。\r - 以前，基于组的筛选仅支持用户、组和联系人对象。 现在，基于组的筛选还支持计算机对象。\r - 以前，可以删除连接器空间数据，而无需禁用 Azure AD Connect 同步计划程序。 现在，如果 Synchronization Service Manager 检测到计划程序已启用，则会阻止删除连接器空间数据。 此外，如果连接器空间数据已被删除，则还会返回警告，告知客户可能有数据丢失。\r - 以前，必须禁用 PowerShell 脚本才能让 Azure AD Connect 向导正常运行。 此问题已部分解决。 如果使用 Azure AD Connect 向导来管理同步配置，则可以启用 PowerShell 脚本。 如果使用 Azure AD Connect 向导来管理 ADFS 配置，则必须禁用 PowerShell 脚本。\r \r \r \r ## <a name=\"114860\"></a>1.1.486.0\r 发布日期：2017 年 4 月\r \r **已解决的问题：**\r - 修复了 Azure AD Connect 无法在本地化版本的 Windows Server 上成功安装的问题。\r \r ## <a name=\"114840\"></a>1.1.484.0\r 发布日期：2017 年 4 月\r \r **已知问题：**\r \r - 如果以下条件全部成立，则不能成功安装 Azure AD Connect 的此版本：\r    1. 正在执行 DirSync 的就地升级或 Azure AD Connect 的全新安装。\r    2. 使用的是本地化版本的 Windows Server，该服务器上的内置 Administrator 组的名称不是“Administrators”。\r    3. 使用的是随 Azure AD Connect 一起安装的默认 SQL Server 2012 Express LocalDB，而不是自己的完整 SQL。\r \r **已解决的问题：**\r \r Azure AD Connect 同步\r - 修复了当一个或多个连接器缺少某个同步步骤的运行配置文件时，同步计划程序会完全跳过这一同步步骤的问题。 例如，使用 Synchronization Service Manager 手动添加了连接器，但没有为其创建增量导入运行配置文件。 此项修复可确保同步计划程序继续运行其他连接器的增量导入。\r - 修复了当 Synchronization Service 在运行步骤的其中一步遇到问题时，立即停止处理运行配置文件的问题。 此项修复可确保 Synchronization Service 会跳过该运行步骤，并继续处理其余步骤。 例如，具有多个运行步骤的 AD 连接器的增量导入运行配置文件（每个本地 AD 域一个步骤）。 即使其中一个 AD 域出现网络连接问题，Synchronization Service 也会运行其他 AD 域的增量导入。\r - 修复了自动升级期间会跳过 Azure AD 连接器更新的问题。\r - 修复了安装过程中 Azure AD 连接器不能正确识别服务器是否是域控制器，进而导致 DirSync 升级失败的问题。\r - 修复了 DirSync 就地升级不会为 Azure AD 连接器创建任何运行配置文件的问题。\r - 修复了当尝试配置通用的 LDAP 连接器时，Synchronization Service Manager 用户界面无法响应的问题。\r \r AD FS 管理\r - 修复了如果 AD FS 主节点已移至其他服务器，Azure AD Connect 向导失败的问题。\r \r 桌面 SSO\r - 修复了 Azure AD Connect 向导中的问题，即在新的安装过程中，如果选择“密码同步”作为登录选项，则无法在登录屏幕中启用桌面 SSO 功能的问题。\r \r **新功能/改进：**\r \r Azure AD Connect 同步\r - Azure AD Connect Sync 现在支持使用虚拟服务帐户、托管服务帐户和组托管服务帐户作为其服务帐户。 此功能仅适用于新安装的 Azure AD Connect。 安装 Azure AD Connect 时：\r     - 默认情况下，Azure AD Connect 向导会创建一个虚拟服务帐户，并将其用作服务帐户。\r     - 如果是在域控制器上进行安装，Azure AD Connect 会回退到之前的处理方式，即创建一个域用户帐户，并将其用作服务帐户。\r     - 可以通过提供以下帐户之一来替代默认的处理方式：\r       - 组托管服务帐户\r       - 托管服务帐户\r       - 域用户帐户\r       - 本地用户帐户\r - 以前，如果升级到的 Azure AD Connect 新版本中更新了连接器或更改了同步规则，Azure AD Connect 将触发完全同步周期。 现在，Azure AD Connect 有选择性地仅对进行了更新的连接器触发完全导入步骤，对更改了同步规则的连接器触发完全同步步骤。\r - 以前，导出删除阈值仅适用于通过同步计划程序触发的导出。 现在，此功能扩展到了适用于客户使用 Synchronization Service Manager 手动触发导出的情况。\r - Azure AD 租户有一个服务配置，该配置指示了是否已为租户启用密码同步功能。 以前，同时拥有活动和暂存服务器时，Azure AD Connect 很容易错误配置服务配置。 现在，Azure AD Connect 会尝试让服务配置只和活动 Azure AD Connect 服务器保持一致。\r - 如果本地 AD 未启用 AD 回收站，Azure AD Connect 向导会检测并返回警告。\r - 以前，如果批中的对象总大小超过特定阈值，导出到 Azure AD 会超时并失败。 现在遇到此问题时，Synchronization Service 会再次尝试以较小批次单独重新发送对象。\r - 已经将 Synchronization Service Key Management 应用程序从 Windows 开始菜单中删除。 仍然支持使用 miiskmu.exe 通过命令行接口管理加密密钥。 有关加密密钥的详细信息，请参阅[弃用 Azure AD Connect 同步加密密钥](/active-directory/connect/active-directory-aadconnectsync-change-serviceacct-pass#abandoning-the-azure-ad-connect-sync-encryption-key)一文。\r - 以前，如果更改了 Azure AD Connect 同步服务帐户密码，则无法正常启动 Synchronization Service，除非已弃用加密密钥并重新初始化 Azure AD Connect 同步服务帐户密码。 现在不再需要此操作。\r \r 桌面 SSO\r \r - 配置传递身份验证和桌面 SSO 时，Azure AD Connect 向导不再需要在网络上打开端口 9090。 只需要端口 443。 \r \r ## <a name=\"114430\"></a>1.1.443.0\r 发布日期：2017 年 3 月\r \r **已解决的问题：**\r \r Azure AD Connect 同步\r - 修复了在 Azure AD 连接器的显示名称没有包含分配给 Azure AD 租户的初始 onmicrosoft.com 域时，Azure AD Connect 向导会失败的问题。\r - 修复了在同步服务帐户的密码包含特殊字符（如撇号、冒号和空格）的情况下，在与 SQL 数据库进行连接时，Azure AD Connect 向导会失败的问题。\r - 修复了在暂时不同步某个本地 AD 对象，再将其进行同步后，暂存模式下的 Azure AD Connect 服务器上将出现“该 dimage 具有不同于映像的定位点”错误的问题。\r - 修复了在暂时不同步某个本地 AD 对象，再将其进行同步后，暂存模式下的 Azure AD Connect 服务器上将出现“DN 定位的对象是一个幻影”错误的问题。\r \r AD FS 管理\r - 修复了在配置备用登录 ID 后，Azure AD Connect 向导不会更新 AD FS 配置并设置对信赖方信任的正确声明的问题。\r - 修复了 Azure AD Connect 向导无法正确处理 AD FS 服务器（该服务器的服务帐户是通过 userPrincipalName 格式设置的，而不是 sAMAccountName 格式）的问题。\r \r 直通身份验证\r - 修复了在选择了“直通身份验证”但其连接器注册失败时，Azure AD Connect 向导会失败的问题。\r - 修复了在启用了桌面 SSO 功能时，Azure AD Connect 向导将绕过对所选登录方法的验证检查。\r \r 密码重置\r - 修复了当连接已由防火墙或代理终止时，可能会导致 Azure AAD Connect 服务器不尝试重新连接的问题。\r \r **新功能/改进：**\r \r Azure AD Connect 同步\r - Get-ADSyncScheduler cmdlet 现在可返回一个名为 SyncCycleInProgress 的新的布尔属性。 如果返回的值为 true，则意味着正在进行计划的同步周期。\r - 已用于存储 Azure AD Connect 安装和安装程序日志的目标文件夹从 %localappdata%\\AADConnect 移至 %programdata%\\AADConnect，以提高日志文件的访问性。\r \r AD FS 管理\r - 添加了对更新 AD FS 场 SSL 证书的支持。\r - 添加了对管理 AD FS 2016 的支持。\r - 现在可以在 AD FS 安装期间指定现有 gMSA（组托管服务帐户）。\r - 现在可以将 SHA-256 配置为 Azure AD 信赖方信任的签名哈希算法。\r \r 密码重置\r - 引入了多项改进，以允许产品在具有更严格防火墙规则的环境中正常工作。\r - 提高了与 Azure 服务总线的连接可靠性。\r \r ## <a name=\"113800\"></a>1.1.380.0\r 发布日期：2016 年 12 月\r \r **修复的问题：**\r \r - 修复了本版本中缺少针对 Active Directory 联合身份验证服务 (AD FS) 的 issuerid 声明规则的问题。\r \r >[!NOTE]\r >不通过 Azure AD Connect 自动升级功能向客户提供此内部版本。\r \r ## <a name=\"113710\"></a>1.1.371.0\r 发布日期：2016 年 12 月\r \r **已知问题：**\r \r - 本版本中缺少针对 AD FS 的 issuerid 声明规则。 若要将多个域与 Azure Active Directory (Azure AD) 联合，需要使用 issuerid 声明规则。 如果使用 Azure AD Connect 管理本地 AD FS 部署，则升级到此版本将从 AD FS 配置中删除现有 issuerid 声明规则。 可在安装/升级后添加 issuerid 声明规则来解决此问题。 有关添加 issuerid 声明规则的详细信息，请参阅[与 Azure AD 联合的多域支持](active-directory-aadconnect-multiple-domains.md)一文。\r \r **修复的问题：**\r \r - 如果未打开用于出站连接的端口 9090，Azure AD Connect 安装或升级会失败。\r \r >[!NOTE]\r >不通过 Azure AD Connect 自动升级功能向客户提供此内部版本。\r \r ## <a name=\"113700\"></a>1.1.370.0\r 发布日期：2016 年 12 月\r \r **已知问题：**\r \r - 本版本中缺少针对 AD FS 的 issuerid 声明规则。 若要将多个域与 Azure AD 联合，需使用 issuerid 声明规则。 如果使用 Azure AD Connect 管理本地 AD FS 部署，则升级到此版本将从 AD FS 配置中删除现有 issuerid 声明规则。 可在安装/升级后添加 issuerid 声明规则来解决此问题。 有关添加 issuerid 声明规则的详细信息，请参阅[与 Azure AD 联合的多域支持](active-directory-aadconnect-multiple-domains.md)一文。\r - 必须打开用于出站连接的端口 9090 才能完成安装。\r \r **新功能：**\r \r - 直通身份验证（预览版）。\r \r >[!NOTE]\r >不通过 Azure AD Connect 自动升级功能向客户提供此内部版本。\r \r ## <a name=\"113430\"></a>1.1.343.0\r 发布日期：2016 年 11 月\r \r **已知问题：**\r \r - 本版本中缺少针对 AD FS 的 issuerid 声明规则。 若要将多个域与 Azure AD 联合，需使用 issuerid 声明规则。 如果使用 Azure AD Connect 管理本地 AD FS 部署，则升级到此版本将从 AD FS 配置中删除现有 issuerid 声明规则。 可在安装/升级后添加 issuerid 声明规则来解决此问题。 有关添加 issuerid 声明规则的详细信息，请参阅[与 Azure AD 联合的多域支持](active-directory-aadconnect-multiple-domains.md)一文。\r \r **已解决的问题：**\r \r - 有时，由于无法创建密码符合组织密码策略指定的复杂性级别的本地服务帐户，安装 Azure AD Connect 失败。\r - 解决了当连接器空间中的某个对象既在一个联接规则的范围以外，同时又在另一个联接规则的范围以内时，无法重新评估联接规则的问题。 如果两个或更多个联接规则的联接条件互斥，则可能会发生此问题。\r - 解决了当（Azure AD 中）不包含联接规则的入站同步规则的优先级值低于包含联接规则的入站同步规则时，不处理前一种规则的问题。\r \r **改进：**\r \r - 添加了在 Windows Server 2016 标准版或更高版本上安装 Azure AD Connect 的支持。\r - 添加了将 SQL Server 2016 用作 Azure AD Connect 远程数据库的支持。\r \r ## <a name=\"112810\"></a>1.1.281.0\r 发布日期：2016 年 8 月\r \r **已解决的问题：**\r \r - 只有在下一个同步周期完成后，才对同步间隔进行更改。\r - Azure AD Connect 向导不接受用户名开头为下划线 (\\_) 的 Azure AD 帐户。\r - 如果帐户密码包含太多特殊字符，Azure AD Connect 向导无法对提供的 Azure AD 帐户进行身份验证。 此时会返回错误消息“无法验证凭据。 发生意外错误” 。\r - 卸载暂存服务器会在 Azure AD 租户中禁用密码同步，导致活动服务器的密码同步失败。\r - 在用户未存储密码哈希的罕见情况下，密码同步失败。\r - 当 Azure AD Connect 服务器启用暂存模式时，不会暂时禁用密码写回。\r - 当服务器处于暂存模式时，Azure AD Connect 向导不会显示实际的密码同步和密码写回配置， 而始终将这些配置显示为已禁用。\r - 当服务器处于暂存模式时，Azure AD Connect 向导不会保存密码同步和密码写回的配置更改。\r \r **改进：**\r \r - 已更新 Start-ADSyncSyncCycle cmdlet，指出是否能够成功启动新的同步周期。\r - 已添加 Stop-ADSyncSyncCycle cmdlet，终止当前正在进行的同步周期和操作。\r - 已更新 Stop-ADSyncScheduler cmdlet，终止当前正在进行的同步周期和操作。\r - 在 Azure AD Connect 向导中配置[目录扩展](active-directory-aadconnectsync-feature-directory-extensions.md)时，现在可选择“Teletex 字符串”类型的 Azure AD 属性。\r \r ## <a name=\"111890\"></a>1.1.189.0\r 发布日期：2016 年 6 月\r \r **已解决的问题和改进：**\r \r - Azure AD Connect 现在可以安装于符合 FIPS 的服务器上。\r   - 有关密码同步，请参阅[密码同步和 FIPS](active-directory-aadconnectsync-implement-password-synchronization.md#password-synchronization-and-fips)。\r - 已修复下列问题：NetBIOS 名称无法解析为 Active Directory 连接器中的 FQDN。\r \r ## <a name=\"111800\"></a>1.1.180.0\r 发布日期：2016 年 5 月\r \r **新功能：**\r \r - 警告并帮助验证域（如果在运行 Azure AD Connect 之前未执行此操作）。\r - 添加了对[德国 Microsoft 云](active-directory-aadconnect-instances.md#microsoft-cloud-germany)的支持。\r - 添加了对最新 [Azure 政府云](active-directory-aadconnect-instances.md#microsoft-azure-government-cloud)基础结构的支持，以及新的 URL 要求。\r \r **已解决的问题和改进：**\r \r - 在同步规则编辑器中添加了筛选功能以方便查找同步规则。\r - 改进了删除连接器空间时的性能。\r - 修复了在同一个运行轮次中同时删除和添加（称为删除/添加）同一个对象时出现的问题。\r - 在升级或刷新目录架构时，已禁用的同步规则不再重新启用包含的对象和属性。\r \r ## <a name=\"111300\"></a>1.1.130.0\r 发布日期：2016 年 4 月\r \r **新功能：**\r \r - 添加了对[目录扩展](active-directory-aadconnectsync-feature-directory-extensions.md)的多值属性支持。\r - 添加了对将[自动升级](active-directory-aadconnect-feature-automatic-upgrade.md)的更多配置变体视为符合升级要求的支持。\r - 为[自定义计划程序](active-directory-aadconnectsync-feature-scheduler.md#custom-scheduler)添加了一些 cmdlet。\r \r ## <a name=\"111190\"></a>1.1.119.0\r 发布日期：2016 年 3 月\r \r **已解决的问题：**\r \r - 确定 Windows Server 2008（R2 之前的版本）上无法使用快速安装，因为此操作系统不支持密码同步。\r - 使用自定义筛选器配置从 DirSync 升级无法按预期进行。\r - 升级到较新版本且没有进行任何配置更改时，不应计划完全导入/同步。\r \r ## <a name=\"111100\"></a>1.1.110.0\r 发布日期：2016 年 2 月\r \r **已解决的问题：**\r \r - 如果安装不位于默认的 C:\\Program Files 文件夹中，则无法从旧版升级。\r - 如果进行安装，并在安装向导结束时清除“启动同步过程”，再次运行安装向导将不启用计划程序。\r - 在日期/时间格式并非美国英语的服务器上，计划程序将无法正常运行。 此外，还会阻止 `Get-ADSyncScheduler` 返回正确的时间。\r - 如果以 AD FS 作为登录选项和升级来安装旧版 Azure AD Connect，便无法再次运行安装向导。\r \r ## <a name=\"111050\"></a>1.1.105.0\r 发布日期：2016 年 2 月\r \r **新功能：**\r \r - 适用于快速设置客户的[自动升级](active-directory-aadconnect-feature-automatic-upgrade.md)功能。\r - 使用安装向导中的 Azure 多重身份验证和 Privileged Identity Management 来提供全局管理员支持。\r   * 如果使用多重身份验证，则代理也需要允许发往 https://secure.aadcdn.microsoftonline-p.com 的流量。\r   * 需将 https://secure.aadcdn.microsoftonline-p.com 添加到受信任的站点列表，这样多重身份验证才能正常工作。\r - 允许在初始安装之后更改用户的登录方法。\r - 允许在安装向导中使用[域和 OU 筛选](active-directory-aadconnect-get-started-custom.md#domain-and-ou-filtering)。 这也允许连接到并非所有域都可供使用的林。\r - [计划程序](active-directory-aadconnectsync-feature-scheduler.md)是同步引擎的内置功能。\r \r **从预览版升级到 GA 的功能：**\r \r - 设备写回 \r - [目录扩展](active-directory-aadconnectsync-feature-directory-extensions.md)\r \r **新的预览功能：**\r \r - 新的默认同步周期间隔为 30 分钟。 过去所有旧版本都是 3 小时。 添加了对更改[计划程序](active-directory-aadconnectsync-feature-scheduler.md)行为的支持。\r \r **已解决的问题：**\r \r - 验证 DNS 域页面不一定都能识别域。\r - 配置 AD FS 时出现域管理员凭据提示。\r - 当本地 AD 帐户所在域的 DNS 树与根域不同时，安装向导无法识别这些帐户。\r \r ## <a name=\"1091310\"></a>1.0.9131.0\r 发布日期：2015 年 12 月\r \r **已解决的问题：**\r \r - 更改 Active Directory 域服务 (AD DS) 中的密码时，密码同步可能不会正常工作，但设置密码时可以正常工作。\r - 如果设置了代理服务器，在安装期间或者在配置页上取消升级时，向 Azure AD 进行身份验证可能会失败。\r - 如果不是 SQL Server 系统管理员 (SA)，从装有完整 SQL Server 实例的旧版 Azure AD Connect 更新会失败。\r - 从装有远程 SQL Server 的旧版 Azure AD Connect 更新时，会显示错误消息“无法访问 ADSync SQL 数据库”。\r \r ## <a name=\"1091250\"></a>1.0.9125.0\r 发布日期：2015 年 11 月\r \r **新功能：**\r \r - 可将 AD FS 重新配置为 Azure AD 信任。\r - 可以刷新 Active Directory 架构和重新生成同步规则。\r - 可以禁用同步规则。\r - 可将“AuthoritativeNull”定义为同步规则中的新文本。\r \r **新的预览功能：**\r \r - 用于同步的 Azure AD Connect Health。\r - 支持 [Azure AD 域服务](../active-directory-passwords-update-your-own-password.md)密码同步。\r \r **新的受支持方案：**\r \r - 支持多个本地 Exchange 组织。 有关详细信息，请参阅 [包含多个 Active Directory 林的混合部署](https://technet.microsoft.com/library/jj873754.aspx)。\r \r **已解决的问题：**\r \r - 密码同步问题：\r   - 从范围外移到范围内的对象不会同步其密码。 这包括 OU 和属性筛选。\r   - 选择要包含在同步中的新 OU 时不需要完全密码同步。\r   - 启用已禁用的用户时密码不会同步。\r   - 密码重试队列是无限的，以前实施的 5,000 个对象限制已停用且已被删除。\r - 无法连接到具有 Windows Server 2016 林功能级别的 Active Directory。\r - 初始安装后，无法更改用于组筛选的组。\r - 对于在启用密码写回的情况下执行密码更改的每个用户，不再能够在 Azure AD Connect 服务器上创建新的用户配置文件。\r - 无法在同步规则范围内使用长整数值。\r - 如果有无法访问的域控制器，“设备写回”复选框将保持禁用状态。\r \r ## <a name=\"1086670\"></a>1.0.8667.0\r 发布日期：2015 年 8 月\r \r **新功能：**\r \r - Azure AD Connect 安装向导现已本地化为所有 Windows Server 语言。\r - 添加了对在使用 Azure AD 密码管理时的帐户解锁支持。\r \r **已解决的问题：**\r \r - 如果另一位用户而不是第一位启动安装的人继续安装，则 Azure AD Connect 安装向导会崩溃。\r - 如果 Azure AD Connect 的先前卸载操作无法将 Azure AD Connect Sync 完全卸载，则无法重新安装。\r - 如果用户不在林的根域中或使用了非英文版 Active Directory，则无法使用快速安装选项安装 Azure AD Connect。\r - 如果无法解析 Active Directory 用户帐户的 FQDN，则会显示“无法提交架构”的误导性错误消息。\r - 如果 Active Directory 连接器上使用的帐户已在向导外部更改，向导在进行后续操作时会失败。\r - Azure AD Connect 有时无法在域控制器上安装。\r - 如果添加了扩展属性，则无法启用和禁用“暂存模式”。\r - 由于 Active Directory 连接器上的密码不正确，某些配置中的密码写回失败。\r - 如果属性筛选中使用可分辨名称 (DN)，则无法升级 DirSync。\r - 使用密码重置时 CPU 使用率过高。\r \r **已删除的预览功能：**\r \r - 根据预览版客户的反馈，已暂时删除[用户写回](active-directory-aadconnect-feature-preview.md#user-writeback)预览版功能。 今后在评审所提供的反馈意见后，我们会再次添加此功能。\r \r ## <a name=\"1086410\"></a>1.0.8641.0\r 发布日期：2015 年 6 月\r \r **Azure AD Connect 的初始版本。**\r \r 名称从 Azure AD Sync 更改为 Azure AD Connect。\r \r **新功能：**\r \r - [快速设置](active-directory-aadconnect-get-started-express.md)安装\r - 可以[配置 AD FS](active-directory-aadconnect-get-started-custom.md#configuring-federation-with-ad-fs)\r - 可[从 DirSync 升级](active-directory-aadconnect-dirsync-upgrade-get-started.md)\r - [防止意外删除](active-directory-aadconnectsync-feature-prevent-accidental-deletes.md)\r - 引入了[暂存模式](active-directory-aadconnectsync-operations.md#staging-mode)\r \r **新的预览功能：**\r \r - [用户写回](active-directory-aadconnect-feature-preview.md#user-writeback)\r - [组写回](active-directory-aadconnect-feature-preview.md#group-writeback)\r - 设备写回\r - [目录扩展](active-directory-aadconnect-feature-preview.md)\r \r ## <a name=\"104940501\"></a>1.0.494.0501\r 发布日期：2015 年 5 月\r \r **新要求：**\r \r - Azure AD Sync 现在要求安装 .NET framework 版本 4.5.1。\r \r **已解决的问题：**\r \r - 从 Azure AD 进行密码写回失败并出现 Azure 服务总线连接错误。\r \r ## <a name=\"104910413\"></a>1.0.491.0413\r 发布日期：2015 年 4 月\r \r **已解决的问题和改进：**\r \r - 如果已启用回收站且林中存在多个域，Active Directory 连接器不会正确处理删除。\r - 对 Azure Active Directory 连接器的导入操作性能有所改进。\r - 当某个组超过成员资格限制（默认情况下，此限制设置为 50,000 个对象）时，便会在 Azure Active Directory 中删除该组。 新行为是不删除该组、引发错误且不导出新的成员身份更改。\r - 如果连接器空间中已经存在 DN 相同的暂存删除，则无法设置新对象。\r - 某些对象需在增量同步期间同步，即使对象上未暂存更改。\r - 强制密码同步还会删除首选的 DC 列表。\r - CSExportAnalyzer 的某些对象状态存在问题。\r \r **新功能：**\r \r - 联接现在可以连接到 MV 中的“任何”对象类型。\r \r ## <a name=\"104850222\"></a>1.0.485.0222\r 发布日期：2015 年 2 月\r \r **改进：**\r \r - 改进了导入性能。\r \r **已解决的问题：**\r \r - 密码同步具有属性筛选所用的 cloudFiltered 属性。 已筛选的对象不再在密码同步范围中。\r - 在拓扑中有大量域控制器的极少数情况下，密码同步不起作用。\r - 在 Azure AD/Intune 中启用设备管理后，在从 Azure AD 连接器导入时，“服务器停止”。\r - 从同一林中的多个域联接外部安全主体 (FSP) 会导致模糊联接错误。\r \r ## <a name=\"104751202\"></a>1.0.475.1202\r 发布日期：2014 年 12 月\r \r **新功能：**\r \r - 现在支持使用基于属性的筛选执行密码同步。 有关详细信息，请参阅[使用筛选进行密码同步](active-directory-aadconnectsync-configure-filtering.md)。\r - msDS-ExternalDirectoryObjectID 属性将写回 Active Directory。 此功能添加了对 Office 365 应用程序的支持。 它使用 OAuth2 访问混合 Exchange 部署中的联机邮箱和本地邮箱。\r \r **修复了升级问题：**\r \r - 服务器上提供了登录助手的更新版本。\r - 自定义安装路径用于安装 Azure AD Sync。\r - 无效的自定义加入条件阻止了升级。\r \r **其他修复：**\r \r - 修复了 Office Pro Plus 的模板。\r - 修复了以短划线开头的用户名导致的安装问题。\r - 修复了第二次运行安装向导时丢失 sourceAnchor 设置的问题。\r - 修复了用于密码同步的 ETW 跟踪。\r \r ## <a name=\"104701023\"></a>1.0.470.1023\r 发布日期：2014 年 10 月\r \r **新功能：**\r \r - 从多个本地 Active Directory 到 Azure AD 的密码同步。\r - 已将安装 UI 本地化为所有的 Windows Server 语言。\r \r **从 AADSync 1.0 正式版升级**\r \r 如果已安装 Azure AD Sync，则还必须执行另外一个步骤（考虑到可能已更改现成的同步规则）。 在升级到 1.0.470.1023 版之后，已修改的同步规则被复制。 对于每个已修改的同步规则，请执行以下操作：\r \r 1.  找到已修改的同步规则，并记下所做的更改。\r - 删除同步规则。\r - 找到由 Azure AD Sync 创建的新同步规则，并重新应用所做的更改。\r \r **Active Directory 帐户的权限**\r \r 必须为 Active Directory 帐户授予其他权限，才能从 Active Directory 读取密码哈希。 要授予的权限称为“复制目录更改”和“复制目录更改所有项”。 需要这两个权限才能读取密码哈希。\r \r ## <a name=\"104190911\"></a>1.0.419.0911\r 发布日期：2014 年 9 月\r \r **Azure AD Sync 的初始版本。**\r \r ## <a name=\"next-steps\"></a>后续步骤\r 了解有关[将本地标识与 Azure Active Directory 集成](active-directory-aadconnect.md)的详细信息。\r \r <!-- Update_Description: wording update -->\r "}