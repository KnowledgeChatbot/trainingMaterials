{"Title":"如何禁用 Azure 虚拟机的日期时间同步","Description":"如何禁用 Azure 虚拟机的日期时间同步","Content":"\r # 如何禁用 Azure 虚拟机的日期时间同步\r \r ## 问题描述\r \r 由于 Azure 虚拟机的特殊性，物理主机会实时同步虚拟机的时间和日期。当有特殊需求时，客户想要停止日期时间的同步，但是一些常见的关闭 NTP 服务等操作都会失败。\r \r ## 解决方案\r \r > [!IMPORTANT]\r > 强烈不建议禁用 Azure 虚拟机的日期时间同步以避免不可预测的潜在风险。\r 如果有特殊需求的客户，请参照如下步骤来实现。\r \r ### Windows 虚拟机\r \r 1. 点击 “**开始**” -> “**运行**” -> “**services.msc**”\r 2. 在打开的 Windows 服务管理列表中，找到服务 “**Hyper-V Time Synchronization Service**”。\r 3. 选择该服务，右键选择“**关闭**”。\r 4. 之后，物理主机与虚拟机的日期时间同步就会停止。\r 5. 重新启动该服务，就会恢复日期时间的同步。\r \r ![services](./media/aog-virtual-machines-howto-disable-time-sync/services.png)\r \r ### Linux 虚拟机\r \r 1. 执行下列命令，获取 lsvmbus 工具：\r     ```\r     # wget https://raw.githubusercontent.com/torvalds/linux/master/tools/hv/lsvmbus\r     # chmod u+x lsvmbus\r     ```\r 2.\t执行命令，获取同步日期时间的驱动设备：\r \r     ```\r     # python lsvmbus -vvv  |grep -A 4 -i \"Time Synchronization\"\r     VMBUS ID 11: Class_ID = {9527e630-d0ae-497b-adce-e80ab0175caf} - [Time Synchronization]\r             Device_ID = {2dd1ce17-079e-403c-b352-a1921ee207ee}\r             Sysfs path: /sys/bus/vmbus/devices/vmbus_11\r             Rel_ID=11, target_cpu=0\r     ```\r \r 3.\t记录上述高亮显示的设备 ID。\r 4.\t执行命令：\r \r     ```\r     # echo 2dd1ce17-079e-403c-b352-a1921ee207ee > /sys/bus/vmbus/drivers/hv_util/unbind\r     ```\r \r 5.\t至此，日期时间同步已被禁用，可以通过 date 等命令来自行调整。\r 6.\t重启虚拟机，即可恢复日期时间同步，如果需要永久禁用，可以在 rc.local 文件中，手工编辑启动脚本来实现。"}