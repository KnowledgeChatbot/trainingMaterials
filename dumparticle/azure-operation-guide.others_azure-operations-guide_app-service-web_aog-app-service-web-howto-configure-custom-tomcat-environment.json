{"Title":"如何为 Web 应用配置自定义 Tomcat 环境","Description":"如何为 Web 应用配置自定义 Tomcat 环境","Content":"\r # 如何为 Web 应用配置自定义 Tomcat 环境\r \r 1. 在门户上选择打开 Java 环境，选择 JDK 版本和 Tomcat 版本。\r \r     ![01](media/aog-app-service-web-howto-configure-custom-tomcat-environment/01.png)\r \r 2. 从官网下载要使用的 tomcat 版本，解压到本地目录。\r \r 3. 修改 `conf/server.xml` 配置文件：\r \r     > [Tip]\r     > 可以在此文件中自定义自己的配置\r \r     1. 将 `port` 改成 `-1`：                   \r \r         ![02](media/aog-app-service-web-howto-configure-custom-tomcat-environment/02.png)\r \r     2. 将 `Http-connect port` 改成 `${port.http}`：\r \r         ![03](media/aog-app-service-web-howto-configure-custom-tomcat-environment/03.png)\r \r     3. 注释 AJP 和 HTTPS 连接\r \r         ![04](media/aog-app-service-web-howto-configure-custom-tomcat-environment/04.png)\r \r     4. 将 `host` 改变为 `127.0.0.1`，并将 appBase 定位到 wwwroot 下的 webapps 目录：\r \r         若 appbase 定位的是 `../../webapps`，那项目文件应该放在 `site-->wwwroot-->webapps-->ROOT` 目录下。</br>\r         若 appbase 定位的是 `webapps`，那项目文件应该放在 `/site/wwwroot/bin/apache-tomcat-<version>/webapps/ROOT`。\r \r         ![05](media/aog-app-service-web-howto-configure-custom-tomcat-environment/05.png)\r \r 4. 修改 `conf/catalina.properties` 文件，末尾加入 `java.net.preferIPv4Stack=true`。\r \r 5. 上传 `Tomcat/java` 目录到 `site/wwwroot/bin`：\r \r     ![06](media/aog-app-service-web-howto-configure-custom-tomcat-environment/06.png)\r \r 6. 在 `site/wwwroot` 目录下上传 web.config 内容如下：\r \r     ```XML\r     <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r     <configuration>\r       <system.webServer>\r         <handlers>\r           <add name=\"httpPlatformHandler\" path=\"*\" verb=\"*\" modules=\"httpPlatformHandler\" resourceType=\"Unspecified\" />\r         </handlers>\r         <httpPlatform processPath=\"%HOME%\\site\\wwwroot\\bin\\tomcat\\bin\\startup.bat\"  arguments=\"\">\r           <environmentVariables>\r             <environmentVariable name=\"CATALINA_OPTS\" value=\"-Dport.http=%HTTP_PLATFORM_PORT%\" />\r             <environmentVariable name=\"CATALINA_HOME\" value=\"%HOME%\\site\\wwwroot\\bin\\tomcat\" />\r             <environmentVariable name=\"JRE_HOME\" value=\"D:\\home\\site\\wwwroot\\bin\\java\\jdk1.6.0_45\\jre6\" />   <!-- 这个是指定 jre 的路径-->\r             <environmentVariable name=\"JAVA_OPTS\" value=\"-Djava.net.preferIPv4Stack=true\" />\r           </environmentVariables>\r         </httpPlatform>\r       </system.webServer>\r     </configuration>\r     ```\r \r 7. 重启网站进行检查配置是否生效。"}