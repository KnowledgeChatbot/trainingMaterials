{"Title":"Azure CLI 脚本示例 - 创建批处理帐户","Description":"Azure CLI 脚本示例 - 创建批处理帐户","Content":"# <a name=\"create-a-batch-account-with-the-azure-cli\"></a>使用 Azure CLI 创建批处理帐户\r \r 此脚本创建 Azure Batch 帐户，并演示如何查询和更新该帐户的各个属性。\r \r ## <a name=\"prerequisites\"></a>先决条件\r \r 按照 [Azure CLI 安装指南](/cli/install-azure-cli)中提供的说明安装 Azure CLI（如果尚未这样做）。\r \r ## <a name=\"batch-account-sample-script\"></a>批处理帐户示例脚本\r \r 创建批处理帐户时，默认情况下，其计算节点由批处理服务在内部分配。 分配的计算节点受到单独的核心配额的限制。可以通过共享密钥凭据或 Azure Active Dirctory 令牌对帐户进行身份验证。\r \r ```azurecli\r #!/bin/bash\r \r # Authenticate CLI session.\r az login\r \r # Create a resource group.\r az group create --name myresourcegroup --location westeurope\r \r # Create a Batch account.\r az batch account create -g myresourcegroup -n mybatchaccount -l westeurope\r \r # Now we can display the details of our created account.\r az batch account show -g myresourcegroup -n mybatchaccount\r \r # Let's add a storage account reference to the Batch account for use as 'auto-storage'\r # for applications. We'll start by creating the storage account.\r az storage account create -g myresourcegroup -n mystorageaccount -l westeurope --sku Standard_LRS\r \r # And then update the Batch account with the either the name (if they exist in\r # the same resource group) or the full resource ID of the storage account.\r az batch account set -g myresourcegroup -n mybatchaccount --storage-account mystorageaccount\r \r # We can view the access keys to the Batch Account for future client authentication.\r az batch account keys list -g myresourcegroup -n mybatchaccount\r \r # Or we can authenticate against the account directly for further CLI interaction.\r az batch account login -g myresourcegroup -n mybatchaccount --shared-key-auth\r ```\r \r ## <a name=\"batch-account-using-user-subscription-sample-script\"></a>使用用户订阅创建批处理帐户的示例脚本\r \r 也可以选择让批处理在你自己的 Azure 订阅中创建其计算节点。\r 用于将计算节点分配到订阅的帐户必须通过 Azure Active Directory 令牌进行身份验证，分配的计算节点数将计入订阅配额。 若要在此模式下创建帐户，必须在创建帐户时指定 Key Vault 引用。\r \r ```azurecli\r #!/bin/bash\r \r # Authenticate CLI session.\r az login\r \r # Allow Azure Batch to access the subscription (one-time operation).\r az role assignment create --assignee MicrosoftAzureBatch --role contributor\r \r # Create a resource group.\r az group create --name myresourcegroup --location westeurope\r \r # A Batch account that will allocate pools in the user's subscription must be configured\r # with a Key Vault located in the same region. Let's create this first.\r az keyvault create \\\r     --resource-group myresourcegroup \\\r     --name mykevault \\\r     --location westeurope \\\r     --enabled-for-deployment true \\\r     --enabled-for-disk-encryption true \\\r     --enabled-for-template-deployment true\r \r # We will add an access-policy to the Key Vault to allow access by the Batch Service.\r az keyvault set-policy \\\r     --resource-group myresourcegroup \\\r     --name mykevault \\\r     --spn ddbf3205-c6bd-46ae-8127-60eb93363864 \\\r     --key-permissions all \\\r     --secret-permissions all\r \r # Now we can create the Batch account, referencing the Key Vault either by name (if they\r # exist in the same resource group) or by its full resource ID.\r az batch account create \\\r     --resource-group myresourcegroup \\\r     --name mybatchaccount \\\r     --location westeurope \\\r     --keyvault mykevault\r \r # We can now authenticate directly against the account for further CLI interaction.\r # Note that Batch accounts that allocate pools in the user's subscription must be\r # authenticated via an Azure Active Directory token.\r az batch account login -g myresourcegroup -n mybatchaccount\r ```\r \r ## <a name=\"clean-up-deployment\"></a>清理部署\r \r 运行上述任一示例脚本后，请运行以下命令以删除资源组和所有相关的资源（包括批处理帐户、Azure 存储帐户和 Azure Key Vault）。\r \r ```azurecli\r az group delete --name myResourceGroup\r ```\r \r ## <a name=\"script-explanation\"></a>脚本说明\r \r 此脚本使用以下命令创建资源组、批处理帐户和所有相关资源。 表中的每条命令链接到特定于命令的文档。\r \r | 命令 | 说明 |\r |---|---|\r | [az group create](/cli/group#create) | 创建用于存储所有资源的资源组。 |\r | [az batch account create](/cli/batch/account#create) | 创建批处理帐户。  |\r | [az batch account set](/cli/batch/account#set) | 更新批处理帐户的属性。  |\r | [az batch account show](/cli/batch/account#show) | 检索指定批处理帐户的详细信息。  |\r | [az batch account keys list](/cli/batch/account/keys#list) | 检索指定批处理帐户的访问密钥。  |\r | [az batch account login](/cli/batch/account#login) | 针对指定的批处理帐户进行身份验证，以便进一步进行 CLI 交互。  |\r | [az storage account create](/cli/storage/account#create) | 创建存储帐户。 |\r | [az keyvault create](/cli/keyvault#create) | 创建密钥保管库。 |\r | [az keyvault set-policy](/cli/keyvault#set-policy) | 更新指定 Key Vault 的安全策略。 |\r | [az group delete](/cli/group#delete) | 删除资源组，包括所有嵌套的资源。 |\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 有关 Azure CLI 的详细信息，请参阅 [Azure CLI 文档](/cli/overview)。\r \r 可以在 [Azure Batch CLI 文档](../batch-cli-samples.md)中找到其他批处理 CLI 脚本示例。\r \r "}