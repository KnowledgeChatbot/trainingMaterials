{"Title":"Azure 诊断 1.0 配置架构","Description":"只有在用户将 Azure SDK 2.4 及更低版本 与 Azure 虚拟机、虚拟机规模集、Service Fabric 或云服务配合使用时，才相关。","Content":"# <a name=\"azure-diagnostics-10-configuration-schema\"></a>Azure 诊断 1.0 配置架构\r > [!NOTE]\r > Azure 诊断是一个组件，用于从 Azure 虚拟机、虚拟机规模集、Service Fabric 和云服务收集性能计数器和其他统计信息。  在使用以下某个服务时，才需要参阅此页。\r >\r \r Azure 诊断可以与其他 Microsoft 诊断产品（例如 Azure Monitor）结合使用。\r \r Azure 诊断配置文件定义用于初始化诊断监视器的值。 此文件用于在诊断监视器启动时初始化诊断配置设置。  \r \r  默认情况下，Azure 诊断配置架构文件将安装到 `C:\\Program Files\\Microsoft SDKs\\Azure\\.NET SDK\\<version>\\schemas` 目录。 将 `<version>` 替换为 [Azure SDK](http://www.windowsazure.com/develop/downloads/) 的已安装版本。  \r \r > [!NOTE]\r >  诊断配置文件通常用于启动任务，此类任务需要在启动进程之前收集诊断数据。 有关使用 Azure 诊断的详细信息，请参阅[使用 Azure 诊断收集日志记录数据](assetId:///83a91c23-5ca2-4fc9-8df3-62036c37a3d7)。  \r \r ## <a name=\"example-of-the-diagnostics-configuration-file\"></a>诊断配置文件示例  \r  以下示例演示典型的诊断配置文件：  \r \r ```xml  \r <?xml version=\"1.0\" encoding=\"utf-8\"?>\r <DiagnosticMonitorConfiguration xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"  \r       configurationChangePollInterval=\"PT1M\"  \r       overallQuotaInMB=\"4096\">  \r    <DiagnosticInfrastructureLogs bufferQuotaInMB=\"1024\"  \r       scheduledTransferLogLevelFilter=\"Verbose\"  \r       scheduledTransferPeriod=\"PT1M\" />  \r    <Logs bufferQuotaInMB=\"1024\"  \r       scheduledTransferLogLevelFilter=\"Verbose\"  \r       scheduledTransferPeriod=\"PT1M\" />  \r \r    <Directories bufferQuotaInMB=\"1024\"   \r       scheduledTransferPeriod=\"PT1M\">  \r \r       <!-- These three elements specify the special directories   \r            that are set up for the log types -->  \r       <CrashDumps container=\"wad-crash-dumps\" directoryQuotaInMB=\"256\" />  \r       <FailedRequestLogs container=\"wad-frq\" directoryQuotaInMB=\"256\" />  \r       <IISLogs container=\"wad-iis\" directoryQuotaInMB=\"256\" />  \r \r       <!-- For regular directories the DataSources element is used -->  \r       <DataSources>  \r          <DirectoryConfiguration container=\"wad-panther\" directoryQuotaInMB=\"128\">  \r             <!-- Absolute specifies an absolute path with optional environment expansion -->  \r             <Absolute expandEnvironment=\"true\" path=\"%SystemRoot%\\system32\\sysprep\\Panther\" />  \r          </DirectoryConfiguration>  \r          <DirectoryConfiguration container=\"wad-custom\" directoryQuotaInMB=\"128\">  \r             <!-- LocalResource specifies a path relative to a local   \r                  resource defined in the service definition -->  \r             <LocalResource name=\"MyLoggingLocalResource\" relativePath=\"logs\" />  \r          </DirectoryConfiguration>  \r       </DataSources>  \r    </Directories>  \r \r    <PerformanceCounters bufferQuotaInMB=\"512\" scheduledTransferPeriod=\"PT1M\">  \r       <!-- The counter specifier is in the same format as the imperative   \r            diagnostics configuration API -->  \r       <PerformanceCounterConfiguration   \r          counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT5S\" />  \r    </PerformanceCounters>  \r \r    <WindowsEventLog bufferQuotaInMB=\"512\"  \r       scheduledTransferLogLevelFilter=\"Verbose\"  \r       scheduledTransferPeriod=\"PT1M\">  \r       <!-- The event log name is in the same format as the imperative   \r            diagnostics configuration API -->  \r       <DataSource name=\"System!*\" />  \r    </WindowsEventLog>  \r </DiagnosticMonitorConfiguration>  \r ```  \r \r ## <a name=\"diagnosticsconfiguration-namespace\"></a>DiagnosticsConfiguration 命名空间  \r  诊断配置文件的 XML 命名空间是：  \r \r ```  \r http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration  \r ```  \r \r ## <a name=\"schema-elements\"></a>架构元素  \r  诊断配置文件包括以下元素。\r \r \r ## <a name=\"diagnosticmonitorconfiguration-element\"></a>DiagnosticMonitorConfiguration 元素  \r 诊断配置文件的顶级元素。  \r \r 属性：\r \r |属性  |类型   |必选| 默认 | 说明|  \r |-----------|-------|--------|---------|------------|  \r |**configurationChangePollInterval**|duration|可选 | PT1M| 指定诊断监视器轮询诊断配置更改的时间间隔。|  \r |**overallQuotaInMB**|unsignedInt|可选| 4000 MB。 提供的值不得超过此值 |为所有日志记录缓冲区分配的文件系统存储的总量。|  \r \r ## <a name=\"diagnosticinfrastructurelogs-element\"></a>DiagnosticInfrastructureLogs 元素  \r 定义由基础诊断基础结构生成的日志的缓冲区配置。\r \r 父元素：[DiagnosticMonitorConfiguration 元素](#DiagnosticMonitorConfiguration)。  \r \r 属性：\r \r |属性|类型|说明|  \r |---------|----|-----------------|  \r |**bufferQuotaInMB**|unsignedInt|可选。 指定可用于存储指定数据的文件系统存储最大容量。<br /><br /> 默认值为 0。|  \r |**scheduledTransferLogLevelFilter**|字符串|可选。 指定传输的日志条目的最低严重级别。 默认值为“未定义”。 其他可能的值为“详细”、“信息”、“警告”、“错误”和“严重”。|  \r |**scheduledTransferPeriod**|duration|可选。 指定计划的数据传输之间的时间间隔，向上舍入为最接近的分钟数。<br /><br /> 默认是 PT0S。|  \r \r ## <a name=\"logs-element\"></a>Logs 元素  \r  定义基本 Azure 日志的缓冲区配置。\r \r  父元素：[DiagnosticMonitorConfiguration 元素](#DiagnosticMonitorConfiguration)。  \r \r 属性：  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**bufferQuotaInMB**|unsignedInt|可选。 指定可用于存储指定数据的文件系统存储最大容量。<br /><br /> 默认值为 0。|  \r |**scheduledTransferLogLevelFilter**|字符串|可选。 指定传输的日志条目的最低严重级别。 默认值为“未定义”。 其他可能的值为“详细”、“信息”、“警告”、“错误”和“严重”。|  \r |**scheduledTransferPeriod**|duration|可选。 指定计划的数据传输之间的时间间隔，向上舍入为最接近的分钟数。<br /><br /> 默认是 PT0S。|  \r \r ## <a name=\"directories-element\"></a>Directories 元素  \r 为可以定义的基于文件的日志定义缓冲区配置。\r \r 父元素：[DiagnosticMonitorConfiguration 元素](#DiagnosticMonitorConfiguration)。  \r \r \r 属性：  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**bufferQuotaInMB**|unsignedInt|可选。 指定可用于存储指定数据的文件系统存储最大容量。<br /><br /> 默认值为 0。|  \r |**scheduledTransferPeriod**|duration|可选。 指定计划的数据传输之间的时间间隔，向上舍入为最接近的分钟数。<br /><br /> 默认是 PT0S。|  \r \r ## <a name=\"crashdumps-element\"></a>CrashDumps 元素  \r  定义故障转储目录。\r \r  父元素：[Directories 元素](#Directories)。  \r \r 属性：  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**容器**|字符串|容器的名称，将要传输容器中的目录内容。|  \r |**directoryQuotaInMB**|unsignedInt|可选。 指定目录的大小上限（以兆字节为单位）。<br /><br /> 默认值为 0。|  \r \r ## <a name=\"failedrequestlogs-element\"></a>FailedRequestLogs 元素  \r  定义失败的请求日志目录。\r \r  父元素：[Directories 元素](#Directories)。  \r \r 属性：  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**容器**|字符串|容器的名称，将要传输容器中的目录内容。|  \r |**directoryQuotaInMB**|unsignedInt|可选。 指定目录的大小上限（以兆字节为单位）。<br /><br /> 默认值为 0。|  \r \r ##  <a name=\"iislogs-element\"></a>IISLogs 元素  \r  定义 IIS 日志目录。\r \r  父元素：[Directories 元素](#Directories)。  \r \r 属性：  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**容器**|字符串|容器的名称，将要传输容器中的目录内容。|  \r |**directoryQuotaInMB**|unsignedInt|可选。 指定目录的大小上限（以兆字节为单位）。<br /><br /> 默认值为 0。|  \r \r ## <a name=\"datasources-element\"></a>DataSources 元素  \r  定义零个或多个其他日志目录。\r \r  父元素：[Directories 元素](#Directories)。\r \r ## <a name=\"directoryconfiguration-element\"></a>DirectoryConfiguration 元素  \r  定义要监视的日志文件的目录。\r \r  父元素：[DataSources 元素](#DataSources)。\r \r 属性：\r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**容器**|字符串|容器的名称，将要传输容器中的目录内容。|  \r |**directoryQuotaInMB**|unsignedInt|可选。 指定目录的大小上限（以兆字节为单位）。<br /><br /> 默认值为 0。|  \r \r ## <a name=\"absolute-element\"></a>Absolute 元素  \r  定义要使用可选环境扩展监视的目录的绝对路径。\r \r  父元素：[DirectoryConfiguration 元素](#DirectoryConfiguration)。  \r \r 属性：  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**路径**|字符串|必需。 要监视的目录的绝对路径。|  \r |**expandEnvironment**|布尔值|必需。 如果设置为 **true**，则扩展路径中的环境变量。|  \r \r ## <a name=\"localresource-element\"></a>LocalResource 元素  \r  定义服务定义中定义的本地资源的相对路径。\r \r  父元素：[DirectoryConfiguration 元素](#DirectoryConfiguration)。  \r \r 属性：  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**name**|字符串|必需。 包含要监视的目录的本地资源的名称。|  \r |**relativePath**|字符串|必需。 相对于要监视的本地资源的路径。|  \r \r ## <a name=\"performancecounters-element\"></a>PerformanceCounters 元素  \r  定义要收集的性能计数器的路径。\r \r  父元素：[DiagnosticMonitorConfiguration 元素](#DiagnosticMonitorConfiguration)。\r \r \r  属性：  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**bufferQuotaInMB**|unsignedInt|可选。 指定可用于存储指定数据的文件系统存储最大容量。<br /><br /> 默认值为 0。|  \r |**scheduledTransferPeriod**|duration|可选。 指定计划的数据传输之间的时间间隔，向上舍入为最接近的分钟数。<br /><br /> 默认是 PT0S。|  \r \r ## <a name=\"performancecounterconfiguration-element\"></a>PerformanceCounterConfiguration 元素  \r  定义要收集的性能计数器。\r \r  父元素：[PerformanceCounters 元素](#PerformanceCounters)。  \r \r  属性：  \r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**counterSpecifier**|字符串|必需。 要收集的性能计数器的路径。|  \r |**sampleRate**|duration|必需。 应收集性能计数器的速率。|  \r \r ## <a name=\"windowseventlog-element\"></a>WindowsEventLog 元素  \r  定义要监视的事件日志。\r \r  父元素：[DiagnosticMonitorConfiguration 元素](#DiagnosticMonitorConfiguration)。\r \r   属性：\r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**bufferQuotaInMB**|unsignedInt|可选。 指定可用于存储指定数据的文件系统存储最大容量。<br /><br /> 默认值为 0。|  \r |**scheduledTransferLogLevelFilter**|字符串|可选。 指定传输的日志条目的最低严重级别。 默认值为“未定义”。 其他可能的值为“详细”、“信息”、“警告”、“错误”和“严重”。|  \r |**scheduledTransferPeriod**|duration|可选。 指定计划的数据传输之间的时间间隔，向上舍入为最接近的分钟数。<br /><br /> 默认是 PT0S。|  \r \r ## <a name=\"datasource-element\"></a>DataSource 元素  \r  定义要监视的事件日志。\r \r  父元素：[WindowsEventLog 元素](#windowsEventLog)。  \r \r  属性：\r \r |属性|类型|说明|  \r |---------------|----------|-----------------|  \r |**name**|字符串|必需。 指定要收集的日志的 XPath 表达式。|  \r "}