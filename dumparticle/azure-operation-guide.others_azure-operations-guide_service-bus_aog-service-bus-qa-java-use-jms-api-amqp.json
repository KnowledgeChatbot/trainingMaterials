{"Title":"使用 JAVA AMQP 协议如何订阅启用分区功能的 Azure 服务总线主题的消息","Description":"借助 Java JMS API 使用 AMQP 协议订阅启用分区的 Azure 服务总线主题的消息","Content":"\r # 使用 JAVA AMQP 协议如何订阅启用分区功能的 Azure 服务总线主题的消息  \r \r ## 问题描述：  \r \r 通常借助 Java JMS API 使用 AMQP 协议订阅启用分区的 Azure 服务总线主题会报错, 而订阅未启用分区功能的  Azure 服务总线主题则可正常运行。  \r \r **报错信息为：**  \r \r ```\r JMS Exception: Cannot open a Topic client for entity type Subscriber\r ```\r \r ## 解决方法：  \r \r 使用 Azure 服务总线队列订阅的方式订阅主题消息，主题订阅者对应队列的 `entity path` 为  `[Topic Name]/Subscriptions/[Subscription Name]`。\r \r **代码如下：**  \r \r ```\r Context context = new InitialContext();\r ConnectionFactory factory = (ConnectionFactory) context.lookup(\"myFactoryLookup\");\r Connection connection = factory.createConnection(USER, PASSWORD);\r connection.setExceptionListener(new ExceptionListener());\r connection.start();\r \r TopicSession session = (TopicSession) connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\r Topic topic = session.createTopic(\"test\");\r \r // 对未启用 partition 的 topic 可以用 TopicSubscriber 订阅消息\r // TopicSubscriber subscriber = session.createDurableSubscriber(topic, \"subscription1\");\r // subscriber.setMessageListener(new MessageListener());\r \r // 对启用 partition的topic 只能用 MessageConsumer 来订阅消息\r MessageConsumer messageConsumer = session.createConsumer(session.createQueue(\"test/Subscriptions/sub1\"));\r messageConsumer.setMessageListener(new MessageListener());\r \r MessageProducer messageProducer = session.createProducer(topic);\r Message message = session.createTextMessage(\"Hello world1213!\");\r messageProducer.send(message);\r ```"}