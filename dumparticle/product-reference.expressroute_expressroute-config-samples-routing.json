{"Title":"ExpressRoute 客户路由器配置示例","Description":"本页提供 Cisco 和 Juniper 路由器的路由器配置示例。","Content":"\r # 用于设置和管理路由的路由器配置示例\r \r 本页提供适用于 Cisco IOS XE 和 Juniper MX 系列路由器的接口与路由配置示例。这些示例仅供指导，不能按原样使用。你可以与你的供应商合作，以便为你的网络指定适当的配置。\r \r >[!IMPORTANT]\r > 本页中的示例仅供指导。你必须与供应商的销售/技术团队和你的网络团队合作，以便指定符合需要的适当配置。对于本页中所列配置的相关问题，Azure 将不提供支持。有关支持问题，必须与设备供应商联系。\r \r 以下路由器配置示例适用于所有对等互连。有关路由的更多详细信息，请查看 [ExpressRoute 对等互连](./expressroute-circuit-peerings.md)和 [ExpressRoute 路由要求](./expressroute-routing.md)。\r \r ## 基于 Cisco IOS-XE 的路由器\r \r 本部分中的示例适用于任何运行 IOS-XE OS 系列的路由器。\r \r ### 1\\.配置接口和子接口\r \r 在连接到 Azure 的每个路由器中，针对每个对等互连都需要有一个子接口。子接口可使用 VLAN ID 或一对堆叠的 VLAN ID 和 IP 地址来标识。\r \r #### Dot1Q 接口定义\r \r 本示例针对包含单个 VLAN ID 的子接口提供子接口定义。在每个对等互连中，VLAN ID 是唯一的。IPv4 地址的最后一个八位字节将始终是奇数。\r \r ```\r interface GigabitEthernet<Interface_Number>.<Number>\r  encapsulation dot1Q <VLAN_ID>\r  ip address <IPv4_Address><Subnet_Mask>\r ```\r \r #### QinQ 接口定义\r \r 本示例针对包含两个 VLAN ID 的子接口提供子接口定义。外部 VLAN ID (s-tag)（如果使用）在所有对等互连中保持不变。在每个对等互连中，内部 VLAN ID (c-tag) 是唯一的。IPv4 地址的最后一个八位字节将始终是奇数。\r \r ```\r interface GigabitEthernet<Interface_Number>.<Number>\r  encapsulation dot1Q <s-tag> seconddot1Q <c-tag>\r  ip address <IPv4_Address><Subnet_Mask>\r ```\r \r ### 2\\.设置 eBGP 会话\r \r 必须针对每个对等互连设置与 Azure 的 BGP 会话。以下示例可让你设置与 Azure 的 BGP 会话。如果对子接口使用的 IPv4 地址是 a.b.c.d，则 BGP 邻居 (Azure) 的 IP 地址将是 a.b.c.d+1。BGP 邻居的 IPv4 地址的最后一个八位字节将始终是偶数。\r \r ```\r router bgp <Customer_ASN>\r  bgp log-neighbor-changes\r  neighbor <IP#2_used_by_Azure> remote-as 12076\r  !        \r  address-family ipv4\r  neighbor <IP#2_used_by_Azure> activate\r  exit-address-family\r !\r ```\r \r ### 3\\.设置要通过 BGP 会话播发的前缀\r \r 你可以配置路由器，以将所选前缀播发给 Azure。可以使用以下示例来执行此操作。\r \r ```\r router bgp <Customer_ASN>\r  bgp log-neighbor-changes\r  neighbor <IP#2_used_by_Azure> remote-as 12076\r  !        \r  address-family ipv4\r   network <Prefix_to_be_advertised> mask <Subnet_mask>\r   neighbor <IP#2_used_by_Azure> activate\r  exit-address-family\r !\r ```\r \r ### 4\\.路由映射\r \r 可以使用路由映射和前缀列表来筛选已传播到网络中的前缀。可以使用以下示例来完成此任务。确保已设置适当的前缀列表。\r \r ```\r router bgp <Customer_ASN>\r  bgp log-neighbor-changes\r  neighbor <IP#2_used_by_Azure> remote-as 12076\r  !        \r  address-family ipv4\r   network <Prefix_to_be_advertised> mask <Subnet_mask>\r   neighbor <IP#2_used_by_Azure> activate\r   neighbor <IP#2_used_by_Azure> route-map <MS_Prefixes_Inbound> in\r  exit-address-family\r !\r route-map <MS_Prefixes_Inbound> permit 10\r  match ip address prefix-list <MS_Prefixes>\r !\r ```\r \r ## Juniper MX 系列路由器 \r \r 本部分中的示例适用于所有 Juniper MX 系列路由器。\r \r ### 1\\.配置接口和子接口\r \r #### Dot1Q 接口定义\r \r 本示例针对包含单个 VLAN ID 的子接口提供子接口定义。在每个对等互连中，VLAN ID 是唯一的。IPv4 地址的最后一个八位字节将始终是奇数。\r \r ```\r interfaces {\r     vlan-tagging;\r     <Interface_Number> {\r         unit <Number> {\r             vlan-id <VLAN_ID>;\r             family inet {\r                 address <IPv4_Address/Subnet_Mask>;\r             }\r         }\r     }\r }\r ```\r \r #### QinQ 接口定义\r \r 本示例针对包含两个 VLAN ID 的子接口提供子接口定义。外部 VLAN ID (s-tag)（如果使用）在所有对等互连中保持不变。在每个对等互连中，内部 VLAN ID (c-tag) 是唯一的。IPv4 地址的最后一个八位字节将始终是奇数。\r \r ```\r interfaces {\r     <Interface_Number> {\r         flexible-vlan-tagging;\r         unit <Number> {\r             vlan-tags outer <S-tag> inner <C-tag>;\r             family inet {\r                 address <IPv4_Address/Subnet_Mask>;\r             }                           \r         }                               \r     }                                   \r }                           \r ```\r \r ### 2\\.设置 eBGP 会话\r \r 必须针对每个对等互连设置与 Azure 的 BGP 会话。以下示例可让你设置与 Azure 的 BGP 会话。如果对子接口使用的 IPv4 地址是 a.b.c.d，则 BGP 邻居 (Azure) 的 IP 地址将是 a.b.c.d+1。BGP 邻居的 IPv4 地址的最后一个八位字节将始终是偶数。\r \r ```\r routing-options {\r     autonomous-system <Customer_ASN>;\r }\r }\r protocols {\r     bgp { \r         group <Group_Name> { \r             peer-as 12076;              \r             neighbor <IP#2_used_by_Azure>;\r         }                               \r     }                                   \r }\r ```\r \r ### 3\\.设置要通过 BGP 会话播发的前缀\r \r 你可以配置路由器，以将所选前缀播发给 Azure。可以使用以下示例来执行此操作。\r \r ```\r policy-options {\r     policy-statement <Policy_Name> {\r         term 1 {\r             from protocol OSPF;\r     route-filter <Prefix_to_be_advertised/Subnet_Mask> exact;\r             then {\r                 accept;\r             }\r         }\r     }\r }\r protocols {\r     bgp { \r         group <Group_Name> { \r             export <Policy_Name>\r             peer-as 12076;              \r             neighbor <IP#2_used_by_Azure>;\r         }                               \r     }                                   \r }\r ```\r \r ### 4\\.路由映射\r \r 可以使用路由映射和前缀列表来筛选已传播到网络中的前缀。可以使用以下示例来完成此任务。确保已设置适当的前缀列表。\r \r ```\r policy-options {\r     prefix-list MS_Prefixes {\r         <IP_Prefix_1/Subnet_Mask>;\r         <IP_Prefix_2/Subnet_Mask>;\r     }\r     policy-statement <MS_Prefixes_Inbound> {\r         term 1 {\r             from {\r     prefix-list MS_Prefixes;\r             }\r             then {\r                 accept;\r             }\r         }\r     }\r }\r protocols {\r     bgp { \r         group <Group_Name> { \r             export <Policy_Name>\r             import <MS_Prefixes_Inbound>\r             peer-as 12076;              \r             neighbor <IP#2_used_by_Azure>;\r         }                               \r     }                                   \r }\r ```\r \r ## 后续步骤\r \r 有关详细信息，请参阅 [ExpressRoute 常见问题](./expressroute-faqs.md)。\r \r <!---HONumber=Mooncake_Quality_Review_0104_2017-->"}