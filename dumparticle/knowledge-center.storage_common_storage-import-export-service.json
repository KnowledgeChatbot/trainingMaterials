{"Title":"使用 Azure 导入/导出将数据传入/传出 Blob 存储","Description":"了解如何在 Azure 门户中创建导入和导出作业，以便将数据传入/传出 Blob 存储。","Content":"# <a name=\"use-the-azure-importexport-service-to-transfer-data-to-azure-storage\"></a>使用 Azure 导入/导出服务可将数据传输到 Azure 存储\r 使用 Azure 导入/导出服务，可以将硬盘驱动器寄送到 Azure 数据中心，从而安全地将大量数据传输到 Azure 存储。 还可以使用此服务将数据从 Azure 存储传输到硬盘驱动器，然后再寄送到本地站点。 如果需要在本地站点和 Azure 之间传输数 TB 的数据，而由于带宽限制或网络成本过高，通过网络上传或下载数据不可行，在这种情况下，则可以使用此服务。\r \r 服务要求对硬盘驱动器进行 BitLocker 加密以确保数据的安全性。 服务支持所有公共 Azure 区域中的经典和 Azure Resource Manager 存储帐户（标准层和冷层）。 必须将硬盘驱动器寄送到本文后面指定的某个受支持的位置。\r \r 本文将详细介绍 Azure 导入/导出服务，以及如何通过寄送驱动器将数据复制到 Azure Blob 存储以及从该存储复制数据。\r \r ## <a name=\"when-should-i-use-the-azure-importexport-service\"></a>应该在什么时候使用 Azure 导入/导出服务？\r 如果通过网络上传或下载数据速度太慢，或者获取额外的网络带宽因成本过高而受到限制，则可考虑使用 Azure 导入/导出服务。\r \r 下面这样的场景可以使用此服务：\r \r * 将数据迁移到云：将大量数据快速且经济高效地转移到 Azure。\r * 内容分发：将数据快速发送到客户站点。\r * 备份：将本地数据备份后存储在 Azure Blob 存储中。\r * 数据恢复：恢复存储在存储中的大量数据，然后将其递送到本地位置。\r \r ## <a name=\"prerequisites\"></a>先决条件\r 本部分列出了使用此服务需要满足的先决条件。 请在寄送驱动器之前仔细查看这些先决条件。\r \r ### <a name=\"storage-account\"></a>存储帐户\r 必须拥有 Azure 订阅以及一个或多个存储帐户才能使用导入/导出服务。 每个作业只能用于将数据传入/传出一个存储帐户。 换言之，一个导入/导出作业不能跨多个存储帐户。 有关创建新存储帐户的信息，请参阅[如何创建存储帐户](storage-create-storage-account.md#create-a-storage-account)。\r \r ### <a name=\"data-types\"></a>数据类型\r 可使用 Azure 导入/导出服务将数据复制到块 Blob、页 Blob 或文件中。 与之相反，只能使用此服务从 Azure 存储中导出块 blob、页 blob 或追加 blob。 该服务不支持导出 Azure 文件，只能将文件导入 Azure 存储。\r \r ### <a name=\"job\"></a>作业\r 要开始从存储进行导入或导出的过程，首先要创建一个“作业”。 作业可以是“导入作业”或“导出作业”：\r \r * 需要将本地数据传输到 Azure 存储帐户中的 Blob 时，请创建导入作业。\r * 若要将当前在存储帐户中以 blob 形式存储的数据传输到寄送给我们的硬盘，请创建导出作业。 创建作业时，需通知导入/导出服务：要将一个或多个硬盘驱动器运送到 Azure 数据中心。\r \r * 对于导入作业，需要寄送包含数据的硬盘驱动器。\r * 对于导出作业，需要寄送空硬盘驱动器。\r * 每个作业最多可以寄送 10 个硬盘驱动器。\r \r 可以使用 Azure 门户或 [Azure 存储导入/导出 REST API](https://docs.microsoft.com/rest/api/storageimportexport) 创建导入或导出作业。\r \r ### <a name=\"waimportexport-tool\"></a>WAImportExport 工具\r 创建 **导入** 作业的第一步是准备需要通过寄送进行数据导入的驱动器。 要准备驱动器，必须将其连接到本地服务器，然后在本地服务器上运行 WAImportExport 工具。 使用此 WAImportExport 工具可以方便地将数据复制到驱动器、使用 BitLocker 加密驱动器上的数据，以及生成驱动器日志文件。\r \r 日志文件存储有关作业和驱动器的基本信息，例如驱动器序列号和存储帐户名称。 此日志文件不存储在该驱动器上。 它在导入作业创建期间使用。 本文稍后将提供有关创建作业的分步详细信息。\r \r WAImportExport 工具仅兼容 64 位 Windows 操作系统。 请参阅 [操作系统](#operating-system) 部分以了解受支持的特定 OS 版本。\r \r 下载最新版本的 [WAImportExport 工具](http://download.microsoft.com/download/3/6/B/36BFF22A-91C3-4DFC-8717-7567D37D64C5/WAImportExportV2.zip)。 有关使用 WAImportExport 工具的详细信息，请参阅[使用 WAImportExport 工具](storage-import-export-tool-how-to.md)。\r \r >[!NOTE]\r >以前的版本：可以[下载 WAImportExpot V1](http://download.microsoft.com/download/0/C/D/0CD6ABA7-024F-4202-91A0-CE2656DCE413/WaImportExportV1.zip) 版本的工具，并参考 [WAImportExpot V1 使用指南](storage-import-export-tool-how-to-v1.md)。 WAImportExpot V1 版本的工具支持在已将数据预先写入磁盘的情况下准备磁盘。 如果唯一可用的密钥是 SAS 密钥，则也需要 WAImportExpot V1 工具。\r \r ### <a name=\"hard-disk-drives\"></a>硬盘驱动器\r 只支持将 2.5 英寸 SSD 或者 2.5/3.5 英寸 SATA II 或 III 内部 HDD 用于导入/导出服务。 单个导入/导出作业最多可以有 10 个 HDD/SSD，并且每个 HDD/SSD 可以为任意大小。 大量驱动器可以分布在多个作业上，并且可创建的作业数没有限制。 \r \r 对于导入作业，只会处理驱动器上的第一个数据卷。 该数据卷必须使用 NTFS 进行格式化。\r \r > [!IMPORTANT]\r > 此服务不支持内置 USB 适配器附带的外部硬盘驱动器。 此外，不能使用外部 HDD 包装内的磁盘；请勿寄送外部 HDD。\r > \r \r 下面是用于将数据复制到内部 HDD 的外部 USB 适配器列表。 Anker 68UPSATAA-02BU Anker 68UPSHHDS-BU Startech SATADOCK22UE Orico 6628SUS3-C-BK（6628 系列）Thermaltake BlacX Hot-Swap SATA External Hard Drive Docking Station（USB 2.0 和 eSATA）\r \r ### <a name=\"encryption\"></a>加密\r 必须使用 BitLocker 驱动器加密对驱动器上的数据进行加密。 这会在运送过程中保护数据。\r \r 对于导入作业，可以通过两种方式进行加密。 第一种方式是在运行 WAImportExport 工具准备驱动器时，使用数据集 CSV 文件指定该选项。 第二种方式是在准备驱动器期间，在驱动器上手动启用 BitLocker 加密并在运行 WAImportExport 工具命令行时，在驱动集 CSV 文件中指定加密密钥。\r \r 对于导出作业，在将你的数据复制到驱动器以后，此服务会使用 BitLocker 加密驱动器，此后再将驱动器寄回给你。 加密密钥会通过 Azure 门户提供。  \r \r ### <a name=\"operating-system\"></a>操作系统\r 在将驱动器寄送到 Azure 之前，可以使用下述 64 位操作系统之一通过 WAImportExport 工具准备硬盘驱动器：\r \r Windows 7 Enterprise、Windows 7 Ultimate、Windows 8 Pro、Windows 8 Enterprise、Windows 8.1 Pro、Windows 8.1 Enterprise、Windows 10<sup>1</sup>、Windows Server 2008 R2、Windows Server 2012、Windows Server 2012 R2。 所有这些操作系统都支持 BitLocker 驱动器加密。\r \r ### <a name=\"locations\"></a>位置\r Azure 导入/导出服务支持将数据复制到中国东部或中国北部的 Azure 存储帐户，以及从后者进行复制。 可以将硬盘驱动器寄送到以下位置之一。 如果存储帐户所在的 Azure 位置未在此处指定，则使用 Azure 门户或导入/导出 REST API 创建作业时，系统会提供备用的寄送位置。\r \r 支持的寄送位置：\r - 中国东部\r - 中国北部\r \r ### <a name=\"shipping\"></a>装运\r **将驱动器寄送到数据中心：**\r \r 创建导入或导出作业时，会向你提供某个受支持位置的寄送地址，以便你寄送自己的驱动器。 提供的寄送地址将取决于存储帐户的位置，但可能不同于存储帐户位置。\r \r 可以通过 FedEx 或中国邮政等快递商将驱动器寄送到寄送地址。\r \r **从数据中心寄送驱动器：**\r \r 创建导入或导出作业时，必须提供回寄地址，以便 21Vainet 在作业完成后使用该地址寄回驱动器。 请确保提供有效的回寄地址，以免延误对驱动器的处理。\r \r 可以使用所选的承运人来寄送硬盘。 该承运人商应提供相应的跟踪号来维护监护链。 此外，还必须提供有效的中国邮政服务帐号，以便 Microsoft 寄回驱动器。 如果已经有了一个快递商帐户号码，请确保其有效。\r \r 寄送包裹时，必须遵循 [Azure 服务条款](https://www.azure.cn/support/legal/services-terms/)中的条款。\r \r > [!IMPORTANT] \r > 在寄送物理介质之前，请咨询顾问以验证介质和数据是否可以合法地寄送到所确定的数据中心。 这有助于确保它可以及时到达 Microsoft。 \r \r ## <a name=\"how-does-the-azure-importexport-service-work\"></a>Azure 导入/导出服务是如何工作的？\r 可以使用 Azure 导入/导出服务在本地站点和 Azure 存储之间传输数据，只需创建作业，然后将硬盘驱动器寄送到 Azure 数据中心即可。 寄送的每个硬盘驱动器都与单个作业相关联。 每个作业都与单个存储帐户相关联。 请仔细查看[先决条件](#pre-requisites)部分，以了解此服务的具体情况，例如支持的数据类型、磁盘类型、位置和寄送方式。\r \r 此部分深入介绍导入和导出作业所涉及的步骤。 随后，会在[“快速启动”部分](#quick-start)提供分步说明，指导创建导入和导出作业。\r \r ### <a name=\"inside-an-import-job\"></a>关于导入作业\r 概括而言，导入作业包括以下步骤：\r \r * 确定要导入的数据，以及所需驱动器数目。\r * 确定 Azure 存储中用于存储数据的目标 Blob 或文件位置。\r * 使用 WAImportExport 工具将数据复制到一个或多个硬盘驱动器，并使用 BitLocker 进行加密。\r * 使用 Azure 门户或导入/导出 REST API 在目标存储帐户中创建导入作业。 如果使用 Azure 门户，请上传驱动器日记文件。\r * 请提供回寄地址以及快递商帐户号码，以便我们将驱动器寄回给你。\r * 将硬盘驱动器寄送到在创建作业时获得的寄送地址。\r * 在导入作业详细信息中更新快递跟踪号码，并提交导入作业。\r * Azure 数据中心在收到驱动器后会对其进行处理。\r * 该中心会使用快递商帐户将驱动器寄送到在导入作业中提供的回寄地址。\r   \r     ![图 1：导入作业流](./media/storage-import-export-service/importjob.png)\r \r ### <a name=\"inside-an-export-job\"></a>关于导出作业\r > [!IMPORTANT]\r > 该服务仅支持导出 Azure Blob，不支持导出 Azure 文件。\r > \r > \r 概括而言，导出作业包括以下步骤：\r \r * 确定要导出的数据，以及所需驱动器数目。\r * 确定数据在 Blob 存储中的源 Blob 或容器路径。\r * 使用 Azure 门户或导入/导出 REST API 在源存储帐户中创建导出作业。\r * 指定数据在导出作业中的源 Blob 或容器路径。\r * 请提供回寄地址以及快递商帐户号码，以便我们将驱动器寄回给你。\r * 将硬盘驱动器寄送到在创建作业时获得的寄送地址。\r * 在导出作业详细信息中更新快递跟踪号码，并提交导出作业。\r * Azure 数据中心在收到驱动器后会对其进行处理。\r * 驱动器使用 BitLocker 加密；密钥通过 Azure 门户提供。  \r * 该中心会使用快递商帐户将驱动器寄送到在导入作业中提供的回寄地址。\r   \r     ![图 2：导出作业流](./media/storage-import-export-service/exportjob.png)\r \r ### <a name=\"viewing-your-job-and-drive-status\"></a>查看作业和驱动器状态\r 可以从 Azure 门户跟踪导入或导出作业的状态。 单击“导入/导出”选项卡。作业的列表出现在该页上。\r \r ![查看作业状态](./media/storage-import-export-service/jobstate.png)\r \r 会看到以下作业状态之一，具体取决于驱动器处于哪个处理阶段。\r \r | 作业状态 | 说明 |\r |:--- |:--- |\r | Creating | 创建一个作业后，其状态设置为 Creating。 当作业处于 Creating 状态时，导入/导出服务假设驱动器尚未寄送到数据中心。 作业可保持 Creating 状态最多两周，之后服务会自动将其删除。 |\r | 装运 | 寄出包裹后，应在 Azure 门户中更新跟踪信息。  这会将作业转为“Shipping”状态。 作业会保持 Shipping 状态最多两周。 \r | Received | 数据中心中收到所有驱动器后，作业状态会设置为 Received。 |\r | 转移 | 至少已开始处理一个驱动器后，作业状态会设置为 Transferring。 有关详细信息，请参阅下面的“驱动器状态”部分。 |\r | 打包 | 处理完所有驱动器后，作业会进入 Packaging 状态，直到将驱动器寄回给你。 |\r | 已完成 | 将所有驱动器寄回给客户后，如果完成作业时未出现错误，则会将该作业设置为 Completed 状态。 作业在保持 Completed 状态 90 天后自动删除。 |\r | 已关闭 | 将所有驱动器寄回给客户后，如果在处理作业期间出现过错误，则会将该作业设置为 Closed 状态。 作业在保持 Closed 状态 90 天后自动删除。 |\r \r 下表描述了单个驱动器在导入或导出作业中转换时的生命周期。 现在，作业中每个驱动器的当前状态都会在 Azure 门户中显示。\r 下表描述了每个驱动器在作业中可能经历的每种状态。\r \r | 驱动器状态 | 说明 |\r |:--- |:--- |\r | Specified | 对于导入作业，在 Azure 门户中创建作业时，驱动器的初始状态为 Specified。 对于导出作业，由于在创建该作业时未指定驱动器，因此驱动器的初始状态为 Received。 |\r | Received | 导入/导出服务操作员为导入作业处理从货运公司收到的驱动器后，驱动器转换为 Received 状态。 对于导出作业，初始驱动器状态为 Received。 |\r | NeverReceived | 当作业的包裹已送达但包裹不包含驱动器时，驱动器会转换为 NeverReceived 状态。 如果在服务收到发货信息后的两周内包裹未送达数据中心，驱动器也会转换为此状态。 |\r | 转移 | 服务开始将数据从驱动器传输到 Azure 存储时，驱动器会转为 Transferring 状态。 |\r | 已完成 | 服务成功传输所有数据且未出错时，驱动器会转换为 Completed 状态。\r | CompletedMoreInfo | 如果服务在从驱动器中复制数据或将数据复制到驱动器时遇到一些问题，驱动器会转为 CompletedMoreInfo 状态。 信息可以包含有关覆盖 Blob 的错误、警告或信息性消息。\r | ShippedBack | 驱动器从数据中心寄送到回邮地址后，驱动器会转换为 ShippedBack 状态。 |\r \r Azure 门户中的此映像会显示示例作业的驱动器状态：\r \r ![查看驱动器状态](./media/storage-import-export-service/drivestate.png)\r \r 下表描述了驱动器故障状态以及针对每种状态采取的措施。\r \r | 驱动器状态 | 事件 | 解决方法/后续步骤 |\r |:--- |:--- |:--- |\r | NeverReceived | 标记为 NeverReceived 的驱动器（因为在作业寄送过程中未收到）通过另一次寄送送达。 | 运营团队将驱动器状态转为 Received。 |\r | 不适用 | 不属于任何作业的驱动器会作为其他作业的一部分送至数据中心。 | 完成与原始包裹关联的作业后，驱动器会标记为额外驱动器并寄回给客户。 |\r \r ### <a name=\"time-to-process-job\"></a>处理作业的时间\r 处理导入/导出作业的时间各不相同，取决于不同的因素，例如寄送时间、作业类型、要复制的数据的类型和大小，以及所提供磁盘的大小。 导入/导出服务没有 SLA，但在收到磁盘之后，服务力求在 7 到 10 天内完成复制。 可以通过 REST API 更密切地跟踪作业进度。 在“列出作业”操作中有一个完成百分比参数，该参数指示复制进度。 如果需要估算何时才能完成时间要求紧的导入/导出作业，请联系我们。\r \r ### <a name=\"pricing\"></a>定价\r **驱动器处理费用**\r \r 在导入或导出作业的过程中，处理每个驱动器都需要支付驱动器处理费用。 请参阅有关 [Azure 导入/导出定价](https://www.azure.cn/pricing/details/storage-import-export/)的详细信息。\r \r **寄送费用**\r \r 将驱动器寄送到 Azure 时，需要向快递商支付寄送费用。 当 Microsoft 将驱动器寄回给你时，寄送费用由你在创建作业时提供的快递商帐户支付。\r \r **事务费用**\r \r 将数据导入 Blob 存储没有事务费用。 将数据从 Blob 存储导出时，需支付标准的传出费用。 有关事务费用的更多详细信息，请参阅 [数据传输定价](https://www.azure.cn/pricing/details/data-transfer/)\r \r ## <a name=\"quick-start\"></a>快速启动\r 此部分提供创建导入和导出作业的分步说明。 请确保在执行下一步操作之前符合所有[先决条件](#pre-requisites)。\r \r > [!IMPORTANT]\r > 服务支持每个导入或导出作业使用一个标准存储帐户，不支持高级存储帐户。 \r > \r > \r ## <a name=\"create-an-import-job\"></a>创建导入作业\r 创建导入作业时，需将数据从硬盘驱动器复制到 Azure 存储帐户，方法是将一个或多个包含数据的驱动器寄送到指定的数据中心。 导入作业会将有关硬盘驱动器、要复制的数据、目标存储帐户和寄送信息的详情传至 Azure 导入/导出服务。 创建导入作业是一个三步过程。 首先，使用 WAImportExport 工具准备驱动器。 其次，使用 Azure 门户提交导入作业。 最后，驱动器寄送到你在创建作业时获得的寄送地址，并在作业详细信息中更新寄送信息。   \r \r ### <a name=\"prepare-your-drives\"></a>准备驱动器\r 使用 Azure 导入/导出服务导入数据时，第一步是通过 WAImportExport 工具准备驱动器。 按照以下步骤准备驱动器。\r \r 1. 确定要导入的数据。 导入的数据可以是本地服务器或网络共享中的目录和独立文件。  \r 2. 根据数据总大小确定所需驱动器数目。 采购所需数目的 2.5 英寸 SSD 或者 2.5/3.5 英寸 SATA II 或 III 硬盘驱动器。\r 3. 确定目标存储帐户、容器、虚拟目录和 Blob。\r 4. 确定要复制到每个磁盘驱动器的目录和/或独立文件。\r 5. 为数据集和驱动器集创建 CSV 文件。\r \r     **数据集 CSV 文件**\r     \r   以下是导入数据作为 Azure Blob 的数据集 CSV 文件示例：\r     \r     ```\r     BasePath,DstItemPathOrPrefix,ItemType,Disposition,MetadataFile,PropertiesFile\r     \"F:\\50M_original\\100M_1.csv.txt\",\"containername/100M_1.csv.txt\",BlockBlob,rename,\"None\",None\r     \"F:\\50M_original\\\",\"containername/\",BlockBlob,rename,\"None\",None \r     ```\r   \r   以下是导入数据作为 Azure 文件的数据集 CSV 文件示例：\r   \r     ```\r     BasePath,DstItemPathOrPrefix,ItemType,Disposition,MetadataFile,PropertiesFile\r     \"F:\\50M_original\\100M_1.csv.txt\",\"fileshare/100M_1.csv.txt\",file,rename,\"None\",None\r     \"F:\\50M_original\\\",\"fileshare/\",file,rename,\"None\",None \r     ```\r    在上面的示例中，100M_1.csv.txt 将复制到名为“containername”或“fileshare”的根容器中。 如果名为“containername”或“fileshare”的容器不存在，系统会创建一个。 50M_original 下的所有文件和文件夹以递归方式复制到 containername 或 fileshare。 文件夹结构保持不变。\r \r     详细了解如何[准备数据集 CSV 文件](storage-import-export-tool-preparing-hard-drives-import.md#prepare-the-dataset-csv-file)。\r     \r     **请记住**：默认情况下，数据将作为块 Blob 导入。 可以使用 BlobType 字段值以页 Blob 的方式导入数据。 例如，如果要要导入 VHD 文件，而这些文件需要以磁盘方式装载到 Azure VM 上，则必须以页 Blob 方式导入。\r \r     **驱动器集 CSV 文件**\r \r     驱动器集标志的值是一个 CSV 文件，其中包含要将驱动器号映射到的磁盘的列表，以便工具可以正确选择要准备的磁盘列表。 \r \r     下面是驱动器集 CSV 文件的示例：\r     \r     ```\r     DriveLetter,FormatOption,SilentOrPromptOnFormat,Encryption,ExistingBitLockerKey\r     G,AlreadyFormatted,SilentMode,AlreadyEncrypted,060456-014509-132033-080300-252615-584177-672089-411631 |\r     H,Format,SilentMode,Encrypt,\r     ```\r \r     在上面的示例中，假设附加了两个磁盘，并创建了盘符为 G:\\ 和 H:\\ 的基本 NTFS 卷。 工具会格式化并加密托管 H:\\ 的磁盘，但不会格式化或加密托管卷 G:\\ 的磁盘。\r \r     详细了解如何[准备驱动器集 CSV 文件](storage-import-export-tool-preparing-hard-drives-import.md#prepare-initialdriveset-or-additionaldriveset-csv-file)。\r \r 6. 使用 [WAImportExport 工具](http://download.microsoft.com/download/3/6/B/36BFF22A-91C3-4DFC-8717-7567D37D64C5/WAImportExport.zip)将数据复制到一个或多个硬盘驱动器。\r 7. 可以通过在驱动器集 CSV 中的 Encryption 字段内指定“Encrypt”，在硬盘驱动器上启用 BitLocker 加密。 也可以手动在硬盘驱动器上启用 BitLocker 加密，并在运行工具时，在驱动器集 CSV 文件中指定“AlreadyEncrypted”并提供密钥。\r \r 8. 完成磁盘准备操作以后，请勿修改硬盘驱动器上的数据，也勿修改日志文件。\r \r > [!IMPORTANT]\r > 准备的每个硬盘驱动器都会生成一个日记文件。 使用 Azure 门户创建导入作业时，必须上传属于该导入作业的驱动器的所有日记文件。 不带日志文件的驱动器得不到处理。\r > \r >\r \r 下面是使用 WAImportExport 工具进行硬盘驱动器准备的命令和示例。\r \r 在第一个复制会话中使用新复制会话复制目录和/或文件的 WAImportExport 工具 PrepImport 命令：\r \r ```\r WAImportExport.exe PrepImport /j:<JournalFile> /id:<SessionId> [/logdir:<LogDirectory>] [/sk:<StorageAccountKey>] [/silentmode] [/InitialDriveSet:<driveset.csv>] DataSet:<dataset.csv>\r ```\r \r 导入示例 1\r \r ```\r WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#1  /sk:************* /InitialDriveSet:driveset-1.csv /DataSet:dataset-1.csv /logdir:F:\\logs\r ```\r \r 若要 **添加更多驱动器**，可以创建一个新的驱动器集文件并运行以下命令。 如果后续复制会话中的磁盘驱动器与 InitialDriveset .csv 中指定的不同，请指定一个新的驱动器集 CSV 文件并将其作为值提供给“AdditionalDriveSet”参数。 使用同一日记文件名称并提供新的会话 ID。 AdditionalDriveset CSV 文件的格式与 InitialDriveSet 的格式相同。\r \r ```\r WAImportExport.exe PrepImport /j:<JournalFile> /id:<SessionId> /AdditionalDriveSet:<driveset.csv>\r ```\r \r 导入示例 2\r ```\r WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#3  /AdditionalDriveSet:driveset-2.csv\r ```\r \r 若要向同一个驱动器集添加更多数据，后续复制会话可以调用 WAImportExport 工具的 PrepImport 命令来复制其他文件/目录：对于 InitialDriveset .csv 文件中为相同硬盘驱动器指定的后续复制会话，请指定同一日记文件名称并提供新的会话 ID；不需要提供存储帐户密钥。\r \r ```\r WAImportExport PrepImport /j:<JournalFile> /id:<SessionId> /j:<JournalFile> /id:<SessionId> [/logdir:<LogDirectory>] DataSet:<dataset.csv>\r ```\r \r 导入示例 3\r \r ```\r WAImportExport.exe PrepImport /j:JournalTest.jrn /id:session#2  /DataSet:dataset-2.csv\r ```\r \r 若要更详细了解如何使用 WAImportExport 工具，请参阅[为导入准备硬盘驱动器](storage-import-export-tool-preparing-hard-drives-import.md)。\r \r 另请参阅[为导入作业准备硬盘驱动器的示例工作流](storage-import-export-tool-sample-preparing-hard-drives-import-job-workflow.md)，以获取更详细的分步说明。  \r \r ### <a name=\"create-the-import-job\"></a>创建导入作业\r 1. 准备好驱动器后，在 Azure 门户中，依次转到“更多服务”->“存储”->“导入/导出作业”。 单击“创建导入/导出作业”。\r \r 2. 在“第 1 步:基本信息”中，选择“导入 Azure”，输入作业名称字符串，选择订阅，输入或选择资源组。 输入导入作业的描述性名称。 请注意，输入的名称只能包含小写字母、数字、连字符和下划线，必须以字母开头并且不得包含空格。 在作业进行中以及作业完成后，你使用所选名称来跟踪作业。\r \r 3. 在“第 2 步:作业详细信息”中，上传在驱动器准备步骤中获取的驱动器日志文件。 如果使用了 waimportexport.exe version1，需要为已准备好的每个驱动器上传一个文件。 在“导入目标”存储帐户部分中，选择要将数据导入哪个存储帐户。 “放置位置”将根据选定存储帐户所属的区域自动进行填充。\r    \r    ![创建导入作业 - 步骤 3](./media/storage-import-export-service/import-job-03.png)\r 4. 在“第 3 步:回寄信息”中，从下拉列表中选择快递商，并输入已通过此快递商创建的有效快递商帐号。 当你的导入作业完成后，Microsoft 会使用此帐户寄回驱动器。 输入完整、有效的联系人姓名、电话号码、电子邮件地址、街道地址、城市、邮政编码、州/省/自治区/直辖市和国家/地区。\r    \r 5. 在“摘要页”中，输入 Azure 数据中心寄送地址是为了将磁盘寄送到 Azure DC。 请确保寄送标签上标明了作业名称和完整地址。 \r \r 6. 单击“摘要页”上的“确定”，完成“创建导入作业”。\r \r 7. 寄送磁盘后，返回到 Azure 门户上的“导入/导出”页，再执行以下操作：a) 转到并单击导入作业；b) 单击“驱动器寄送后，更新作业状态和跟踪信息”； \r      c) 选中“标记为‘已寄送’”复选框；d) 输入“快递商”和“跟踪号码”。\r     \r    如果在创建作业后的 2 周内未更新跟踪号，该作业便会过期。\r    \r 8. 可以在门户仪表板上跟踪作业进度。 若要了解上一部分中每个作业状态的含义，请 [查看作业状态](#viewing-your-job-status)。\r \r ## <a name=\"create-an-export-job\"></a>创建导出作业\r 创建导出作业的目的是通知导入/导出服务：用户要将一个或多个空驱动器寄送到数据中心；这样数据中心就可以将数据从用户的存储帐户导出到驱动器，并将驱动器寄送给用户。\r \r ### <a name=\"prepare-your-drives\"></a>准备驱动器\r 对驱动器进行准备以便完成导出作业时，建议执行以下预检查：\r \r 1. 使用 WAImportExport 工具的 PreviewExport 命令检查所需的磁盘数。 有关详细信息，请参阅[预览导出作业的驱动器使用情况](https://msdn.microsoft.com/library/azure/dn722414.aspx)。 它可以根据要使用的驱动器大小，帮助你预览所选 Blob 的驱动器使用情况。\r 2. 请检查你是否可以读取/写入需要寄送的用于导出作业的硬盘驱动器。\r \r ### <a name=\"create-the-export-job\"></a>创建导出作业\r 1. 若要创建导出作业，请在 Azure 门户上依次转到“更多服务”->“存储”->“导入/导出作业”。 单击“创建导入/导出作业”。\r 2. 在“第 1 步:基本信息”中，选择“从 Azure 导出”，输入作业名称字符串，选择订阅，输入或选择资源组。 输入导入作业的描述性名称。 请注意，输入的名称只能包含小写字母、数字、连字符和下划线，必须以字母开头并且不得包含空格。 在作业进行中以及作业完成后，你使用所选名称来跟踪作业。 输入此导出作业的负责人的联系信息。 \r \r 3. 在“第 2 步:作业详细信息”中，从存储帐户部分中选择要导出其中数据的存储帐户。 “放置位置”将根据选定存储帐户所属的区域自动进行填充。 指定要从存储帐户导出到空驱动器的 blob 数据。 可以选择导出该存储帐户中的所有 Blob 数据，也可以指定要导出的 Blob 或 Blob 组。\r    \r    若要指定要导出的 Blob，请使用“等于”选择器，并指定该 Blob 的相对路径，以容器名称开头  。 使用 *$root* 指定根容器。\r    \r    若要指定以某一前缀开头的所有 Blob，请使用“开头为”选择器，并指定前缀，以正斜杠“/”开头  。 该前缀可以是容器名称的前缀、完整容器名称或者后跟 Blob 名称前缀的完整容器名称。\r    \r    下表显示有效 Blob 路径的示例：\r    \r    | 选择器 | Blob 路径 | 说明 |\r    | --- | --- | --- |\r    | 开头为 |/ |导出存储帐户中的所有 Blob |\r    | 开头为 |/$root/ |导出根容器中的所有 Blob |\r    | 开头为 |/book |导出任何容器中以前缀 book 开头的所有 Blob |\r    | 开头为 |/music/ |导出容器 music 中的所有 Blob |\r    | 开头为 |/music/love |导出容器 music 中以前缀 love 开头的所有 Blob |\r    | 等于 |$root/logo.bmp |导出根容器中的 Blob logo.bmp |\r    | 等于 |videos/story.mp4 |导出容器 videos 中的 Blob story.mp4 |\r    \r    必须以有效格式提供 Blob 路径，以免在处理过程中出现错误，如以下屏幕快照所示。\r    \r    ![创建导出作业 - 步骤 3](./media/storage-import-export-service/export-job-03.png)\r \r 4. 在“第 3 步:回寄信息”中，从下拉列表中选择快递商，并输入已通过此快递商创建的有效快递商帐号。 当导入作业完成后，我们会使用此帐户寄回驱动器。 输入完整、有效的联系人姓名、电话号码、电子邮件地址、街道地址、城市、邮政编码、州/省/自治区/直辖市和国家/地区。\r    \r  5. 在“摘要页”中，输入 Azure 数据中心寄送地址是为了将磁盘寄送到 Azure DC。 请确保寄送标签上标明了作业名称和完整地址。 \r \r 6. 单击“摘要页”上的“确定”，完成“创建导入作业”\r \r 7. 寄送磁盘后，返回到 Azure 门户上的“导入/导出”页，再执行以下操作：a) 转到并单击导入作业；b) 单击“驱动器寄送后，更新作业状态和跟踪信息”； \r      c) 选中“标记为‘已寄送’”复选框；d) 输入“快递商”和“跟踪号码”。\r     \r    如果在创建作业后的 2 周内未更新跟踪号，该作业便会过期。\r    \r 8. 可以在门户仪表板上跟踪作业进度。 若要了解上一部分中每个作业状态的含义，请 [查看作业状态](#viewing-your-job-status)。\r \r    > [!NOTE]\r    > 如果在复制到硬盘时要导出的 Blob 正在使用中，Azure 导入/导出服务将生成该 Blob 的快照，并复制快照。\r    > \r    > \r  \r 9. 收到包含已导出数据的驱动器以后，即可查看和复制该服务为驱动器生成的 BitLocker 密钥。 在 Azure 门户中，转到导出作业，再单击“导入/导出”选项卡。从列表中选择导出作业，再单击“BitLocker 密钥”选项。 BitLocker 密钥随即出现，如下所示：\r    \r    ![查看导出作业的 BitLocker 密钥](./media/storage-import-export-service/export-job-bitlocker-keys.png)\r \r 请查看下面的“常见问题”部分，因为该部分介绍了客户在使用此服务时遇到的最常见问题。\r \r ## <a name=\"frequently-asked-questions\"></a>常见问题\r \r 能否使用 Azure 导入/导出服务复制 Azure 文件存储？\r \r 可以，Azure 导入/导出服务支持导入到 Azure 文件存储。 目前它不支持导出 Azure 文件。\r \r **Azure 导入/导出服务是否适用于 CSP 订阅？**\r \r Azure 导入/导出服务支持 CSP 订阅。\r \r **能否跳过导入作业的驱动器准备步骤？能否在不复制的情况下准备驱动器？**\r \r 任何需要寄送到数据中心进行数据导入的驱动器都必须使用 WAImportExport 工具进行准备。 必须使用 WAImportExport 工具将数据复制到驱动器。\r \r **在创建导出作业时我是否需要执行任何磁盘准备操作？**\r \r 不需要，但建议执行一些预先检查。 使用 WAImportExport 工具的 PreviewExport 命令检查所需的磁盘数。 有关详细信息，请参阅[预览导出作业的驱动器使用情况](https://msdn.microsoft.com/library/azure/dn722414.aspx)。 它可以根据要使用的驱动器大小，帮助你预览所选 Blob 的驱动器使用情况。 此外，请检查你是否可以读取和写入需要寄送的用于导出作业的硬盘驱动器。\r \r **如果我无意中发送了不符合支持的要求的 HDD，会发生什么情况？**\r \r Azure 数据中心会将不符合支持要求的驱动器返还给你。 如果包裹中只有某些驱动器满足支持要求，则会处理这些驱动器，而不符合支持要求的驱动器则会返还给你。\r \r **是否可以取消我的作业？**\r \r 可以取消状态为“创建”或“装运”的作业。\r \r **在 Azure 门户中可以查看多长时间的已完成作业的状态？**\r \r 可以查看最长 90 天的已完成作业的状态。 已完成作业在 90 天后被删除。\r \r **如果我想要导入或导出超过 10 个驱动器，我应该做什么？**\r \r 对于导入/导出服务，一个导入或导出作业在单个作业中只能引用 10 个驱动器。 如果想要装运超过 10 个驱动器，可以创建多个作业。 与同一作业关联的驱动器必须放在同一个包裹中一起寄送。\r \r **该服务是否会在返还驱动器之前将其格式化？**\r \r 否。 所有驱动器都使用 BitLocker 加密。\r \r **是否可为导入/导出作业从 21Vianet 购买驱动器？**\r \r 不可以。 对于导入和导出作业，需要装运自己的驱动器。\r \r **如何访问此服务导入的数据** 可以通过 Azure 门户或使用名为“存储资源管理器”的独立工具来访问 Azure 存储帐户中的数据。 https://docs.azure.cn/vs-azure-tools-storage-manage-with-storage-explorer \r \r 导入作业完成后，数据在存储帐户中看起来是什么样的？是否会保留目录层次结构？\r \r 为导入作业准备硬盘驱动器时，目标由数据集 CSV 文件中的 DstBlobPathOrPrefix 字段指定。 该目标是存储帐户中的目标容器，可以将硬盘驱动器中的数据复制到其中。 在该目标容器中，为硬盘驱动器中的文件夹创建虚拟目录，为文件创建 Blob。 \r \r **如果驱动器的文件已存在于我的存储帐户中，该服务是否会覆盖我的存储帐户中的现有 Blob？**\r \r 准备驱动器时，可以使用数据集 CSV 文件中名为 /Disposition:<rename|no-overwrite|overwrite> 的字段指定是否应覆盖或忽略目标文件。 默认情况下，该服务会将新文件重命名，而不是覆盖现有 Blob。\r \r **WAImportExport 工具是否与 32 位操作系统兼容？**\r 否。 WAImportExport 工具仅与 64 位 Windows 操作系统兼容。 有关受支持的 OS 版本的完整列表，请参阅 [先决条件](#pre-requisites) 中的“操作系统”部分。\r \r **是否应该在包裹中添加除硬盘驱动器之外的其他东西？**\r \r 请仅发运硬盘驱动器。 不要包括电源线或 USB 电缆之类的物品。\r \r 是否必须通过 FedEx 或中国邮政寄送驱动器？\r \r 可以通过任何知名的快递商（例如 FedEx 或中国邮政）将驱动器寄送到数据中心。 但是，如果要求我们将驱动器从数据中心寄回给你，你必须提供可用地址。\r \r **跨国寄送驱动器是否存在限制？**\r \r 请注意，发运的物理介质可能需要穿越国界。 应当负责确保物理介质和数据是遵照适用的法律导入和/或导出的。 在发运物理介质之前，请咨询顾问以验证介质和数据是否可以合法地发运到所确定的数据中心。 这有助于确保它可以及时到达 21Vianet。\r \r 创建作业时，寄送地址是一个不同于存储帐户位置的位置。我该怎样做？\r \r 某些存储帐户位置映射到备用寄送位置。 此前可用的寄送位置也可临时映射到备用位置。 在寄送驱动器之前，请始终查看你在创建作业的过程中提供的寄送地址。\r \r 寄送驱动器时，快递商要求提供数据中心的联系人地址和电话号码。我该提供哪些内容？\r \r 电话号码和数据中心地址是在创建作业过程中提供的。\r \r **能否使用 Azure 导入/导出服务将 PST 邮箱和 SharePoint 数据复制到 O365？**\r \r 请参阅[将 PST 文件或 SharePoint 数据导入到 Office 365](https://technet.microsoft.com/library/ms.o365.cc.ingestionhelp.aspx)。\r \r **能否使用 Azure 导入/导出服务将我的备份脱机复制到 Azure 备份服务？**\r \r 请参阅 [Azure 备份中的脱机备份工作流](../../backup/backup-azure-backup-import-export.md)。\r \r **一次寄送中 HDD 的最大数量是多少？**\r \r 一次寄送中可以有任何数量 HDD，并且如果磁盘属于多个作业，建议：a) 使用对应的作业名称标记磁盘。 b) 使用后缀为 -1、-2 等的跟踪号码更新作业。\r   \r **磁盘导入/导出支持的块 Blob 和页 Blob 的最大大小是多少？**\r \r 最大块 Blob 大小约为 4.768 TB 或 5,000,000 MB。\r 最大页 Blob 大小为 1 TB。\r \r 磁盘导入/导出是否支持 AES 256 加密？\r \r 默认情况下，Azure 导入/导出服务使用 AES 128 BitLocker 加密进行加密，但在复制数据前，可以使用 BitLocker 进行手动加密，从而将加密提升为 AES 256。 \r \r 如果使用的是 [WAImportExpot V1](http://download.microsoft.com/download/0/C/D/0CD6ABA7-024F-4202-91A0-CE2656DCE413/WaImportExportV1.zip)，请参阅下面的示例命令\r ```\r WAImportExport PrepImport /sk:<StorageAccountKey> /csas:<ContainerSas> /t: <TargetDriveLetter> [/format] [/silentmode] [/encrypt] [/bk:<BitLockerKey>] [/logdir:<LogDirectory>] /j:<JournalFile> /id:<SessionId> /srcdir:<SourceDirectory> /dstdir:<DestinationBlobVirtualDirectory> [/Disposition:<Disposition>] [/BlobType:<BlockBlob|PageBlob>] [/PropertyFile:<PropertyFile>] [/MetadataFile:<MetadataFile>] \r ```\r 如果使用的是 [WAImportExport 工具](http://download.microsoft.com/download/3/6/B/36BFF22A-91C3-4DFC-8717-7567D37D64C5/WAImportExport.zip)，请指定“AlreadyEncrypted”，并在驱动集 CSV 中提供密钥。\r ```\r DriveLetter,FormatOption,SilentOrPromptOnFormat,Encryption,ExistingBitLockerKey\r G,AlreadyFormatted,SilentMode,AlreadyEncrypted,060456-014509-132033-080300-252615-584177-672089-411631 |\r ```\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r * [设置 WAImportExport 工具](storage-import-export-tool-how-to.md)\r * [使用 AzCopy 命令行实用程序传输数据](storage-use-azcopy.md)\r * [Azure 导入/导出 REST API 示例](https://github.com/Azure-Samples/storage-dotnet-import-export-job-management/)\r \r <!--Update_Description: wording update-->"}