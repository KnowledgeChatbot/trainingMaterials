{"Title":"如何使用 Azure CLI 在 Azure Marketplace 中查找 Linux VM 映像","Description":"了解如何使用 Azure CLI 确定发布服务器、产品/服务、SKU 和 Marketplace VM 映像的版本。","Content":"# <a name=\"how-to-find-linux-vm-images-in-the-azure-marketplace-with-the-azure-cli\"></a>如何使用 Azure CLI 在 Azure Marketplace 中查找 Linux VM 映像\r \r 本主题介绍如何使用 Azure CLI 2.0 在 Azure Marketplace 中查找 VM 映像。 创建 Linux VM 时使用此信息来指定 Marketplace 映像。\r \r 确保已安装最新的 [Azure CLI 2.0](https://docs.azure.cn/zh-cn/cli/install-az-cli2?view=azure-cli-latest) 并已登录到 Azure 帐户 (`az login`)。\r \r ## <a name=\"terminology\"></a>术语\r \r CLI 和其他 Azure 工具中根据层次结构标识 Marketplace 映像：\r \r * 发布者 - 创建映像的组织。 示例：Canonical\r * 产品/服务 - 发布者创建的一组相关映像。 示例：Ubuntu 服务器\r * SKU - 产品/服务的实例，例如分发的主要版本。 示例：16.04-LTS\r * 版本 - 映像 SKU 的版本号。 指定映像时，可将版本号替换为“latest”，这会选择最新的分发版本。\r \r 若要指定 Marketplace 映像，通常使用 URN 映像。 URN 将这些值合并，值之间用冒号 (:) 字符隔开：*发布者*:*产品/服务*:*Sku*:*版本*。 \r \r [!INCLUDE [azure-cli-2-azurechinacloud-environment-parameter](../../../includes/azure-cli-2-azurechinacloud-environment-parameter.md)]\r \r ## <a name=\"list-popular-images\"></a>列出常用映像\r \r 运行 [az vm image list](https://docs.azure.cn/zh-cn/cli/vm/image?view=azure-cli-latest#list) 命令，无需选择 `--all` 选项即可在 Azure Marketplace 中查看常用 VM 映像的列表。 例如，运行以下命令以表格形式显示缓存的常用映像列表：\r \r ```azurecli\r az vm image list --output table\r ```\r \r 输出包括用以指定映像的 URN（Urn 列中的值）。 使用其中一个常用 Marketplace 映像创建 VM 时，可选择指定 URN 别名，如 UbuntuLTS。\r \r ```\r You are viewing an offline list of images, use --all to retrieve an up-to-date list\r Offer          Publisher               Sku                 Urn                                                             UrnAlias             Version\r -------------  ----------------------  ------------------  --------------------------------------------------------------  -------------------  ---------\r CentOS         OpenLogic               7.3                 OpenLogic:CentOS:7.3:latest                                     CentOS               latest\r CoreOS         CoreOS                  Stable              CoreOS:CoreOS:Stable:latest                                     CoreOS               latest\r Debian         credativ                8                   credativ:Debian:8:latest                                        Debian               latest\r openSUSE-Leap  SUSE                    42.2                SUSE:openSUSE-Leap:42.2:latest                                  openSUSE-Leap        latest\r SLES           SUSE                    12-SP2              SUSE:SLES:12-SP2:latest                                         SLES                 latest\r UbuntuServer   Canonical               16.04-LTS           Canonical:UbuntuServer:16.04-LTS:latest                         UbuntuLTS            latest\r ...\r ```\r \r ## <a name=\"find-specific-images\"></a>查找特定映像\r \r 若要在 Marketplace 中查找特定 VM 映像，请结合使用 `az vm image list` 命令和 `--all` 选项。 此版本命令完成需要一些时间，且会返回冗长输出，因此通常可按 `--publisher` 或其他参数筛选列表。 \r \r 例如，以下命令显示所有 Debian 产品/服务（请记住，不使用 `--all` 开关时，只搜索常见映像的本地缓存）：\r \r ```azurecli\r az vm image list --offer Debian --all --output table \r ```\r \r 部分输出： \r ```\r Offer    Publisher    Sku                Urn                                              Version\r -------  -----------  -----------------  -----------------------------------------------  --------------\r Debian   credativ     7                  credativ:Debian:7:7.0.201602010                  7.0.201602010\r Debian   credativ     7                  credativ:Debian:7:7.0.201603020                  7.0.201603020\r Debian   credativ     7                  credativ:Debian:7:7.0.201604050                  7.0.201604050\r Debian   credativ     7                  credativ:Debian:7:7.0.201604200                  7.0.201604200\r Debian   credativ     7                  credativ:Debian:7:7.0.201606280                  7.0.201606280\r Debian   credativ     7                  credativ:Debian:7:7.0.201609120                  7.0.201609120\r Debian   credativ     7                  credativ:Debian:7:7.0.201611020                  7.0.201611020\r Debian   credativ     8                  credativ:Debian:8:8.0.201602010                  8.0.201602010\r Debian   credativ     8                  credativ:Debian:8:8.0.201603020                  8.0.201603020\r Debian   credativ     8                  credativ:Debian:8:8.0.201604050                  8.0.201604050\r Debian   credativ     8                  credativ:Debian:8:8.0.201604200                  8.0.201604200\r Debian   credativ     8                  credativ:Debian:8:8.0.201606280                  8.0.201606280\r Debian   credativ     8                  credativ:Debian:8:8.0.201609120                  8.0.201609120\r Debian   credativ     8                  credativ:Debian:8:8.0.201611020                  8.0.201611020\r Debian   credativ     8                  credativ:Debian:8:8.0.201701180                  8.0.201701180\r Debian   credativ     8                  credativ:Debian:8:8.0.201703150                  8.0.201703150\r Debian   credativ     8                  credativ:Debian:8:8.0.201704110                  8.0.201704110\r Debian   credativ     8                  credativ:Debian:8:8.0.201704180                  8.0.201704180\r Debian   credativ     8                  credativ:Debian:8:8.0.201706190                  8.0.201706190\r Debian   credativ     8                  credativ:Debian:8:8.0.201706210                  8.0.201706210\r Debian   credativ     8                  credativ:Debian:8:8.0.201708040                  8.0.201708040\r ...\r ```\r \r 通过 `--location`、`--publisher` 和 `--sku` 选项应用类似的筛选器。 甚至可以在筛选器上执行部分匹配，如搜索 `--offer Deb` 以查找所有 Debian 映像。\r \r 如果没有使用 `--location` 选项指定一个特定位置，则会默认返回 `chinanorth` 的值。 （通过运行 `az configure --defaults location=<location>` 设置不同默认位置。）\r \r 例如，以下命令列出了 `chinanorth` 中的所有 Debian 8 SKU：\r \r ```azurecli\r az vm image list --location chinanorth --offer Deb --publisher credativ --sku 8 --all --output table\r ```\r \r 部分输出：\r \r ```\r Offer    Publisher    Sku                Urn                                              Version\r -------  -----------  -----------------  -----------------------------------------------  -------------\r Debian   credativ     8                  credativ:Debian:8:8.0.201602010                  8.0.201602010\r Debian   credativ     8                  credativ:Debian:8:8.0.201603020                  8.0.201603020\r Debian   credativ     8                  credativ:Debian:8:8.0.201604050                  8.0.201604050\r Debian   credativ     8                  credativ:Debian:8:8.0.201604200                  8.0.201604200\r Debian   credativ     8                  credativ:Debian:8:8.0.201606280                  8.0.201606280\r Debian   credativ     8                  credativ:Debian:8:8.0.201609120                  8.0.201609120\r Debian   credativ     8                  credativ:Debian:8:8.0.201611020                  8.0.201611020\r Debian   credativ     8                  credativ:Debian:8:8.0.201701180                  8.0.201701180\r Debian   credativ     8                  credativ:Debian:8:8.0.201703150                  8.0.201703150\r Debian   credativ     8                  credativ:Debian:8:8.0.201704110                  8.0.201704110\r Debian   credativ     8                  credativ:Debian:8:8.0.201704180                  8.0.201704180\r Debian   credativ     8                  credativ:Debian:8:8.0.201706190                  8.0.201706190\r Debian   credativ     8                  credativ:Debian:8:8.0.201706210                  8.0.201706210\r ...\r ```\r \r ## <a name=\"navigate-the-images\"></a>浏览映像 \r 在某个位置查找映像的另一种方法是，运行序列中的 [az vm image list-publishers](https://docs.azure.cn/zh-cn/cli/vm/image?view=azure-cli-latest#list-publishers)、[az vm image list-offers](https://docs.azure.cn/zh-cn/cli/vm/image?view=azure-cli-latest#list-offers) 和 [az vm image list-skus](https://docs.azure.cn/zh-cn/cli/vm/image?view=azure-cli-latest#list-skus) 命令。 可以使用这些命令确定以下值：\r \r 1. 列出映像发布者。\r 2. 对于给定的发布者，列出其产品。\r 3. 对于给定的产品，列出其 SKU。\r \r 例如，以下命令列出了中国北部位置的映像发布者：\r \r ```azurecli\r az vm image list-publishers --location chinanorth --output table\r ```\r \r 部分输出：\r \r ```\r Location    Name\r ----------  ----------------------------------------------------\r chinanorth      1e\r chinanorth      4psa\r chinanorth      7isolutions\r chinanorth      a10networks\r chinanorth      abiquo\r chinanorth      accellion\r chinanorth      Acronis\r chinanorth      Acronis.Backup\r chinanorth      actian_matrix\r chinanorth      actifio\r chinanorth      activeeon\r chinanorth      adatao\r ...\r ```\r 使用此信息可以从特定发布者找到产品/服务。 例如，如果 Canonical 是中国北部位置的映像发布者，可通过运行 `azure vm image list-offers` 查找其产品/服务。 传递位置和发布者，如以下示例中所示：\r \r ```azurecli\r az vm image list-offers --location chinanorth --publisher Canonical --output table\r ```\r \r 输出：\r \r ```\r Location    Name\r ----------  -------------------------\r chinanorth      Ubuntu15.04Snappy\r chinanorth      Ubuntu15.04SnappyDocker\r chinanorth      UbunturollingSnappy\r chinanorth      UbuntuServer\r chinanorth      Ubuntu_Core\r chinanorth      Ubuntu_Snappy_Core\r chinanorth      Ubuntu_Snappy_Core_Docker\r ```\r 可以看到，在中国北部区域，Canonical 在 Azure 上发布了 **UbuntuServer** 产品。 但是，有哪些 SKU 呢？ 要获取这些值，请运行 `azure vm image list-skus`，并对找到的位置、发布者和产品/服务进行设置：\r \r ```azurecli\r az vm image list-skus --location chinanorth --publisher Canonical --offer UbuntuServer --output table\r ```\r \r 输出：\r \r ```\r Location    Name\r ----------  -----------------\r chinanorth      12.04.3-LTS\r chinanorth      12.04.4-LTS\r chinanorth      12.04.5-DAILY-LTS\r chinanorth      12.04.5-LTS\r chinanorth      12.10\r chinanorth      14.04.0-LTS\r chinanorth      14.04.1-LTS\r chinanorth      14.04.2-LTS\r chinanorth      14.04.3-LTS\r chinanorth      14.04.4-LTS\r chinanorth      14.04.5-DAILY-LTS\r chinanorth      14.04.5-LTS\r chinanorth      16.04-beta\r chinanorth      16.04-DAILY-LTS\r chinanorth      16.04-LTS\r chinanorth      16.04.0-LTS\r chinanorth      16.10\r chinanorth      16.10-DAILY\r chinanorth      17.04\r chinanorth      17.04-DAILY\r chinanorth      17.10-DAILY\r ```\r \r 最后，使用 `az vm image list` 命令查找所需的特定版本的 SKU，例如，16.04-LTS：\r \r ```azurecli\r az vm image list --location chinanorth --publisher Canonical --offer UbuntuServer --sku 16.04-LTS --all --output table\r ```\r \r 输出：\r \r ```\r Offer         Publisher    Sku        Urn                                               Version\r ------------  -----------  ---------  ------------------------------------------------  ---------------\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201611220  16.04.201611220\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201611300  16.04.201611300\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201612050  16.04.201612050\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201612140  16.04.201612140\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201612210  16.04.201612210\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201701130  16.04.201701130\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201702020  16.04.201702020\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201702200  16.04.201702200\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201702210  16.04.201702210\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201702240  16.04.201702240\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201703020  16.04.201703020\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201703030  16.04.201703030\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201703070  16.04.201703070\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201703270  16.04.201703270\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201703280  16.04.201703280\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201703300  16.04.201703300\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201705080  16.04.201705080\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201705160  16.04.201705160\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201706100  16.04.201706100\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201706191  16.04.201706191\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201707210  16.04.201707210\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201707270  16.04.201707270\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201708030  16.04.201708030\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201708110  16.04.201708110\r UbuntuServer  Canonical    16.04-LTS  Canonical:UbuntuServer:16.04-LTS:16.04.201708151  16.04.201708151\r ```\r ## <a name=\"next-steps\"></a>后续步骤\r 现在，可通过记下 URN 值准确地选择想要使用的映像。 通过 [az vm create](https://docs.azure.cn/zh-cn/cli/vm?view=azure-cli-latest#create) 命令创建 VM 时，可将此值与 `--image` 参数一起传递。 记住，可选择将 URN 中的版本号替换为“latest”。 此版本始终是分发的最新版本。 若要使用 URN 信息快速创建虚拟机，请参阅[使用 Azure CLI 创建和管理 Linux VM](tutorial-manage-vm.md)。\r \r <!--Update_Description: update meta properties, wording update-->"}