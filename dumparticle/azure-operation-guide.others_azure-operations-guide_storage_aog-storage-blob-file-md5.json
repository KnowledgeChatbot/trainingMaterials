{"Title":"如何调用 API 获取 Azure 文件存储中文件的 MD5","Description":"Azure storage file中api获取不到MD5的问题解释。","Content":"\r # 如何调用 API 获取 Azure File 存储中文件的 MD5值 #\r \r **问题：** 如何调用 API 获取 Azure File 存储中文件的 MD5值\r \r **现象：** 文件以 Blob 形式存储，可以通过调用 API 获取其 MD5 值。而如果文件存储在 File 存储中时，通过 API 获取到的 MD5 值为空 \r \r 1. NET SDK 测试：\r \r     测试代码：\r \r     ```\r         //file 文件测试\r         String filePath1 = \"E:\\\\Background\\\\linux-087.jpg\";\r         CloudFile cloudFile1 = rootDir.GetFileReference(\"image-03.jpg\");\r         cloudFile1.UploadFromFile(filePath1,FileMode.OpenOrCreate);   \r         Console.WriteLine(\"md5=\"+cloudFile1.Properties.ContentMD5);\r \r         //blob 文件测试\r         CloudBlobClient blobClient = storageAccount.CreateCloudBlobClient();\r         CloudBlobContainer container = blobClient.GetContainerReference(\"file\");\r         CloudBlockBlob blob = container.GetBlockBlobReference(@\"image-03.jpg\");\r         blob.UploadFromFile(filePath1, FileMode.OpenOrCreate);\r         Console.WriteLine(\"md5=\" + blob.Properties.ContentMD5);\r     ```\r \r     测试结果：\r \r     ![.net-test-result](./media/aog-storage-blob-file-md5/net-test-result.png \".net-test-result\")\r \r 2. JAVA SDK 测试：\r \r     测试代码：\t\r \r     ```\r         //file 文件测试\r         final String filePath = \"E:\\\\Background\\\\linux-087.jpg\";\r         CloudFile cloudFile = rootDir.getFileReference(\"image-04.jpg\");\r         cloudFile.uploadFromFile(filePath); \r         System.out.println(\"md5=\"+cloudFile.getProperties().getContentMD5());\r \r         //blob 文件测试\r         CloudBlobClient blobClient = account.createCloudBlobClient();\r         CloudBlobContainer container = blobClient.getContainerReference(\"file\");\r         CloudBlockBlob blobFile = container.getBlockBlobReference(\"image-04.jpg\");\r         blobFile.uploadFromFile(filePath);\r         System.out.println(\"md5=\"+blobFile.getProperties().getContentMD5());\r     ```\r \r      测试结果：\r \r     ![java-test-result](./media/aog-storage-blob-file-md5/java-test-result.png \"java-test-result\")\r \r **问题原因：** 由于文件存储本身应用形式为磁盘，而文件的一些更新等动作会导致 MD5 重新计算，这对于磁盘性能影响较大，因此暂不支持 MD5 自动生成。而 Blob 本身而言并不支持修改操作，文件的 MD5 值相对稳定。详细请参考[这篇文章](/storage/storage-dotnet-how-to-use-files)。\r \r **解决方法：** 如果一定要使用这种特性，建议考虑 Blob Storage 或者手动方式计算文件的 MD5。"}