{"Title":"使用 Azure CLI 1.0 部署 LAMP 堆栈","Description":"了解如何在 Azure 中的 Linux VM 上安装 LAMP 堆栈","Content":"# <a name=\"deploy-lamp-stack-with-the-azure-cli-10\"></a>使用 Azure CLI 1.0 部署 LAMP 堆栈\r 本文介绍如何在 Azure 上部署 Apache web 服务器、MySQL 和 PHP（LAMP 堆栈）。 需要一个 Azure 帐户（[获取试用版](https://www.azure.cn/pricing/1rmb-trial/)）和[连接到 Azure 帐户](../../xplat-cli-connect.md)的 [Azure CLI](../../cli-install-nodejs.md)。\r \r ## <a name=\"cli-versions-to-complete-the-task\"></a>用于完成任务的 CLI 版本\r 可使用以下 CLI 版本之一完成任务：\r \r - Azure CLI 1.0 - 用于经典部署模型和资源管理部署模型（本文）的 CLI\r - [Azure CLI 2.0](create-lamp-stack.md?toc=%2fvirtual-machines%2flinux%2ftoc.json) - 适用于资源管理部署模型的下一代 CLI\r \r ```\r # One command to create a resource group holding a VM with LAMP already on it\r $ azure group create -n uniqueResourceGroup -l chinanorth --template-uri https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/lamp-app/azuredeploy.json\r ```\r \r * 在现有 VM 上部署 LAMP\r \r ```\r # Two commands: one updates packages, the other installs Apache, MySQL, and PHP\r user@ubuntu$ sudo apt-get update\r user@ubuntu$ sudo apt-get install apache2 mysql-server php5 php5-mysql\r ```\r \r ## <a name=\"deploy-lamp-on-new-vm-walkthrough\"></a>在新的 VM 上部署 LAMP 的演练\r 可以首先创建一个包含新 VM 的[资源组](../../azure-resource-manager/resource-group-overview.md)：\r \r     $ azure group create uniqueResourceGroup chinanorth\r     info:    Executing command group create\r     info:    Getting resource group uniqueResourceGroup\r     info:    Creating resource group uniqueResourceGroup\r     info:    Created resource group uniqueResourceGroup\r     data:    Id:                  /subscriptions/########-####-####-####-############/resourceGroups/uniqueResourceGroup\r     data:    Name:                uniqueResourceGroup\r     data:    Location:            chinanorth\r     data:    Provisioning State:  Succeeded\r     data:    Tags: null\r     data:\r     info:    group create command OK\r \r 若要创建 VM 本身，可以使用在 [GitHub 上的此处](https://github.com/Azure/azure-quickstart-templates/tree/master/lamp-app)找到的已编写好的 Azure Resource Manager 模板。\r \r     $ azure group deployment create --template-uri https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/lamp-app/azuredeploy.json uniqueResourceGroup uniqueLampName\r \r 你会看到提示输入更多内容的响应：\r \r     info:    Executing command group deployment create\r     info:    Supply values for the following parameters\r     storageAccountNamePrefix: lampprefix\r     location: chinanorth\r     adminUsername: someUsername\r     adminPassword: somePassword\r     mySqlPassword: somePassword\r     dnsLabelPrefix: azlamptest\r     info:    Initializing template configurations and parameters\r     info:    Creating a deployment\r     info:    Created template deployment \"uniqueLampName\"\r     info:    Waiting for deployment to complete\r     data:    DeploymentName     : uniqueLampName\r     data:    ResourceGroupName  : uniqueResourceGroup\r     data:    ProvisioningState  : Succeeded\r     data:    Timestamp          :\r     data:    Mode               : Incremental\r     data:    CorrelationId      : d51bbf3c-88f1-4cf3-a8b3-942c6925f381\r     data:    TemplateLink       : https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/lamp-app/azuredeploy.json\r     data:    ContentVersion     : 1.0.0.0\r     data:    DeploymentParameters :\r     data:    Name                      Type          Value\r     data:    ------------------------  ------------  -----------\r     data:    storageAccountNamePrefix  String        lampprefix\r     data:    location                  String        chinanorth\r     data:    adminUsername             String        someUsername\r     data:    adminPassword             SecureString  undefined\r     data:    mySqlPassword             SecureString  undefined\r     data:    dnsLabelPrefix            String        azlamptest\r     data:    ubuntuOSVersion           String        14.04.2-LTS\r     info:    group deployment create command OK\r \r 现在你已创建已安装 LAMP 的 Linux VM。 可以根据需要跳转到[验证是否已成功安装 LAMP](#verify-lamp-successfully-installed) 来验证此安装。\r \r ## <a name=\"deploy-lamp-on-existing-vm-walkthrough\"></a>在现有 VM 上部署 LAMP 的演练\r 如果需要有关创建 Linux VM 方面的帮助，可以转到[此处了解如何创建 Linux VM](quick-create-cli.md?toc=%2fvirtual-machines%2flinux%2ftoc.json)。 接下来，需通过 SSH 登录 Linux VM。 如果需要有关创建 SSH 密钥方面的帮助，可以转到[此处了解如何在 Linux/Mac 上创建 SSH 密钥](mac-create-ssh-keys.md?toc=%2fvirtual-machines%2flinux%2ftoc.json)。\r 如果已有 SSH 密钥，请继续操作，使用 `ssh exampleUsername@exampleDNS` 从命令行通过 SSH 登录 Linux VM。\r \r 现在你是在 Linux VM 中操作，我们可以指导你在基于 Debian 的分发版上安装 LAMP 堆栈。 对于其他 Linux 分发版，确切的命令可能会有所不同。\r \r #### <a name=\"installing-on-debianubuntu\"></a>在 Debian/Ubuntu 上安装\r 需要安装以下程序包：`apache2`、`mysql-server`、`php5`、`php5-mysql`。 可以直接使用这些包来安装，也可以使用 Tasksel 来安装。 下面列出了这两种方法的说明。\r 在安装之前，需要下载并更新包列表。\r \r     user@ubuntu$ sudo apt-get update\r \r ##### <a name=\"individual-packages\"></a>单个包\r 使用 apt-get：\r \r     user@ubuntu$ sudo apt-get install apache2 mysql-server php5 php5-mysql\r \r ##### <a name=\"using-tasksel\"></a>使用 tasksel\r 此外，你可以下载 Tasksel，它是一个 Debian/Ubuntu 工具，可将多个相关包作为协同“任务”安装到你的系统中。\r \r     user@ubuntu$ sudo apt-get install tasksel\r     user@ubuntu$ sudo tasksel install lamp-server\r \r 运行上述任一选项以后，系统会提示用户安装这些包以及各种其他的依赖项。 按“y”再按“Enter”即可继续，然后再遵循任何其他的提示为 MySQL 设置一个管理密码。 此时会安装最低要求的 PHP 扩展，这些扩展是通过 MySQL 使用 PHP 所必需的。 \r \r ![][1]\r \r 运行以下命令即可查看以程序包形式提供的其他 PHP 扩展：\r \r     user@ubuntu$ apt-cache search php5\r \r #### <a name=\"create-infophp-document\"></a>创建 info.php 文档\r 现在你可以通过在命令行中键入 `apache2 -v`、`mysql -v` 或 `php -v` 来检查 Apache、MySQL 和 PHP 的版本。\r \r 如果你想要进行进一步的检测，可以创建在浏览器中查看的快速 PHP 信息页。 通过以下命令使用 Nano 文本编辑器创建一个文件：\r \r     user@ubuntu$ sudo nano /var/www/html/info.php\r \r 在 GNU Nano 文本编辑器中，添加以下行：\r \r     <?php\r     phpinfo();\r     ?>\r \r 然后保存并退出文本编辑器。\r \r 使用此命令重启 Apache，以便所有新安装都生效。\r \r     user@ubuntu$ sudo service apache2 restart\r \r ## <a name=\"verify-lamp-successfully-installed\"></a>验证是否已成功安装 LAMP\r 现在，用户可以查看所创建的 PHP 信息页，只需打开浏览器并转到 http://youruniqueDNS/info.php 即可。 应如下图所示。\r \r ![][2]\r \r 可以通过转到 http://youruniqueDNS/ 查看 Apache2 Ubuntu 默认页来检查 Apache 安装。 用户会看到类似下图的内容。\r \r ![][3]\r \r 恭喜，你刚刚在 Azure VM 上安装了 LAMP 堆栈！\r \r ## <a name=\"next-steps\"></a>后续步骤\r 签出 LAMP 堆栈上的 Ubuntu 文档：\r \r * [https://help.ubuntu.com/community/ApacheMySQLPHP](https://help.ubuntu.com/community/ApacheMySQLPHP)\r \r [1]: ./media/deploy-lamp-stack/configmysqlpassword-small.png\r [2]: ./media/deploy-lamp-stack/phpsuccesspage.png\r [3]: ./media/deploy-lamp-stack/apachesuccesspage.png\r "}