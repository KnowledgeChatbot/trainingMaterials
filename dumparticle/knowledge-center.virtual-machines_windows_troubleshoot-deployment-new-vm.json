{"Title":"排查在 Azure 中新建 Windows VM 时遇到的部署问题","Description":"排查在 Azure 中新建 Windows 虚拟机时遇到的 Resource Manager 部署问题","Content":"# <a name=\"troubleshoot-deployment-issues-when-creating-a-new-windows-vm-in-azure\"></a>排查在 Azure 中新建 Windows VM 时遇到的部署问题\r [!INCLUDE [virtual-machines-troubleshoot-deployment-new-vm-opening](../../../includes/virtual-machines-troubleshoot-deployment-new-vm-opening-include.md)]\r \r [!INCLUDE [support-disclaimer](../../../includes/support-disclaimer.md)]\r \r ## <a name=\"top-issues\"></a>常见问题\r [!INCLUDE [support-disclaimer](../../../includes/virtual-machines-windows-troubleshoot-deploy-vm-top.md)]\r \r 若有其他 VM 部署问题和疑问，请参阅[排查 Azure 中的 Windows 虚拟机部署问题](troubleshoot-deploy-vm.md)。\r \r ## <a name=\"collect-activity-logs\"></a>收集活动日志\r 若要开始故障排除，请收集活动日志，以识别与问题相关的错误。 以下链接包含有关要遵循的过程的详细信息。\r \r [查看部署操作](../../azure-resource-manager/resource-manager-deployment-operations.md)\r \r [通过查看活动日志管理 Azure 资源](../../resource-group-audit.md)\r \r [!INCLUDE [virtual-machines-troubleshoot-deployment-new-vm-issue1](../../../includes/virtual-machines-troubleshoot-deployment-new-vm-issue1-include.md)]\r \r [!INCLUDE [virtual-machines-windows-troubleshoot-deployment-new-vm-table](../../../includes/virtual-machines-windows-troubleshoot-deployment-new-vm-table.md)]\r \r **Y：** 如果 OS 是通用的 Windows，并且是使用通用设置上传和/或捕获的，则不会有任何错误。 同理，如果 OS 是专用的 Windows，并且是使用专用设置上传和/或捕获的，也不会有任何错误。\r \r **上传错误：**\r \r **N<sup>1</sup>：**如果 OS 是通用的 Windows，但是以专用设置上传的，则会发生预配超时错误，并且 VM 会卡在 OOBE 屏幕上。\r \r **N<sup>2</sup>：**如果 OS 是专用的 Windows，但是以通用设置上传的，则会发生预配失败错误，并且 VM 会卡在 OOBE 屏幕上，因为新 VM 是以原始计算机名称、用户名和密码运行的。\r \r **解决方法**\r \r 若要解决这两个错误，请使用 [Add-AzureRmVhd 上传原始 VHD](https://msdn.microsoft.com/library/mt603554.aspx)（可在本地找到），其设置与 OS 的设置相同（通用/专用）。 若要以通用设置上传，请记得先运行 sysprep。\r \r **捕获错误：**\r \r **N<sup>3</sup>：**如果 OS 是通用的 Windows，但是以专用设置捕获的，则会发生预配超时错误，因为标记为通用的原始 VM 不可用。\r \r **N<sup>4</sup>：**如果 OS 是专用的 Windows，但是以通用设置捕获的，则会发生预配失败错误，因为新 VM 是以原始计算机名称、用户名和密码运行的。 此外，标记为专用的原始 VM 不可用。\r \r **解决方法**\r \r 若要解决这两个错误，请从门户中删除当前映像，并[从当前 VHD 重新捕获映像](create-vm-specialized.md?toc=%2fvirtual-machines%2fwindows%2ftoc.json)，其设置与 OS 的设置相同（通用/专用）。\r \r ## <a name=\"issue-customgallerymarketplace-image-allocation-failure\"></a>问题：自定义/库/应用商店映像；分配失败\r 当新的 VM 请求被固定到不支持所请求的 VM 大小、或没有可用空间可处理请求的群集时，便会发生此错误。\r \r **原因 1：** 群集不支持请求的 VM 大小。\r \r **解决方法 1：**\r \r * 使用更小的 VM 大小来重试请求。\r * 如果无法更改请求的 VM 大小：\r   * 停止可用性集中的所有 VM。\r     单击“资源组” >  *你的资源组*  > “资源” >  *你的可用性集*  > “虚拟机” >  *你的虚拟机*  > “停止”。\r   * 所有 VM 都停止后，创建所需大小的新 VM。\r   * 先启动新 VM，选择每个已停止的 VM，然后单击“启动”。\r \r **原因 2：** 群集没有可用的资源。\r \r **解决方法 2：**\r \r * 稍后重试请求。\r * 如果新 VM 属于不同的可用性集\r   * 在不同的可用性集（位于同一区域）中创建新 VM。\r   * 将新 VM 添加到同一虚拟网络。\r \r ## <a name=\"next-steps\"></a>后续步骤\r 如果在 Azure 中启动已停止的 Windows VM 或调整现有 Windows VM 的大小时遇到问题，请参阅[排查在 Azure 中重新启动现有 Windows 虚拟机或调整其大小时遇到的 Resource Manager 部署问题](restart-resize-error-troubleshooting.md?toc=%2fvirtual-machines%2fwindows%2ftoc.json)。\r \r <!--Update_Description: update meta properties-->"}