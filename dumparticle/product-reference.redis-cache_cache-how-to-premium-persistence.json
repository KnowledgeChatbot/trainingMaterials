{"Title":"如何为高级 Azure Redis 缓存配置数据暂留","Description":"了解如何为高级层的 Azure Redis 缓存实例配置和管理数据暂留","Content":"# <a name=\"how-to-configure-data-persistence-for-a-premium-azure-redis-cache\"></a>如何为高级 Azure Redis 缓存配置数据暂留\r Azure Redis 缓存具有不同的缓存产品（包括群集、持久性和虚拟网络支持等高级层功能），使缓存大小和功能的选择更加灵活。 本文介绍如何配置高级 Azure Redis 缓存实例中的暂留。\r \r 有关其他高级缓存功能的信息，请参阅 [Azure Redis 缓存高级层简介](cache-premium-tier-intro.md)。\r \r ## <a name=\"what-is-data-persistence\"></a>什么是数据暂留？\r [Redis 暂留](https://redis.io/topics/persistence)可让你保留存储在 Redis 中的数据。 还可以获取快照并备份数据，以便在出现硬件故障时进行加载。 这相对于基本层或标准层是一项巨大优势，因为基本层或标准层将所有数据存储在内存中，在出现故障的情况下，如果缓存节点停机，则可能导致数据丢失。 \r \r Azure Redis 缓存使用 [RDB 模型](http://redis.io/topics/persistence)提供 Redis 暂留功能，允许将数据存储在 Azure 存储帐户中。 配置暂留以后，Azure Redis 缓存会按照可配置的备份频率，将 Redis 缓存的快照以 Redis 二进制格式暂留在磁盘上。 如果发生了灾难性事件，导致主缓存和副缓存都无法使用，则会使用最新快照重新构造缓存。\r \r 可在缓存创建过程中通过“Redis 数据暂留”边栏选项卡或者现有高级缓存的“设置”边栏选项卡配置暂留。\r \r [!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]\r \r 选中某个高级定价层后，请单击“Redis 暂留”。\r \r ![Redis 暂留][redis-cache-persistence]\r \r 下一部分中的步骤介绍如何在新的高级缓存上配置 Redis 暂留。 配置 Redis 暂留后，单击“创建”以创建具有 Redis 暂留的新高级版缓存。\r \r ## <a name=\"configure-redis-persistence\"></a>配置 Redis 持久性\r 在“Redis 数据暂留”边栏选项卡上配置 Redis 暂留。 对于新缓存，可以按前一部分中所述，在创建缓存过程中访问此边栏选项卡。 对于现有缓存，可从缓存的“设置”边栏选项卡访问“Redis 数据暂留”边栏选项卡。\r \r ![Redis 设置][redis-cache-settings]\r \r 若要启用 Redis 暂留，请单击“启用”来启用 RDB（Redis 数据库）备份。 若要在以前启用的高级缓存上禁用 Redis 暂留，请单击“禁用”。\r \r 若要配置备份间隔，请从下拉列表选择“备份频率”。 选项包括“15 分钟”、“30 分钟”、“60 分钟”、“6 小时”、“12 小时”和“24 小时”。 在上一个备份操作成功完成以后，此时间间隔就会开始倒计时，同时会启动新的备份。\r \r 单击“存储帐户”以选择要使用的存储帐户，并从“存储密钥”下拉列表中选择要使用的“主密钥”或“辅助密钥”。 必须选择与缓存处于相同区域的存储帐户，建议选择“高级存储”帐户，因为高级存储的吞吐量较高。 \r \r > [!IMPORTANT]\r > 如果重新生成了暂留帐户的存储密钥，必须从“存储密钥”下拉列表中重新配置所需密钥。\r > \r > \r \r ![Redis 暂留][redis-cache-persistence-selected]\r \r 单击“确定”可保存暂留配置。\r \r 一旦备份频率间隔时间已过，则会启动下一次备份（或新缓存的首次备份）。\r \r ## <a name=\"persistence-faq\"></a>暂留常见问题\r 以下列表包含有关 Azure Redis 缓存暂留常见问题的解答。\r \r * [能否在此前已创建的缓存的基础上启用保留？](#can-i-enable-persistence-on-a-previously-created-cache)\r * [能否在创建缓存后更改备份频率？](#can-i-change-the-backup-frequency-after-i-create-the-cache)\r * [为何我的备份频率为 60 分钟，而两次备份的间隔却超过 60 分钟？](#why-if-i-have-a-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups)\r * [进行新备份以后，旧备份会发生什么情况？](#what-happens-to-the-old-backups-when-a-new-backup-is-made)\r * [如果我缩放到不同大小并还原了缩放操作之前生成的备份，会发生什么情况？](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)\r \r ### <a name=\"can-i-enable-persistence-on-a-previously-created-cache\"></a>能否在此前已创建的缓存的基础上启用保留？\r 是的，可以在创建缓存时或者在现有高级缓存上配置 Redis 暂留。\r \r ### <a name=\"can-i-change-the-backup-frequency-after-i-create-the-cache\"></a>能否在创建缓存后更改备份频率？\r 能，可以在“Redis 数据暂留”边栏选项卡上更改备份频率。 有关说明，请参阅[配置 Redis 暂留](#configure-redis-persistence)。\r \r ### <a name=\"why-if-i-have-a-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups\"></a>为何我的备份频率为 60 分钟，而两次备份的间隔却超过 60 分钟？\r 在上一次备份过程成功完成之前，本次备份不会开始，其频率所对应的时间间隔也不会开始计算。 如果备份频率为 60 分钟，而备份过程需要 15 分钟才能成功完成，则在上一次备份开始以后，要再过 75 分钟才会开始下一次备份。\r \r ### <a name=\"what-happens-to-the-old-backups-when-a-new-backup-is-made\"></a>进行新备份以后，旧备份会发生什么情况？\r 除最新备份外的所有备份都会自动删除。 这种删除可能不会即刻发生，但旧备份是不会无限期保留下去的。\r \r ### <a name=\"what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation\"></a>如果我缩放到不同大小并还原了缩放操作之前生成的备份，会发生什么情况？\r * 如果缩放到更大的大小，则没有任何影响。\r * 如果缩放到更小的大小，并且自定义[数据库](cache-configure.md#databases)设置大于新大小的[数据库限制](cache-configure.md#databases)，则不会还原这些数据库中的数据。 有关详细信息，请参阅[在缩放过程中，自定义数据库设置是否会受影响？](cache-how-to-scale.md#is-my-custom-databases-setting-affected-during-scaling)\r * 如果缩放到更小的大小，并且更小的大小空间不足，无法容纳上次备份的所有数据，则在还原过程中，通常会使用 [allkeys-lru](http://redis.io/topics/lru-cache) 逐出策略逐出密钥。\r \r ## <a name=\"next-steps\"></a>后续步骤\r 了解如何使用更多的高级缓存功能。\r \r * [Azure Redis 缓存高级层简介](cache-premium-tier-intro.md)\r \r <!-- IMAGES -->\r \r [redis-cache-new-cache-menu]: ./media/cache-how-to-premium-persistence/redis-cache-new-cache-menu.png\r \r [redis-cache-premium-pricing-tier]: ./media/cache-how-to-premium-persistence/redis-cache-premium-pricing-tier.png\r \r [redis-cache-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-persistence.png\r \r [redis-cache-persistence-selected]: ./media/cache-how-to-premium-persistence/redis-cache-persistence-selected.png\r \r [redis-cache-settings]: ./media/cache-how-to-premium-persistence/redis-cache-settings.png\r \r <!--Update_Description: wording update-->\r "}