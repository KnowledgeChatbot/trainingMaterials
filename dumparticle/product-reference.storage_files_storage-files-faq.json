{"Title":"有关 Azure 文件的常见问题解答","Description":"查看有关 Azure 文件的常见问题解答。","Content":"# <a name=\"frequently-asked-questions-about-azure-files\"></a>有关 Azure 文件的常见问题解答\r \r ## <a name=\"general\"></a>常规\r * **什么是 Azure 文件？**  \r \r     Azure 文件在云中提供可以通过行业标准的[服务器消息块 (SMB) 协议](https://msdn.microsoft.com/library/windows/desktop/aa365233.aspx)（也称为通用 Internet 文件系统，简称 CIFS）访问的完全托管文件共享。 Azure 文件共享可由云或者 Windows、Linux 和 macOS 的本地部署同时装载。\r \r * **为何 Azure 文件很有用？**  \r \r    借助 Azure 文件，无需应对物理服务器或设备的开销即可在云中创建文件共享。 这意味着，你可以在应用 OS 更新和替换损坏的磁盘方面花费更少的时间 - 我们会为你全部代劳这份枯燥的工作。 若要详细了解 Azure 文件适用的应用场景，请参阅[为何 Azure 文件很有用](storage-files-introduction.md#why-azure-files-is-useful)。\r \r * **访问 Azure 文件中的文件有哪些不同方式？**  \r \r     可以使用 SMB 3.0 协议将文件共享装载到本地计算机上，也可以使用[存储资源管理器](http://storageexplorer.com/)等工具访问文件共享中的文件。 在应用程序中，可以使用存储客户端库、REST API 或 Powershell 访问 Azure 文件共享中的文件。\r \r \r * **相对于 Azure Blob 存储，我为什么要对数据使用 Azure 文件共享？**  \r \r     Azure 文件和 Azure Blob 存储均提供在云中存储大量数据的方法，但是用途略有不同。 Azure Blob 存储适用于需要存储非结构化数据且具有大规模缩放性的云本机应用程序。 为了更大程度地提升性能和可缩放性，相对于真实的文件系统而言，Azure Blob 存储是更简单的存储抽象。 此外，Azure Blob 存储只可通过基于 REST 的客户端库访问（或直接通过基于 REST 的协议访问）。\r \r     而在另一方面，Azure 文件将专门致力于成为一个文件系统，让你可在多年所熟知和喜爱的本地操作系统中获取所有文件抽象。 与 Azure Blob 存储相同的是，Azure 文件提供 REST 接口和基于 REST 的客户端库，不同于 Azure Blob 存储的是，Azure 文件还提供了对 Azure 文件共享的 SMB 访问。 这意味着，无需对文件系统写入任何代码或附加任何特殊驱动程序，即可在 Windows、Linux 或 macOS 上及本地或云 VM 中直接装载 Azure 文件共享。  \r    \r     有关 Azure 文件和 Azure Blob 存储之间差异的深入介绍，请参阅[确定何时使用 Azure Blob 存储、Azure 文件或 Azure 磁盘](../common/storage-decide-blobs-files-disks.md?toc=%2fstorage%2ffiles%2ftoc.json)。 若要了解有关 Azure Blob 存储的详细信息，请参阅 [Blob 存储简介](../blobs/storage-blobs-introduction.md)。\r \r * **相对于 Azure 磁盘，我为什么要使用 Azure 文件共享？**  \r \r     Azure 磁盘只是一个磁盘。 一个独立的磁盘本身并不是非常有用 - 若要充分利用 Azure 磁盘，必须与 Azure 中运行的虚拟机关联。 Azure 磁盘适用于将在本地服务器上使用磁盘的所有内容：无论是 OS 系统磁盘、OS 的交换空间还是应用程序的专用存储。 Azure 磁盘其中一个有趣的用途是，可在云中创建一个文件服务器，以在可能使用 Azure 文件共享的相同位置使用。 当需要 Azure 文件当前不支持的部署选项（例如，NFS 协议支持或高级存储）时，在 Azure VM 中部署文件服务器则是一种非常好的获取 Azure 中文件存储的高性能方法。 \r \r     另一方面，相比使用 Azure 文件共享，通过将 Azure 磁盘作为后端存储来运行文件服务器的方式，由于多方面的原因，其经济成本通常会更高。 首先，除了为磁盘存储付费之外，还必须为运行一个或多个 Azure VM 的成本付费。 其次，还必须要管理用于运行文件服务器的 VM，诸如负责进行 OS 升级等。最后，如果你最终需要本地缓存的数据，则还要自行安装和管理复制技术（例如，分布式文件系统复制）来实现此目的。\r \r     如果 Azure 文件共享与文件服务器位于同一个区域，则可启用云分层并将卷可用空间百分比设置为最大值 (99%)。 这可最大程度地减少重复数据，并允许在文件服务器上使用任何你所需要的应用程序，例如任何需要 NFS 协议支持的内容。\r \r     有关在 Azure 中设置高性能和高可用性的方法的详细信息，请参阅[在 Azure 中部署 IaaS VM 来宾群集](https://blogs.msdn.microsoft.com/clustering/2017/02/14/deploying-an-iaas-vm-guest-clusters-in-microsoft-azure/)。 有关 Azure 文件和 Azure 磁盘之间差异的深入介绍，请参阅[确定何时使用 Azure Blob 存储、Azure 文件或 Azure 磁盘](../common/storage-decide-blobs-files-disks.md?toc=%2fstorage%2ffiles%2ftoc.json)。 若要详细了解 Azure 磁盘，请参阅 [Azure 托管磁盘概述](../../virtual-machines/windows/managed-disks-overview.md)。\r \r * **如何开始使用 Azure 文件？**  \r \r     开始使用 Azure 文件非常简单：只需[创建文件共享](storage-how-to-create-file-share.md)，并在首选的操作系统中进行装载： \r \r     - [在 Windows 上装载](storage-how-to-use-files-windows.md)\r     - [在 Linux 上装载](storage-how-to-use-files-linux.md)\r     - [在 macOS 上装载](storage-how-to-use-files-mac.md)\r \r     有关如何部署 Azure 文件共享以替换组织中的生产文件共享的详细指南，请参阅[规划 Azure 文件部署](storage-files-planning.md)。\r \r * **Azure 文件支持哪些存储冗余选项？**  \r \r     Azure 文件目前仅支持本地冗余存储 (LRS) 和异地冗余存储 (GRS)。 将来我们计划支持区域冗余存储空间 (ZRS) 和读取访问权限异地冗余存储 (RA-GRS)，但目前还没有可分享的日程表。\r \r \r * **是否可以在冷存储中创建文件共享？**   \r \r     冷存储帐户目前仅支持 Blob。 它不支持文件共享。 你需要创建标准存储帐户。 标准存储在价格方面非常有竞争力，并且最近还进一步对标准 Azure 文件大幅降价。 有关详细信息，请参阅 [Azure 定价](https://www.azure.cn/pricing/details/storage/)。\r \r * **无法从本地访问文件共享？**  \r \r     如果要尝试从本地网络访问文件共享，必须满足以下先决条件：\r \r     - 端口 445 必须已由 ISP 启用（请与 ISP 联系以启用该端口）。\r \r     - 本地客户端计算机必须启用了 SMB 3.0。\r \r     - 当客户端访问文件存储时，所使用的 SMB 版本取决于操作系统支持的 SMB 版本。 \r     \r     以下列表提供了有关 Windows 客户端支持的摘要。\r \r     - 支持的 Windows 客户端 SMB 版本\r     - Windows 7 SMB 2.1\r     - Windows Server 2008 R2 SMB 2.1\r     - Windows 8 SMB 3.0\r     - Windows Server 2012 SMB 3.0\r     - Windows Server 2012 R2 SMB 3.0\r     - Windows 10 SMB 3.0\r \r     有关详细信息，请参阅 [Azure 文件存储问题疑难解答](https://support.microsoft.com/help/4022301/azure-file-storage-connection-creation--performance-problems)。\r \r * **无法从本地客户端装载 Azure 文件共享**\r \r     若要解决此问题，请使用 [Azure 文件存储疑难解答](problemshttps://support.microsoft.com/help/4022301/azure-file-storage-connection-creation--performance-problems)。\r \r * **如何在 VM 上映射容器文件夹**？ \r \r    请参阅[在 Azure 容器实例中装载 Azure 文件共享](https://docs.microsoft.com/en-us/azure/container-instances/container-instances-mounting-azure-files-volume)。\r \r * **是否可以增加文件共享的最大大小？**\r \r     不可以。 文件共享的最大大小为 5 TB。\r \r * **是否可以转换到高级存储帐户以进行文件共享？**\r \r     不可以。 高级存储目前在 Azure 文件共享上不可用。\r \r \r ## <a name=\"security-authentication-and-access-control\"></a>安全性、身份验证和访问控制\r * **Azure 文件是否支持基于 Active Directory 的身份验证和访问控制？**  \r \r     Azure 文件目前不支持基于 AD 的身份验证或 ACL，不过，我们正在积极解决此问题。 \r \r     - 使用 SAS，可以生成在指定时间间隔内有效的特定权限令牌。 例如，可以生成在 10 分钟后到期的令牌，其中包含对给定文件的只读访问权限。 只要拥有此有效令牌，就可以在 10 分钟内拥有对给定文件的只读访问权限。 目前，只能通过 REST API 或客户端库支持 SAS 密钥，你必须使用存储帐户密钥通过 SMB 装载 Azure 文件共享。\r \r \r * **如何确保已静态加密 Azure文件共享？**  \r \r     无需执行任何操作来启用加密，目前所有公用区域和各国云端的 Azure 文件均默认启用[服务器端加密](../common/storage-service-encryption.md?toc=%2fstorage%2ffiles%2ftoc.json)。 \r \r * **如何使用 Web 浏览器提供对特定文件的访问权限？** \r \r     使用 SAS，可以生成在指定时间间隔内有效的特定权限令牌。 例如，可以生成一个令牌，在特定的时段对特定的文件进行只读访问。 只要拥有此有效 URL，就可以直接通过任意 Web 浏览器访问文件。 可以轻松地通过 UI（例如存储资源管理器）生成 SAS 密钥。\r \r * **是否可以对共享中的文件夹指定只读或只写权限？**  \r \r     如果通过 SMB 装载文件共享，不具有此级别的权限控制。 但是，可以通过 REST API 或客户端库创建共享访问签名 (SAS) 来实现此控制。\r \r * **如何将所有用户的 Azure 文件存储映射为网络共享，而不提示他们输入凭据？** \r \r     Azure 文件不支持 AD 或 Azure AD。 这意味着通常需要映射用户的驱动器。 如果有一个方案，其中登录脚本映射该驱动器，那么此方案可向某人提供对存储密钥的访问而无需其输入凭据。 \r    \r    有关详细信息，请参阅以下文档：    \r    \r    - [在 Windows 上开始使用 Azure 文件存储（常规信息）](storage-dotnet-how-to-use-files.md )\r    - [持久保存与 Azure 文件的连接（使用 CMDKey 持久保存连接，映射到其他用户）](https://blogs.msdn.microsoft.com/windowsazurestorage/2014/05/26/persisting-connections-to-microsoft-azure-files/ )\r    - [如何为所有用户持久保存与 Azure 文件的连接？（有关存储密钥的限制的讨论）](https://serverfault.com/questions/772168/how-can-i-persist-connections-to-microsoft-azure-files-for-all-the-users)\r  \r * **是否可以在文件共享中设置不同文件夹的不同权限？** \r \r     一个文件共享中的所有文件夹都具有相同的一个权限。 若要实现此目标，可以尝试创建不同的文件共享作为解决方法，并为这些文件共享设置不同的权限。 然后，可以实现类似功能。\r \r * **是否可以将域或 NTFS 权限应用到 Azure 文件共享？如果不能，这种情况的最佳解决方案是什么？**\r \r     没有任何可将域或 NTFS 权限应用到 Azure 文件共享的方法。 不过，通过使用共享访问签名 (SAS)，可将存储帐户中对象的受限访问权限授予其他客户端而不必公开帐户密钥。\r \r * **是否可以使用域帐户凭据访问文件共享？**\r \r     不可以。 目前 Azure 文件共享只支持存储密钥身份验证。 因此我们无法使用域帐户凭据对其进行访问。\r \r ## <a name=\"on-premises-access\"></a>本地访问\r * **必须使用 Azure ExpressRoute 才能连接到 Azure 文件吗？**  \r \r     否，ExpressRoute 不是访问 Azure 文件共享的必要条件。 如果要直接在本地装载 Azure 文件共享，你只需打开端口 445（TCP 出站）以进行 Internet 访问（这是 SMB 用于进行通信的端口）。 \r \r * **如何才能在本地计算机上装载 Azure 文件共享？** \r \r     可以通过 SMB 协议装载文件共享，只要端口 445（TCP 出站）处于打开状态，且客户端支持 SMB 3.0 协议（例如，使用的是 Windows 10 或 Windows Server 2016）。 \r \r * **如何在本地 macOS 中装载文件共享？**  \r \r     请参阅以下文章以便在本地 macOS 上装载 Azure 文件共享：\r     - [在 macOS 中通过 SMB 装载 Azure 文件共享](storage-how-to-use-files-mac.md)\r     - [如何与 Mac 上的“文件共享”进行连接](https://support.apple.com/en-us/HT204445)\r \r ## <a name=\"backup\"></a>备份\r * **如何备份我的 Azure 文件共享？**  \r \r     可以使用定期共享快照（预览版）来防止意外删除。 可以使用 AzCopy、RoboCopy 或能够备份已装载文件共享的第三方备份工具。\r \r \r ## <a name=\"billing-and-pricing\"></a>计费和定价\r * **Azure VM 与文件共享之间的网络流量是否作为外部带宽计入订阅费用？**  \r \r     如果文件共享和 VM 位于同一 Azure 区域，它们之间的流量是免费的。 如果文件共享和 VM 位于不同的区域，它们之间的流量作为外部带宽收费。\r \r ## <a name=\"scale-and-performance\"></a>缩放和性能\r * **Azure 文件存在哪些缩放限制？** \r \r     若要了解 Azure 文件的可伸缩性和性能目标，请参阅 [Azure 存储可伸缩性和性能目标](../common/storage-scalability-targets.md?toc=%2fstorage%2ffiles%2ftoc.json)。\r \r * **多少个客户端可以同时访问同一文件？** \r \r     单个文件有 2000 个打开句柄配额。 一旦有 2000 个打开句柄，就会收到错误，指示已达到配额。\r \r * **尝试将文件解压缩到 Azure 文件中时性能降低。我该怎样做？**  \r \r     若要将大量文件传输到 Azure 文件，建议使用 AzCopy（Windows 版、Linux/Unix 预览版）或 Azure Powershell，因为这些工具已针对网络传输进行优化。\r \r * **我在 Windows Server 2012 R2 或 Windows 8.1 上装载了 Azure 文件共享，但性能不佳，为什么？**  \r \r     在 Windows Server 2012 R2 和 Windows 8.1 上装载 Azure 文件共享后，有一个已知问题，2014 年 4 月的 Windows 8.1 和 Windows Server 2012 R2 累积更新已修补了此问题。 请确保 Windows Server 2012 R2 和 Windows 8.1 的所有实例均应用了此修补程序，以获得最佳性能（当然，我们始终建议你通过 Windows 更新获取所有的 Windows 修补程序）。 有关详细信息，请查看相关的知识库文章：[Slow performance when you access Azure Files from Windows 8.1 or Server 2012 R2](https://support.microsoft.com/kb/3114025)（从 Windows 8.1 或 Server 2012 R2 访问 Azure 文件时性能降低）。\r \r ## <a name=\"features-and-interoperability-with-other-services\"></a>功能以及与其他服务的互操作性\r * **故障转移群集的“文件共享见证”是 Azure 文件的用例之一吗？**  \r \r     Azure 文件共享目前不支持此服务。 有关如何为 Azure Blob 存储设置此服务的详细信息，请参阅[部署故障转移群集的云见证](https://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness)。\r \r * **REST API 中是否有重命名操作？**  \r \r     目前没有。\r \r * **能否使用嵌套共享，换而言之就是共享下的共享？**  \r \r     否。 文件共享是可以装载的虚拟驱动程序，因此不支持嵌套共享。\r \r * **将 Azure 文件与 IBM MQ 配合使用**  \r \r     IBM 已发布相关文档，指导 IBM MQ 客户通过其服务配置 Azure 文件。 有关详细信息，请查阅 [How to setup IBM MQ Multi instance queue manager with Azure File Service](https://github.com/ibm-messaging/mq-azure/wiki/How-to-setup-IBM-MQ-Multi-instance-queue-manager-with-Microsoft-Azure-File-Service)（如何通过 Azure 文件服务来设置 IBM MQ 多实例队列管理器）。\r \r ## <a name=\"see-also\"></a>另请参阅\r * [在 Windows 中排查 Azure 文件问题](storage-troubleshoot-windows-file-connection-problems.md)\r * [在 Linux 中排查 Azure 文件问题](storage-troubleshoot-linux-file-connection-problems.md)\r <!--Update_Description:whole content update-->"}