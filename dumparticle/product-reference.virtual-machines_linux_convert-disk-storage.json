{"Title":"Azure 标准与高级托管磁盘存储的相互转换","Description":"如何使用 Azure CLI 实现 Azure 标准与高级托管磁盘存储的相互转换。","Content":"# <a name=\"convert-azure-managed-disks-storage-from-standard-to-premium-and-vice-versa\"></a>Azure 标准与高级托管磁盘存储的相互转换\r \r 托管磁盘提供两种存储选项：[高级](../windows/premium-storage.md)（基于 SSD）和[标准](../windows/standard-storage.md)（基于 HDD）。 它允许基于性能需求在这两个选项之间轻松切换，并保障最短停机时间。 非托管磁盘不具备此功能。 但可以轻松[转换为托管磁盘](convert-unmanaged-to-managed-disks.md)，以便在这两个选项之间轻松切换。\r \r 本文介绍了如何使用 Azure CLI 实现标准与高级托管磁盘的相互转换。 如果需要对其进行安装或升级，请参阅[安装 Azure CLI 2.0](https://docs.azure.cn/zh-cn/cli/install-azure-cli?view=azure-cli-latest)。 \r \r ## <a name=\"before-you-begin\"></a>开始之前\r \r * 该转换需要重启 VM，因此请在预先存在的维护时段内计划磁盘存储迁移。 \r * 如果使用的是非托管磁盘，请先[转换为托管磁盘](convert-unmanaged-to-managed-disks.md)，以便按照本文中的说明在两个存储选项之间切换。 \r \r ## <a name=\"convert-all-the-managed-disks-of-a-vm-from-standard-to-premium-and-vice-versa\"></a>实现 VM 的所有标准与高级托管磁盘的相互转换\r \r 以下示例展示如何将 VM 的所有磁盘从标准存储切换到高级存储。 若要使用高级托管磁盘，VM 必须使用支持高级存储的 [VM 大小](sizes.md)。 此示例还切换到了支持高级存储的大小。\r \r  ```azurecli\r \r #resource group that contains the virtual machine\r rgName='yourResourceGroup'\r \r #Name of the virtual machine\r vmName='yourVM'\r \r #Premium capable size \r #Required only if converting from standard to premium\r size='Standard_DS2_v2'\r \r #Choose between Standard_LRS and Premium_LRS based on your scenario\r sku='Premium_LRS'\r \r #Deallocate the VM before changing the size of the VM\r az vm deallocate --name $vmName --resource-group $rgName\r \r #Change the VM size to a size that supports premium storage \r #Skip this step if converting storage from premium to standard\r az vm resize --resource-group $rgName --name $vmName --size $size\r \r #Update the sku of all the data disks \r az vm show -n $vmName -g $rgName --query storageProfile.dataDisks[*].managedDisk -o tsv \\\r  | awk -v sku=$sku '{system(\"az disk update --sku \"sku\" --ids \"$1)}'\r \r #Update the sku of the OS disk\r az vm show -n $vmName -g $rgName --query storageProfile.osDisk.managedDisk -o tsv \\\r | awk -v sku=$sku '{system(\"az disk update --sku \"sku\" --ids \"$1)}'\r \r az vm start --name $vmName --resource-group $rgName\r \r ```\r ## <a name=\"convert-a-managed-disk-from-standard-to-premium-and-vice-versa\"></a>标准与高级托管磁盘的相互转换\r \r 对于开发/测试工作负荷，可能需要同时具有标准磁盘和高级磁盘，以减少成本。 可通过仅将需要更佳性能的磁盘升级到高级存储来实现此目的。 以下示例展示如何将 VM 的单个磁盘在标准存储与高级存储之间相互切换。 若要使用高级托管磁盘，VM 必须使用支持高级存储的 [VM 大小](sizes.md)。 此示例还切换到了支持高级存储的大小。\r \r  ```azurecli\r \r #resource group that contains the managed disk\r rgName='yourResourceGroup'\r \r #Name of your managed disk\r diskName='yourManagedDiskName'\r \r #Premium capable size \r #Required only if converting from standard to premium\r size='Standard_DS2_v2'\r \r #Choose between Standard_LRS and Premium_LRS based on your scenario\r sku='Premium_LRS'\r \r #Get the parent VM Id \r vmId=$(az disk show --name $diskName --resource-group $rgName --query managedBy --output tsv)\r \r #Deallocate the VM before changing the size of the VM\r az vm deallocate --ids $vmId \r \r #Change the VM size to a size that supports premium storage \r #Skip this step if converting storage from premium to standard\r az vm resize --ids $vmId --size $size\r \r # Update the sku\r az disk update --sku $sku --name $diskName --resource-group $rgName \r \r az vm start --ids $vmId \r ```\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 使用[快照](snapshot-copy-managed-disk.md)获取 VM 的只读副本。\r \r <!-- Update_Description: update meta properties, update link -->"}