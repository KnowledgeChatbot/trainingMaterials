{"Title":"人脸 API JavaScript 快速入门","Description":"获取信息和代码示例，帮助自己快速开始使用认知服务中的人脸 API 和 JavaScript。","Content":"# <a name=\"face-api-javascript-quick-starts\"></a>人脸 API JavaScript 快速入门\r \r 本文提供信息和代码示例来帮助读者快速开始使用人脸 API 和 JavaScript 来完成以下任务： \r - [检测图像中的人脸](#Detect) \r - [识别图像中的人脸](#Identify)\r \r 在[此处](../../Computer-vision/Vision-API-How-to-Topics/HowToSubscribe.md)详细了解如何获取免费订阅密钥\r \r ## 使用人脸 API 通过 JavaScript 检测图像中的人脸 <a name=\"Detect\"> </a>\r \r 使用[“人脸 - 检测”方法](https://dev.cognitive.azure.cn/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395236)可以检测图像中的人脸，并返回人脸属性，包括：\r - 人脸 ID：在多种人脸 API 方案使用的唯一 ID。 \r - 人脸矩形：左侧坐标、顶部坐标、宽度和高度，指示人脸在图像中的位置。\r - 地标：27 点人脸地标数组，指向人脸组成部分的重要位置。\r - 面部属性包括年龄、性别、笑容强度、头部姿势和面部毛发。 \r \r #### <a name=\"face-detect-javascript-example-request\"></a>人脸检测 JavaScript 示例请求\r \r 若要运行示例，请执行以下步骤：\r \r 1. 复制以下内容并将其保存到某个文件，例如 `detectFaces.html`。\r 1. 将 `subscriptionKey` 值替换为有效的订阅密钥。\r 1. 更改 `uriBase` 值以使用订阅密钥的获取位置。\r 1. 将此文件拖放到浏览器中。\r 1. 单击 `Analyze faces` 按钮。\r \r ```html \r <!DOCTYPE html>\r <html>\r <head>\r     <title>Detect Faces Sample</title>\r     <script src=\"http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js\"></script>\r </head>\r <body>\r \r <script type=\"text/javascript\">\r     function processImage() {\r         // **********************************************\r         // *** Update or verify the following values. ***\r         // **********************************************\r \r         // Replace the subscriptionKey string value with your valid subscription key.\r         var subscriptionKey = \"13hc77781f7e4b19b5fcdd72a8df7156\";\r \r         var uriBase = \"https://api.cognitive.azure.cn/face/v1.0/detect\";\r \r         // Request parameters.\r         var params = {\r             \"returnFaceId\": \"true\",\r             \"returnFaceLandmarks\": \"false\",\r             \"returnFaceAttributes\": \"age,gender,headPose,smile,facialHair,glasses,emotion,hair,makeup,occlusion,accessories,blur,exposure,noise\",\r         };\r \r         // Display the image.\r         var sourceImageUrl = document.getElementById(\"inputImage\").value;\r         document.querySelector(\"#sourceImage\").src = sourceImageUrl;\r \r         // Perform the REST API call.\r         $.ajax({\r             url: uriBase + \"?\" + $.param(params),\r             \r             // Request headers.\r             beforeSend: function(xhrObj){\r                 xhrObj.setRequestHeader(\"Content-Type\",\"application/json\");\r                 xhrObj.setRequestHeader(\"Ocp-Apim-Subscription-Key\", subscriptionKey);\r             },\r             \r             type: \"POST\",\r             \r             // Request body.\r             data: '{\"url\": ' + '\"' + sourceImageUrl + '\"}',\r         })\r         \r         .done(function(data) {\r             // Show formatted JSON on webpage.\r             $(\"#responseTextArea\").val(JSON.stringify(data, null, 2));\r         })\r         \r         .fail(function(jqXHR, textStatus, errorThrown) {\r             // Display error message.\r             var errorString = (errorThrown === \"\") ? \"Error. \" : errorThrown + \" (\" + jqXHR.status + \"): \";\r             errorString += (jqXHR.responseText === \"\") ? \"\" : (jQuery.parseJSON(jqXHR.responseText).message) ? \r                 jQuery.parseJSON(jqXHR.responseText).message : jQuery.parseJSON(jqXHR.responseText).error.message;\r             alert(errorString);\r         });\r     };\r </script>\r \r <h1>Detect Faces:</h1>\r Enter the URL to an image that includes a face or faces, then click the <strong>Analyze face</strong> button.\r <br><br>\r Image to analyze: <input type=\"text\" name=\"inputImage\" id=\"inputImage\" value=\"https://upload.wikimedia.org/wikipedia/commons/c/c3/RH_Louise_Lillian_Gish.jpg\" />\r <button onclick=\"processImage()\">Analyze face</button>\r <br><br>\r <div id=\"wrapper\" style=\"width:1020px; display:table;\">\r     <div id=\"jsonOutput\" style=\"width:600px; display:table-cell;\">\r         Response:\r         <br><br>\r         <textarea id=\"responseTextArea\" class=\"UIInput\" style=\"width:580px; height:400px;\"></textarea>\r     </div>\r     <div id=\"imageDiv\" style=\"width:420px; display:table-cell;\">\r         Source image:\r         <br><br>\r         <img id=\"sourceImage\" width=\"400\" />\r     </div>\r </div>\r </body>\r </html>\r ```\r \r #### <a name=\"face-detect-response\"></a>人脸检测响应\r \r 成功响应将以 JSON 格式返回。 下面是成功响应的示例： \r \r ```json\r [\r   {\r     \"faceId\": \"49d55c17-e018-4a42-ba7b-8cbbdfae7c6f\",\r     \"faceRectangle\": {\r       \"top\": 131,\r       \"left\": 177,\r       \"width\": 162,\r       \"height\": 162\r     },\r     \"faceAttributes\": {\r       \"smile\": 0,\r       \"headPose\": {\r         \"pitch\": 0,\r         \"roll\": 0.1,\r         \"yaw\": -32.9\r       },\r       \"gender\": \"female\",\r       \"age\": 22.9,\r       \"facialHair\": {\r         \"moustache\": 0,\r         \"beard\": 0,\r         \"sideburns\": 0\r       },\r       \"glasses\": \"NoGlasses\",\r       \"emotion\": {\r         \"anger\": 0,\r         \"contempt\": 0,\r         \"disgust\": 0,\r         \"fear\": 0,\r         \"happiness\": 0,\r         \"neutral\": 0.986,\r         \"sadness\": 0.009,\r         \"surprise\": 0.005\r       },\r       \"blur\": {\r         \"blurLevel\": \"low\",\r         \"value\": 0.06\r       },\r       \"exposure\": {\r         \"exposureLevel\": \"goodExposure\",\r         \"value\": 0.67\r       },\r       \"noise\": {\r         \"noiseLevel\": \"low\",\r         \"value\": 0\r       },\r       \"makeup\": {\r         \"eyeMakeup\": true,\r         \"lipMakeup\": true\r       },\r       \"accessories\": [],\r       \"occlusion\": {\r         \"foreheadOccluded\": false,\r         \"eyeOccluded\": false,\r         \"mouthOccluded\": false\r       },\r       \"hair\": {\r         \"bald\": 0,\r         \"invisible\": false,\r         \"hairColor\": [\r           {\r             \"color\": \"brown\",\r             \"confidence\": 1\r           },\r           {\r             \"color\": \"black\",\r             \"confidence\": 0.87\r           },\r           {\r             \"color\": \"other\",\r             \"confidence\": 0.51\r           },\r           {\r             \"color\": \"blond\",\r             \"confidence\": 0.08\r           },\r           {\r             \"color\": \"red\",\r             \"confidence\": 0.08\r           },\r           {\r             \"color\": \"gray\",\r             \"confidence\": 0.02\r           }\r         ]\r       }\r     }\r   }\r ]\r ```\r \r ## 使用人脸 API 通过 JavaScript 识别图像中的人脸 <a name=\"Identify\"> </a>\r \r 复制以下内容并将其保存到某个文件，例如 `test.html`。 更改 `url` 以使用订阅密钥的获取位置，将“Ocp-Apim-Subscription-Key”值替换为有效的订阅密钥，并添加请求正文。 若要运行示例，请将此文件拖放到浏览器中。\r \r 使用[“人脸 - 识别”方法](https://dev.cognitive.azure.cn/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395239)可以根据检测到的人脸和人员数据库（定义为人员组，需提前创建，并可在不同的时间进行编辑）识别人员\r \r #### <a name=\"face-identify-javascript-example-request\"></a>人脸识别 JavaScript 示例请求\r \r ```html\r <!DOCTYPE html>\r <html>\r <head>\r     <title>JSSample</title>\r     <script src=\"http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js\"></script>\r </head>\r <body>\r \r <script type=\"text/javascript\">\r     $(function() {\r         var params = {\r             // Request parameters\r         };\r       \r         $.ajax({\r             url: \"https://api.cognitive.azure.cn/face/v1.0/identify?\" + $.param(params),\r             beforeSend: function(xhrObj){\r                 // Request headers\r                 xhrObj.setRequestHeader(\"Content-Type\",\"application/json\");\r \r                 // NOTE: Replace the \"Ocp-Apim-Subscription-Key\" value with a valid subscription key.\r                 xhrObj.setRequestHeader(\"Ocp-Apim-Subscription-Key\",\"13hc77781f7e4b19b5fcdd72a8df7156\");\r             },\r             type: \"POST\",\r             // Request body\r             data: \"{body}\",\r         })\r         .done(function(data) {\r             alert(\"success\");\r         })\r         .fail(function() {\r             alert(\"error\");\r         });\r     });\r </script>\r </body>\r </html>\r \r ```\r \r #### <a name=\"face-identify-response\"></a>人脸识别响应\r \r 成功响应将以 JSON 格式返回。 下面是成功响应的示例： \r \r ```json\r [\r     {\r         \"faceId\":\"c5c24a82-6845-4031-9d5d-978df9175426\",\r         \"candidates\":[\r             {\r                 \"personId\":\"25985303-c537-4467-b41d-bdb45cd95ca1\",\r                 \"confidence\":0.92\r             }\r         ]\r     },\r     {\r         \"faceId\":\"65d083d4-9447-47d1-af30-b626144bf0fb\",\r         \"candidates\":[\r             {\r                 \"personId\":\"2ae4935b-9659-44c3-977f-61fac20d0538\",\r                 \"confidence\":0.89\r             }\r         ]\r     }\r ]\r ```\r \r "}