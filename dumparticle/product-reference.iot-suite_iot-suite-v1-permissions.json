{"Title":"Azure IoT 套件和 Azure Active Directory","Description":"介绍 Azure IoT 套件如何使用 Azure Active Directory 管理权限。","Content":"# <a name=\"permissions-on-the-azureiotsuitecn-site\"></a>azureiotsuite.cn 站点权限\r \r ## <a name=\"what-happens-when-you-sign-in\"></a>登录时发生的情况\r \r 在 [azureiotsuite.cn][lnk-azureiotsuite] 上首次登录时，站点会基于当前所选 Azure Active Directory (AAD) 租户和 Azure 订阅来确定所拥有的权限级别。\r \r 1. 首先，为了填充用户名旁边显示的租户列表，该站点会从 Azure 中找到用户所属的 AAD 租户。 当前，该站点一次只能获取一个租户的用户令牌。 因此，当用户使用右上角的下拉列表切换租户时，该站点会将用户登录到该租户，以获取该租户的令牌。\r \r 2. 接下来，站点从 Azure 查明你所具有的与所选租户关联的订阅。 创建新的预配置解决方案时，会看到可用订阅。\r \r 3. 最后，站点检索标记为预配置解决方案的订阅和资源组中的所有资源，并填充主页上的磁贴。\r \r 下列各部分介绍用于控制对预配置解决方案的访问的角色。\r \r ## <a name=\"aad-roles\"></a>AAD 角色\r \r AAD 角色可控制设置预配置解决方案以及在预配置解决方案中管理用户的能力。\r \r 有关 AAD 中的管理员角色的详细信息，请参阅 [在 Azure AD 中分配管理员角色][lnk-aad-admin]。 本文重点介绍预配置解决方案使用的**全局管理员**和**用户**目录角色。\r \r ### <a name=\"global-administrator\"></a>全局管理员\r \r 对于每个 AAD 租户，可以存在许多个全局管理员。\r \r * 在创建某个 AAD 租户时，默认情况下会成为该租户的全局管理员。\r * 全局管理员可以预配预配置解决方案，并被分配了其 AAD 租户中应用程序的**管理员**角色。\r * 如果同一 AAD 租户中的其他用户创建应用程序，则向全局管理员授予的默认角色是**只读**。\r * 全局管理员可以使用 [Azure 门户][lnk-portal]为用户分配应用程序角色。\r \r ### <a name=\"domain-user\"></a>域用户\r \r 每个 AAD 租户可以有多个域用户。\r \r * 域用户可以通过 [azureiotsuite.cn][lnk-azureiotsuite] 站点设置预配置解决方案。 默认情况下，会向域用户授予预配应用程序中的**管理员**角色。\r * 域用户可使用 [azure-iot-remote-monitoring][lnk-rm-github-repo] 或 [azure-iot-predictive-maintenance][lnk-pm-github-repo]存储库中的 build.cmd 脚本创建应用程序。 但是，向域用户授予的默认角色为“只读”，这是因为域用户没有分配角色的权限。\r * 如果 AAD 租户中的其他用户创建了应用程序，则默认情况下，会向域用户分配该应用程序的**只读**角色。\r * 域用户无法为应用程序分配角色；因此域用户无法为应用程序添加用户或用户的角色（即使是他们预配的应用程序）。\r \r ### <a name=\"guest-user\"></a>来宾用户\r \r 每个 AAD 租户可以有多个来宾用户。 来宾用户在 AAD 租户中拥有有限的权利集。 因此，来宾用户无法在 AAD 租户中设置预配置解决方案。\r \r 有关 AAD 中的用户和角色的详细信息，请参阅以下资源：\r \r * [在 Azure AD 中创建用户][lnk-create-edit-users]\r \r \r ## <a name=\"azure-subscription-administrator-roles\"></a>Azure 订阅管理员角色\r \r Azure 管理员角色可控制将 Azure 订阅映射到 AD 租户的能力。\r \r \r ## <a name=\"application-roles\"></a>应用程序角色\r \r 应用程序角色可在预配置解决方案中控制对设备的访问。\r \r 预配解决方案中定义了两个明确的角色和一个隐式角色：\r \r * **管理员：**具有添加、管理、删除设备和修改设置的完全控制权限。\r * **只读：**可以查看设备、规则、操作、作业和遥测数据。\r \r 可以在 [RolePermissions.cs][lnk-resource-cs] 源文件中找到分配给每个角色的权限。\r \r ### <a name=\"changing-application-roles-for-a-user\"></a>更改用户的应用程序角色\r \r 可以使用下面的过程在 Active Directory 中使用户成为预配置解决方案的管理员。\r \r 必须是 AAD 全局管理员才能更改用户的角色：\r \r 1. 转到 [Azure 门户][lnk-portal]。\r 2. 选择“Azure Active Directory” 。\r 3. 请确保使用的是预配解决方案时在 azureiotsuite.cn 上选择的目录。 如果有多个目录与订阅关联，单击门户右上角的帐户名称，可以在这些目录之间进行切换。\r 4. 依次单击“企业应用程序”、“所有应用程序”。\r 4. 显示具有**任何**状态的**所有应用程序**。 然后搜索具有预配置解决方案名称的应用程序。\r 5. 单击与预配置解决方案名称匹配的应用程序名称。\r 6. 单击“用户和组”。\r 7. 选择要切换角色的用户。\r 8. 单击“分配”并选择要分配给用户的角色（如“管理员”），单击复选标记。\r \r ## <a name=\"faq\"></a>常见问题\r \r ### <a name=\"im-a-service-administrator-and-id-like-to-change-the-directory-mapping-between-my-subscription-and-a-specific-aad-tenant-how-do-i-complete-this-task\"></a>我是服务管理员，要更改我的订阅与特定 AAD 租户之间的目录映射。 如何完成此任务？\r \r 请参阅[如何将现有订阅添加到 Azure AD 目录](../active-directory/active-directory-how-subscriptions-associated-directory.md#how-to-add-an-azure-subscription-to-azure-active-directory)。\r \r ### <a name=\"im-a-domain-usermember-on-the-aad-tenant-and-ive-created-a-preconfigured-solution-how-do-i-get-assigned-a-role-for-my-application\"></a>我是 AAD 租户上的域用户/成员，我创建了一个预配置解决方案。 如何针对我的应用程序向我分配角色？\r \r 请全局管理员将你分配为 AAD 租户中的全局管理员，然后自行将角色分配给用户。 或者，请全局管理员直接向你分配角色。 如果要更改预配置解决方案部署到的 AAD 租户，请参阅下一个问题。\r \r ### <a name=\"how-do-i-switch-the-aad-tenant-my-remote-monitoring-preconfigured-solution-and-application-are-assigned-to\"></a>如何切换将我的远程监控预配置解决方案和应用程序分配到的 AAD 租户？\r \r 可以从 <https://github.com/Azure/azure-iot-remote-monitoring> 中运行云部署，并使用新创建的 AAD 租户重新部署。 默认情况下，你在创建 AAD 租户时会成为全局管理员，因此拥有添加用户以及向这些用户分配角色的权限。\r \r 1. 在 [Azure 门户][lnk-portal]中创建 AAD 目录。\r 2. 转到 <https://github.com/Azure/azure-iot-remote-monitoring>。\r 3. 运行 `build.cmd cloud [debug | release] {name of previously deployed remote monitoring solution}`（例如 `build.cmd cloud debug myRMSolution`）\r 4. 出现提示时，将 **tenantid** 设置为新创建的租户，而不是以前的租户。\r \r \r ### <a name=\"why-am-i-seeing-this-error-your-account-does-not-have-the-proper-permissions-to-create-a-solution-please-check-with-your-account-administrator-or-try-with-a-different-account\"></a>为何会出现以下错误？ “你的帐户没有创建解决方案的正确权限。 请咨询帐户管理员或使用其他帐户进行尝试。”\r \r 请查看以下指南示意图：\r \r ![][img-flowchart]\r \r > [!NOTE]\r > 如果在验证你是 AAD 租户的全局管理员和订阅的共同管理员后，仍看到此错误，请让帐户管理员删除该用户，并按以下顺序重新分配必要的权限。 首先，将用户添加为全局管理员，然后将用户添加为 Azure 订阅的协同管理员。 如果问题仍然存在，请联系[帮助和支持][lnk-help-support]。\r >\r >\r \r ### <a name=\"why-am-i-seeing-this-error-when-i-have-an-azure-subscription-an-azure-subscription-is-required-to-create-pre-configured-solutions-you-can-create-a-free-trial-account-in-just-a-couple-of-minutes\"></a>为何在我具有 Azure 订阅时会出现以下错误？ “创建预配置解决方案需要 Azure 订阅。 只需几分钟即可创建一个试用帐户。”\r \r 如果确定具有 Azure 订阅，请验证订阅的租户映射，并确保在下拉列表中选择正确租户。 如果验证了所需租户是正确的，请按照上图，验证订阅和此 AAD 租户的映射。\r \r ## <a name=\"next-steps\"></a>后续步骤\r 若要继续了解 IoT 套件，请参阅如何 [自定义预配置解决方案][lnk-customize]。\r \r [img-flowchart]: media/iot-suite-v1-permissions/flowchart.png\r \r [lnk-azureiotsuite]: https://www.azureiotsuite.cn/\r [lnk-rm-github-repo]: https://github.com/Azure/azure-iot-remote-monitoring\r [lnk-pm-github-repo]: https://github.com/Azure/azure-iot-predictive-maintenance\r [lnk-aad-admin]: ../active-directory/active-directory-assign-admin-roles.md\r [lnk-portal]: https://portal.azure.cn/\r [lnk-create-edit-users]: ../active-directory/active-directory-create-users.md\r [lnk-resource-cs]: https://github.com/Azure/azure-iot-remote-monitoring/blob/master/DeviceAdministration/Web/Security/RolePermissions.cs\r [lnk-help-support]: https://portal.azure.cn/#blade/Microsoft_Azure_Support/HelpAndSupportBlade\r [lnk-customize]: iot-suite-v1-guidance-on-customizing-preconfigured-solutions.md\r "}