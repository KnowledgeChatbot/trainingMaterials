{"Title":"Azure SQL 数据仓库备份 - 快照、异地冗余","Description":"了解 SQL 数据仓库的内置数据库备份，该功能可以将 Azure SQL 数据仓库还原到某个还原点或另一地理区域。","Content":"# <a name=\"backup-and-restore-in-sql-data-warehouse\"></a>SQL 数据仓库中的备份和还原\r 本文介绍了在 SQL 数据仓库中进行备份的细节。 使用数据仓库备份，将数据库快照还原到主要区域，或将异地备份还原到异地配对区域。 \r \r ## <a name=\"what-is-a-data-warehouse-backup\"></a>什么是数据仓库备份？\r 数据仓库备份是可用于还原数据仓库的数据库的副本。  由于 SQL 数据仓库属于分布式系统，因此数据仓库备份包含许多位于 Azure 存储中的文件。 数据仓库备份包括本地数据库快照、所有数据库的异地备份以及与数据仓库关联的文件。 \r \r ## <a name=\"local-snapshot-backups\"></a>本地快照备份\r SQL 数据仓库全天对数据仓库捕获快照。 快照的可用期为七天。 SQL 数据仓库支持八小时恢复点目标 (RPO)。 可将主要区域中的数据仓库还原至过去七天内所捕获的任意快照中。\r \r 若要查看上一个快照的启动时间，可对联机 SQL 数据仓库运行以下查询。 \r \r ```sql\r select top 1 *\r from sys.pdw_loader_backup_runs \r order by run_id desc;\r ```\r \r ## <a name=\"geo-backups\"></a>异地备份\r SQL 数据仓库每天执行一次异地备份，将内容备份到配对的数据中心。 异地还原的 RPO 为 24 小时。 可将异地备份还原至异地配对区域中的服务器。 异地备份可确保用户能够在无法访问主要区域中的快照的情况下还原数据仓库。\r <!-- Not Available on (../best-practices-availability-paired-regions.md) -->\r \r 默认情况下，异地备份处于启用状态。 如果数据仓库已进行弹性优化，则可按需[选择退出](https://docs.microsoft.com/powershell/resourcemanager/Azurerm.sql/v2.1.0/Set-AzureRmSqlDatabaseGeoBackupPolicyredirectedfrom=msdn)。 如果对计算性能层进行了优化，则无法选择退出异地备份。\r \r ## <a name=\"backup-costs\"></a>备份成本\r Azure 帐单上将列出 Azure 高级存储的明细项目以及异地冗余存储的明细项目。 高级存储费用是指在主要区域中存储数据（包括快照）的总费用。  异地冗余费用是指存储异地备份的费用。  \r \r 主数据仓库和 7 天 Azure Blob 快照的总费用按最接近的 TB 数进行计算。 例如，如果数据仓库为 1.5 TB，快照使用了 100 GB，则会按 2 TB 的数据以 Azure 高级存储费率计费。 \r \r > [!NOTE]\r > 每个快照最初是空的，随着用户对主数据仓库的更改而增大。 所有快照的大小都随数据仓库的更改而增加。 因此，快照的存储费用也会随因更改而导致的费率变化而增加。\r > \r > \r \r 如果使用的是异地冗余存储，则会单独收取异地存储费。 异地冗余存储按标准的读取访问异地冗余存储 (RA-GRS) 费率计费。\r \r 有关 SQL 数据仓库定价的详细信息，请参阅 [SQL 数据仓库定价](https://www.azure.cn/pricing/details/sql-data-warehouse/)。\r \r ## <a name=\"snapshot-retention-when-a-data-warehouse-is-paused\"></a>数据仓库被暂停时的快照保留期\r 暂停数据仓库时，SQL 数据仓库不会创建快照，也不会让快照过期。 暂停数据仓库时，快照年龄不变。 快照保留期取决于数据仓库处于联机状态的天数，而不是日历日期。\r \r 例如，如果快照的启动时间是 10 月 1 日下午 4 点，而数据仓库在 10 月 3 日下午 4 点暂停，则快照的保留期最多为 2 天。 不管数据仓库何时回到联机状态，快照的保留期始终为 2 天。 如果数据仓库在 10 月 5 日下午 4 点回到联机状态，则快照的年龄为 2 天，还剩 5 天过期。\r \r 当数据仓库回到联机状态以后，SQL 数据仓库将继续创建新的快照，并且会让其数据年龄超过 7 天的快照过期。\r \r ## <a name=\"can-i-restore-a-dropped-data-warehouse\"></a>可以还原已删除的数据仓库吗？\r 删除数据仓库时，SQL 数据仓库将创建一个最终快照并保存七天。 可以将数据仓库还原至删除时所创建的最终还原点。 \r \r > [!IMPORTANT]\r > 如果删除某个逻辑 SQL Server 实例，则属于该实例的所有数据库也会删除，且无法恢复。 无法还原已删除的服务器。\r > \r \r ## <a name=\"next-steps\"></a>后续步骤\r 若要还原 SQL 数据仓库，请参阅[还原 SQL 数据仓库](sql-data-warehouse-restore-database-overview.md)。\r \r 有关业务连续性概述，请参阅[业务连续性概述](../sql-database/sql-database-business-continuity.md)\r \r <!--Update_Description: wording update, add content of Snapshot retention when a data warehouse is paused, add content of restore a dropped data warehouse -->"}