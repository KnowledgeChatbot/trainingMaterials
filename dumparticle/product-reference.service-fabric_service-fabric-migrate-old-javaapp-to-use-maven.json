{"Title":"从 Java SDK 迁移到 Maven - 更新旧的 Azure Service Fabric Java 应用程序以使用 Maven","Description":"更新曾使用 Service Fabric Java SDK 的旧式 Java 应用程序，以便从 Maven 提取 Service Fabric Java 依赖项。 完成此设置以后，即可生成旧式 Java 应用程序。","Content":"# <a name=\"update-your-previous-java-service-fabric-application-to-fetch-java-libraries-from-maven\"></a>更新旧式 Java Service Fabric 应用程序，以便从 Maven 提取 Java 库\r 我们最近已将 Service Fabric Java 二进制文件从 Service Fabric Java SDK 移至 Maven 托管。 现在，你可以使用 mavencentral 来提取最新的 Service Fabric Java 依赖项。 本快速入门介绍如何更新现有的 Java 应用程序（此前使用 Yeoman 模板或 Eclipse 创建，可与 Service Fabric Java SDK 配合使用），使之与基于 Maven 的版本兼容。\r \r ## <a name=\"prerequisites\"></a>先决条件\r 1. 首先需卸载现有的 Java SDK。\r \r     ```bash\r     sudo dpkg -r servicefabricsdkjava\r     ```\r 2. 按照[此处](service-fabric-cli.md)提到的步骤安装最新的 Service Fabric CLI。\r \r 3. 若要生成和使用 Service Fabric Java 应用程序，需确保已安装 JDK 1.8 和 Gradle。 如果尚未安装，可运行以下命令来安装 JDK 1.8 (openjdk-8-jdk) 和 Gradle：\r \r     ```bash\r     sudo apt-get install openjdk-8-jdk-headless\r     sudo apt-get install gradle\r     ```\r 4. 按照[此处](service-fabric-application-lifecycle-sfctl.md)提到的步骤，更新应用程序的安装/卸载脚本，以便使用新的 Service Fabric CLI。 可以参考入门[示例](https://github.com/Azure-Samples/service-fabric-java-getting-started)。\r \r >[!TIP]\r > 卸载 Service Fabric Java SDK 后，Yeoman 将无法使用。 请遵循[此处](service-fabric-create-your-first-linux-application-with-java.md)提到的先决条件，以便启动和运行 Service Fabric Yeoman Java 模板生成器。\r \r ## <a name=\"service-fabric-java-libraries-on-maven\"></a>Maven 上的 Service Fabric Java 库\r Service Fabric Java 库已托管在 Maven 中。 可以在项目的 ``pom.xml`` 或 ``build.gradle`` 中添加依赖项，以便使用 mavenCentral 提供的 Service Fabric Java 库。\r \r ### <a name=\"actors\"></a>执行组件\r \r 针对应用程序的 Service Fabric Reliable Actor 支持。\r \r   ```XML\r   <dependency>\r       <groupId>com.microsoft.servicefabric</groupId>\r       <artifactId>sf-actors-preview</artifactId>\r       <version>0.10.0</version>\r   </dependency>\r   ```\r \r   ```gradle\r   repositories {\r       mavenCentral()\r   }\r   dependencies {\r       compile 'com.microsoft.servicefabric:sf-actors-preview:0.10.0'\r   }\r   ```\r \r ### <a name=\"services\"></a>服务\r \r 针对应用程序的 Service Fabric 无状态服务支持。\r \r   ```XML\r   <dependency>\r       <groupId>com.microsoft.servicefabric</groupId>\r       <artifactId>sf-services-preview</artifactId>\r       <version>0.10.0</version>\r   </dependency>\r   ```\r \r   ```gradle\r   repositories {\r       mavenCentral()\r   }\r   dependencies {\r       compile 'com.microsoft.servicefabric:sf-services-preview:0.10.0'\r   }\r   ```\r \r ### <a name=\"others\"></a>其他\r #### <a name=\"transport\"></a>传输\r \r 针对 Service Fabric Java 应用程序的传输层支持。 不需向 Reliable Actor 或 Service 应用程序显式添加此依赖项，除非在传输层编程。\r \r   ```XML\r   <dependency>\r       <groupId>com.microsoft.servicefabric</groupId>\r       <artifactId>sf-transport-preview</artifactId>\r       <version>0.10.0</version>\r   </dependency>\r   ```\r \r   ```gradle\r   repositories {\r       mavenCentral()\r   }\r   dependencies {\r       compile 'com.microsoft.servicefabric:sf-transport-preview:0.10.0'\r   }\r   ```\r \r #### <a name=\"fabric-support\"></a>Fabric 支持\r \r 针对 Service Fabric（与本机 Service Fabric 运行时通信）的系统级支持。 不需向 Reliable Actor 或 Service 应用程序显式添加此依赖项。 当你包括上述其他依赖项时，会自动从 Maven 提取此依赖项。\r \r   ```XML\r   <dependency>\r       <groupId>com.microsoft.servicefabric</groupId>\r       <artifactId>sf-preview</artifactId>\r       <version>0.10.0</version>\r   </dependency>\r   ```\r \r   ```gradle\r   repositories {\r       mavenCentral()\r   }\r   dependencies {\r       compile 'com.microsoft.servicefabric:sf-preview:0.10.0'\r   }\r   ```\r \r ## <a name=\"migrating-service-fabric-stateless-service\"></a>迁移 Service Fabric 无状态服务\r \r 若要使用从 Maven 提取的 Service Fabric 依赖项生成现有的 Service Fabric 无状态 Java 服务，需更新该服务中的 ``build.gradle`` 文件。 以前，该文件如下所示：\r ```\r dependencies {\r     compile fileTree(dir: '/opt/microsoft/sdk/servicefabric/java/packages/lib', include: ['*.jar'])\r     compile project(':Interface')\r }\r .\r .\r .\r jar {\r     manifest {\r     attributes(\r                 'Main-Class': 'statelessservice.MyStatelessServiceHost',\r                 \"Class-Path\": configurations.compile.collect { 'lib/' + it.getName() }.join(' '))\r     baseName \"MyStateless\"\r     destinationDir = file('./../MyStatelessApplication/MyStatelessPkg/Code')\r }\r .\r .\r .\r task copyDeps <<{\r     copy {\r         from(\"/opt/microsoft/sdk/servicefabric/java/packages/lib\")\r         into(\"./../MyStatelessApplication/MyStatelessPkg/Code/lib\")\r         include('*.jar')\r     }\r     copy {\r         from(\"/opt/microsoft/sdk/servicefabric/java/packages/lib\")\r         into(\"./../MyStatelessApplication/MyStatelessPkg/Code/lib\")\r         include('libj*.so')\r     }\r }\r ```\r 现在，若要从 Maven 提取依赖项，更新的 ``build.gradle`` 需包含如下所示的相应部分：\r ```\r repositories {\r         mavenCentral()\r }\r \r configurations {\r     azuresf\r }\r \r dependencies {\r     compile project(':Interface')\r     azuresf ('com.microsoft.servicefabric:sf-services-preview:0.10.0')\r     compile fileTree(dir: 'lib', include: '*.jar')\r }\r \r task explodeDeps(type: Copy, dependsOn:configurations.azuresf) { task ->\r     configurations.azuresf.filter { it.toString().contains(\"native-preview\") }.each{\r         from zipTree(it)\r     }\r     configurations.azuresf.filter { !it.toString().contains(\"native-preview\") }.each {\r         from it\r     }\r     into \"lib\"\r     include \"libj*.so\", \"*.jar\"\r }\r \r compileJava.dependsOn(explodeDeps)\r .\r .\r .\r jar {\r     manifest {\r         def mpath = configurations.compile.collect {'lib/'+it.getName()}.join (' ')\r         mpath = mpath + ' ' + configurations.azuresf.collect {'lib/'+it.getName()}.join (' ')\r         attributes(\r                 'Main-Class': 'statelessservice.MyStatelessServiceHost',\r                 \"Class-Path\": mpath)\r     baseName \"MyStateless\"\r     destinationDir = file('./../MyStatelessApplication/MyStatelessPkg/Code')\r    }\r }\r .\r .\r .\r task copyDeps <<{\r     copy {\r         from(\"lib/\")\r         into(\"./../MyStatelessApplication/MyStatelessPkg/Code/lib\")\r         include('*')\r     }\r }\r ```\r 通常情况下，若要粗略地了解 Service Fabric 无状态 Java 服务的生成脚本的情况，可参阅入门示例中提供的任何示例。 这里是适用于 EchoServer 示例的 [build.gradle](https://github.com/Azure-Samples/service-fabric-java-getting-started/blob/master/Services/EchoServer/EchoServer1.0/EchoServerService/build.gradle)。\r \r ## <a name=\"migrating-service-fabric-actor-service\"></a>迁移 Service Fabric Actor 服务\r \r 若要使用从 Maven 提取的 Service Fabric 依赖项生成现有的 Service Fabric Actor Java 应用程序，需更新接口包和服务包中的 ``build.gradle`` 文件。 如果有 TestClient 包，则也需更新该包。 因此，对于执行组件 ``Myactor``，需在以下位置进行更新：\r ```\r ./Myactor/build.gradle\r ./MyactorInterface/build.gradle\r ./MyactorTestClient/build.gradle\r ```\r \r #### <a name=\"updating-build-script-for-the-interface-project\"></a>更新接口项目的生成脚本\r \r 以前，该文件如下所示：\r ```\r dependencies {\r     compile fileTree(dir: '/opt/microsoft/sdk/servicefabric/java/packages/lib', include: ['*.jar'])\r }\r .\r .\r ```\r 现在，若要从 Maven 提取依赖项，更新的 ``build.gradle`` 需包含如下所示的相应部分：\r ```\r repositories {\r     mavenCentral()\r }\r \r configurations {\r     azuresf\r }\r \r dependencies {\r     azuresf ('com.microsoft.servicefabric:sf-actors-preview:0.10.0')\r     compile fileTree(dir: 'lib', include: '*.jar')\r }\r \r task explodeDeps(type: Copy, dependsOn:configurations.azuresf) { task ->\r     configurations.azuresf.filter { it.toString().contains(\"native-preview\") }.each{\r         from zipTree(it)\r     }\r     configurations.azuresf.filter { !it.toString().contains(\"native-preview\") }.each {\r         from it\r     }\r     into \"lib\"\r     include \"libj*.so\", \"*.jar\"\r }\r \r compileJava.dependsOn(explodeDeps)\r .\r .\r ```\r \r #### <a name=\"updating-build-script-for-the-actor-project\"></a>更新执行组件项目的生成脚本\r \r 以前，该文件如下所示：\r ```\r dependencies {\r     compile fileTree(dir: '/opt/microsoft/sdk/servicefabric/java/packages/lib', include: ['*.jar'])\r     compile project(':MyactorInterface')\r }\r .\r .\r .\r jar {\r     manifest {\r     attributes(\r                 'Main-Class': 'reliableactor.MyactorHost',\r                 \"Class-Path\": configurations.compile.collect { 'lib/' + it.getName() }.join(' '))\r       baseName \"myactor\"\r     destinationDir = file('./../myjavaapp/MyactorPkg/Code')\r     }\r }\r .\r .\r .\r task copyDeps<< {\r     copy {\r         from(\"/opt/microsoft/sdk/servicefabric/java/packages/lib\")\r         into(\"./../myjavaapp/MyactorPkg/Code/lib\")\r         include('*.jar')\r     }\r     copy {\r         from(\"/opt/microsoft/sdk/servicefabric/java/packages/lib\")\r         into(\"./../myjavaapp/MyactorPkg/Code/lib\")\r         include('libj*.so')\r     }\r     copy {\r         from(\"../MyactorInterface/out/lib\")\r         into(\"./../myjavaapp/MyactorPkg/Code/lib\")\r         include('*.jar')\r     }\r }\r ```\r 现在，若要从 Maven 提取依赖项，更新的 ``build.gradle`` 需包含如下所示的相应部分：\r ```\r repositories {\r     mavenCentral()\r }\r \r configurations {\r     azuresf\r }\r \r dependencies {\r     compile project(':MyactorInterface')\r     azuresf ('com.microsoft.servicefabric:sf-actors-preview:0.10.0')\r     compile fileTree(dir: 'lib', include: '*.jar')\r }\r \r task explodeDeps(type: Copy, dependsOn:configurations.azuresf) { task ->\r     configurations.azuresf.filter { it.toString().contains(\"native-preview\") }.each{\r         from zipTree(it)\r     }\r     configurations.azuresf.filter { !it.toString().contains(\"native-preview\") }.each {\r         from it\r     }\r     into \"lib\"\r     include \"libj*.so\", \"*.jar\"\r }\r \r compileJava.dependsOn(explodeDeps)\r .\r .\r .\r jar {\r     manifest {\r         def mpath = configurations.compile.collect {'lib/'+it.getName()}.join (' ')\r         mpath = mpath + ' ' + configurations.azuresf.collect {'lib/'+it.getName()}.join (' ')\r         attributes(\r                 'Main-Class': 'reliableactor.MyactorHost',\r                 \"Class-Path\": mpath)\r     baseName \"myactor\"\r     destinationDir = file('../myjavaapp/MyactorPkg/Code')}\r  }\r .\r .\r .\r task copyDeps<< {\r       copy {\r               from(\"lib/\")\r               into(\"../myjavaapp/MyactorPkg/Code/lib\")\r               include('*')\r       }\r       copy {\r               from(\"../MyactorInterface/out/lib\")\r               into(\"../myjavaapp/MyactorPkg/Code/lib\")\r               include('*.jar')\r       }\r }\r ```\r \r #### <a name=\"updating-build-script-for-the-test-client-project\"></a>更新测试客户端项目的生成脚本\r \r 此处的更改类似于在上一部分（即执行组件项目）中讨论的更改。 以前，Gradle 脚本如下所示：\r ```\r dependencies {\r     compile fileTree(dir: '/opt/microsoft/sdk/servicefabric/java/packages/lib', include: ['*.jar'])\r       compile project(':MyactorInterface')\r }\r .\r .\r .\r jar\r {\r     manifest {\r     attributes(\r         'Main-Class': 'reliableactor.test.MyactorTestClient',\r         \"Class-Path\": configurations.compile.collect { 'lib/' + it.getName() }.join(' '))\r     }\r     baseName \"myactor-test\"\r   destinationDir = file('out/lib')\r }\r .\r .\r .\r task copyDeps<< {\r         copy {\r                 from(\"/opt/microsoft/sdk/servicefabric/java/packages/lib\")\r                 into(\"./out/lib/lib\")\r                 include('*.jar')\r         }\r         copy {\r                 from(\"/opt/microsoft/sdk/servicefabric/java/packages/lib\")\r                 into(\"./out/lib/lib\")\r                 include('libj*.so')\r         }\r         copy {\r                 from(\"../MyactorInterface/out/lib\")\r                 into(\"./out/lib/lib\")\r                 include('*.jar')\r         }\r }\r ```\r 现在，若要从 Maven 提取依赖项，更新的 ``build.gradle`` 需包含如下所示的相应部分：\r ```\r repositories {\r     mavenCentral()\r }\r \r configurations {\r     azuresf\r }\r \r dependencies {\r     compile project(':MyactorInterface')\r     azuresf ('com.microsoft.servicefabric:sf-actors-preview:0.10.0')\r     compile fileTree(dir: 'lib', include: '*.jar')\r }\r \r task explodeDeps(type: Copy, dependsOn:configurations.azuresf) { task ->\r     configurations.azuresf.filter { it.toString().contains(\"native-preview\") }.each{\r         from zipTree(it)\r     }\r     configurations.azuresf.filter { !it.toString().contains(\"native-preview\") }.each {\r         from it\r     }\r     into \"lib\"\r     include \"libj*.so\", \"*.jar\"\r }\r \r compileJava.dependsOn(explodeDeps)\r .\r .\r .\r jar\r {\r     manifest {\r         def mpath = configurations.compile.collect {'lib/'+it.getName()}.join (' ')\r         mpath = mpath + ' ' + configurations.azuresf.collect {'lib/'+it.getName()}.join (' ')\r     attributes(\r                 'Main-Class': 'reliableactor.test.MyactorTestClient',\r                 \"Class-Path\": mpath)\r     baseName \"myactor-test\"\r     destinationDir = file('./out/lib')\r         }\r }\r .\r .\r .\r task copyDeps<< {\r         copy {\r                 from(\"lib/\")\r                 into(\"./out/lib/lib\")\r                 include('*')\r         }\r         copy {\r                 from(\"../MyactorInterface/out/lib\")\r                 into(\"./out/lib/lib\")\r                 include('*.jar')\r         }\r }\r ```\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r * [使用 Yeoman 在 Linux 上创建和部署第一个 Service Fabric Java 应用程序](service-fabric-create-your-first-linux-application-with-java.md)\r * [使用适用于 Eclipse 的 Service Fabric 插件在 Linux 上创建和部署第一个 Service Fabric Java 应用程序](service-fabric-get-started-eclipse.md)\r * [使用 Service Fabric CLI 与 Service Fabric 群集交互](service-fabric-cli.md)\r \r <!--Update_Description: new articles to migrate old javaapp to maven framework-->"}