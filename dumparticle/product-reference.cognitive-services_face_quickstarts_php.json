{"Title":"人脸 API PHP 快速入门","Description":"获取信息和代码示例，帮助自己快速开始使用认知服务中的人脸 API 和 PHP。","Content":"# <a name=\"face-api-php-quick-starts\"></a>人脸 API PHP 快速入门\r 本文提供信息和代码示例来帮助读者快速开始使用人脸 API 和 PHP 来完成以下任务： \r - [检测图像中的人脸](#Detect) \r - [识别图像中的人脸](#Identify)\r \r 在[此处](../../Computer-vision/Vision-API-How-to-Topics/HowToSubscribe.md)详细了解如何获取免费订阅密钥。\r \r ## 使用人脸 API 通过 PHP 检测图像中的人脸 <a name=\"Detect\"> </a>\r 使用[“人脸 - 检测”方法](https://dev.cognitive.azure.cn/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395236)可以检测图像中的人脸，并返回人脸属性，包括：\r - 人脸 ID：在多种人脸 API 方案使用的唯一 ID。 \r - 人脸矩形：左侧坐标、顶部坐标、宽度和高度，指示人脸在图像中的位置。\r - 地标：27 点人脸地标数组，指向人脸组成部分的重要位置。\r - 面部属性包括年龄、性别、笑容强度、头部姿势和面部毛发。 \r \r #### <a name=\"face-detect-php-example-request\"></a>人脸检测 PHP 示例请求\r \r 更改 REST URL 以使用订阅密钥的获取位置，将正文更改为图像的 URL，并将“Ocp-Apim-Subscription-Key”值替换为有效的订阅密钥。\r \r ```php\r <?php\r // This sample uses the Apache HTTP client from HTTP Components (http://hc.apache.org/httpcomponents-client-ga/)\r require_once 'HTTP/Request2.php';\r \r $request = new Http_Request2('https://api.cognitive.azure.cn/face/v1.0/detect');\r $url = $request->getUrl();\r \r $headers = array(\r     // Request headers\r     'Content-Type' => 'application/json',\r     \r     // NOTE: Replace the \"Ocp-Apim-Subscription-Key\" value with a valid subscription key.\r     'Ocp-Apim-Subscription-Key' => '13hc77781f7e4b19b5fcdd72a8df7156',\r );\r \r $request->setHeader($headers);\r \r $parameters = array(\r     // Request parameters\r     'returnFaceId' => 'true',\r     'returnFaceLandmarks' => 'false',\r     'returnFaceAttributes' => 'age,gender',\r );\r \r $url->setQueryVariables($parameters);\r \r $request->setMethod(HTTP_Request2::METHOD_POST);\r \r // Request body\r $request->setBody('{\"url\": \"http://www.example.com/images/image.jpg\"}');\r \r try\r {\r     $response = $request->send();\r     echo $response->getBody();\r }\r catch (HttpException $ex)\r {\r     echo $ex;\r }\r \r ?>  \r \r ```\r #### <a name=\"face---detect-response\"></a>“人脸 - 检测”响应\r 成功响应将以 JSON 格式返回。 下面是成功响应的示例： \r \r ```json\r [\r     {\r         \"faceId\": \"c5c24a82-6845-4031-9d5d-978df9175426\",\r         \"faceRectangle\": {\r             \"width\": 78,\r             \"height\": 78,\r             \"left\": 394,\r             \"top\": 54\r         },\r         \"faceLandmarks\": {\r             \"pupilLeft\": {\r                 \"x\": 412.7,\r                 \"y\": 78.4 \r             },\r             \"pupilRight\": {\r                 \"x\": 446.8,\r                 \"y\": 74.2 \r             },\r             \"noseTip\": {\r                 \"x\": 437.7,\r                 \"y\": 92.4 \r             },\r             \"mouthLeft\": {\r                 \"x\": 417.8,\r                 \"y\": 114.4 \r             },\r             \"mouthRight\": {\r                 \"x\": 451.3,\r                 \"y\": 109.3 \r             },\r             \"eyebrowLeftOuter\": {\r                 \"x\": 397.9,\r                 \"y\": 78.5 \r             },\r             \"eyebrowLeftInner\": {\r                 \"x\": 425.4,\r                 \"y\": 70.5 \r             },\r             \"eyeLeftOuter\": {\r                 \"x\": 406.7,\r                 \"y\": 80.6 \r             },\r             \"eyeLeftTop\": {\r                 \"x\": 412.2,\r                 \"y\": 76.2 \r             },\r             \"eyeLeftBottom\": {\r                 \"x\": 413.0,\r                 \"y\": 80.1 \r             },\r             \"eyeLeftInner\": {\r                 \"x\": 418.9,\r                 \"y\": 78.0 \r             },\r             \"eyebrowRightInner\": {\r                 \"x\": 4.8,\r                 \"y\": 69.7 \r             },\r             \"eyebrowRightOuter\": {\r                 \"x\": 5.5,\r                 \"y\": 68.5 \r             },\r             \"eyeRightInner\": {\r                 \"x\": 441.5,\r                 \"y\": 75.0 \r             },\r             \"eyeRightTop\": {\r                 \"x\": 446.4,\r                 \"y\": 71.7 \r             },\r             \"eyeRightBottom\": {\r                 \"x\": 447.0,\r                 \"y\": 75.3 \r             },\r             \"eyeRightOuter\": {\r                 \"x\": 451.7,\r                 \"y\": 73.4 \r             },\r             \"noseRootLeft\": {\r                 \"x\": 428.0,\r                 \"y\": 77.1 \r             },\r             \"noseRootRight\": {\r                 \"x\": 435.8,\r                 \"y\": 75.6 \r             },\r             \"noseLeftAlarTop\": {\r                 \"x\": 428.3,\r                 \"y\": 89.7 \r             },\r             \"noseRightAlarTop\": {\r                 \"x\": 442.2,\r                 \"y\": 87.0 \r             },\r             \"noseLeftAlarOutTip\": {\r                 \"x\": 424.3,\r                 \"y\": 96.4 \r             },\r             \"noseRightAlarOutTip\": {\r                 \"x\": 446.6,\r                 \"y\": 92.5 \r             },\r             \"upperLipTop\": {\r                 \"x\": 437.6,\r                 \"y\": 105.9 \r             },\r             \"upperLipBottom\": {\r                 \"x\": 437.6,\r                 \"y\": 108.2 \r             },\r             \"underLipTop\": {\r                 \"x\": 436.8,\r                 \"y\": 111.4 \r             },\r             \"underLipBottom\": {\r                 \"x\": 437.3,\r                 \"y\": 114.5 \r             }\r         },\r         \"faceAttributes\": {\r             \"age\": 71.0,\r             \"gender\": \"male\",\r             \"smile\": 0.88,\r             \"facialHair\": {\r                 \"mustache\": 0.8,\r                 \"beard\": 0.1,\r                 \"sideburns\": 0.02\r             },\r             \"glasses\": \"sunglasses\",\r             \"headPose\": {\r                 \"roll\": 2.1,\r                 \"yaw\": 3,\r                 \"pitch\": 0\r             }\r         }\r     }\r ]\r ```\r ## 使用人脸 API 通过 PHP 识别图像中的人脸 <a name=\"Identify\"> </a>\r 使用[“人脸 - 识别”方法](https://dev.cognitive.azure.cn/docs/services/563879b61984550e40cbbe8d/operations/563879b61984550f30395239)可以根据检测到的人脸和人员数据库（定义为人员组，需提前创建，并可在不同的时间进行编辑）识别人员\r \r #### <a name=\"face---identify-php-example-request\"></a>“人脸 - 识别”PHP 示例请求\r \r 更改 REST URL 以使用订阅密钥的获取位置，将正文更改为图像的 URL，并将“Ocp-Apim-Subscription-Key”值替换为有效的订阅密钥。\r \r ```php\r <?php\r // This sample uses the Apache HTTP client from HTTP Components (http://hc.apache.org/httpcomponents-client-ga/)\r require_once 'HTTP/Request2.php';\r \r $request = new Http_Request2('https://api.cognitive.azure.cn/face/v1.0/identify');\r $url = $request->getUrl();\r \r $headers = array(\r     // Request headers\r     'Content-Type' => 'application/json',\r     \r     // NOTE: Replace the \"Ocp-Apim-Subscription-Key\" value with a valid subscription key.\r     'Ocp-Apim-Subscription-Key' => '13hc77781f7e4b19b5fcdd72a8df7156',\r );\r \r $request->setHeader($headers);\r \r $parameters = array(\r     // Request parameters\r );\r \r $url->setQueryVariables($parameters);\r \r $request->setMethod(HTTP_Request2::METHOD_POST);\r \r // Request body\r $request->setBody(\"{body}\");\r \r try\r {\r     $response = $request->send();\r     echo $response->getBody();\r }\r catch (HttpException $ex)\r {\r     echo $ex;\r }\r \r ?>\r \r ```\r #### <a name=\"face---identify-response\"></a>“人脸 - 识别”响应\r 成功响应将以 JSON 格式返回。 下面是成功响应的示例： \r ```json\r [\r     {\r         \"faceId\":\"c5c24a82-6845-4031-9d5d-978df9175426\",\r         \"candidates\":[\r             {\r                 \"personId\":\"25985303-c537-4467-b41d-bdb45cd95ca1\",\r                 \"confidence\":0.92\r             }\r         ]\r     },\r     {\r         \"faceId\":\"65d083d4-9447-47d1-af30-b626144bf0fb\",\r         \"candidates\":[\r             {\r                 \"personId\":\"2ae4935b-9659-44c3-977f-61fac20d0538\",\r                 \"confidence\":0.89\r             }\r         ]\r     }\r ]\r ```\r \r \r "}