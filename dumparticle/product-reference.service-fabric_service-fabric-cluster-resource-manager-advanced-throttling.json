{"Title":"Service Fabric 群集 Resource Manager 中的限制","Description":"了解如何配置 Service Fabric 群集 Resource Manager 提供的限制。","Content":"# <a name=\"throttling-the-service-fabric-cluster-resource-manager\"></a>限制 Service Fabric 群集资源管理器\r 即使已正确配置了群集资源管理器，群集有时也会中断。 例如，可能同时发生节点和容错域故障 - 升级时如果发生这种情况会怎么样？ 群集资源管理器始终尝试修复所有问题，同时占用群集的资源，尝试重新整理和修复群集。 限制有助于提供一个停止机制，让群集可以使用资源进行稳定 - 节点恢复正常、网络分区修复、部署已更正的部分。\r \r 为帮助应对此类情况，Service Fabric 群集 Resource Manager 提供多种限制。 这些限制都是相当大的约束。 通常未经仔细地规划和测试，不应更改。\r \r 如果更改群集资源管理器的限制，则应将其调整到预期的实际负载。 你可能会需要让某些限制到位，即使这意味着群集需要更长时间才能在一些情况下达到稳定状态。 确定限制的正确值时，需要进行测试。 限制需要足够高，群集才能在合理的时间内对更改做出响应，需要足够低才能实际防止占用过多资源。 \r \r 大多数情况下，我们已了解客户使用限制，因为这些限制已在资源受限环境中。 一些例子包括各个节点中受限制的网络带宽或由于吞吐量限制不能并行生成多个有状态副本的磁盘。 如果没有限制，操作会占用大量的这些资源，导致操作失败或很慢。 在这些情况下，客户使用限制并知道他们正在延长使群集达到稳定状态所需的时间量。 客户还知道，如果受到限制，他们最终会以较低的整体可靠性运行。\r \r ## <a name=\"configuring-the-throttles\"></a>配置限制\r \r Service Fabric 具有两种机制用于限制副本移动数。 Service Fabric 5.7 之前已存在的默认机制将限制以允许移动的绝对数表示。 这并非适用于所有大小的群集。 具体而言，对于大型群集，该默认值太小，均衡速度明显变慢（即使是必需的），但对较小的群集又不起作用。 基于百分比的限制已取代这项旧机制，该机制在服务数和节点数定期更改的动态群集中能够更好地缩放。\r \r 限制是基于群集中副本数的百分比进行的。 例如，利用基于百分比的限制可以表达规则：“不要在 10 分钟时间间隔内移动 10% 以上的副本”。\r \r 基于百分比的限制的配置设置如下：\r \r   - GlobalMovementThrottleThresholdPercentage - 任何时候群集中允许的最大移动数，以群集中副本总数的百分比表示。 0 表示没有限制。 默认值为 0。 如果指定了此设置和 GlobalMovementThrottleThreshold，则使用更保守的限制。\r   - GlobalMovementThrottleThresholdPercentageForPlacement - 放置阶段允许的最大移动数，以群集中副本总数的百分比表示。 0 表示没有限制。 默认值为 0。 如果指定了此设置和 GlobalMovementThrottleThresholdForPlacement，则使用更保守的限制。\r   - GlobalMovementThrottleThresholdPercentageForBalancing - 均衡阶段允许的最大移动数，以群集中副本总数的百分比表示。 0 表示没有限制。 默认值为 0。 如果指定了此设置和 GlobalMovementThrottleThresholdForBalancing，则使用更保守的限制。\r \r 指定限制百分比时，将 5% 指定为 0.05。 控制这些限制的间隔为 GlobalMovementThrottleCountingInterval，以秒为单位进行指定。\r \r ``` xml\r <Section Name=\"PlacementAndLoadBalancing\">\r      <Parameter Name=\"GlobalMovementThrottleThresholdPercentage\" Value=\"0\" />\r      <Parameter Name=\"GlobalMovementThrottleThresholdPercentageForPlacement\" Value=\"0\" />\r      <Parameter Name=\"GlobalMovementThrottleThresholdPercentageForBalancing\" Value=\"0\" />\r      <Parameter Name=\"GlobalMovementThrottleCountingInterval\" Value=\"600\" />\r </Section>\r ```\r \r 通过用于独立部署的 ClusterConfig.json 或用于 Azure 托管群集的 Template.json：\r \r ```json\r \"fabricSettings\": [\r   {\r     \"name\": \"PlacementAndLoadBalancing\",\r     \"parameters\": [\r       {\r           \"name\": \"GlobalMovementThrottleThresholdPercentage\",\r           \"value\": \"0.0\"\r       },\r       {\r           \"name\": \"GlobalMovementThrottleThresholdPercentageForPlacement\",\r           \"value\": \"0.0\"\r       },\r       {\r           \"name\": \"GlobalMovementThrottleThresholdPercentageForBalancing\",\r           \"value\": \"0.0\"\r       },\r       {\r           \"name\": \"GlobalMovementThrottleCountingInterval\",\r           \"value\": \"600\"\r       }\r     ]\r   }\r ]\r ```\r \r ### <a name=\"default-count-based-throttles\"></a>基于默认计数的限制\r 如果具有较旧的群集或仍将这些配置保留在之后已升级的群集中，则提供此信息。 一般情况下，建议将这些限制替换为以上基于百分比的限制。 由于基于百分比的限制默认是禁用的，这些限制保持为群集的默认限制，直到被禁用并替换为基于百分比的限制。 \r \r   - GlobalMovementThrottleThreshold - 此设置控制一段时间内群集中移动的总数。 时间量指定为 GlobalMovementThrottleCountingInterval，以秒为单位。 GlobalMovementThrottleThreshold 的默认值为 1000，GlobalMovementThrottleCountingInterval 的默认值为 600。\r   - MovementPerPartitionThrottleThreshold - 此设置控制一段时间内针对任何服务分区的移动总数。 时间量指定为 MovementPerPartitionThrottleCountingInterval，以秒为单位。 MovementPerPartitionThrottleThreshold 的默认值为 50，MovementPerPartitionThrottleCountingInterval 的默认值为 600。\r \r 这些限制的配置遵循与基于百分比的限制相同的模式。\r \r ## <a name=\"next-steps\"></a>后续步骤\r - 若要了解群集 Resource Manager 如何管理和均衡群集中的负载，请查看有关[均衡负载](service-fabric-cluster-resource-manager-balancing.md)的文章\r - 群集 Resource Manager 提供许多用于描述群集的选项。 若要详细了解这些选项，请查看这篇[描述 Service Fabric 群集](service-fabric-cluster-resource-manager-cluster-description.md)的文章\r \r <!--Update_Description: update meta properties, wording update-->"}