{"Title":"使用 Azure Active Directory 和 API 管理保护 Web API 后端","Description":"了解如何使用 Azure Active Directory 和 API 管理保护 Web API 后端。","Content":"# <a name=\"how-to-protect-a-web-api-backend-with-azure-active-directory-and-api-management\"></a>如何使用 Azure Active Directory 和 API 管理保护 Web API 后端\r \r ## <a name=\"create-an-azure-ad-directory\"></a>创建 Azure AD 目录\r 若要使用 Azure Active Directory 保护 Web API 后端，必须首先创建 AAD 租户。 若要创建 AAD 租户，请登录 [Azure 经典管理门户](https://manage.windowsazure.cn)，单击“新建”->“应用服务”->“Active Directory”->“目录”->“自定义创建”。 \r \r ![Azure Active Directory][api-management-create-aad-menu]\r \r 此示例中使用默认域 DemoAPIM.onmicrosoft.com 创建目录 APIMDemo。 \r \r ![Azure Active Directory][api-management-create-aad]\r \r ## <a name=\"create-a-web-api-service-secured-by-azure-active-directory\"></a>创建由 Azure Active Directory 保护的 Web API 服务\r 此步骤使用 Visual Studio 2013 创建 Web API 后端。 若要在 Visual Studio 中创建 Web API 后端项目，请单击“文件”->“新建”->“项目”，并从“Web”模板列表中选择“ASP.NET Web 应用程序”。 单击“确定”以创建该项目  。 \r \r ![Visual Studio][api-management-new-web-app]\r \r 单击“选择模板”列表中的“Web API”，创建 Web API 项目。 若要配置 Azure Directory 身份验证，请单击“更改身份验证”。\r \r ![新建项目][api-management-new-project]\r \r 单击“组织帐户”，并指定 AAD 租户的“域”。 此示例中的域是 DemoAPIM.onmicrosoft.com。可从目录的“域”选项卡获取目录的域。\r \r ![域][api-management-aad-domains]\r \r 在“更改身份验证”对话框中配置所需设置，并单击“确定”。\r \r ![更改身份验证][api-management-change-authentication]\r \r 单击“确定”后，Visual Studio 会尝试向 Azure AD 目录注册应用程序，并且系统可能会提示你通过 Visual Studio 登录。 使用目录的管理帐户登录。\r \r ![登录 Visual Studio][api-management-sign-in-vidual-studio]\r \r 若要将此项目配置为 Azure Web API，请选中“在云中托管”框，然后单击“确定”。\r \r ![新建项目][api-management-new-project-cloud]\r \r 系统可能会提示你，需要登录 Azure 才能配置 Web 应用。\r \r ![配置][api-management-configure-web-app]\r \r 此示例中指定了一个新的名为“APIMAADDemo”的“应用服务计划”。\r \r 单击“确定”配置 Web 应用和创建项目。\r \r ## <a name=\"add-the-code-to-the-web-api-project\"></a>将代码添加到 Web API 项目\r 下一步是将代码添加到 Web API 项目。 \r \r 此示例中的 Web API 使用模型和控制器实现基本计算器服务。 若要为服务添加模型，请右键单击“解决方案资源管理器”中的“模型”，并依次选择“添加”、“类”。 将类命名为 `CalcInput`，然后单击“添加”。\r \r 将下面的 `using` 语句添加到 `CalcInput.cs` 文件顶部。\r \r ```c#\r using Newtonsoft.Json;\r ```\r \r 将生成的类替换为以下代码。\r \r ```c#\r public class CalcInput\r {\r     [JsonProperty(PropertyName = \"a\")]\r     public int a;\r \r     [JsonProperty(PropertyName = \"b\")]\r     public int b;\r }\r ```\r \r 右键单击“解决方案资源管理器”中的“Controllers”文件夹，并选择“添加”->“控制器”。 选择“Web API 2 控制器 - 空”，并单击“添加”。 键入 CalcController 作为控制器名称，并单击“添加”。\r \r ![添加控制器][api-management-add-controller]\r \r 将下面的 `using` 语句添加到 `CalcController.cs` 文件顶部。\r \r ```c#\r using System.IO;\r using System.Web;\r using APIMAADDemo.Models;\r ```\r \r 将生成的控制器类替换为以下代码。 此代码实施基本计算器 API 的 `Add`、`Subtract`、`Multiply` 和 `Divide` 操作。\r \r ```c#\r [Authorize]\r public class CalcController : ApiController\r {\r     [Route(\"api/add\")]\r     [HttpGet]\r     public HttpResponseMessage GetSum([FromUri]int a, [FromUri]int b)\r     {\r         string xml = string.Format(\"<result><value>{0}</value><broughtToYouBy>Azure API Management - http://azure.microsoft.com/apim/ </broughtToYouBy></result>\", a + b);\r         HttpResponseMessage response = Request.CreateResponse();\r         response.Content = new StringContent(xml, System.Text.Encoding.UTF8, \"application/xml\");\r         return response;\r     }\r \r     [Route(\"api/sub\")]\r     [HttpGet]\r     public HttpResponseMessage GetDiff([FromUri]int a, [FromUri]int b)\r     {\r         string xml = string.Format(\"<result><value>{0}</value><broughtToYouBy>Azure API Management - http://azure.microsoft.com/apim/ </broughtToYouBy></result>\", a - b);\r         HttpResponseMessage response = Request.CreateResponse();\r         response.Content = new StringContent(xml, System.Text.Encoding.UTF8, \"application/xml\");\r         return response;\r     }\r \r     [Route(\"api/mul\")]\r     [HttpGet]\r     public HttpResponseMessage GetProduct([FromUri]int a, [FromUri]int b)\r     {\r         string xml = string.Format(\"<result><value>{0}</value><broughtToYouBy>Azure API Management - http://azure.microsoft.com/apim/ </broughtToYouBy></result>\", a * b);\r         HttpResponseMessage response = Request.CreateResponse();\r         response.Content = new StringContent(xml, System.Text.Encoding.UTF8, \"application/xml\");\r         return response;\r     }\r \r     [Route(\"api/div\")]\r     [HttpGet]\r     public HttpResponseMessage GetDiv([FromUri]int a, [FromUri]int b)\r     {\r         string xml = string.Format(\"<result><value>{0}</value><broughtToYouBy>Azure API Management - http://azure.microsoft.com/apim/ </broughtToYouBy></result>\", a / b);\r         HttpResponseMessage response = Request.CreateResponse();\r         response.Content = new StringContent(xml, System.Text.Encoding.UTF8, \"application/xml\");\r         return response;\r     }\r }\r ```\r \r 按 F6 生成并验证解决方案。\r \r ## <a name=\"publish-the-project-to-azure\"></a>将项目发布到 Azure\r 此步骤将 Visual Studio 项目发布到 Azure。\r \r 若要将项目发布到 Azure，请右键单击 Visual Studio 中的“APIMAADDemo”项目，然后选择“发布”。 保留“发布 Web”对话框中的默认设置，并单击“发布”。\r \r ![Web 发布][api-management-web-publish]\r \r ## <a name=\"grant-permissions-to-the-azure-ad-backend-service-application\"></a>向 Azure AD 后端服务应用程序授予权限\r 在配置和发布 Web API 项目的过程中，会在 Azure AD 目录中创建适用于后端服务的新应用程序。 此步骤向 Web API 后端授予权限。\r \r ![应用程序][api-management-aad-backend-app]\r \r 单击应用程序的名称，配置所需权限。 导航到“配置”选项卡，向下滚动到“对其他应用程序的权限”部分。 单击 Windows Azure Active Directory 旁边的“应用程序权限”下拉列表，选中“读取目录数据”框，并单击“保存”。\r \r ![添加权限][api-management-aad-add-permissions]\r \r > [!NOTE]\r > 如果 Windows Azure Active Directory 未在“对其他应用程序的权限”下列出，则单击“添加应用程序”，从列表中添加该应用程序。\r > \r > \r \r 记下“应用 ID URI”，以便在后续步骤中为 API 管理开发人员门户配置 Azure AD 应用时使用。\r \r ![应用 ID URI][api-management-aad-sso-uri]\r \r ## <a name=\"import-the-web-api-into-api-management\"></a>将 Web API 导入 API 管理\r 在 API 发布者门户（通过 Azure 门户访问）中配置 API。 若要访问该门户，请单击 API 管理服务工具栏中的“发布者门户”。 如果尚未创建 API 管理服务实例，请参阅[管理第一个 API][Manage your first API] 教程中的[创建 API 管理服务实例][Create an API Management service instance]。\r \r ![发布者门户][api-management-management-console]\r \r 可将操作[手动添加到 API](./api-management-howto-add-operations.md)，也可以导入操作。 \r \r 创建包含以下内容的文件 `calcapi.json` 并将其保存到计算机。 确保 `host` 属性指向 Web API 后端。 此示例使用 `\"host\": \"apimaaddemo.azurewebsites.cn\"`。\r \r ```json\r {\r   \"swagger\": \"2.0\",\r   \"info\": {\r     \"title\": \"Calculator\",\r     \"description\": \"Arithmetics over HTTP!\",\r     \"version\": \"1.0\"\r   },\r   \"host\": \"apimaaddemo.azurewebsites.cn\",\r   \"basePath\": \"/api\",\r   \"schemes\": [\r     \"http\"\r   ],\r   \"paths\": {\r     \"/add?a={a}&b={b}\": {\r       \"get\": {\r         \"description\": \"Responds with a sum of two numbers.\",\r         \"operationId\": \"Add two integers\",\r         \"parameters\": [\r           {\r             \"name\": \"a\",\r             \"in\": \"query\",\r             \"description\": \"First operand. Default value is <code>51</code>.\",\r             \"required\": true,\r             \"type\": \"string\",\r             \"default\": \"51\",\r             \"enum\": [\r               \"51\"\r             ]\r           },\r           {\r             \"name\": \"b\",\r             \"in\": \"query\",\r             \"description\": \"Second operand. Default value is <code>49</code>.\",\r             \"required\": true,\r             \"type\": \"string\",\r             \"default\": \"49\",\r             \"enum\": [\r               \"49\"\r             ]\r           }\r         ],\r         \"responses\": { }\r       }\r     },\r     \"/sub?a={a}&b={b}\": {\r       \"get\": {\r         \"description\": \"Responds with a difference between two numbers.\",\r         \"operationId\": \"Subtract two integers\",\r         \"parameters\": [\r           {\r             \"name\": \"a\",\r             \"in\": \"query\",\r             \"description\": \"First operand. Default value is <code>100</code>.\",\r             \"required\": true,\r             \"type\": \"string\",\r             \"default\": \"100\",\r             \"enum\": [\r               \"100\"\r             ]\r           },\r           {\r             \"name\": \"b\",\r             \"in\": \"query\",\r             \"description\": \"Second operand. Default value is <code>50</code>.\",\r             \"required\": true,\r             \"type\": \"string\",\r             \"default\": \"50\",\r             \"enum\": [\r               \"50\"\r             ]\r           }\r         ],\r         \"responses\": { }\r       }\r     },\r     \"/div?a={a}&b={b}\": {\r       \"get\": {\r         \"description\": \"Responds with a quotient of two numbers.\",\r         \"operationId\": \"Divide two integers\",\r         \"parameters\": [\r           {\r             \"name\": \"a\",\r             \"in\": \"query\",\r             \"description\": \"First operand. Default value is <code>100</code>.\",\r             \"required\": true,\r             \"type\": \"string\",\r             \"default\": \"100\",\r             \"enum\": [\r               \"100\"\r             ]\r           },\r           {\r             \"name\": \"b\",\r             \"in\": \"query\",\r             \"description\": \"Second operand. Default value is <code>20</code>.\",\r             \"required\": true,\r             \"type\": \"string\",\r             \"default\": \"20\",\r             \"enum\": [\r               \"20\"\r             ]\r           }\r         ],\r         \"responses\": { }\r       }\r     },\r     \"/mul?a={a}&b={b}\": {\r       \"get\": {\r         \"description\": \"Responds with a product of two numbers.\",\r         \"operationId\": \"Multiply two integers\",\r         \"parameters\": [\r           {\r             \"name\": \"a\",\r             \"in\": \"query\",\r             \"description\": \"First operand. Default value is <code>20</code>.\",\r             \"required\": true,\r             \"type\": \"string\",\r             \"default\": \"20\",\r             \"enum\": [\r               \"20\"\r             ]\r           },\r           {\r             \"name\": \"b\",\r             \"in\": \"query\",\r             \"description\": \"Second operand. Default value is <code>5</code>.\",\r             \"required\": true,\r             \"type\": \"string\",\r             \"default\": \"5\",\r             \"enum\": [\r               \"5\"\r             ]\r           }\r         ],\r         \"responses\": { }\r       }\r     }\r   }\r }\r ```\r \r 若要导入计算器 API，请单击左侧“API 管理”菜单中的“API”，并单击“导入 API”。\r \r ![“导入 API”按钮][api-management-import-api]\r \r 执行以下步骤，配置计算器 API。\r \r 1. 单击“从文件”，浏览到保存的 `calculator.json` 文件，并单击“Swagger”单选按钮。\r 2. 在“Web API URL 后缀”文本框中键入“calc”。\r 3. 单击“产品(可选)”框，并选择“初学者”。\r 4. 单击“保存”导入 API。\r \r ![添加新的 API][api-management-import-new-api]\r \r 导入 API 后，该 API 的摘要页会显示在发布者门户中。\r \r ## <a name=\"call-the-api-unsuccessfully-from-the-developer-portal\"></a>从开发人员门户调用 API 失败\r 此时，该 API 已导入 API 管理，但无法从开发人员门户成功调用，因为后端服务受 Azure AD 身份验证保护。 \r \r 单击发布者门户右上角的“开发人员门户”。\r \r ![开发人员门户][api-management-developer-portal-menu]\r \r 依次单击“API”和“计算器”API。\r \r ![开发人员门户][api-management-dev-portal-apis]\r \r 单击“试用”。\r \r ![试用][api-management-dev-portal-try-it]\r \r 单击“发送”并记下响应状态“401 未授权”。\r \r ![发送][api-management-dev-portal-send-401]\r \r 请求未经授权，因为后端 API 受 Azure Active Directory 保护。 若要成功调用 API，必须首先将开发人员门户配置为使用 OAuth 2.0 向开发人员授权。 此过程在以下部分中介绍。\r \r ## <a name=\"register-the-developer-portal-as-an-aad-application\"></a>将开发人员门户注册为 AAD 应用程序\r 将开发人员门户配置为使用 OAuth 2.0 向开发人员授权的第一步是：将开发人员门户注册为 AAD 应用程序。 \r \r 通过第一步导航到 Azure AD 租户（此示例中的租户为“APIMDemo”），然后导航到“应用程序”选项卡。\r \r ![新应用程序][api-management-aad-new-application-devportal]\r \r 单击“添加”按钮创建新的 Azure Active Directory 应用程序，并选择“添加我的组织正在开发的应用程序”。\r \r ![新应用程序][api-management-new-aad-application-menu]\r \r 选择“Web 应用程序和/或 Web API”，输入一个名称，并单击下一步箭头。 此示例中使用“APIMDeveloperPortal”。\r \r ![新应用程序][api-management-aad-new-application-devportal-1]\r \r 对于“登录 URL”，请输入 API 管理服务的 URL，并追加 `/signin`。 此示例使用 `https://contoso5.portal.azure-api.cn/signin`。\r \r 对于“应用 ID URL”，请输入 API 管理服务的 URL，并追加某些唯一字符。 这些类型可以是任何所需字符，在此示例中使用了 `https://contoso5.portal.azure-api.cn/dp`。 配置所需“应用属性”后，单击复选标记创建应用程序。\r \r ![新应用程序][api-management-aad-new-application-devportal-2]\r \r ## <a name=\"configure-an-api-management-oauth-20-authorization-server\"></a>配置 API 管理 OAuth 2.0 授权服务器\r 下一步是在 API 管理中配置 OAuth 2.0 授权服务器。\r \r 在左侧的“API 管理”菜单中单击“安全”，并单击“OAuth 2.0”和“添加授权服务器”。\r \r ![添加授权服务器][api-management-add-authorization-server]\r \r 在“名称”和“说明”字段中输入名称和可选说明。 这些字段用于标识 API 管理服务实例中的 OAuth 2.0 授权服务器。 此示例中使用“授权服务器演示”。 稍后指定用于 API 身份验证的 OAuth 2.0 服务器时，需选择此名称。\r \r 对于“客户端注册页 URL”，请输入占位符值，如 `http://localhost`。  “客户端注册页 URL”指向供用户针对 OAuth 2.0 提供程序创建和配置其自己的帐户的页面，这些提供程序支持用户管理帐户。 在此示例中，用户不会创建和配置自己的帐户，因此使用占位符。\r \r ![添加授权服务器][api-management-add-authorization-server-1]\r \r 接下来，指定“授权终结点 URL”和“令牌终结点 URL”。\r \r ![授权服务器][api-management-add-authorization-server-1a]\r \r 可从为开发人员门户创建的 AAD 应用程序的“应用终结点”页面检索这些值。 若要访问终结点，请导航到 AAD 应用程序的“配置”选项卡，并单击“查看终结点”。\r \r ![应用程序][api-management-aad-devportal-application]\r \r ![查看终结点][api-management-aad-view-endpoints]\r \r 复制“OAuth 2.0 授权终结点”，并将其粘贴到“授权终结点 URL”文本框。\r \r ![添加授权服务器][api-management-add-authorization-server-2]\r \r 复制“OAuth 2.0 令牌终结点”，并将其粘贴到“令牌终结点 URL”文本框。\r \r ![添加授权服务器][api-management-add-authorization-server-2a]\r \r 除了在令牌终结点中粘贴以外，还需添加另一个正文参数 resource，其值则使用 AAD 应用程序的“应用 ID URI”，此 AAD 应用程序属于发布 Visual Studio 项目时创建的后端服务。\r \r ![应用 ID URI][api-management-aad-sso-uri]\r \r 接下来，指定客户端凭据。 这些是想要访问的资源的凭据，此示例中的该资源为开发人员门户。\r \r ![客户端凭据][api-management-client-credentials]\r \r 若要获取“客户端 ID”，请导航到用于开发人员门户的 AAD 应用程序的“配置”选项卡，并复制“客户端 ID”。\r \r 若要获取“客户端机密”，请单击“密钥”部分中的“选择持续时间”下拉列表，并指定时间间隔。 此示例中使用 1 年。\r \r ![客户端 ID][api-management-aad-client-id]\r \r 单击“保存”保存配置并显示密钥。 \r \r > [!IMPORTANT]\r > 记下此密钥。 关闭 Azure Active Directory 配置窗口后，无法再次显示密钥。\r > \r > \r \r 将密钥复制到剪贴板，切换回发布者门户，再将密钥粘贴到“客户端机密”文本框，然后单击“保存”。\r \r ![添加授权服务器][api-management-add-authorization-server-3]\r \r 客户端凭据后紧跟授权代码授予。 复制此授权代码并切换回 Azure AD 开发人员门户应用程序配置页，将授权代码粘贴到“答复 URL”字段，然后再次单击“保存”。\r \r ![回复 URL][api-management-aad-reply-url]\r \r 下一步是配置开发人员门户 AAD 应用程序的权限。 单击“应用程序权限”并选中“读取目录数据”框。 单击“保存”保存此更改，并单击“添加应用程序”。\r \r ![添加权限][api-management-add-devportal-permissions]\r \r 单击搜索图标，在“起始值”框中键入“APIM”，选择“APIMAADDemo”，并单击用于保存的复选标记。\r \r ![添加权限][api-management-aad-add-app-permissions]\r \r 单击“APIMAADDemo”的“委派权限”，选中“访问 APIMAADDemo”框，并单击“保存”。 这时开发人员门户应用程序便可访问后端服务。\r \r ![添加权限][api-management-aad-add-delegated-permissions]\r \r ## <a name=\"enable-oauth-20-user-authorization-for-the-calculator-api\"></a>为计算器 API 启用 OAuth 2.0 用户授权\r 配置 OAuth 2.0 服务器后，便可在 API 的安全设置中指定该服务器。 \r \r 单击左侧菜单中的“API”，并单击“计算器”查看和配置其设置。\r \r ![计算器 API][api-management-calc-api]\r \r 导航到“安全”选项卡，选中“OAuth 2.0”复选框，从“授权服务器”下拉列表中选择所需的授权服务器，并单击“保存”。\r \r ![计算器 API][api-management-enable-aad-calculator]\r \r ## <a name=\"successfully-call-the-calculator-api-from-the-developer-portal\"></a>成功从开发人员门户调用计算器 API\r 由于 OAuth 2.0 授权已在 API 上完成配置，因此可从开发人员中心成功调用其操作。 \r \r 在开发人员门户中，导航回到计算器服务的“添加两个整数”操作，并单击“试用”。 请注意，“授权”部分中的新项与刚添加的授权服务器对应。\r \r ![计算器 API][api-management-calc-authorization-server]\r \r 从授权下拉列表中选择“授权代码”，并输入要使用的帐户的凭据。 如果已使用帐户登录，则可能不会出现提示。\r \r ![计算器 API][api-management-devportal-authorization-code]\r \r 单击“发送”，并记下响应状态“200 正常”和响应内容中的操作结果。\r \r ![计算器 API][api-management-devportal-response]\r \r ## <a name=\"configure-a-desktop-application-to-call-the-api\"></a>配置桌面应用程序以调用 API\r 下一过程是配置一个简单的桌面应用程序来调用 API。 第一步是在 Azure AD 中注册桌面应用程序，并向其授予访问目录和后端服务的权限。 18:25 开始演示桌面应用程序调用计算器 API 上的操作。\r \r ## <a name=\"configure-a-jwt-validation-policy-to-pre-authorize-requests\"></a>配置 JWT 验证策略，对请求进行预授权\r \r ```xml\r <validate-jwt header-name=\"Authorization\" failed-validation-httpcode=\"401\" failed-validation-error-message=\"Unauthorized. Access token is missing or invalid.\">\r     <openid-config url=\"https://login.chinacloudapi.cn/DemoAPIM.onmicrosoft.com/.well-known/openid-configuration\" />\r     <required-claims>\r         <claim name=\"aud\">\r             <value>https://DemoAPIM.NOTonmicrosoft.com/APIMAADDemo</value>\r         </claim>\r     </required-claims>\r </validate-jwt>\r ```\r \r \r ## <a name=\"next-steps\"></a>后续步骤\r * 有关保护后端服务的其他方法，请参阅[使用证书进行相互身份验证](./api-management-howto-mutual-certificates.md)。\r \r [api-management-management-console]: ./media/api-management-howto-protect-backend-with-aad/api-management-management-console.png\r \r [api-management-import-api]: ./media/api-management-howto-protect-backend-with-aad/api-management-import-api.png\r [api-management-import-new-api]: ./media/api-management-howto-protect-backend-with-aad/api-management-import-new-api.png\r [api-management-create-aad-menu]: ./media/api-management-howto-protect-backend-with-aad/api-management-create-aad-menu.png\r [api-management-create-aad]: ./media/api-management-howto-protect-backend-with-aad/api-management-create-aad.png\r [api-management-new-web-app]: ./media/api-management-howto-protect-backend-with-aad/api-management-new-web-app.png\r [api-management-new-project]: ./media/api-management-howto-protect-backend-with-aad/api-management-new-project.png\r [api-management-new-project-cloud]: ./media/api-management-howto-protect-backend-with-aad/api-management-new-project-cloud.png\r [api-management-change-authentication]: ./media/api-management-howto-protect-backend-with-aad/api-management-change-authentication.png\r [api-management-sign-in-vidual-studio]: ./media/api-management-howto-protect-backend-with-aad/api-management-sign-in-vidual-studio.png\r [api-management-configure-web-app]: ./media/api-management-howto-protect-backend-with-aad/api-management-configure-web-app.png\r [api-management-aad-domains]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-domains.png\r [api-management-add-controller]: ./media/api-management-howto-protect-backend-with-aad/api-management-add-controller.png\r [api-management-web-publish]: ./media/api-management-howto-protect-backend-with-aad/api-management-web-publish.png\r [api-management-aad-backend-app]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-backend-app.png\r [api-management-aad-add-permissions]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-add-permissions.png\r [api-management-developer-portal-menu]: ./media/api-management-howto-protect-backend-with-aad/api-management-developer-portal-menu.png\r [api-management-dev-portal-apis]: ./media/api-management-howto-protect-backend-with-aad/api-management-dev-portal-apis.png\r [api-management-dev-portal-try-it]: ./media/api-management-howto-protect-backend-with-aad/api-management-dev-portal-try-it.png\r [api-management-dev-portal-send-401]: ./media/api-management-howto-protect-backend-with-aad/api-management-dev-portal-send-401.png\r [api-management-aad-new-application-devportal]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-new-application-devportal.png\r [api-management-aad-new-application-devportal-1]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-new-application-devportal-1.png\r [api-management-aad-new-application-devportal-2]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-new-application-devportal-2.png\r [api-management-aad-devportal-application]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-devportal-application.png\r [api-management-add-authorization-server]: ./media/api-management-howto-protect-backend-with-aad/api-management-add-authorization-server.png\r [api-management-aad-sso-uri]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-sso-uri.png\r [api-management-aad-view-endpoints]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-view-endpoints.png\r [api-management-aad-client-id]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-client-id.png\r [api-management-add-authorization-server-1]: ./media/api-management-howto-protect-backend-with-aad/api-management-add-authorization-server-1.png\r [api-management-add-authorization-server-2]: ./media/api-management-howto-protect-backend-with-aad/api-management-add-authorization-server-2.png\r [api-management-add-authorization-server-2a]: ./media/api-management-howto-protect-backend-with-aad/api-management-add-authorization-server-2a.png\r [api-management-add-authorization-server-3]: ./media/api-management-howto-protect-backend-with-aad/api-management-add-authorization-server-3.png\r [api-management-aad-reply-url]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-reply-url.png\r [api-management-add-devportal-permissions]: ./media/api-management-howto-protect-backend-with-aad/api-management-add-devportal-permissions.png\r [api-management-aad-add-app-permissions]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-add-app-permissions.png\r [api-management-aad-add-delegated-permissions]: ./media/api-management-howto-protect-backend-with-aad/api-management-aad-add-delegated-permissions.png\r [api-management-calc-api]: ./media/api-management-howto-protect-backend-with-aad/api-management-calc-api.png\r [api-management-enable-aad-calculator]: ./media/api-management-howto-protect-backend-with-aad/api-management-enable-aad-calculator.png\r [api-management-devportal-authorization-code]: ./media/api-management-howto-protect-backend-with-aad/api-management-devportal-authorization-code.png\r [api-management-devportal-response]: ./media/api-management-howto-protect-backend-with-aad/api-management-devportal-response.png\r [api-management-calc-authorization-server]: ./media/api-management-howto-protect-backend-with-aad/api-management-calc-authorization-server.png\r [api-management-add-authorization-server-1a]: ./media/api-management-howto-protect-backend-with-aad/api-management-add-authorization-server-1a.png\r [api-management-client-credentials]: ./media/api-management-howto-protect-backend-with-aad/api-management-client-credentials.png\r [api-management-new-aad-application-menu]: ./media/api-management-howto-protect-backend-with-aad/api-management-new-aad-application-menu.png\r \r [Create an API Management service instance]: ./api-management-get-started.md#create-service-instance\r [Manage your first API]: ./api-management-get-started.md\r "}