{"Title":"在 Azure Site Recovery 中管理横向扩展进程服务器","Description":"本文介绍如何在 Azure Site Recovery 中设置和管理横向扩展进程服务器。","Content":"# <a name=\"manage-a-scale-out-process-server\"></a>管理横向扩展进程服务器\r \r 横向扩展进程服务器充当 Site Recovery 服务与本地基础结构之间的数据传输的协调器。 本文介绍如何设置、配置和管理横向扩展进程服务器。\r \r ## <a name=\"prerequisites\"></a>先决条件\r 以下是设置横向扩展进程服务器所需的推荐硬件、软件和网络配置。\r \r > [!NOTE]\r > [容量规划](site-recovery-capacity-planner.md)是一个重要的步骤，用于确保使用符合负载要求的配置部署横向扩展进程服务器。 阅读有关 [横向扩展进程服务器的缩放特征](#sizing-requirements-for-a-configuration-server)的详细信息。\r \r [!INCLUDE [site-recovery-configuration-server-requirements](../../includes/site-recovery-configuration-and-scaleout-process-server-requirements.md)]\r \r ## <a name=\"downloading-the-scale-out-process-server-software\"></a>下载横向扩展进程服务器软件\r 1. 登录到 Azure 门户并浏览到恢复服务保管库。\r 2. 浏览到“Site Recovery 基础结构” > “配置服务器”（在“针对 VMware 和物理计算机”下面）。\r 3. 选择配置服务器以向下钻取到此配置服务器的详细信息页。\r 4. 单击“+ 进程服务器”按钮  。\r 5. 在“添加进程服务器”页上，从“选择要部署进程服务器的位置”下拉列表中选择“在本地部署横向扩展进程服务器”。\r \r   ![“添加服务器”页](./media/site-recovery-vmware-to-azure-manage-scaleout-process-server/add-process-server.png)\r 6. 单击“下载 Azure Site Recovery 统一安装”链接以下载最新版本的横向扩展进程服务器的安装程序。\r \r   > [!WARNING]\r   横向扩展进程服务器的版本应等于或小于环境中运行的配置服务器版本。 确保版本兼容性的一种简单方法是使用最近用来安装/更新配置服务器的安装程序位数。\r \r ## <a name=\"installing-and-registering-a-scale-out-process-server-from-gui\"></a>通过 GUI 安装并注册横向扩展进程服务器\r 如果必须将部署扩大到 200 台源计算机以上，或者每日改动率总计超过 2 TB，则需要额外的进程服务器来处理流量。\r \r 请查看 [进程服务器的大小建议](#size-recommendations-for-the-process-server)，并按照这些说明来设置进程服务器。 设置服务器后，可以迁移源计算机来使用它。\r \r [!INCLUDE [site-recovery-configuration-server-requirements](../../includes/site-recovery-add-process-server.md)]\r \r ## <a name=\"installing-and-registering-a-scale-out-process-server-using-command-line\"></a>使用命令行安装并注册横向扩展进程服务器\r \r ```\r UnifiedSetup.exe [/ServerMode <CS/PS>] [/InstallDrive <DriveLetter>] [/MySQLCredsFilePath <MySQL credentials file path>] [/VaultCredsFilePath <Vault credentials file path>] [/EnvType <VMWare/NonVMWare>] [/PSIP <IP address to be used for data transfer] [/CSIP <IP address of CS to be registered with>] [/PassphraseFilePath <Passphrase file path>]\r ```\r \r ### <a name=\"sample-usage\"></a>示例用法\r ```\r MicrosoftAzureSiteRecoveryUnifiedSetup.exe /q /xC:\\Temp\\Extracted\r cd C:\\Temp\\Extracted\r UNIFIEDSETUP.EXE /AcceptThirdpartyEULA /servermode \"PS\" /InstallLocation \"D:\\\" /EnvType \"VMWare\" /CSIP \"10.150.24.119\" /PassphraseFilePath \"C:\\Users\\Administrator\\Desktop\\Passphrase.txt\" /DataTransferSecurePort 443\r ```\r \r ### <a name=\"scale-out-process-server-installer-command-line-arguments\"></a>横向扩展进程服务器安装程序命令行参数。\r [!INCLUDE [site-recovery-unified-setup-parameters](../../includes/site-recovery-unified-installer-command-parameters.md)]\r \r ### <a name=\"create-a-proxy-settings-configuration-file\"></a>创建代理设置配置文件\r ProxySettingsFilePath 参数使用某个文件作为输入。 创建使用以下格式的文件并将其作为输入 ProxySettingsFilePath 参数进行传递。\r ```\r * [ProxySettings]\r * ProxyAuthentication = \"Yes/No\"\r * Proxy IP = \"IP Address\"\r * ProxyPort = \"Port\"\r * ProxyUserName=\"UserName\"\r * ProxyPassword=\"Password\"\r ```\r ## <a name=\"modifying-proxy-settings-for-scale-out-process-server\"></a>修改横向扩展进程服务器的代理设置\r 1. 登录横向扩展进程服务器。\r 2. 打开管理员 PowerShell 命令窗口。\r 3. 运行以下命令\r   ```\r   $pwd = ConvertTo-SecureString -String MyProxyUserPassword\r   Set-OBMachineSetting -ProxyServer http://myproxyserver.domain.com -ProxyPort PortNumber -ProxyUserName domain\\username -ProxyPassword $pwd\r   net stop obengine\r   net start obengine\r   ```\r 4. 接下来，浏览到目录 **%PROGRAMDATA%\\ASR\\Agent** 并运行以下命令\r   ```\r   cmd\r   cdpcli.exe --registermt\r \r   net stop obengine\r \r   net start obengine\r \r   exit\r   ```\r \r ## <a name=\"re-registering-a-scale-out-process-server\"></a>重新注册横向扩展进程服务器\r [!INCLUDE [site-recovery-vmware-register-process-server](../../includes/site-recovery-vmware-register-process-server.md)]\r \r * 接下来，打开管理员命令提示符。\r * 浏览到目录 **%PROGRAMDATA%\\ASR\\Agent** 并运行以下命令\r \r ```\r cdpcli.exe --registermt\r \r net stop obengine\r \r net start obengine\r ```\r \r ## <a name=\"upgrading-a-scale-out-process-server\"></a>升级横向扩展进程服务器\r [!INCLUDE [site-recovery-vmware-upgrade -process-server](../../includes/site-recovery-vmware-upgrade-process-server-internal.md)]\r \r ## <a name=\"decommissioning-a-scale-out-process-server\"></a>解除横向扩展进程服务器\r 1. 请确保：\r   - 在 Azure 门户中，配置服务器的连接状态显示为“已连接” \r   - 进程服务器仍能够与配置服务器通信。\r 2. 以管理员身份登录到进程服务器\r 3. 打开“控制面板”>“程序”>“卸载程序”\r 4. 按照以下指定的顺序卸载程序：\r   * Azure Site Recovery 配置服务器/进程服务器\r   * Azure Site Recovery 配置服务器依赖项\r   * Azure 恢复服务代理\r \r 进程服务器的删除反映在 Azure 门户中最长需要 15 分钟。\r \r   > [!NOTE]\r   如果进程服务器无法与配置服务器通信（门户中的连接状态为“已断开连接”），则需要按照以下步骤从配置服务器中清除它。\r \r ## <a name=\"unregistering-a-disconnected-scale-out-process-server-from-a-configuration-server\"></a>从配置服务器中注销已断开连接的横向扩展进程服务器\r \r [!INCLUDE [site-recovery-vmware-upgrade-process-server](../../includes/site-recovery-vmware-unregister-process-server.md)]\r \r ## <a name=\"sizing-requirements-for-a-scale-out-process-server\"></a>横向扩展进程服务器大小要求\r \r | **额外的进程服务器** | **缓存磁盘大小** | **数据更改率** | **受保护的计算机** |\r | --- | --- | --- | --- |\r |4 个 vCPU（2 个插槽 * 2 个核心 @ 2.5 GHz），8 GB 内存 |300 GB |250 GB 或更少 |复制 85 台或更少的计算机。 |\r |8 个 vCPU（2 个插槽 * 4 个核心 @ 2.5 GHz），12 GB 内存 |600 GB |250 GB 到 1 TB |复制 85-150 台计算机。 |\r |12 个 vCPU（2 个插槽 * 6 个核心 @ 2.5 GHz），24 GB 内存 |1 TB |1 TB 到 2 TB |复制 150-225 台计算机。 |\r \r <!--Update_Description: new articles on vmware to azure manage scale out process server in site recovery -->"}