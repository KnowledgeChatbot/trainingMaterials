{"Title":"计划程序出站身份验证","Description":"计划程序出站身份验证","Content":"# <a name=\"scheduler-outbound-authentication\"></a>计划程序出站身份验证\r \r 计划程序作业可能需要调用要求进行身份验证的服务。 这样，被调用的服务可以确定计划程序作业是否可以访问其资源。 其中的某些服务包括其他 Azure 服务、Salesforce.com、Facebook 和安全的自定义网站。\r \r ## <a name=\"adding-and-removing-authentication\"></a>添加和删除身份验证\r \r 将身份验证添加到计划程序作业非常简单 – 只需在创建或更新作业时将一个 JSON 子元素 `authentication` 添加到 `request` 元素。 在 PUT、PATCH 或 POST 请求中（作为 `authentication` 对象的一部分）传递给计划程序服务的机密永远不会在响应中返回。 在响应中，机密信息将设置为 null，或者包含一个表示已经过身份验证的实体的公共令牌。\r \r 若要删除身份验证，请对作业显式执行 PUT 或 PATCH，并将 `authentication` 对象设置为 null。 响应中不会传回任何身份验证属性。\r \r 目前，支持的身份验证类型仅包括 `ClientCertificate` 模型（表示使用 SSL/TLS 客户端证书）、`Basic` 模型（表示基本身份验证）和 `ActiveDirectoryOAuth` 模型（表示 Active Directory OAuth 身份验证）。\r \r ## <a name=\"request-body-for-clientcertificate-authentication\"></a>ClientCertificate 身份验证的请求正文\r \r 使用 `ClientCertificate` 模型添加身份验证时，请在请求正文中指定以下附加元素。  \r \r | 元素 | 说明 |\r |:--- |:--- |\r | *authentication（父元素）* |用于使用 SSL 客户端证书的身份验证对象。 |\r | *类型* |必需。 身份验证的类型。对于 SSL 客户端证书，该值必须是 `ClientCertificate`。 |\r | *pfx* |必需。 PFX 文件的 Base64 编码内容。 |\r | *password* |必需。 用于访问 PFX 文件的密码。 |\r \r ## <a name=\"response-body-for-clientcertificate-authentication\"></a>ClientCertificate 身份验证的响应正文\r \r 发送包含身份验证信息的请求时，响应将包含以下与身份验证相关的元素。\r \r | 元素 | 说明 |\r |:--- |:--- |\r | *authentication（父元素）* |用于使用 SSL 客户端证书的身份验证对象。 |\r | *类型* |身份验证的类型。 对于 SSL 客户端证书，该值为 `ClientCertificate`。 |\r | *certificateThumbprint* |证书的指纹。 |\r | *certificateSubjectName* |证书的使用者可分辨名称。 |\r | *certificateExpiration* |证书的过期日期。 |\r \r ## <a name=\"sample-rest-request-for-clientcertificate-authentication\"></a>ClientCertificate 身份验证的示例 REST 请求\r \r ```\r PUT https://management.chinacloudapi.cn/subscriptions/1fe0abdf-581e-4dfe-9ec7-e5cb8e7b205e/resourceGroups/CS-SoutheastAsia-scheduler/providers/Microsoft.Scheduler/jobcollections/southeastasiajc/jobs/httpjob?api-version=2016-01-01 HTTP/1.1\r User-Agent: Fiddler\r Host: management.chinacloudapi.cn\r Authorization: Bearer sometoken\r Content-Type: application/json; charset=utf-8\r \r {\r   \"properties\": {\r     \"startTime\": \"2015-05-14T14:10:00Z\",\r     \"action\": {\r       \"request\": {\r         \"uri\": \"https://mywebserviceendpoint.com\",\r         \"method\": \"GET\",\r         \"headers\": {\r           \"x-ms-version\": \"2013-03-01\"\r         },\r         \"authentication\": {\r           \"type\": \"clientcertificate\",\r           \"password\": \"password\",\r           \"pfx\": \"pfx key\"\r         }\r       },\r       \"type\": \"http\"\r     },\r     \"recurrence\": {\r       \"frequency\": \"minute\",\r       \"endTime\": \"2016-04-10T08:00:00Z\",\r       \"interval\": 1\r     },\r     \"state\": \"enabled\",\r   }\r }\r ```\r \r ## <a name=\"sample-rest-response-for-clientcertificate-authentication\"></a>ClientCertificate 身份验证的示例 REST 响应\r \r ```\r HTTP/1.1 200 OK\r Cache-Control: no-cache\r Pragma: no-cache\r Content-Length: 858\r Content-Type: application/json; charset=utf-8\r Expires: -1\r x-ms-request-id: 56c7b40e-721a-437e-88e6-f68562a73aa8\r Server: Microsoft-IIS/8.5\r X-AspNet-Version: 4.0.30319\r X-Powered-By: ASP.NET\r x-ms-ratelimit-remaining-subscription-resource-requests: 599\r x-ms-correlation-request-id: 1075219e-e879-4030-bc81-094e54fbabce\r x-ms-routing-request-id: WESTUS:20160316T190424Z:1075219e-e879-4030-bc81-094e54fbabce\r Strict-Transport-Security: max-age=31536000; includeSubDomains\r Date: Wed, 16 Mar 2016 19:04:23 GMT\r \r {\r   \"id\": \"/subscriptions/1fe0abdf-581e-4dfe-9ec7-e5cb8e7b205e/resourceGroups/CS-SoutheastAsia-scheduler/providers/Microsoft.Scheduler/jobCollections/southeastasiajc/jobs/httpjob\",\r   \"type\": \"Microsoft.Scheduler/jobCollections/jobs\",\r   \"name\": \"southeastasiajc/httpjob\",\r   \"properties\": {\r     \"startTime\": \"2015-05-14T14:10:00Z\",\r     \"action\": {\r       \"request\": {\r         \"uri\": \"https://mywebserviceendpoint.com\",\r         \"method\": \"GET\",\r         \"headers\": {\r           \"x-ms-version\": \"2013-03-01\"\r         },\r         \"authentication\": {\r           \"certificateThumbprint\": \"88105CG9DF9ADE75B835711D899296CB217D7055\",\r           \"certificateExpiration\": \"2021-01-01T07:00:00Z\",\r           \"certificateSubjectName\": \"CN=Scheduler Mgmt\",\r           \"type\": \"ClientCertificate\"\r         }\r       },\r       \"type\": \"http\"\r     },\r     \"recurrence\": {\r       \"frequency\": \"minute\",\r       \"endTime\": \"2016-04-10T08:00:00Z\",\r       \"interval\": 1\r     },\r     \"state\": \"enabled\",\r     \"status\": {\r       \"nextExecutionTime\": \"2016-03-16T19:05:00Z\",\r       \"executionCount\": 0,\r       \"failureCount\": 0,\r       \"faultedCount\": 0\r     }\r   }\r }\r ```\r \r ## <a name=\"request-body-for-basic-authentication\"></a>基本身份验证的请求正文\r \r 使用 `Basic` 模型添加身份验证时，请在请求正文中指定以下附加元素。\r \r | 元素 | 说明 |\r |:--- |:--- |\r | *authentication（父元素）* |用于使用基本身份验证的身份验证对象。 |\r | *类型* |必需。 身份验证的类型。 对于基本身份验证，该值必须是 `Basic`。 |\r | *username* |必需。 要进行身份验证的用户名。 |\r | *password* |必需。 要进行身份验证的密码。 |\r \r ## <a name=\"response-body-for-basic-authentication\"></a>基本身份验证的响应正文\r \r 发送包含身份验证信息的请求时，响应将包含以下与身份验证相关的元素。\r \r | 元素 | 说明 |\r |:--- |:--- |\r | *authentication（父元素）* |用于使用基本身份验证的身份验证对象。 |\r | *类型* |身份验证的类型。 对于基本身份验证，该值为 `Basic`。 |\r | *username* |经过身份验证的用户名。 |\r \r ## <a name=\"sample-rest-request-for-basic-authentication\"></a>基本身份验证的示例 REST 请求\r \r ```\r PUT https://management.chinacloudapi.cn/subscriptions/1d908808-e491-4fe5-b97e-29886e18efd4/resourceGroups/CS-SoutheastAsia-scheduler/providers/Microsoft.Scheduler/jobcollections/southeastasiajc/jobs/httpjob?api-version=2016-01-01 HTTP/1.1\r User-Agent: Fiddler\r Host: management.chinacloudapi.cn\r Authorization: Bearer sometoken\r Content-Length: 562\r Content-Type: application/json; charset=utf-8\r \r {\r   \"properties\": {\r     \"startTime\": \"2015-05-14T14:10:00Z\",\r     \"action\": {\r       \"request\": {\r         \"uri\": \"https://mywebserviceendpoint.com\",\r         \"method\": \"GET\",\r         \"headers\": {\r           \"x-ms-version\": \"2013-03-01\"\r         },\r         \"authentication\": {\r           \"type\": \"basic\",\r           \"username\": \"user\",\r           \"password\": \"password\"\r         }\r       },\r       \"type\": \"http\"\r     },\r     \"recurrence\": {\r       \"frequency\": \"minute\",\r       \"endTime\": \"2016-04-10T08:00:00Z\",\r       \"interval\": 1\r     },\r     \"state\": \"enabled\",\r   }\r }\r ```\r \r ## <a name=\"sample-rest-response-for-basic-authentication\"></a>基本身份验证的示例 REST 响应\r \r ```\r HTTP/1.1 200 OK\r Cache-Control: no-cache\r Pragma: no-cache\r Content-Length: 701\r Content-Type: application/json; charset=utf-8\r Expires: -1\r x-ms-request-id: a2dcb9cd-1aea-4887-8893-d81273a8cf04\r Server: Microsoft-IIS/8.5\r X-AspNet-Version: 4.0.30319\r X-Powered-By: ASP.NET\r x-ms-ratelimit-remaining-subscription-resource-requests: 599\r x-ms-correlation-request-id: 7816f222-6ea7-468d-b919-e6ddebbd7e95\r x-ms-routing-request-id: WESTUS:20160316T190506Z:7816f222-6ea7-468d-b919-e6ddebbd7e95\r Strict-Transport-Security: max-age=31536000; includeSubDomains\r Date: Wed, 16 Mar 2016 19:05:06 GMT\r \r {  \r    \"id\":\"/subscriptions/1d908808-e491-4fe5-b97e-29886e18efd4/resourceGroups/CS-SoutheastAsia-scheduler/providers/Microsoft.Scheduler/jobCollections/southeastasiajc/jobs/httpjob\",\r    \"type\":\"Microsoft.Scheduler/jobCollections/jobs\",\r    \"name\":\"southeastasiajc/httpjob\",\r    \"properties\":{  \r       \"startTime\":\"2015-05-14T14:10:00Z\",\r       \"action\":{  \r          \"request\":{  \r             \"uri\":\"https://mywebserviceendpoint.com\",\r             \"method\":\"GET\",\r             \"headers\":{  \r                \"x-ms-version\":\"2013-03-01\"\r             },\r             \"authentication\":{  \r                \"username\":\"user1\",\r                \"type\":\"Basic\"\r             }\r          },\r          \"type\":\"http\"\r       },\r       \"recurrence\":{  \r          \"frequency\":\"minute\",\r          \"endTime\":\"2016-04-10T08:00:00Z\",\r          \"interval\":1\r       },\r       \"state\":\"enabled\",\r       \"status\":{  \r          \"nextExecutionTime\":\"2016-03-16T19:06:00Z\",\r          \"executionCount\":0,\r          \"failureCount\":0,\r          \"faultedCount\":0\r       }\r    }\r }\r ```\r \r ## <a name=\"request-body-for-activedirectoryoauth-authentication\"></a>ActiveDirectoryOAuth 身份验证的请求正文\r \r 使用 `ActiveDirectoryOAuth` 模型添加身份验证时，请在请求正文中指定以下附加元素。\r \r | 元素 | 说明 |\r |:--- |:--- |\r | *authentication（父元素）* |用于使用 ActiveDirectoryOAuth 身份验证的身份验证对象。 |\r | *类型* |必需。 身份验证的类型。 对于 ActiveDirectoryOAuth 身份验证，该值必须是 `ActiveDirectoryOAuth`。 |\r | *tenant* |必需。 Azure AD 租户的租户标识符。 |\r |*audience* |必需。 设置为 https://management.core.chinacloudapi.cn/。|\r | *clientId* |必需。 为 Azure AD 应用程序提供客户端标识符。 |\r | *secret* |必需。 正在请求令牌的客户端的机密。 |\r \r ### <a name=\"determining-your-tenant-identifier\"></a>确定你的租户标识符\r \r 可以通过在 Azure PowerShell 中运行 `Get-AzureAccount` ，找到 Azure AD 租户的租户标识符。\r \r ## <a name=\"response-body-for-activedirectoryoauth-authentication\"></a>ActiveDirectoryOAuth 身份验证的响应正文\r \r 发送包含身份验证信息的请求时，响应将包含以下与身份验证相关的元素。\r \r | 元素 | 说明 |\r |:--- |:--- |\r | *authentication（父元素）* |用于使用 ActiveDirectoryOAuth 身份验证的身份验证对象。 |\r | *类型* |身份验证的类型。 对于 ActiveDirectoryOAuth 身份验证，该值为 `ActiveDirectoryOAuth`。 |\r | *tenant* |Azure AD 租户的租户标识符。 |\r |*audience* |设置为 https://management.core.chinacloudapi.cn/。|\r | *clientId* |AD 应用程序的客户端标识符。 |\r \r ## <a name=\"sample-rest-request-for-activedirectoryoauth-authentication\"></a>ActiveDirectoryOAuth 身份验证的示例 REST 请求\r \r ```\r PUT https://management.chinacloudapi.cn/subscriptions/1d908808-e491-4fe5-b97e-29886e18efd4/resourceGroups/CS-SoutheastAsia-scheduler/providers/Microsoft.Scheduler/jobcollections/southeastasiajc/jobs/httpjob?api-version=2016-01-01 HTTP/1.1\r User-Agent: Fiddler\r Host: management.chinacloudapi.cn\r Authorization: Bearer sometoken\r Content-Length: 757\r Content-Type: application/json; charset=utf-8\r \r {\r   \"properties\": {\r     \"startTime\": \"2015-05-14T14:10:00Z\",\r     \"action\": {\r       \"request\": {\r         \"uri\": \"https://mywebserviceendpoint.com\",\r         \"method\": \"GET\",\r         \"headers\": {\r           \"x-ms-version\": \"2013-03-01\"\r         },\r         \"authentication\": {\r           \"tenant\":\"microsoft.onmicrosoft.com\",\r           \"audience\":\"https://management.core.chinacloudapi.cn/\",\r           \"clientId\":\"dc23e764-9be6-4a33-9b9a-c46e36f0c137\",\r           \"secret\": \"G6u071r8Gjw4V4KSibnb+VK4+tX399hkHaj7LOyHuj5=\",\r           \"type\":\"ActiveDirectoryOAuth\"\r         }\r       },\r       \"type\": \"http\"\r     },\r     \"recurrence\": {\r       \"frequency\": \"minute\",\r       \"endTime\": \"2016-04-10T08:00:00Z\",\r       \"interval\": 1\r     },\r     \"state\": \"enabled\",\r   }\r }\r ```\r \r ## <a name=\"sample-rest-response-for-activedirectoryoauth-authentication\"></a>ActiveDirectoryOAuth 身份验证的示例 REST 响应\r \r ```\r HTTP/1.1 200 OK\r Cache-Control: no-cache\r Pragma: no-cache\r Content-Length: 885\r Content-Type: application/json; charset=utf-8\r Expires: -1\r x-ms-request-id: 86d8e9fd-ac0d-4bed-9420-9baba1af3251\r Server: Microsoft-IIS/8.5\r X-AspNet-Version: 4.0.30319\r X-Powered-By: ASP.NET\r x-ms-ratelimit-remaining-subscription-resource-requests: 599\r x-ms-correlation-request-id: 5183bbf4-9fa1-44bb-98c6-6872e3f2e7ce\r x-ms-routing-request-id: WESTUS:20160316T191003Z:5183bbf4-9fa1-44bb-98c6-6872e3f2e7ce\r Strict-Transport-Security: max-age=31536000; includeSubDomains\r Date: Wed, 16 Mar 2016 19:10:02 GMT\r \r {  \r    \"id\":\"/subscriptions/1d908808-e491-4fe5-b97e-29886e18efd4/resourceGroups/CS-SoutheastAsia-scheduler/providers/Microsoft.Scheduler/jobCollections/southeastasiajc/jobs/httpjob\",\r    \"type\":\"Microsoft.Scheduler/jobCollections/jobs\",\r    \"name\":\"southeastasiajc/httpjob\",\r    \"properties\":{  \r       \"startTime\":\"2015-05-14T14:10:00Z\",\r       \"action\":{  \r          \"request\":{  \r             \"uri\":\"https://mywebserviceendpoint.com\",\r             \"method\":\"GET\",\r             \"headers\":{  \r                \"x-ms-version\":\"2013-03-01\"\r             },\r             \"authentication\":{  \r                \"tenant\":\"microsoft.onmicrosoft.com\",\r                \"audience\":\"https://management.core.chinacloudapi.cn/\",\r                \"clientId\":\"dc23e764-9be6-4a33-9b9a-c46e36f0c137\",\r                \"type\":\"ActiveDirectoryOAuth\"\r             }\r          },\r          \"type\":\"http\"\r       },\r       \"recurrence\":{  \r          \"frequency\":\"minute\",\r          \"endTime\":\"2016-04-10T08:00:00Z\",\r          \"interval\":1\r       },\r       \"state\":\"enabled\",\r       \"status\":{  \r          \"lastExecutionTime\":\"2016-03-16T19:10:00.3762123Z\",\r          \"nextExecutionTime\":\"2016-03-16T19:11:00Z\",\r          \"executionCount\":5,\r          \"failureCount\":5,\r          \"faultedCount\":1\r       }\r    }\r }\r ```\r \r ## <a name=\"see-also\"></a>另请参阅\r \r  [计划程序是什么？](scheduler-intro.md)\r \r  [Azure 计划程序的概念、术语和实体层次结构](scheduler-concepts-terms.md)\r \r  [开始在 Azure 门户中使用计划程序](scheduler-get-started-portal.md)\r \r  [Azure 计划程序中的计划和计费](scheduler-plans-billing.md)\r \r  [Azure 计划程序 REST API 参考](https://msdn.microsoft.com/library/mt629143)\r \r  [Azure 计划程序 PowerShell cmdlet 参考](scheduler-powershell-reference.md)\r \r  [Azure 计划程序的高可用性和可靠性](scheduler-high-availability-reliability.md)\r \r  [Azure 计划程序的限制、默认值和错误代码](scheduler-limits-defaults-errors.md)\r \r "}