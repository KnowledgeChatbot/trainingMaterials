{"Title":"DocumentDB API 性能级别","Description":"了解如何通过 DocumentDB API 性能级别在每个容器的基础上保留吞吐量。","Content":"# <a name=\"retiring-the-s1-s2-and-s3-performance-levels\"></a>停用 S1、S2 和 S3 性能级别\r \r > [!IMPORTANT] \r > 本文所述的 S1、S2 和 S3 性能级别即将停用，不再适用于新的 DocumentDB API 帐户。\r >\r \r 本文概述 S1、S2 和 S3 性能级别，并介绍在 2017 年下旬如何将使用这些性能级别的集合迁移到单分区集合。 阅读本文后，可以回答以下问题：\r \r - [为何要停用 S1、S2 和 S3 性能级别？](#why-retired)\r - [单区集合和分区集合与 S1、S2、S3 性能级别有哪些区别？](#compare)\r - [我需要做些什么才能确保不间断地访问我的数据？](#uninterrupted-access)\r - [迁移后，集合会发生怎样的变化？](#collection-change)\r <!-- Not Available - [How will my billing change after I'm migrated to single partition collections?](#billing-change)-->\r - [如果需要 10 GB 以上的存储，应该怎么做？](#more-storage-needed)\r - [在计划的迁移期限之前，是否可以在 S1、S2 和 S3 性能级别之间切换？](#change-before)\r - [如何了解集合已迁移？](#when-migrated)\r - [如何自行从 S1、S2、S3 性能级别迁移到单区集合？](#migrate-diy)\r <!-- Not Available- [How am I impacted if I'm an EA customer?](#ea-customer)-->\r \r <a name=\"why-retired\"></a>\r \r ## <a name=\"why-are-the-s1-s2-and-s3-performance-levels-being-retired\"></a>为何要停用 S1、S2 和 S3 性能级别？\r \r S1、S2 和 S3 性能级别无法提供 Cosmos DB API 集合可提供的灵活性。 使用 S1、S2、S3 性能级别时，吞吐量和存储容量都是预设的，没有任何弹性。 现在，Azure Cosmos DB 允许用户自定义吞吐量和存储，大幅提高随需求变化而缩放的灵活性。\r \r <a name=\"compare\"></a>\r \r ## <a name=\"how-do-single-partition-collections-and-partitioned-collections-compare-to-the-s1-s2-s3-performance-levels\"></a>单区集合和分区集合与 S1、S2、S3 性能级别有哪些区别？\r \r 下表比较了单区集合、分区集合以及 S1、S2、S3 性能级别提供的吞吐量和存储选项。 下面是“中国东部 2”区域的一个示例：\r \r |   |分区集合|单区集合|S1|S2|S3|\r |---|---|---|---|---|---|\r |最大吞吐量|不受限制|10K RU/s|250 RU/s|1 K RU/s|2.5 K RU/秒|\r |最小吞吐量|2.5 K RU/秒|400 RU/s|250 RU/s|1 K RU/s|2.5 K RU/秒|\r |最大存储|不受限制|10 GB|10 GB|10 GB|10 GB|\r <!-- 不可用 |价格|吞吐量：6 美元/100 RU/s<br><br>存储：0.25 美元/GB|吞吐量：6 美元/100 RU/s<br><br>存储：0.25 美元/GB|25 美元|50 美元|100 美元|-->\r \r <!-- Not Avaialbel Are you an EA customer? If so, see [How am I impacted if I'm an EA customer?](#ea-customer) -->\r \r <a name=\"uninterrupted-access\"></a>\r \r ## <a name=\"what-do-i-need-to-do-to-ensure-uninterrupted-access-to-my-data\"></a>我需要做些什么才能确保不间断地访问我的数据？\r \r 不需要执行任何操作，Cosmos DB 会代你处理迁移。 如果正在使用 S1、S2 或 S3 集合，当前集合会在 2017 年下旬迁移到单分区集合。 \r \r <a name=\"collection-change\"></a>\r \r ## <a name=\"how-will-my-collection-change-after-the-migration\"></a>迁移后，集合会发生怎样的变化？\r \r 如果有 S1 集合，该集合将迁移到吞吐量为 400 RU/s 的单区集合。 400 RU/s 是单区集合提供的最低吞吐量。 但是，单分区集合中 400 RU/秒吞吐量的费用大致与 S1 集合中 250 RU/秒吞吐量的费用相同 - 因此，不需要为提供的额外 150 RU/秒付费。\r \r 如果有 S2 集合，该集合将迁移到吞吐量为 1 K RU/s 的单区集合。 吞吐量级别没有可见变化。\r \r 如果有 S3 集合，该集合将迁移到吞吐量为 2.5 K RU/s 的单区集合。 吞吐量级别没有可见变化。\r \r 对于上面的每种情况，在迁移集合后，可自定义吞吐量级别，或根据需要增加或减少它以向用户提供低延迟的访问。 如果要在迁移集合后更改吞吐量级别，只需在 Azure 门户中打开 Cosmos DB 帐户，单击“缩放”，选择集合，并如以下屏幕截图所示调整吞吐量级别：\r \r ![如何在 Azure 门户中缩放吞吐量](./media/performance-levels/portal-scale-throughput.png)\r \r <a name=\"billing-change\"></a>\r \r <!--Not Available ## How will my billing change after I'm migrated to the single partition collections?-->\r \r <a name=\"more-storage-needed\"></a>\r \r ## <a name=\"what-if-i-need-more-than-10-gb-of-storage\"></a>如果需要 10 GB 以上的存储，应该怎么做？\r \r 无论使用的是 S1、S2 或 S3 性能级别的集合还是单分区集合，它们的可用存储都是 10 GB。可以使用 Cosmos DB 数据迁移工具将数据迁移到存储几乎无限的分区集合。 有关分区集合优势的信息，请参阅 [Azure Cosmos DB 中的分区和缩放](documentdb-partition-data.md)。 有关如何将 S1、S2、S3 或单分区集合迁移到分区集合的信息，请参阅[从单分区迁移到分区集合](documentdb-partition-data.md#migrating-from-single-partition)。 \r \r <a name=\"change-before\"></a>\r \r ## <a name=\"can-i-change-between-the-s1-s2-and-s3-performance-levels-before-the-planned-migration\"></a>在计划的迁移期限之前，是否可以在 S1、S2 和 S3 性能级别之间切换？\r \r 只有 S1、S2 和 S3 性能级别的现有帐户才能通过门户或编程方式更改和切换性能级别层。 如果从 S1、S3 或 S3 切换到了单区集合，则无法恢复到 S1、S2 或 S3 性能级别。\r \r <a name=\"when-migrated\"></a>\r \r ## <a name=\"how-will-i-know-when-my-collection-has-migrated\"></a>如何了解集合已迁移？\r \r 迁移会在 2017 年下旬进行。 如果有使用 S1、S2 或 S3 性能级别的集合，Cosmos DB 团队会在进行迁移前通过电子邮件与你联系。 完成迁移后，Azure 门户会显示集合使用的是标准定价。\r \r ![如何确认集合已迁移到标准定价层](./media/performance-levels/portal-standard-pricing-applied.png)\r \r <a name=\"migrate-diy\"></a>\r \r ## <a name=\"how-do-i-migrate-from-the-s1-s2-s3-performance-levels-to-single-partition-collections-on-my-own\"></a>如何自行从 S1、S2、S3 性能级别迁移到单区集合？\r \r 可通过 Azure 门户或编程方式从 S1、S2 和 S3 性能级别迁移到单区集合。 可以在计划的迁移期限之前自行执行此操作，即可享用单分区集合提供的灵活吞吐量选项；或者，我们会在 2017 年下旬代客户迁移集合。\r \r **使用 Azure 门户迁移到单区集合**\r \r 1. 在 [**Azure 门户**](https://portal.azure.cn)中单击“Azure Cosmos DB”，然后选择要修改的 Cosmos DB 帐户。 \r \r     如果跳转栏上没有“Azure Cosmos DB”，请单击 >，滚动到“数据库”，选择“Azure Cosmos DB”，并选择帐户。  \r \r 2. 在资源菜单中的“容器”下单击“缩放”，从下拉列表中选择要修改的集合，然后单击“定价层”。 使用预定义吞吐量的帐户拥有定价层 S1、S2 或 S3。  在“选择定价层”页中，单击“标准”以更改为用户定义的吞吐量，并单击“选择”保存更改。\r \r     ![显示在何处更改吞吐量值的“设置”页屏幕截图](./media/performance-levels/change-performance-set-thoughput.png)\r \r 3. 返回到“规模”页中，“定价层”已更改为“标准”，“吞吐量(RU/s)”框显示默认值 400。 可以在 400 和 10,000 [请求单位](request-units.md)/秒 (RU/s) 之间设置吞吐量。 页面底部的“估计的每月帐单”  自动更新以提供月成本估计值。 \r \r     >[!IMPORTANT] \r     > 保存更改后并转移到标准定价层后，无法回滚到 S1、S2 或 S3 性能级别。\r \r 4.  以保存更改。\r \r     如果确定需要更多吞吐量（大于 10,000 RU/秒）或更多存储（大于 10GB），可以创建分区集合。 若要将单分区集合迁移到分区集合，请参阅[从单分区迁移到分区集合](documentdb-partition-data.md#migrating-from-single-partition)。\r \r     > [!NOTE]\r     > 从 S1、S2 或 S3 更改为“标准”定价层最长可能需要 2 分钟时间。\r     > \r     > \r \r **使用 .NET SDK 迁移到单区集合**\r \r 另一个更改集合的性能级别的选项便是通过 Azure Cosmos DB SDK 进行操作。 本部分只介绍了使用 [Cosmos DB .NET API](documentdb-sdk-dotnet.md) 更改集合的性能级别，但对于我们的其他 SDK，过程也是相似的。\r \r 以下代码片段可将集合吞吐量更改为每秒 5,000 个请求单位：\r \r ```C#\r     //Fetch the resource to be updated\r     Offer offer = client.CreateOfferQuery()\r                       .Where(r => r.ResourceLink == collection.SelfLink)    \r                       .AsEnumerable()\r                       .SingleOrDefault();\r \r     // Set the throughput to 5000 request units per second\r     offer = new OfferV2(offer, 5000);\r \r     //Now persist these changes to the database by replacing the original resource\r     await client.ReplaceOfferAsync(offer);\r ```\r \r 请访问 [MSDN](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.aspx) 以查看其他示例并了解更多有关服务方法的信息：\r \r * [**ReadOfferAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.readofferasync.aspx)\r * [**ReadOffersFeedAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.readoffersfeedasync.aspx)\r * [**ReplaceOfferAsync**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.documentclient.replaceofferasync.aspx)\r * [**CreateOfferQuery**](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.linq.documentqueryable.createofferquery.aspx)\r \r <a name=\"ea-customer\"></a>\r \r <!-- Not Available ## How am I impacted if I'm an EA customer?-->\r \r \r ## <a name=\"next-steps\"></a>后续步骤\r 若要了解更多有关 Azure Cosmos DB 的定价和管理数据的信息，请浏览以下资源：\r \r 1.  [对 Cosmos DB 中的数据进行分区](documentdb-partition-data.md)。 了解单区容器与分区容器的差异，以及有关实施分区策略以进行无缝缩放的提示。\r 2.  [Cosmos DB 定价](https://www.azure.cn/pricing/details/cosmos-db/)。 了解预配吞吐量和使用存储的费用。\r 3.  [请求单位](request-units.md)。 了解不同操作类型（例如读取、写入和查询）的吞吐量消耗。\r \r <!--Update_Description: update meta properties, wording update -->"}