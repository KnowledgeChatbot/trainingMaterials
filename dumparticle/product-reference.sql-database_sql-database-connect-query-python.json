{"Title":"使用 Python 查询 Azure SQL 数据库","Description":"本主题介绍如何使用 Python 创建可连接到 Azure SQL 数据库的程序并使用 Transact-SQL 语句对其进行查询。","Content":"# <a name=\"use-python-to-query-an-azure-sql-database\"></a>使用 Python 查询 Azure SQL 数据库\r \r  本快速入门演示了如何使用 [Python](https://python.org) 连接到 Azure SQL 数据库，并使用 Transact-SQL 语句查询数据。\r \r ## <a name=\"prerequisites\"></a>先决条件\r \r 若要完成本快速入门教程，请确保具备以下条件：\r \r - Azure SQL 数据库。 此快速入门使用以下某个快速入门中创建的资源： \r \r    - [创建 DB - 门户](sql-database-get-started-portal.md)\r    - [创建 DB - CLI](sql-database-get-started-cli.md)\r    - [创建 DB - PowerShell](sql-database-get-started-powershell.md)\r \r - 针对用于本快速入门教程的计算机的公共 IP 地址制定[服务器级防火墙规则](sql-database-get-started-portal.md#create-a-server-level-firewall-rule)。\r \r - 已为操作系统安装 Python 和相关软件。\r \r     - **MacOS**：安装 Homebrew 和 Python，接着安装 ODBC 驱动程序和 SQLCMD，再安装 Python Driver for SQL Server。 请参阅[步骤 1.2、1.3 和 2.1](https://www.microsoft.com/sql-server/developer-get-started/python/mac/)。\r     - **Ubuntu**：安装 Python 和其他所需包，然后安装 Python Driver for SQL Server。 请参阅[步骤 1.2、1.3 和 2.1](https://www.microsoft.com/sql-server/developer-get-started/python/ubuntu/)。\r     - **Windows**：安装最新版的 Python（现已为你配置环境变量），安装 ODBC 驱动程序和 SQLCMD，然后安装 Python Driver for SQL Server。 请参阅[步骤 1.2、1.3 和 2.1](https://www.microsoft.com/sql-server/developer-get-started/python/windows/)。 \r \r ## <a name=\"sql-server-connection-information\"></a>SQL Server 连接信息\r \r 获取连接到 Azure SQL 数据库所需的连接信息。 在后续过程中，将需要完全限定的服务器名称、数据库名称和登录信息。\r \r 1. 登录到 [Azure 门户](https://portal.azure.cn/)。\r 2. 从左侧菜单中选择“SQL 数据库”，并单击“SQL 数据库”页上的数据库。 \r 3. 在数据库的“概览”页上，查看如下图所示的完全限定的服务器名称。 将鼠标悬停在服务器名称上即可打开“通过单击进行复制”选项。  \r \r    ![server-name](./media/sql-database-connect-query-dotnet/server-name.png) \r \r 4. 如果忘了服务器的登录信息，请导航到 SQL 数据库服务器页，查看服务器管理员名称并重置密码（如果需要）。     \r    \r ## <a name=\"insert-code-to-query-sql-database\"></a>插入用于查询 SQL 数据库的代码 \r \r 1. 在常用的文本编辑器中，创建一个新文件 **sqltest.py**。  \r \r 2. 将内容替换为以下代码，为服务器、数据库、用户和密码添加相应的值。\r     ```Python\r     import pyodbc\r     server = 'your_server.database.chinacloudapi.cn'\r     database = 'your_database'\r     username = 'your_username'\r     password = 'your_password'\r     driver= '{ODBC Driver 13 for SQL Server}'\r     cnxn = pyodbc.connect('DRIVER='+driver+';PORT=1433;SERVER='+server+';PORT=1443;DATABASE='+database+';UID='+username+';PWD='+ password)\r     cursor = cnxn.cursor()\r     cursor.execute(\"SELECT TOP 20 pc.Name as CategoryName, p.name as ProductName FROM [SalesLT].[ProductCategory] pc JOIN [SalesLT].[Product] p ON pc.productcategoryid = p.productcategoryid\")\r     row = cursor.fetchone()\r     while row:\r         print (str(row[0]) + \" \" + str(row[1]))\r         row = cursor.fetchone()\r     ```\r \r ## <a name=\"run-the-code\"></a>运行代码\r \r 1. 在命令提示符下运行以下命令：\r     ```Python\r     python sqltest.py\r     ```\r \r 2. 验证是否已返回前 20 行，然后关闭应用程序窗口。\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r - [设计第一个 Azure SQL 数据库](sql-database-design-first-database.md)\r - [用于 SQL Server 的 Microsoft Python 驱动程序](https://docs.microsoft.com/sql/connect/python/python-driver-for-sql-server/)\r - [Python 开发人员中心](/develop/python/)\r \r "}