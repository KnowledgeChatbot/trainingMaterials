{"Title":"在 Azure Redis 缓存中导入和导出数据","Description":"了解如何使用高级 Azure Redis 缓存实例从 blob 存储导入数据，以及将数据导出到 blob 存储","Content":"# <a name=\"import-and-export-data-in-azure-redis-cache\"></a>在 Azure Redis 缓存中导入和导出数据\r 导入/导出是一种 Azure Redis 缓存数据管理操作，可用于通过从高级缓存导入 Redis 缓存数据库 (RDB) 快照以及将 Redis 缓存数据库 (RDB) 快照导出到 Azure 存储帐户中的 blob 来相应地将数据导入到 Azure Redis 缓存以及从 Azure Redis 缓存导出数据。 \r \r - **导出** - 可以将 Azure Redis 缓存 RDB 快照导出到页 Blob。\r - **导入** - 可以从页 Blob 或块 Blob 导入 Redis 缓存 RDB 快照。\r \r 导入/导出允许在不同 Azure Redis 缓存实例之间进行迁移，或者在使用缓存之前在缓存中填充数据。\r \r 本文提供使用 Azure Redis 缓存导入和导出数据的指南，并提供常见问题的解答。\r \r > [!IMPORTANT]\r > 导入/导出处于预览状态，仅适用于[高级层](cache-premium-tier-intro.md)缓存。\r >\r >\r \r ## <a name=\"import\"></a>导入\r 导入可用于从任何云或环境中运行的任何 Redis 服务器引入与 Redis 兼容的 RDB 文件，包括在 Linux、Windows 上运行的 Redis 或任何云提供程序（如 Amazon Web Services 等）。 导入数据是使用预先填充的数据创建缓存的简单方式。 在导入过程中，Azure Redis 缓存从 Azure 存储将 RDB 文件加载到内存中，再将密钥插入到缓存中。\r \r > [!NOTE]\r > 在开始导入操作之前，请确保 Redis 数据库 (RDB) 文件已上传到 Azure 存储的页 blob 或块 blob 中，并与 Azure Redis 缓存实例在同一区域和订阅中。 有关详细信息，请参阅 [Get started with Azure Blob storage](../storage/blobs/storage-dotnet-how-to-use-blobs.md)（Azure Blob 存储入门）。 如果已使用 [Azure Redis 缓存导出](#export) 功能导出 RDB 文件，则 RDB 文件已存储在页 blob 中并已准备好进行导入。\r >\r >\r \r 1. 若要导入一个或多个导出的缓存 blob，请在 Azure 门户中[浏览到缓存](cache-configure.md#configure-redis-cache-settings)，然后在“资源”菜单中单击“导入数据”。\r \r     ![导入数据][cache-import-data]\r 2. 单击“选择 Blob”，并选择包含要导入的数据的存储帐户。\r \r     ![选择存储帐户][cache-import-choose-storage-account]\r 3. 单击包含要导入的数据的容器。\r \r     ![选择容器][cache-import-choose-container]\r 4. 通过单击 blob 名称左侧的区域选择要导入的一个或多个 blob，并单击“选择” 。\r \r     ![选择 blob][cache-import-choose-blobs]\r 5. 单击“导入”以开始导入过程  。\r \r    > [!IMPORTANT]\r    > 在导入过程中，缓存客户端无法访问该缓存，并且将删除该缓存中的任何现有数据。\r    >\r    >\r \r     ![导入][cache-import-blobs]\r \r     可以通过关注 Azure 门户中的通知或通过查看[审核日志](../azure-resource-manager/resource-group-audit.md)中的事件，来监视导入操作的进度。\r \r     ![导入进度][cache-import-data-import-complete]\r \r ## <a name=\"export\"></a>导出\r 使用导出可以将 Azure Redis 缓存中存储的数据导出到与 Redis 兼容的 RDB 文件。 可以使用此功能将一个 Azure Redis 缓存实例中的数据移到另一个 Azure Redis 缓存实例或另一个 Redis 服务器。 在导出过程中，会在托管 Azure Redis 缓存服务器实例的 VM 上创建临时文件，并将该文件上传到指定的存储帐户。 导出操作完成后，无论状态为成功还是失败，都会删除临时文件。\r \r 1. 若要将缓存的当前内容导出到存储，请在 Azure 门户中[浏览到缓存](cache-configure.md#configure-redis-cache-settings)，然后在“资源”菜单中单击“导出数据”。\r \r     ![选择存储容器][cache-export-data-choose-storage-container]\r 2. 单击“选择存储容器”并选择所需的存储帐户  。 存储帐户必须与缓存在同一订阅和区域中。\r \r    > [!IMPORTANT]\r    > 导出适用于页 blob，经典存储帐户和 Resource Manager 存储帐户都支持页 blob，但目前 [Blob 存储帐户](../storage/blobs/storage-blob-storage-tiers.md#blob-storage-accounts)不支持页 blob。\r    >\r    >\r \r     ![存储帐户][cache-export-data-choose-account]\r 3. 选择所需的 blob 容器，并单击“选择” 。 如果要使用新容器，请单击“添加容器”以先添加该容器，再从列表中选择该容器  。\r \r     ![选择存储容器][cache-export-data-container]\r 4. 键入 **Blob 名称前缀**，单击“导出”开始导出过程。 blob 名称前缀用于作为此导出操作生成的文件名称的前缀。\r \r     ![导出][cache-export-data]\r \r     可通过关注 Azure 门户中的通知或查看[审核日志](../azure-resource-manager/resource-group-audit.md)中的事件，来监视导出操作的进度。\r \r     ![导出数据完成][cache-export-data-export-complete]\r \r     在导出过程中，缓存仍可供使用。\r \r ## <a name=\"importexport-faq\"></a>导入/导出常见问题\r 本部分包含有关导入/导出功能的常见问题。\r \r - [哪些定价层可以使用导入/导出？](#what-pricing-tiers-can-use-importexport)\r - [能否从任何 Redis 服务器导入数据？](#can-i-import-data-from-any-redis-server)\r - [可以导入哪些 RDB 版本？](#what-rdb-versions-can-i-import)\r - [导入/导出操作期间缓存是否可用？](#is-my-cache-available-during-an-importexport-operation)\r - [能否对 Redis 群集使用导入/导出？](#can-i-use-importexport-with-redis-cluster)\r - [导入/导出如何可用于自定义数据库设置？](#how-does-importexport-work-with-a-custom-databases-setting)\r - [导入/导出与 Redis 持久性有何区别？](#how-is-importexport-different-from-redis-persistence)\r - [能否使用 PowerShell、CLI 或其他管理客户端自动执行导入/导出？](#can-i-automate-importexport-using-powershell-cli-or-other-management-clients)\r - [我在导入/导出操作期间收到超时错误。它意味着什么？](#i-received-a-timeout-error-during-my-importexport-operation-what-does-it-mean)\r - [在将我的数据导出到 Azure Blob 存储时收到错误。发生了什么情况？](#i-got-an-error-when-exporting-my-data-to-azure-blob-storage-what-happened)\r \r ### <a name=\"what-pricing-tiers-can-use-importexport\"></a>哪些定价层可以使用导入/导出？\r 导入/导出仅在高级定价层中可用。\r \r ### <a name=\"can-i-import-data-from-any-redis-server\"></a>能否从任何 Redis 服务器导入数据？\r 能，除了导入从 Azure Redis 缓存实例导出的数据外，还可以从任何云或环境中运行的任何 Redis 服务器导入 RDB 文件，如 Linux、Windows 或云提供程序（如 Amazon Web Services）。 为此，请从所需的 Redis 服务器将 RDB 文件上传到 Azure 存储帐户中的页 blob 或块 blob，然后将其导入到高级 Azure Redis 缓存实例中。 例如，建议从生产缓存导出数据，并将其导入到用作过渡环境的一部分的缓存，用于测试或迁移。\r \r > [!IMPORTANT]\r > 使用页 blob 时，要成功导入从非 Azure Redis 缓存的 Redis 服务器导出的数据，页 blob 大小必须在 512 字节边界上对齐。 有关用于执行任何所需的字节填充的示例代码，请参阅[示例页 blob 上传](https://github.com/JimRoberts-MS/SamplePageBlobUpload)。\r > \r > \r \r ### <a name=\"what-rdb-versions-can-i-import\"></a>可以导入哪些 RDB 版本？\r \r 对于 RDB 版本 7 以及更低版本，Azure Redis 缓存支持 RDB 导入。\r \r ### <a name=\"is-my-cache-available-during-an-importexport-operation\"></a>导入/导出操作期间缓存是否可用？\r - **导出** - 缓存保持可用，可在导出操作过程中继续使用缓存。\r - **导入** - 在导入操作开始时，缓存即变为不可用，在导入操作完成后，缓存变为可供使用。\r \r ### <a name=\"can-i-use-importexport-with-redis-cluster\"></a>能否对 Redis 群集使用导入/导出？\r 能，并且可以在群集缓存和非群集缓存之间导入/导出。 由于 Redis 群集[仅支持数据库 0](cache-how-to-premium-clustering.md#do-i-need-to-make-any-changes-to-my-client-application-to-use-clustering)，因此将不会导入 0 以外的数据库中的任何数据。 导入群集缓存数据时，密钥会在群集的分片之间重新分发。\r \r ### <a name=\"how-does-importexport-work-with-a-custom-databases-setting\"></a>导入/导出如何使用自定义数据库设置？\r 某些定价层具有不同的[数据库限制](cache-configure.md#databases)，因此，如果在缓存创建过程中为 `databases` 设置配置了自定义值，则在导入时需注意一些注意事项。\r \r - 当导入到的定价层的 `databases` 限制低于导出层的相应限制时：\r   - 如果使用的是默认 `databases`数（对于所有定价层来说为 16），则不会丢失数据。\r   - 如果使用的是在要导入到的层的限制内的自定义 `databases` 数，则不会丢失数据。\r   - 如果导出的数据包含超出新层限制的数据库中的数据，则将不会导入这些更高版本数据库中的数据。\r \r ### <a name=\"how-is-importexport-different-from-redis-persistence\"></a>导入/导出与 Redis 持久性有何区别？\r Azure Redis 缓存持久性能够将 Redis 中存储的数据长期保存在 Azure 存储中。 配置暂留以后，Azure Redis 缓存会按照可配置的备份频率，将 Redis 缓存的快照以 Redis 二进制格式暂留在磁盘上。 如果发生了灾难性事件，导致主缓存和副本缓存都无法使用，则会使用最新快照自动还原缓存数据。 有关详细信息，请参阅[如何为高级 Azure Redis 缓存配置数据持久性](cache-how-to-premium-persistence.md)。\r \r 使用导入/导出，可以将数据引入 Azure Redis 缓存或从 Azure Redis 缓存中导出。 它不使用 Redis 持久性配置备份和还原。\r \r ### <a name=\"can-i-automate-importexport-using-powershell-cli-or-other-management-clients\"></a>能否使用 PowerShell、CLI 或其他管理客户端自动执行导入/导出？\r 能。如需 PowerShell 说明，请参阅[导入 Redis 缓存](cache-howto-manage-redis-cache-powershell.md#to-import-a-redis-cache)和[导出 Redis 缓存](cache-howto-manage-redis-cache-powershell.md#to-export-a-redis-cache)。\r \r ### <a name=\"i-received-a-timeout-error-during-my-importexport-operation-what-does-it-mean\"></a>在导入/导出操作期间收到超时错误。 它意味着什么？\r 如果在发起操作前停留在“导入数据”或“导出数据”边栏选项卡的时间超过 15 分钟，则将收到错误，其错误消息类似于以下示例：\r \r     The request to import data into cache 'contoso55' failed with status 'error' and error 'One of the SAS URIs provided could not be used for the following reason: The SAS token end time (se) must be at least 1 hour from now and the start time (st), if given, must be at least 15 minutes in the past.\r \r 若要解决此问题，请在经过 15 分钟前发起导入或导出操作。\r \r ### <a name=\"i-got-an-error-when-exporting-my-data-to-azure-blob-storage-what-happened\"></a>在将数据导出到 Azure Blob 存储时收到错误。 发生了什么情况？\r 导出仅适用于以页 blob 形式存储的 RDB 文件。 目前不支持其他 blob 类型，包括带有热层和冷层的 blob 存储帐户。 有关详细信息，请参阅 [Blob 存储帐户](../storage/blobs/storage-blob-storage-tiers.md#blob-storage-accounts)。\r \r ## <a name=\"next-steps\"></a>后续步骤\r 了解如何使用更多的高级缓存功能。\r \r - [Azure Redis 缓存高级层简介](cache-premium-tier-intro.md)    \r \r <!-- IMAGES -->\r [cache-settings-import-export-menu]: ./media/cache-how-to-import-export-data/cache-settings-import-export-menu.png\r [cache-export-data-choose-account]: ./media/cache-how-to-import-export-data/cache-export-data-choose-account.png\r [cache-export-data-choose-storage-container]: ./media/cache-how-to-import-export-data/cache-export-data-choose-storage-container.png\r [cache-export-data-container]: ./media/cache-how-to-import-export-data/cache-export-data-container.png\r [cache-export-data-export-complete]: ./media/cache-how-to-import-export-data/cache-export-data-export-complete.png\r [cache-export-data]: ./media/cache-how-to-import-export-data/cache-export-data.png\r [cache-import-data]: ./media/cache-how-to-import-export-data/cache-import-data.png\r [cache-import-choose-storage-account]: ./media/cache-how-to-import-export-data/cache-import-choose-storage-account.png\r [cache-import-choose-container]: ./media/cache-how-to-import-export-data/cache-import-choose-container.png\r [cache-import-choose-blobs]: ./media/cache-how-to-import-export-data/cache-import-choose-blobs.png\r [cache-import-blobs]: ./media/cache-how-to-import-export-data/cache-import-blobs.png\r [cache-import-data-import-complete]: ./media/cache-how-to-import-export-data/cache-import-data-import-complete.png\r \r <!--Update_Description: wording update-->\r "}