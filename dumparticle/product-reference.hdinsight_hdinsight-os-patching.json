{"Title":"为基于 Linux 的 HDInsight 群集配置 OS 修补计划 - Azure","Description":"了解如何为基于 Linux 的 HDInsight 群集配置 OS 修补计划。","Content":"# <a name=\"os-patching-for-hdinsight\"></a>针对 HDInsight 的 OS 修补 \r 作为托管的 Hadoop 服务，HDInsight 负责修补 HDInsight 群集使用的基础 VM 的 OS。 自 2016 年 8 月 1 日起，我们已经为基于 Linux 的 HDInsight 群集（版本 3.4 或更高版本）更改了来宾 OS 修补策略。 新策略的目标是显著减少由于修补导致的重启次数。 新策略会继续在 Linux 群集上修补虚拟机 (VM)，每周一或周四从 12AM UTC 开始以交错的方式在任意给定群集的节点上进行。 但是，任何给定 VM 最多只会因来宾 OS 修补而 30 天重启一次。 此外，自新创建群集的创建日期起 30 天内，该群集不会发生第一次重启。 重启 VM 后，修补程序即可生效。\r \r ## <a name=\"how-to-configure-the-os-patching-schedule-for-linux-based-hdinsight-clusters\"></a>如何为基于 Linux 的 HDInsight 群集配置 OS 修补计划\r 需不定期重启 HDInsight 群集中的虚拟机，以便安装重要的安全修补程序。 自 2016 年 8 月 1 日起，已使用以下计划重启新的基于 Linux 的 HDInsight 群集（版本 3.4 或更高版本）：\r \r 1. 群集中的虚拟机最多只能在 30 天内重启一次以进行修补。\r 2. 重新启动在 UTC 时间晚上 12 点开始。\r 3. 重新启动过程在群集中各个虚拟机之间交错进行，因此群集在重新启动过程中仍然可用。\r 4. 对于新创建的群集，第一次重新启动的时间不会早于群集创建日期之后的 30 天。\r \r 使用本文中描述的脚本操作，可以按如下所示修改 OS 修补计划：\r 1. 启用或禁用自动重新启动\r 2. 设置重新启动的频率（两次重新启动相隔的天数）\r 3. 设置在星期几重新启动\r \r > [!NOTE]\r > 此脚本操作仅适用于 2016 年 8 月 1 日后创建的基于 Linux 的 HDInsight 群集。 修补程序在 VM 重新启动后才生效。 \r >\r \r ## <a name=\"how-to-use-the-script\"></a>如何使用此脚本 \r \r 使用此脚本需要以下信息：\r 1. 脚本位置：https://hdiconfigactions.blob.core.windows.net/linuxospatchingrebootconfigv01/os-patching-reboot-config.sh。HDInsight 使用此 URI 在群集中的所有虚拟机上查找并运行脚本。\r \r 2. 脚本所适用的群集节点类型：头节点、辅助角色节点、zookeeper。 此脚本必须适用于群集中的所有节点类型。 如果此脚本不适用于某个节点类型，则该节点类型的虚拟机会继续使用以前的修补计划。\r \r 3.  参数：此脚本接受三个数字参数：\r \r     | 参数 | 定义 |\r     | --- | --- |\r     | 启用/禁用自动重新启动 |0 或 1。 值为 0 将禁用自动重新启动，值 为 1 会启用自动重新启动。 |\r     | 频率 |7 到 90（含）。 在重新启动虚拟机之前需等待的天数，适用于需要重新启动的修补程序。 |\r     | 星期几 |1 到 7（含）。 值为 1 表示应在星期一重新启动，值为 7 表示应在星期日重新启动。例如，使用参数 1 60 2 时，至多每隔 60 天就会在星期二自动重新启动。 |\r     | 持久性 |向现有群集应用脚本操作时，可将脚本标记为持久性脚本。 通过缩放操作将新的辅助角色节点添加到群集时，会应用持久性脚本。 |\r \r > [!NOTE]\r > 在应用到现有群集时，必须将该脚本标记为持久性脚本。 否则，通过缩放操作创建的任何新节点都会使用默认修补计划。\r 如果在群集创建过程中应用该脚本，则其会自动持久化。\r >\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 若要了解使用脚本操作的具体步骤，请参阅[使用脚本操作自定义基于 Linux 的 HDInsight 群集](hdinsight-hadoop-customize-cluster-linux.md)中的以下部分:\r \r * [在创建群集期间使用脚本操作](hdinsight-hadoop-customize-cluster-linux.md#use-a-script-action-during-cluster-creation)\r * [将脚本操作应用到正在运行的群集](hdinsight-hadoop-customize-cluster-linux.md#apply-a-script-action-to-a-running-cluster)\r \r \r <!--Update_Description: update wording and link references-->"}