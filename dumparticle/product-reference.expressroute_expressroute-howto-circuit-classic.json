{"Title":"修改 ExpressRoute 线路：PowerShell：Azure 经典","Description":"本文逐步讲解检查状态以及更新或删除并预配 ExpressRoute 经典部署模型线路的步骤。","Content":"# <a name=\"modify-an-expressroute-circuit-using-powershell-classic\"></a>使用 PowerShell 修改 ExpressRoute 线路（经典）\r \r > [!div class=\"op_single_selector\"]\r > * [Azure 门户](expressroute-howto-circuit-portal-resource-manager.md)\r > * [PowerShell](expressroute-howto-circuit-arm.md)\r > * [Azure CLI](howto-circuit-cli.md)\r > * [PowerShell（经典）](expressroute-howto-circuit-classic.md)\r >\r \r 本文还介绍如何查看状态，以及如何更新、删除和取消预配 ExpressRoute 线路。\r \r [!INCLUDE [expressroute-classic-end-include](../../includes/expressroute-classic-end-include.md)]\r \r \r **关于 Azure 部署模型**\r \r [!INCLUDE [vpn-gateway-clasic-rm](../../includes/vpn-gateway-classic-rm-include.md)]\r \r ## <a name=\"before-you-begin\"></a>开始之前\r \r 安装最新版本的 Azure 服务管理 (SM) PowerShell 模块\r \r 有关如何配置计算机以使用 Azure PowerShell 模块的分步指导，请遵循 [Azure PowerShell cmdlet 入门](../powershell-install-configure.md)中的说明。\r \r ## <a name=\"get-the-status-of-a-circuit\"></a>获取线路的状态\r \r 可以随时使用 `Get-AzureCircuit` cmdlet 检索此信息。 进行不带任何参数的调用将列出所有线路。\r \r ```powershell\r Get-AzureDedicatedCircuit\r \r     Bandwidth                        : 200\r     CircuitName                      : MyTestCircuit\r     Location                         : Beijing\r     ServiceKey                       : *********************************\r     ServiceProviderName              : Beijing Telecom Ethernet\r     ServiceProviderProvisioningState : Provisioned\r     Sku                              : Standard\r     Status                           : Enabled\r \r ```\r \r 可以将服务密钥作为参数传递给调用，从而获取特定 ExpressRoute 线路的相关信息。\r \r     Get-AzureDedicatedCircuit -ServiceKey \"*********************************\"\r \r     Bandwidth                        : 200\r     CircuitName                      : MyTestCircuit\r     Location                         : Beijing\r     ServiceKey                       : *********************************\r     ServiceProviderName              : Beijing Telecom Ethernet\r     ServiceProviderProvisioningState : Provisioned\r     Sku                              : Standard\r     Status                           : Enabled\r \r \r 可以通过运行以下示例获取所有这些参数的详细说明：\r \r ```powershell\r get-help get-azurededicatedcircuit -detailed\r ```\r \r ## <a name=\"modify-a-circuit\"></a>修改线路\r \r 可以在不影响连接的情况下修改 ExpressRoute 线路的某些属性。\r \r 可以在不停机的情况下执行以下任务：\r \r * 为 ExpressRoute 线路启用或禁用 ExpressRoute 高级版外接程序。\r * 增加 ExpressRoute 线路的带宽，前提是端口上有可用容量。 不支持对线路的带宽进行降级。 \r * 将计量套餐从数据流量套餐更改为无限制流量套餐。 不支持将计量套餐从无限制流量套餐更改为数据流量套餐。\r * 可以启用和禁用允许经典操作。\r \r 有关限制和局限性的详细信息，请参阅 [ExpressRoute 常见问题](./expressroute-faqs.md)。\r \r ### <a name=\"enable-the-expressroute-premium-add-on\"></a>启用 ExpressRoute 高级版外接程序\r \r 可以使用以下 PowerShell cmdlet 为现有线路启用 ExpressRoute 高级外接程序：\r \r ```powershell\r Set-AzureDedicatedCircuitProperties -ServiceKey \"*********************************\" -Sku Premium\r \r Bandwidth                        : 1000\r CircuitName                      : TestCircuit\r Location                         : Beijing\r ServiceKey                       : *********************************\r ServiceProviderName              : Beijing Telecom Ethernet\r ServiceProviderProvisioningState : Provisioned\r Sku                              : Premium\r Status                           : Enabled\r ```\r \r 现在，线路已启用 ExpressRoute 高级外接程序功能。 成功运行该命令后，就会开始对高级版外接程序功能计费。\r \r ### <a name=\"disable-the-expressroute-premium-add-on\"></a>禁用 ExpressRoute 高级版外接程序\r \r > [!IMPORTANT]\r > 如果使用的资源超出标准线路允许的范围，此操作可能会失败。\r > \r > \r \r #### <a name=\"considerations\"></a>注意事项\r \r * 从高级版降级到标准版之前，请确保链接到线路的虚拟网络数少于 10。 否则，更新请求会失败，并且会按高级版费率计费。\r * 必须取消其他地理政治区域的所有虚拟网络的链接。 否则，更新请求会失败，并且会按高级版费率计费。\r * 路由表中专用对等互连的路由必须少于 4,000。 如果路由表大小超出 4,000 个路由，则会删除 BGP 会话且不会重新启用它，除非已播发前缀的数目低于 4,000。\r \r #### <a name=\"to-disable-the-premium-add-on\"></a>禁用高级外接程序\r \r 可以使用以下 PowerShell cmdlet 为现有线路禁用 ExpressRoute 高级外接程序：\r \r ```powershell\r \r     Set-AzureDedicatedCircuitProperties -ServiceKey \"*********************************\" -Sku Standard\r \r     Bandwidth                        : 1000\r     CircuitName                      : TestCircuit\r     Location                         : Beijing\r     ServiceKey                       : *********************************\r     ServiceProviderName              : Beijing Telecom Ethernet\r     ServiceProviderProvisioningState : Provisioned\r     Sku                              : Standard\r     Status                           : Enabled\r ```\r \r ### <a name=\"update-the-expressroute-circuit-bandwidth\"></a>更新 ExpressRoute 线路带宽\r 有关提供商支持的带宽选项，请查看 [ExpressRoute 常见问题](./expressroute-faqs.md)。 只要在其上创建线路的物理端口允许，即可选取大于现有线路大小的任何大小。\r \r > [!IMPORTANT]\r > 如果现有端口上的容量不足，可能需要重新创建 ExpressRoute 线路。 如果该位置没有额外的可用容量，则不能升级线路。\r >\r > 但是，无法在不中断的情况下降低 ExpressRoute 线路的带宽。 带宽降级需要取消对 ExpressRoute 线路的预配，并重新预配新的 ExpressRoute 线路。\r > \r > \r \r #### <a name=\"resize-a-circuit\"></a>调整线路大小\r \r 确定所需的大小后，可以使用以下命令调整线路的大小：\r \r ```powershell\r Set-AzureDedicatedCircuitProperties -ServiceKey ********************************* -Bandwidth 1000\r \r Bandwidth                        : 1000\r CircuitName                      : TestCircuit\r Location                         : Beijing\r ServiceKey                       : *********************************\r ServiceProviderName              : Beijing Telecom Ethernet\r ServiceProviderProvisioningState : Provisioned\r Sku                              : Standard\r Status                           : Enabled\r ```\r \r 已经在 Microsoft 端估计线路的大小。 必须联系连接提供商，以便根据此更改更新其配置。 请注意，我们将从现在开始按照已更新的带宽选项计费。\r \r 如果在增加线路带宽时看到以下错误，这意味着创建现有线路的物理端口上没有足够的带宽可用。 必须删除此线路，并创建所需大小的新线路。 \r \r     Set-AzureDedicatedCircuitProperties : InvalidOperation : Insufficient bandwidth available to perform this circuit\r     update operation\r     At line:1 char:1\r     + Set-AzureDedicatedCircuitProperties -ServiceKey ********************* ...\r     + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r         + CategoryInfo          : CloseError: (:) [Set-AzureDedicatedCircuitProperties], CloudException\r         + FullyQualifiedErrorId : Microsoft.WindowsAzure.Commands.ExpressRoute.SetAzureDedicatedCircuitPropertiesCommand\r \r \r ## <a name=\"deprovision-and-delete-a-circuit\"></a>取消预配和删除线路\r \r ### <a name=\"considerations\"></a>注意事项\r \r * 必须取消所有虚拟网络与 ExpressRoute 线路的链接，才能成功执行此操作。 如果此操作失败，请查看是否有虚拟网络链接到了此线路。\r * 如果 ExpressRoute 线路服务提供商预配状态为“正在预配”或“已预配”，则必须与服务提供商合作，在他们一端取消预配线路。 在服务提供商取消对线路的预配并通知我们之前，我们会继续保留资源并收费。\r * 如果服务提供商已取消预配线路（服务提供商预配状态设置为“未预配”），则可以删除线路。 这样就会停止对线路的计费。\r \r #### <a name=\"delete-a-circuit\"></a>删除线路\r \r 可以通过运行以下命令删除 ExpressRoute 线路：\r \r ```powershell\r Remove-AzureDedicatedCircuit -ServiceKey \"*********************************\"\r ```\r \r <!--Update_Description:update wording and code-->"}