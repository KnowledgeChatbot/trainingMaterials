{"Title":"导入要在 Azure Cosmos DB 表 API 中使用的数据","Description":"了解如何导入要在 Azure Cosmos DB 表 API 中使用的数据。","Content":"# <a name=\"import-data-for-use-with-the-azure-cosmos-db-table-api\"></a>导入要在 Azure Cosmos DB 表 API 中使用的数据\r \r 本教程说明如何导入要在 Azure Cosmos DB [表 API](table-introduction.md) 中使用的数据。 如果已将数据存储在 Azure 表存储中，可以使用数据迁移工具或 AzCopy 来导入数据。 如果已将数据存储在 Azure Cosmos DB 表 API（预览版）帐户中，则必须使用数据迁移工具来迁移数据。 导入数据后，便可以利用 Azure Cosmos DB 提供的高级功能，例如统包式全局分发、专用吞吐量、99% 的情况下低至个位数的毫秒级延迟、有保障的高可用性，以及自动辅助索引。\r \r 本教程涵盖以下任务：\r \r > [!div class=\"checklist\"]\r > * 使用数据迁移工具导入数据\r > * 使用 AzCopy 导入数据\r > * 从表 API（预览版）迁移到表 API \r \r ## <a name=\"data-migration-tool\"></a>数据迁移工具\r \r 可以使用命令行形式的 Azure Cosmos DB 数据迁移工具 (dt.exe) 将现有 Azure 表存储数据导入到表 API GA 帐户，或者将数据从表 API（预览版）帐户迁移到表 API GA 帐户。 目前不支持其他源。\r \r 若要执行表数据迁移，请完成以下任务：\r \r 1. 从 [Microsoft 下载中心](http://www.microsoft.com/downloads/details.aspx?FamilyID=cda7703a-2774-4c07-adcc-ad02ddc1a44d)或从 [GitHub](https://github.com/azure/azure-documentdb-datamigrationtool) 下载迁移工具。\r 2. 使用适用于你的方案的命令行参数运行 `dt.exe`。\r \r dt.exe 采用以下格式的命令：\r \r     dt.exe [/<option>:<value>] /s:<source-name> [/s.<source-option>:<value>] /t:<target-name> [/t.<target-option>:<value>] \r \r 该命令的选项包括：\r \r     /ErrorLog: Optional. Name of the CSV file to redirect data transfer failures\r     /OverwriteErrorLog: Optional. Overwrite error log file\r     /ProgressUpdateInterval: Optional, default is 00:00:01. Time interval to refresh on-screen data transfer progress\r     /ErrorDetails: Optional, default is None. Specifies that detailed error information should be displayed for the following errors: None, Critical, All\r \r ### <a name=\"command-line-source-settings\"></a>命令行源设置\r \r 将 Azure 表存储或表 API 预览版定义为迁移源时，请使用以下源选项。\r \r     /s:AzureTable: Reads data from Azure Table storage\r     /s.ConnectionString: Connection string for the table endpoint. This can be retrieved from the Azure portal\r     /s.LocationMode: Optional, default is PrimaryOnly. Specifies which location mode to use when connecting to Azure Table storage: PrimaryOnly, PrimaryThenSecondary, SecondaryOnly, SecondaryThenPrimary\r     /s.Table: Name of the Azure Table\r     /s.InternalFields: Set to All for table migration as RowKey and PartitionKey are required for import.\r     /s.Filter: Optional. Filter string to apply\r     /s.Projection: Optional. List of columns to select\r \r 在从 Azure 表存储进行导入时，若要检索源连接字符串，请打开 Azure 门户并单击“存储帐户” > “帐户” > “访问密钥”，然后使用复制按钮复制**连接字符串**。\r \r ![HBase 源选项的屏幕截图](./media/table-import/storage-table-access-key.png)\r \r 在从 Azure 表存储进行导入时，若要检索源连接字符串，请打开 Azure 门户并单击“存储帐户” > “帐户” > “访问密钥”，然后使用复制按钮复制**连接字符串**。\r \r ![HBase 源选项的屏幕截图](./media/table-import/cosmos-connection-string.png)\r \r [示例 Azure 表存储命令](#azure-table-storage)\r \r [示例 Azure Cosmos DB 表 API（预览版）命令](#table-api-preview)\r \r ### <a name=\"command-line-target-settings\"></a>命令行目标设置\r \r 将 Azure Cosmos DB 表 API 定义为迁移目标时，请使用以下目标选项。\r \r     /t:TableAPIBulk: Uploads data into Azure CosmosDB Table in batches\r     /t.ConnectionString: Connection string for the table endpoint\r     /t.TableName: Specifies the name of the table to write to\r     /t.Overwrite: Optional, default is false. Specifies if existing values should be overwritten\r     /t.MaxInputBufferSize: Optional, default is 1GB. Approximate estimate of input bytes to buffer before flushing data to sink\r     /t.Throughput: Optional, service defaults if not specified. Specifies throughput to configure for table\r     /t.MaxBatchSize: Optional, default is 2MB. Specify the batch size in bytes\r \r <a id=\"azure-table-storage\"></a>\r ### <a name=\"sample-command-source-is-azure-table-storage\"></a>示例命令：源是 Azure 表存储\r \r 下面的命令行示例展示了如何从 Azure 表存储导入到表 API：\r \r ```\r dt /s:AzureTable /s.ConnectionString:DefaultEndpointsProtocol=https;AccountName=<Azure Table storage account name>;AccountKey==<Account Key>;EndpointSuffix=core.chinacloudapi.cn /s.Table:<Table name> /t:TableAPIBulk /t.ConnectionString:DefaultEndpointsProtocol=https;AccountName=<Azure Cosmos DB account name>;AccountKey=<Azure Cosmos DB account key>;TableEndpoint=https://<Account name>.table.cosmosdb.azure.cn:443 /t.TableName:<Table name> /t.Overwrite\r ```\r <a id=\"table-api-preview\"></a>\r ### <a name=\"sample-command-source-is-azure-cosmos-db-table-api-preview\"></a>示例命令：源是 Azure Cosmos DB 表 API（预览版）\r \r 下面的命令行示例展示了如何从表 API 预览版导入到表 API GA：\r \r ```\r dt /s:AzureTable /s.ConnectionString:DefaultEndpointsProtocol=https;AccountName=<Table API preview account name>;AccountKey=<Table API preview account key>;TableEndpoint=https://<Account Name>.documents.azure.cn; /s.Table:<Table name> /t:TableAPIBulk /t.ConnectionString:DefaultEndpointsProtocol=https;AccountName=<Azure Cosmos DB account name>;AccountKey=<Azure Cosmos DB account key>;TableEndpoint=https://<Account name>.table.cosmosdb.azure.cn:443 /t.TableName:<Table name> /t.Overwrite\r ```\r \r ## <a name=\"azcopy-command\"></a>AzCopy 命令\r \r 使用 AzCopy 命令行实用工具是将数据从 Azure 表存储迁移到 Azure Cosmos DB 表 API 的另一个选项。 若要使用 AzCopy，首先需要根据[从表存储导出数据](../storage/common/storage-use-azcopy.md#export-data-from-table-storage)中所述导出数据，然后根据 [Azure Cosmos DB 表 API](../storage/common/storage-use-azcopy.md#import-data-into-table-storage) 中所述将数据导入到 Azure Cosmos DB。\r \r 在执行到 Azure Cosmos DB 的导入时，请参阅以下示例。 注意，/Dest 值使用的是 cosmosdb，而不是 core。\r \r 示例导入命令：\r \r ```\r AzCopy /Source:C:\\myfolder\\ /Dest:https://myaccount.table.cosmosdb.chinacloudapi.cn/mytable1/ /DestKey:key /Manifest:\"myaccount_mytable_20140103T112020.manifest\" /EntityOperation:InsertOrReplace\r ```\r \r ## <a name=\"migrate-from-table-api-preview-to-table-api\"></a>从表 API（预览版）迁移到表 API\r \r > [!WARNING]\r > 如果希望立即享受正式版表带来的好处，请根据本部分中所述迁移现有的预览版表，否则，我们将在接下来的几周内为现有的预览版客户执行自动迁移，但请注意，自动迁移的预览版表将具有一些限制，而新创建的表则不会有这些限制。\r > \r \r 表 API 现在已为正式版 (GA)。 表的预览版和 GA 版之间有一些差异，这同时体现于在云中运行的代码和在客户端运行的代码。 因此，建议不要尝试将预览版 SDK 客户端与 GA 表 API 帐户混合使用，反之亦然。 对于希望在生产环境中继续使用其现有表的表 API 预览版客户，需要从预览版迁移到 GA 环境，或者等待自动迁移。 如果等待自动迁移，则会向你发送通知，指明迁移的表的限制。 在迁移后，将能够在现有帐户上创建没有限制的新表（只有迁移的表才会有限制）。\r \r 要从表 API（预览版）迁移到正式版表 API，请执行以下操作：\r \r 1. 如[创建数据库帐户](create-table-dotnet.md#create-a-database-account)中所述，创建一个新的 Azure Cosmos DB 帐户并将其 API 类型设置为 Azure 表。\r \r 2. 将客户端更改为使用[表 API SDK](table-sdk-dotnet.md) 的 GA 版。\r \r 3. 使用数据迁移工具将客户端数据从预览版表迁移到 GA 表。 [数据迁移工具](#data-migration-tool)中提供了将数据迁移工具用于此用途的说明。 \r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 本教程介绍了如何：\r \r > [!div class=\"checklist\"]\r > * 使用数据迁移工具导入数据\r > * 使用 AzCopy 导入数据\r > * 从表 API（预览版）迁移到表 API\r \r 现在可以继续学习下一教程并了解如何使用 Azure Cosmos DB 表 API 查询数据。 \r \r > [!div class=\"nextstepaction\"]\r >[如何查询数据？](../cosmos-db/tutorial-query-table.md)\r \r <!-- Update_Description: new articles on table import -->"}