{"Title":"Azure 自动化中的证书资产","Description":"可以安全地将证书存储在 Azure 自动化中，以便可以通过 Runbook 访问这些证书，对 Azure 和第三方资源进行身份验证。 本文介绍了有关证书的详细信息，以及如何在文本和图形创作中使用证书。","Content":"# <a name=\"certificate-assets-in-azure-automation\"></a>Azure 自动化中的证书资产\r \r 可以安全地将证书存储在 Azure 自动化中，以便使用 Get-AzureAutomationCertificate 活动通过 Runbook 访问这些证书。 这样，便可以创建使用证书进行身份验证的 Runbook，或者将证书添加到 Azure 或第三方资源。\r \r > [!NOTE] \r > Azure 自动化中的安全资产包括凭据、证书、连接和加密的变量。 这些资产已使用针对每个自动化帐户生成的唯一密钥加密并存储在 Azure 自动化中。 此密钥由主证书加密，并存储在 Azure 自动化中。 在存储安全资产之前，会先使用主证书来解密自动化帐户的密钥，然后使用该密钥来加密资产。\r > \r \r ## <a name=\"windows-powershell-cmdlets\"></a>Windows PowerShell Cmdlet\r \r 下表中的 cmdlet 用于通过 Windows PowerShell 创建和管理自动化证书资产。 可在自动化 Runbook 中使用的 [Azure PowerShell 模块](../powershell-install-configure.md)已随附了这些 cmdlet。\r \r |Cmdlet|说明|\r |:---|:---|\r |[Get-AzureAutomationCertificate](https://msdn.microsoft.com/library/dn913765.aspx)|检索有关证书的信息。 只能从 Get-AzureAutomationCertificate 活动中检索证书本身。|\r |[New-AzureAutomationCertificate](https://msdn.microsoft.com/library/dn913764.aspx)|将新证书创建到 Azure 自动化中。|\r [Remove-AzureAutomationCertificate](https://msdn.microsoft.com/library/dn913773.aspx)|从 Azure自动化中删除证书。|\r |[Set-AzureAutomationCertificate](https://msdn.microsoft.com/library/dn913763.aspx)|设置现有证书的属性，包括上传证书文件和设置 .pfx 的密码。|\r |[Add-AzureCertificate](https://msdn.microsoft.com/library/azure/dn495214.aspx)|为指定的云服务上传服务证书。|\r \r ## <a name=\"creating-a-new-certificate\"></a>创建新证书\r \r 创建新证书时，需要将 .cer 或 .pfx 文件上传到 Azure 自动化。 将证书标记为可导出后，可以将其转出 Azure 自动化证书存储区。 如果证书不可导出，则它只可用于在 Runbook 中签名。\r \r ### <a name=\"to-create-a-new-certificate-with-the-azure-classic-management-portal\"></a>使用 Azure 经典管理门户创建新证书\r \r 1. 在你的自动化帐户中，单击窗口顶部的“资产”  。\r 2. 在窗口底部，单击“添加设置” 。\r 3. 单击“添加凭据” 。\r 4. 在“凭据类型”下拉列表中，选择“证书”。\r 5. 在“名称”框中键入证书的名称，然后单击右箭头  。\r 6. 浏览到 .cer 或 .pfx 文件。  如果选择了 .pfx 文件，请指定密码，以及它是否允许导出。\r 7. 单击复选标记上传该证书文件。\r \r ### <a name=\"to-create-a-new-certificate-with-windows-powershell\"></a>使用 Windows PowerShell 创建新证书\r \r 以下示例演示了如何创建新的自动化证书并将其标记为可导出。 这将导入现有的 .pfx 文件。\r \r     $certName = 'MyCertificate'\r     $certPath = '.\\MyCert.pfx'\r     $certPwd = ConvertTo-SecureString -String 'P@$$w0rd' -AsPlainText -Force\r \r     New-AzureAutomationCertificate -AutomationAccountName \"MyAutomationAccount\" -Name $certName -Path $certPath -Password $certPwd -Exportable\r \r ## <a name=\"using-a-certificate\"></a>使用证书\r \r 必须通过 **Get-AutomationCertificate** 活动来使用证书。 不能使用 [Get-AzureAutomationCertificate](https://msdn.microsoft.com/library/dn913765.aspx) cmdlet，因为它返回有关证书资产的信息，而不是证书本身的信息。\r \r ### <a name=\"textual-runbook-sample\"></a>文本 Runbook 示例\r \r 以下示例代码演示了如何将证书添加到 Runbook 中的云服务。 在此示例中，已从加密的自动化变量检索了密码。\r \r     $serviceName = 'MyCloudService'\r     $cert = Get-AutomationCertificate -Name 'MyCertificate'\r     $certPwd = Get-AutomationVariable -Name 'MyCertPassword'\r     Add-AzureCertificate -ServiceName $serviceName -CertToDeploy $cert\r "}