{"Title":"在 Azure VM 上安装 LEMP Web 服务器","Description":"教程 - 在 Azure 中的 Linux VM上安装 LEMP 堆栈","Content":"# <a name=\"install-a-lemp-web-server-on-an-azure-vm\"></a>在 Azure VM 上安装 LEMP Web 服务器\r 本文逐步讲解如何在 Azure 中的 Ubuntu VM 上部署 NGINX Web 服务器、MySQL 和 PHP（LEMP 堆栈）。 LEMP 堆栈可以替代常用的 [LAMP 堆栈](tutorial-lamp-stack.md)，可安装在 Azure 中。 若要了解 LEMP 服务器的运作情况，可以选择性地安装并配置 WordPress 站点。 本教程介绍如何执行下列操作：\r \r > [!div class=\"checklist\"]\r > * 创建 Ubuntu VM（LEMP 堆栈中的“L”）\r > * 为 Web 流量打开端口 80\r > * 安装 NGINX、MySQL 和 PHP\r > * 验证安装和配置\r > * 在 LEMP 服务器上安装 WordPress\r \r [!INCLUDE [azure-cli-2-azurechinacloud-environment-parameter](../../../includes/azure-cli-2-azurechinacloud-environment-parameter.md)]\r \r 如果选择在本地安装并使用 CLI，本教程要求运行 Azure CLI 2.0.4 或更高版本。 运行 `az --version` 即可查找版本。 如果需要进行安装或升级，请参阅[安装 Azure CLI 2.0](https://docs.azure.cn/zh-cn/cli/install-azure-cli?view=azure-cli-latest)。 \r \r [!INCLUDE [virtual-machines-linux-tutorial-stack-intro.md](../../../includes/virtual-machines-linux-tutorial-stack-intro.md)]\r \r ## <a name=\"install-nginx-mysql-and-php\"></a>安装 NGINX、MySQL 和 PHP\r \r 运行以下命令更新 Ubuntu 包源并安装 NGINX、MySQL 和 PHP。 \r \r ```bash\r sudo apt update && sudo apt install nginx mysql-server php-mysql php php-fpm\r ```\r \r 系统会提示安装包和其他依赖项。 出现提示时，请为 MySQL 设置 root 密码，并按 [Enter] 继续。 遵照剩余的提示操作。 此股从会安装最低要求的 PHP 扩展，这些扩展是通过 MySQL 使用 PHP 所必需的。 \r \r ![MySQL root 密码页][1]\r \r ## <a name=\"verify-installation-and-configuration\"></a>验证安装和配置\r \r ### <a name=\"nginx\"></a>NGINX\r \r 使用以下命令检查 NGINX 版本：\r ```bash\r nginx -v\r ```\r \r 安装 NGINX 并向 VM 打开端口 80 以后，即可通过 Internet 访问 Web 服务器。 若要查看 NGINX 欢迎页，请打开 Web 浏览器并输入 VM 的公共 IP 地址。 使用通过 SSH 连接到 VM 时所用的公共 IP 地址：\r \r ![NGINX 默认页][3]\r \r ### <a name=\"mysql\"></a>MySQL\r \r 使用以下命令检查 MySQL 版本（请注意大写的 `V` 参数）：\r \r ```bash\r mysql -V\r ```\r \r 建议运行以下脚本来帮助保护 MySQL 的安装：\r \r ```bash\r mysql_secure_installation\r ```\r \r 输入 MySQL root 密码，并配置环境的安全设置。\r \r 如果想要创建 MySQL 数据库，请添加用户或更改配置设置，并登录到 MySQL：\r \r ```bash\r mysql -u root -p\r ```\r \r 完成后，键入 `\\q` 退出 mysql 提示符。\r \r ### <a name=\"php\"></a>PHP\r \r 使用以下命令检查 PHP 版本：\r \r ```bash\r php -v\r ```\r \r 配置 NGINX 以使用 PHP FastCGI Process Manager (PHP-FPM)。 运行以下命令备份原始 NGINX 服务器块配置文件，并在所选的编辑器中编辑原始文件：\r \r ```bash\r sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default_backup\r \r sudo sensible-editor /etc/nginx/sites-available/default\r ```\r \r 在编辑器中，将 `/etc/nginx/sites-available/default` 的内容替换为以下内容。 请参阅注释了解设置说明。 用自己 VM 的公共 IP 地址替换 *yourPublicIPAddress*，并保留其余设置。 然后保存文件。\r \r ```\r server {\r     listen 80 default_server;\r     listen [::]:80 default_server;\r \r     root /var/www/html;\r     # Homepage of website is index.php\r     index index.php;\r \r     server_name yourPublicIPAddress;\r \r     location / {\r         try_files $uri $uri/ =404;\r     }\r \r     # Include FastCGI configuration for NGINX\r     location ~ \\.php$ {\r         include snippets/fastcgi-php.conf;\r         fastcgi_pass unix:/run/php/php7.0-fpm.sock;\r     }\r }\r ```\r \r 检查 NGINX 配置中的语法错误：\r \r ```bash\r sudo nginx -t\r ```\r \r 如果语法正确，请使用以下命令重启 NGINX：\r \r ```bash\r sudo service nginx restart\r ```\r \r 如果想要进一步测试，请创建一个可在浏览器中查看的快速 PHP 信息页。 以下命令创建 PHP 信息页：\r \r ```bash\r sudo sh -c 'echo \"<?php phpinfo(); ?>\" > /var/www/html/info.php'\r ```\r \r 现在，可以检查创建的 PHP 信息页。 打开浏览器并转到 `http://yourPublicIPAddress/info.php`。 替换 VM 的公共 IP 地址。 应如下图所示。\r \r ![PHP 信息页][2]\r \r [!INCLUDE [virtual-machines-linux-tutorial-wordpress.md](../../../includes/virtual-machines-linux-tutorial-wordpress.md)]\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 本教程在 Azure 中部署了一台 LEMP 服务器。 你已了解如何：\r \r > [!div class=\"checklist\"]\r > * 创建 Ubuntu VM\r > * 为 Web 流量打开端口 80\r > * 安装 NGINX、MySQL 和 PHP\r > * 验证安装和配置\r > * 在 LEMP 堆栈上安装 WordPress\r \r 转到下一教程，了解如何使用 SSL 证书保护 Web 服务器。\r \r > [!div class=\"nextstepaction\"]\r > [使用 SSL 保护 Web 服务器](tutorial-secure-web-server.md)\r \r [1]: ./media/tutorial-lemp-stack/configmysqlpassword-small.png\r [2]: ./media/tutorial-lemp-stack/phpsuccesspage.png\r [3]: ./media/tutorial-lemp-stack/nginx.png\r \r <!--Update_Description: update meta properties, wording update-->"}