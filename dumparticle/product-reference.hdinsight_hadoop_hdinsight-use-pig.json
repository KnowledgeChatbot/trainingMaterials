{"Title":"在 HDInsight 中使用 Hadoop Pig","Description":"了解如何将 Pig 与 HDInsight 上的 Hadoop 配合使用。","Content":"# <a name=\"use-pig-with-hadoop-on-hdinsight\"></a>将 Pig 与 Hadoop on HDInsight 配合使用\r \r 了解如何将 [Apache Pig](http://pig.apache.org/) 与 HDInsight 配合使用...\r \r Pig 是一个平台，可以使用名为 *Pig Latin* 的过程语言为 Hadoop 创建程序。 Pig 可以替代 Java 来创建 *MapReduce* 解决方案，它已包括在 Azure HDInsight 中。 使用下表可以找出将 Pig 与 HDInsight 配合使用的各种方法：\r \r | **使用此方法** ，如果想要... | ... **交互式** shell | ...**批处理** | ...使用此 **群集操作系统** | ...从此 **客户端操作系统** |\r |:--- |:---:|:---:|:--- |:--- |\r | [SSH](apache-hadoop-use-pig-ssh.md) |✔ |✔ |Linux |Linux、Unix、Mac OS X 或 Windows |\r | [REST API](apache-hadoop-use-pig-curl.md) |&nbsp; |✔ |Linux 或 Windows |Linux、Unix、Mac OS X 或 Windows |\r | [.NET SDK for Hadoop](apache-hadoop-use-pig-dotnet-sdk.md) |&nbsp; |✔ |Linux 或 Windows |Windows（暂时） |\r | [Windows PowerShell](apache-hadoop-use-pig-powershell.md) |&nbsp; |✔ |Linux 或 Windows |Windows |\r | [远程桌面](apache-hadoop-use-pig-remote-desktop.md)（HDInsight 3.2 和 3.3） |✔ |✔ |Windows |Windows |\r \r > [!IMPORTANT]\r > Linux 是在 HDInsight 3.4 版或更高版本上使用的唯一操作系统。 有关详细信息，请参阅 [HDInsight 在 Windows 上停用](../hdinsight-component-versioning.md#hdinsight-windows-retirement)。\r \r ## <a id=\"why\"></a>为何使用 Pig\r \r 在 Hadoop 中使用 MapReduce 来处理数据时，其中一项难题是仅使用映射和化简函数来实现处理逻辑。 进行复杂的处理时，通常必须将处理分解成多个 MapReduce 操作，这些操作合在一起即可获得所需的结果。\r \r 使用 Pig，可以将处理定义成一系列转换，相关数据经过这些转换即可生成所需的输出。\r \r 通过 Pig Latin 语言，可以描述从原始输入开始，经过一个或多个转换，最终生成所需输出的数据流。 Pig Latin 程序遵循下述常规模式：\r \r * **加载**：从文件系统中读取要操作的数据\r \r * **转换**：操作该数据\r \r * **转储或存储**：将数据输出到屏幕或将其存储后再进行处理\r \r ### <a name=\"user-defined-functions\"></a>用户定义的函数\r \r Pig Latin 还支持使用用户定义函数 (UDF) 来调用外部组件，以便实现难以在 Pig Latin 中建模的逻辑。\r \r 有关 Pig Latin 的详细信息，请参阅 [Pig Latin Reference Manual 1](http://pig.apache.org/docs/r0.7.0/piglatin_ref1.html)（Pig Latin 参考手册 1）和 [Pig Latin Reference Manual 2](http://pig.apache.org/docs/r0.7.0/piglatin_ref2.html)（Pig Latin 参考手册 2）。\r \r 如需通过 Pig 使用 UDF 的示例，请参阅以下文档：\r \r * [在 HDInsight 中通过 Pig 使用 DataFu](apache-hadoop-use-pig-datafu-udf.md) - DataFu 是由 Apache 维护的有用 UDF 的集合\r * [在 HDInsight 中将 Python 与 Pig 和 Hive 配合使用](python-udf-hdinsight.md)\r * [在 HDInsight 中将 C# 与 Hive 和 Pig 配合使用](apache-hadoop-hive-pig-udf-dotnet-csharp.md)\r \r ## <a id=\"data\"></a>示例数据\r \r HDInsight 提供各种示例数据集，它们存储在 `/example/data` 和 `/HdiSamples` 目录中。 这些目录位于群集的默认存储中。 本文档中的 Pig 示例使用来自 `/example/data/sample.log` 的 *log4j* 文件。\r \r 该文件中的每个日志都包含一行字段，其中包含一个 `[LOG LEVEL]` 字段，用于显示类型和严重性，例如：\r \r     2012-02-03 20:26:41 SampleClass3 [ERROR] verbose detail for id 1527353937\r \r 在前面的示例中，日志级别为 ERROR。\r \r > [!NOTE]\r > 还可以使用 [Apache Log4j](http://en.wikipedia.org/wiki/Log4j) 日志记录工具来生成 log4j 文件，然后将该文件上传到 Blob。 请参阅[将数据上传到 HDInsight](../hdinsight-upload-data.md) 以获取相关说明。 有关如何将 Azure 存储中的 Blob 与 HDInsight 配合使用的详细信息，请参阅[将 Azure Blob 存储与 HDInsight 配合使用](../hdinsight-hadoop-use-blob-storage.md)。\r \r ## <a id=\"job\"></a>示例作业\r \r 下面的 Pig Latin 作业从 HDInsight 群集的默认存储加载 `sample.log` 文件。 然后，它会执行一系列转换，对输入数据中出现的每个日志级别进行计数。 结果会写入 STDOUT。\r \r     LOGS = LOAD 'wasb:///example/data/sample.log';\r     LEVELS = foreach LOGS generate REGEX_EXTRACT($0, '(TRACE|DEBUG|INFO|WARN|ERROR|FATAL)', 1)  as LOGLEVEL;\r     FILTEREDLEVELS = FILTER LEVELS by LOGLEVEL is not null;\r     GROUPEDLEVELS = GROUP FILTEREDLEVELS by LOGLEVEL;\r     FREQUENCIES = foreach GROUPEDLEVELS generate group as LOGLEVEL, COUNT(FILTEREDLEVELS.LOGLEVEL) as COUNT;\r     RESULT = order FREQUENCIES by COUNT desc;\r     DUMP RESULT;\r \r 下图概要显示每个转换对数据的影响。\r \r ![转换的图形表示形式][image-hdi-pig-data-transformation]\r \r ## <a id=\"run\"></a>运行 Pig Latin 作业\r \r HDInsight 可以使用各种方法来运行 Pig Latin 作业。 使用下表来确定哪种方法最适合用户，并访问此链接进行演练。\r \r | **使用此方法** ，如果想要... | ... **交互式** shell | ...**批处理** | ...使用此**群集操作系统** | ...通过此**客户端** |\r |:--- |:---:|:---:|:--- |:--- |\r | [SSH](apache-hadoop-use-pig-ssh.md) |✔ |✔ |Linux |Linux、Unix、Mac OS X 或 Windows |\r | [Curl](apache-hadoop-use-pig-curl.md) |&nbsp; |✔ |Linux 或 Windows |Linux、Unix、Mac OS X 或 Windows |\r | [.NET SDK for Hadoop](apache-hadoop-use-pig-dotnet-sdk.md) |&nbsp; |✔ |Linux 或 Windows |Windows（暂时） |\r | [Windows PowerShell](apache-hadoop-use-pig-powershell.md) |&nbsp; |✔ |Linux 或 Windows |Windows |\r | [远程桌面](apache-hadoop-use-pig-remote-desktop.md)（HDInsight 3.2 和 3.3） |✔ |✔ |Windows |Windows |\r \r [!INCLUDE [hdinsight-linux-acn-version.md](../../../includes/hdinsight-linux-acn-version.md)]\r \r > [!IMPORTANT]\r > Linux 是在 HDInsight 3.4 版或更高版本上使用的唯一操作系统。 有关详细信息，请参阅 [HDInsight 在 Windows 上停用](../hdinsight-component-versioning.md#hdinsight-windows-retirement)。\r \r ## <a name=\"pig-and-sql-server-integration-services\"></a>Pig 和 SQL Server Integration Services\r \r 可以使用 SQL Server Integration Services (SSIS) 来运行 Pig 作业。 Azure Feature Pack for SSIS 提供适用于 HDInsight 上的 Pig 作业的以下组件。\r \r * [Azure HDInsight Pig 任务][pigtask]\r \r * [Azure 订阅连接管理器][connectionmanager]\r \r 在 [此处][ssispack]了解有关 Azure Feature Pack for SSIS 的详细信息。\r \r ## <a id=\"nextsteps\"></a>后续步骤\r 现在，已了解如何将 Pig 与 HDInsight 配合使用，请使用以下链接来学习 Azure HDInsight 的其他用法。\r \r * [将数据上传到 HDInsight](../hdinsight-upload-data.md)\r * [将 Hive 与 HDInsight 配合使用][hdinsight-use-hive]\r * [将 Sqoop 与 HDInsight 配合使用](hdinsight-use-sqoop.md)\r * [将 Oozie 与 HDInsight 配合使用](../hdinsight-use-oozie.md)\r * [将 MapReduce 作业与 HDInsight 配合使用][hdinsight-use-mapreduce]\r \r [apachepig-home]: http://pig.apache.org/\r [putty]: http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html\r [curl]: http://curl.haxx.se/\r [pigtask]: http://msdn.microsoft.com/library/mt146781(v=sql.120).aspx\r [connectionmanager]: http://msdn.microsoft.com/library/mt146773(v=sql.120).aspx\r [ssispack]: http://msdn.microsoft.com/library/mt146770(v=sql.120).aspx\r [hdinsight-admin-powershell]: ../hdinsight-administer-use-powershell.md\r \r [hdinsight-use-hive]:../hdinsight-use-hive.md\r [hdinsight-use-mapreduce]:../hdinsight-use-mapreduce.md\r \r [hdinsight-provision]: ../hdinsight-hadoop-provision-linux-clusters.md\r [hdinsight-submit-jobs]:submit-apache-hadoop-jobs-programmatically.md#mapreduce-sdk\r \r [Powershell-install-configure]: https://docs.microsoft.com/powershell/azureps-cmdlets-docs\r \r [powershell-start]: http://technet.microsoft.com/library/hh847889.aspx\r \r [image-hdi-pig-data-transformation]: ./media/hdinsight-use-pig/HDI.DataTransformation.gif\r \r \r <!--Update_Description: update wording and link references-->"}