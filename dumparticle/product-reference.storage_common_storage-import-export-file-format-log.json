{"Title":"Azure 导入/导出日志文件格式","Description":"了解针对导入/导出服务作业执行步骤时创建的日志文件的格式。","Content":"# <a name=\"azure-importexport-service-log-file-format\"></a>Azure 导入/导出服务日志文件格式\r 当 Azure 导入/导出服务在执行导入作业或导出作业的过程中针对驱动器执行某个操作时，会将日志写入到与该作业关联的存储帐户中的块 Blob 中。  \r \r 导入/导出服务可能会写入两种日志：  \r \r -   发生错误时始终生成错误日志。  \r \r -   详细日志默认未启用，但可通过对[放置作业](https://docs.microsoft.com/rest/api/storageimportexport/jobs#Jobs_CreateOrUpdate)或[更新作业属性](https://docs.microsoft.com/rest/api/storageimportexport/jobs#Jobs_Update)操作设置 `EnableVerboseLog` 属性来启用该日志。  \r \r ## <a name=\"log-file-location\"></a>日志文件位置  \r 日志将写入到 `ImportExportStatesPath` 设置（可在“`Put Job`”操作中设置）指定的容器或虚拟目录中的块 Blob。 日志写入到的位置取决于为该作业指定身份验证的方式，以及为 `ImportExportStatesPath`指定的值。 可通过存储帐户密钥或容器 SAS（共享访问签名）为作业指定身份验证。  \r \r 容器或虚拟目录的名称可以是 `waimportexport`的默认名称，也可以是指定的另一个容器或虚拟目录名称。  \r \r 下表显示了可能的选项：  \r \r |身份验证方法|`ImportExportStatesPath`元素的值|日志 Blob 的位置|  \r |---------------------------|----------------------------------------------|---------------------------|  \r |存储帐户密钥|默认值|名为 `waimportexport` 的容器，这是默认容器。 例如：<br /><br /> `https://myaccount.blob.core.chinacloudapi.cn/waimportexport`|  \r |存储帐户密钥|用户指定的值|由用户命名的容器。 例如：<br /><br /> `https://myaccount.blob.core.chinacloudapi.cn/mylogcontainer`|  \r |容器 SAS|默认值|名为 `waimportexport` 的虚拟目录，这是默认名称，位于 SAS 中指定的容器下方。<br /><br /> 例如，如果为作业指定的 SAS 是 `https://myaccount.blob.core.chinacloudapi.cn/mylogcontainer?sv=2012-02-12&se=2015-05-22T06%3A54%3A55Z&sr=c&sp=wl&sig=sigvalue`，则日志位置应为 `https://myaccount.blob.core.chinacloudapi.cn/mylogcontainer/waimportexport`|  \r |容器 SAS|用户指定的值|由用户命名的虚拟目录，位于 SAS 中指定的容器下方。<br /><br /> 例如，如果为作业指定的 SAS 是 `https://myaccount.blob.core.chinacloudapi.cn/mylogcontainer?sv=2012-02-12&se=2015-05-22T06%3A54%3A55Z&sr=c&sp=wl&sig=sigvalue`，指定的虚拟目录名为 `mylogblobs`，则日志位置应为 `https://myaccount.blob.core.chinacloudapi.cn/mylogcontainer/waimportexport/mylogblobs`。|  \r \r 可以通过调用 [获取作业](https://docs.microsoft.com/rest/api/storageimportexport/jobs#Jobs_CreateOrUpdate) 操作来检索错误日志和详细日志的 URL。 处理完驱动器后，会提供日志。  \r \r ## <a name=\"log-file-format\"></a>日志文件格式  \r 这两种日志的格式相同：它是一个 Blob，包含在硬盘驱动器与客户帐户之间复制 Blob 时发生的事件的 XML 说明。  \r \r 详细日志包含有关每个 Blob（针对导入作业）或文件（针对导出作业）的复制操作状态的完整信息，错误日志仅包含执行导入作业或导出作业期间遇到错误的 Blob 或文件的信息。  \r \r 详细日志格式如下所示。 错误日志具有相同的结构，但可筛选出成功的操作。  \r \r ```xml\r <DriveLog Version=\"2014-11-01\">  \r   <DriveId>drive-id</DriveId>  \r   [<Blob Status=\"blob-status\">  \r    <BlobPath>blob-path</BlobPath>  \r    <FilePath>file-path</FilePath>  \r    [<Snapshot>snapshot</Snapshot>]  \r    <Length>length</Length>  \r    [<LastModified>last-modified</LastModified>]  \r    [<ImportDisposition Status=\"import-disposition-status\">import-disposition</ImportDisposition>]  \r    [page-range-list-or-block-list]  \r    [metadata-status]  \r    [properties-status]  \r   </Blob>]  \r   [<Blob>  \r     . . .  \r   </Blob>]  \r   <Status>drive-status</Status>  \r </DriveLog>  \r \r page-range-list-or-block-list ::= \r   page-range-list | block-list  \r \r page-range-list ::=   \r <PageRangeList>  \r       [<PageRange Offset=\"page-range-offset\" Length=\"page-range-length\"   \r        [Hash=\"md5-hash\"] Status=\"page-range-status\"/>]  \r       [<PageRange Offset=\"page-range-offset\" Length=\"page-range-length\"   \r        [Hash=\"md5-hash\"] Status=\"page-range-status\"/>]  \r </PageRangeList>  \r \r block-list ::=  \r <BlockList>  \r       [<Block Offset=\"block-offset\" Length=\"block-length\" [Id=\"block-id\"]  \r        [Hash=\"md5-hash\"] Status=\"block-status\"/>]  \r       [<Block Offset=\"block-offset\" Length=\"block-length\" [Id=\"block-id\"]   \r        [Hash=\"md5-hash\"] Status=\"block-status\"/>]  \r </BlockList>  \r \r metadata-status ::=  \r <Metadata Status=\"metadata-status\">  \r    [<GlobalPath Hash=\"md5-hash\">global-metadata-file-path</GlobalPath>]  \r    [<Path Hash=\"md5-hash\">metadata-file-path</Path>]  \r </Metadata>  \r \r properties-status ::=  \r <Properties Status=\"properties-status\">  \r    [<GlobalPath Hash=\"md5-hash\">global-properties-file-path</GlobalPath>]  \r    [<Path Hash=\"md5-hash\">properties-file-path</Path>]  \r </Properties>  \r ```\r \r 下表介绍了日志文件的元素。  \r \r |XML 元素|类型|说明|  \r |-----------------|----------|-----------------|  \r |`DriveLog`|XML 元素|表示驱动器日志。|  \r |`Version`|属性，字符串|日志格式的版本。|  \r |`DriveId`|String|驱动器的硬件序列号。|  \r |`Status`|String|驱动器处理状态。 有关详细信息，请参阅下面的“ `Drive Status Codes` ”表。|  \r |`Blob`|嵌套的 XML 元素|表示 Blob。|  \r |`Blob/BlobPath`|String|Blob 的 URI。|  \r |`Blob/FilePath`|String|驱动器上文件的相对路径。|  \r |`Blob/Snapshot`|DateTime|Blob 的快照版本（仅适用于导出作业）。|  \r |`Blob/Length`|Integer|Blob 的总长度（字节）。|  \r |`Blob/LastModified`|DateTime|上次修改 Blob 的日期/时间（仅适用于导出作业）。|  \r |`Blob/ImportDisposition`|String|Blob 的导入处置（仅适用于导入作业）。|  \r |`Blob/ImportDisposition/@Status`|属性，字符串|导入处理状态。|  \r |`PageRangeList`|嵌套的 XML 元素|表示页 Blob 的页面范围列表。|  \r |`PageRange`|XML 元素|表示页面范围。|  \r |`PageRange/@Offset`|属性，整数|Blob 中页面范围的起始偏移量。|  \r |`PageRange/@Length`|属性，整数|页面范围的长度（字节）。|  \r |`PageRange/@Hash`|属性，字符串|页面范围的 Base16 编码 MD5 哈希。|  \r |`PageRange/@Status`|属性，字符串|页面范围的处理状态。|  \r |`BlockList`|嵌套的 XML 元素|表示块 Blob 的块列表。|  \r |`Block`|XML 元素|表示块。|  \r |`Block/@Offset`|属性，整数|Blob 中块的起始偏移量。|  \r |`Block/@Length`|属性，整数|块的长度（字节）。|  \r |`Block/@Id`|属性，字符串|块 ID。|  \r |`Block/@Hash`|属性，字符串|块的 Base16 编码 MD5 哈希。|  \r |`Block/@Status`|属性，字符串|块的处理状态。|  \r |`Metadata`|嵌套的 XML 元素|表示 Blob 的元数据。|  \r |`Metadata/@Status`|属性，字符串|Blob 元数据的处理状态。|  \r |`Metadata/GlobalPath`|String|全局元数据文件的相对路径。|  \r |`Metadata/GlobalPath/@Hash`|属性，字符串|全局元数据文件的 Base16 编码 MD5 哈希。|  \r |`Metadata/Path`|String|元数据文件的相对路径。|  \r |`Metadata/Path/@Hash`|属性，字符串|元数据文件的 Base16 编码 MD5 哈希。|  \r |`Properties`|嵌套的 XML 元素|表示 Blob 属性。|  \r |`Properties/@Status`|属性，字符串|Blob 属性的处理状态，例如，找不到文件、已完成。|  \r |`Properties/GlobalPath`|String|全局 properties 文件的相对路径。|  \r |`Properties/GlobalPath/@Hash`|属性，字符串|全局 properties 文件的 Base16 编码 MD5 哈希。|  \r |`Properties/Path`|String|properties 文件的相对路径。|  \r |`Properties/Path/@Hash`|属性，字符串|properties 文件的 Base16 编码 MD5 哈希。|  \r |`Blob/Status`|String|Blob 的处理状态。|  \r \r # <a name=\"drive-status-codes\"></a>驱动器状态代码  \r 下表列出了驱动器的处理状态代码。  \r \r |状态代码|说明|  \r |-----------------|-----------------|  \r |`Completed`|驱动器已完成处理，未出现任何错误。|  \r |`CompletedWithWarnings`|驱动器已完成处理针对 Blob 指定的导入处置，但一个或多个 Blob 中出现警告。|  \r |`CompletedWithErrors`|驱动器已完成处理，但一个或多个 Blob 或区块中出现错误。|  \r |`DiskNotFound`|在驱动器上找不到磁盘。|  \r |`VolumeNotNtfs`|磁盘上的第一个数据卷未采用 NTFS 格式。|  \r |`DiskOperationFailed`|对驱动器执行操作时出现未知错误。|  \r |`BitLockerVolumeNotFound`|找不到可通过 BitLocker 加密的卷。|  \r |`BitLockerNotActivated`|未在卷上启用 BitLocker。|  \r |`BitLockerProtectorNotFound`|卷上不存在数字密码密钥保护程序。|  \r |`BitLockerKeyInvalid`|提供的数字密码无法解锁卷。|  \r |`BitLockerUnlockVolumeFailed`|尝试解锁卷时出现未知错误。|  \r |`BitLockerFailed`|执行 BitLocker 操作时出现未知错误。|  \r |`ManifestNameInvalid`|清单文件名无效。|  \r |`ManifestNameTooLong`|清单文件名太长。|  \r |`ManifestNotFound`|找不到清单文件。|  \r |`ManifestAccessDenied`|拒绝访问清单文件。|  \r |`ManifestCorrupted`|清单文件已损坏（内容与其哈希不匹配）。|  \r |`ManifestFormatInvalid`|清单内容不符合所需的格式。|  \r |`ManifestDriveIdMismatch`|清单文件中的驱动器 ID 与从驱动器读取的 ID 不匹配。|  \r |`ReadManifestFailed`|从清单进行读取时出现磁盘 I/O 故障。|  \r |`BlobListFormatInvalid`|导出 Blob 列表 Blob 不符合所需的格式。|  \r |`BlobRequestForbidden`|禁止访问存储帐户中的 Blob。 这可能是因为存储帐户密钥或容器 SAS 无效。|  \r |`InternalError`|处理驱动器时出现内部错误。|  \r \r ## <a name=\"blob-status-codes\"></a>Blob 状态代码  \r 下表列出了 Blob 的处理状态代码。  \r \r |状态代码|说明|  \r |-----------------|-----------------|  \r |`Completed`|Blob 已完成处理，未出现错误。|  \r |`CompletedWithErrors`|Blob 已完成处理，但一个或多个页面范围或者块、元数据或属性中出现错误。|  \r |`FileNameInvalid`|文件名无效。|  \r |`FileNameTooLong`|文件名太长。|  \r |`FileNotFound`|找不到该文件。|  \r |`FileAccessDenied`|拒绝访问文件。|  \r |`BlobRequestFailed`|访问 Blob 的 Blob 服务请求失败。|  \r |`BlobRequestForbidden`|访问 Blob 的 Blob 服务请求被禁止。 这可能是因为存储帐户密钥或容器 SAS 无效。|  \r |`RenameFailed`|无法重命名 Blob（针对导入作业）或文件（针对导出作业）。|  \r |`BlobUnexpectedChange`|Blob 出现意外更改（针对导出作业）。|  \r |`LeasePresent`|Blob 上存在租约。|  \r |`IOFailed`|处理 Blob 时出现磁盘或网络 I/O 故障。|  \r |`Failed`|处理 Blob 时出现未知错误。|  \r \r ## <a name=\"import-disposition-status-codes\"></a>导入处置状态代码  \r 下表列出了导入处置的解决状态代码。  \r \r |状态代码|说明|  \r |-----------------|-----------------|  \r |`Created`|已创建 Blob。|  \r |`Renamed`|已根据重命名导入处置将 Blob 重命名。 `Blob/BlobPath` 元素包含已重命名的 Blob 的 URI。|  \r |`Skipped`|已根据 `no-overwrite` 导入处置跳过 Blob。|  \r |`Overwritten`|Blob 已根据 `overwrite` 导入处置覆盖现有 Blob。|  \r |`Cancelled`|前一个错误导致停止进一步处理导入处置。|  \r \r ## <a name=\"page-rangeblock-status-codes\"></a>页面范围/块状态代码  \r 下表列出了页面范围或块的处理状态代码。  \r \r |状态代码|说明|  \r |-----------------|-----------------|  \r |`Completed`|页面范围或块已完成处理，未出现任何错误。|  \r |`Committed`|块已提交，但不在完整块列表中，因为其他块已失败或放置完整块列表本身已失败。|  \r |`Uncommitted`|块已上传但未提交。|  \r |`Corrupted`|页面范围或块已损坏（内容与其哈希不匹配）。|  \r |`FileUnexpectedEnd`|遇到了意外的文件结束。|  \r |`BlobUnexpectedEnd`|遇到了意外的 Blob 结束。|  \r |`BlobRequestFailed`|访问页面范围或块的 Blob 服务请求失败。|  \r |`IOFailed`|处理页面范围或块时出现磁盘或网络 I/O 故障。|  \r |`Failed`|处理页面范围或块时出现未知错误。|  \r |`Cancelled`|前一个错误导致停止进一步处理页面范围或块。|  \r \r ## <a name=\"metadata-status-codes\"></a>元数据状态代码  \r 下表列出了 Blob 元数据的处理状态代码。  \r \r |状态代码|说明|  \r |-----------------|-----------------|  \r |`Completed`|元数据已完成处理，未出现错误。|  \r |`FileNameInvalid`|元数据文件名无效。|  \r |`FileNameTooLong`|元数据文件名太长。|  \r |`FileNotFound`|找不到元数据文件。|  \r |`FileAccessDenied`|拒绝访问元数据文件。|  \r |`Corrupted`|元数据文件已损坏（内容与其哈希不匹配）。|  \r |`XmlReadFailed`|元数据内容不符合所需的格式。|  \r |`XmlWriteFailed`|写入元数据 XML 失败。|  \r |`BlobRequestFailed`|访问元数据的 Blob 服务请求失败。|  \r |`IOFailed`|处理元数据时出现磁盘或网络 I/O 故障。|  \r |`Failed`|处理元数据时出现未知错误。|  \r |`Cancelled`|前一个错误导致停止进一步处理元数据。|  \r \r ## <a name=\"properties-status-codes\"></a>属性状态代码  \r 下表列出了 Blob 属性的处理状态代码。  \r \r |状态代码|说明|  \r |-----------------|-----------------|  \r |`Completed`|属性已完成处理，未出现任何错误。|  \r |`FileNameInvalid`|properties 文件名无效。|  \r |`FileNameTooLong`|properties 文件名太长。|  \r |`FileNotFound`|找不到 properties 文件。|  \r |`FileAccessDenied`|拒绝访问 properties 文件。|  \r |`Corrupted`|属性文件已损坏（内容与其哈希不匹配）。|  \r |`XmlReadFailed`|属性内容不符合所需的格式。|  \r |`XmlWriteFailed`|写入属性 XML 失败。|  \r |`BlobRequestFailed`|访问属性的 Blob 服务请求失败。|  \r |`IOFailed`|处理属性时出现磁盘或网络 I/O 故障。|  \r |`Failed`|处理属性时出现未知错误。|  \r |`Cancelled`|前一个错误导致停止进一步处理属性。|  \r \r ## <a name=\"sample-logs\"></a>示例日志  \r 下面是一个详细日志示例。  \r \r ```xml\r <?xml version=\"1.0\" encoding=\"UTF-8\"?>  \r <DriveLog Version=\"2014-11-01\">  \r     <DriveId>WD-WMATV123456</DriveId>  \r     <Blob Status=\"Completed\">  \r        <BlobPath>pictures/bob/wild/desert.jpg</BlobPath>  \r        <FilePath>\\Users\\bob\\Pictures\\wild\\desert.jpg</FilePath>  \r        <Length>98304</Length>  \r        <ImportDisposition Status=\"Created\">overwrite</ImportDisposition>  \r        <BlockList>  \r           <Block Offset=\"0\" Length=\"65536\" Id=\"AAAAAA==\" Hash=\" 9C8AE14A55241F98533C4D80D85CDC68\" Status=\"Completed\"/>  \r           <Block Offset=\"65536\" Length=\"32768\" Id=\"AQAAAA==\" Hash=\" DF54C531C9B3CA2570FDDDB3BCD0E27D\" Status=\"Completed\"/>  \r        </BlockList>  \r        <Metadata Status=\"Completed\">  \r           <GlobalPath Hash=\" E34F54B7086BCF4EC1601D056F4C7E37\">\\Users\\bob\\Pictures\\wild\\metadata.xml</GlobalPath>  \r        </Metadata>  \r     </Blob>  \r     <Blob Status=\"CompletedWithErrors\">  \r        <BlobPath>pictures/bob/animals/koala.jpg</BlobPath>  \r        <FilePath>\\Users\\bob\\Pictures\\animals\\koala.jpg</FilePath>  \r        <Length>163840</Length>  \r        <ImportDisposition Status=\"Overwritten\">overwrite</ImportDisposition>  \r        <PageRangeList>  \r           <PageRange Offset=\"0\" Length=\"65536\" Hash=\"19701B8877418393CB3CB567F53EE225\" Status=\"Completed\"/>  \r           <PageRange Offset=\"65536\" Length=\"65536\" Hash=\"AA2585F6F6FD01C4AD4256E018240CD4\" Status=\"Corrupted\"/>  \r           <PageRange Offset=\"131072\" Length=\"4096\" Hash=\"9BA552E1C3EEAFFC91B42B979900A996\" Status=\"Completed\"/>  \r        </PageRangeList>  \r        <Properties Status=\"Completed\">  \r           <Path Hash=\"38D7AE80653F47F63C0222FEE90EC4E7\">\\Users\\bob\\Pictures\\animals\\koala.jpg.properties</Path>  \r        </Properties>  \r     </Blob>  \r     <Status>CompletedWithErrors</Status>  \r </DriveLog>  \r ```\r \r 相应的错误日志如下所示。  \r \r ```xml\r <?xml version=\"1.0\" encoding=\"UTF-8\"?>  \r <DriveLog Version=\"2014-11-01\">  \r     <DriveId>WD-WMATV6965824</DriveId>  \r     <Blob Status=\"CompletedWithErrors\">  \r        <BlobPath>pictures/bob/animals/koala.jpg</BlobPath>  \r        <FilePath>\\Users\\bob\\Pictures\\animals\\koala.jpg</FilePath>  \r        <Length>163840</Length>  \r        <ImportDisposition Status=\"Overwritten\">overwrite</ImportDisposition>  \r        <PageRangeList>  \r           <PageRange Offset=\"65536\" Length=\"65536\" Hash=\"AA2585F6F6FD01C4AD4256E018240CD4\" Status=\"Corrupted\"/>  \r        </PageRangeList>  \r     </Blob>  \r     <Status>CompletedWithErrors</Status>  \r </DriveLog>  \r ```\r \r  以下导入作业的错误日志包含有关在导入驱动器上找不到的文件的错误。 请注意，后续组件的状态为 `Cancelled`。  \r \r ```xml\r <?xml version=\"1.0\" encoding=\"utf-8\"?>  \r <DriveLog Version=\"2014-11-01\">  \r   <DriveId>9WM35C2V</DriveId>  \r   <Blob Status=\"FileNotFound\">  \r     <BlobPath>pictures/animals/koala.jpg</BlobPath>  \r     <FilePath>\\animals\\koala.jpg</FilePath>  \r     <Length>30310</Length>  \r     <ImportDisposition Status=\"Cancelled\">rename</ImportDisposition>  \r     <BlockList>  \r       <Block Offset=\"0\" Length=\"6062\" Id=\"MD5/cAzn4h7VVSWXf696qp5Uaw==\" Hash=\"700CE7E21ED55525977FAF7AAA9E546B\" Status=\"Cancelled\" />  \r       <Block Offset=\"6062\" Length=\"6062\" Id=\"MD5/PEnGwYOI8LPLNYdfKr7kAg==\" Hash=\"3C49C6C18388F0B3CB35875F2ABEE402\" Status=\"Cancelled\" />  \r       <Block Offset=\"12124\" Length=\"6062\" Id=\"MD5/FG4WxqfZKuUWZ2nGTU2qVA==\" Hash=\"146E16C6A7D92AE5166769C64D4DAA54\" Status=\"Cancelled\" />  \r       <Block Offset=\"18186\" Length=\"6062\" Id=\"MD5/ZzibNDzr3IRBQENRyegeXQ==\" Hash=\"67389B343CEBDC8441404351C9E81E5D\" Status=\"Cancelled\" />  \r       <Block Offset=\"24248\" Length=\"6062\" Id=\"MD5/ZzibNDzr3IRBQENRyegeXQ==\" Hash=\"67389B343CEBDC8441404351C9E81E5D\" Status=\"Cancelled\" />  \r     </BlockList>  \r   </Blob>  \r   <Status>CompletedWithErrors</Status>  \r </DriveLog>  \r ```\r \r 以下导出作业的错误日志指示已将 Blob 内容成功写入驱动器，但在导出 Blob 的属性时出错。  \r \r ```xml\r <?xml version=\"1.0\" encoding=\"utf-8\"?>  \r <DriveLog Version=\"2014-11-01\">  \r   <DriveId>9WM35C3U</DriveId>  \r   <Blob Status=\"CompletedWithErrors\">  \r     <BlobPath>pictures/wild/canyon.jpg</BlobPath>  \r     <FilePath>\\pictures\\wild\\canyon.jpg</FilePath>  \r     <LastModified>2012-09-18T23:47:08Z</LastModified>  \r     <Length>163840</Length>  \r     <BlockList />  \r     <Properties Status=\"Failed\" />  \r   </Blob>  \r   <Status>CompletedWithErrors</Status>  \r </DriveLog>  \r ```\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r * [存储导入/导出 REST API](https://docs.microsoft.com/rest/api/storageimportexport/)\r <!--Update_Description: update link-->"}