{"Title":"Microsoft Azure 中的指标概述","Description":"Microsoft Azure 中的指标及其用法的概述","Content":"# <a name=\"overview-of-metrics-in-azure\"></a>Azure 中的指标概述\r 本文介绍 Azure 中的指标及其优点，以及如何开始使用它们。  \r \r ## <a name=\"what-are-metrics\"></a>什么是指标？\r 在 Azure 监视器中可以使用遥测来查看 Azure 上的工作负荷的性能与运行状况。 最重要的 Azure 遥测数据类型是大多数 Azure 资源发出的指标（也称为性能计数器）。 Azure 监视器提供多种方式来配置和使用这些指标，以便进行监视与故障排除。\r \r ## <a name=\"what-can-you-do-with-metrics\"></a>指标有哪些作用？\r 指标是重要的遥测来源，可以执行以下任务：\r \r * 通过在门户图表上绘制资源（例如 VM、网站）的指标并将该图表固定到仪表板，来**跟踪资源的性能**。\r * **接收通知** 。\r * **配置自动化操作**，例如自动缩放资源，或者在指标超过特定的阈值时触发 Runbook。\r * 针对资源的性能或使用趋势**执行高级分析**或报告。\r * 针对**合规性或审核**目的**存档**资源的性能或运行状况历史记录。\r \r ## <a name=\"what-are-the-characteristics-of-metrics\"></a>指标的特征是什么？\r 指标具有以下特征：\r \r * 所有指标都有 **一分钟的频率**。 每隔一分钟就会从资源接收指标值，因此几乎可以实时洞察资源的状态和运行状况。\r * 指标 **可立即使用**。 不需选择加入，也不需设置其他的诊断。\r * 可以访问每个指标的 **30 天历史记录** 。 可以快速查看最近和每个月的资源性能或运行状况趋势。\r * 某些指标可能具有称为“维度”的名称/值对属性。 这些属性可让你以更有意义的方式进一步细分和探索指标。\r \r 也可执行以下操作：\r \r * 配置指标 **警报规则，以便在指标超过设置的阈值时，发送通知或执行自动化操作** 。 自动缩放是一种特殊的自动化操作，可用于扩展资源，满足网站或计算资源的传入请求或负载要求。 可将自动缩放设置规则配置为根据超出阈值的指标进行扩展或缩减。\r \r * **将指标存档到存档**以延长保留时间，或者将其用于脱机报告。 为资源配置诊断设置时，可将指标路由到 Azure Blob 存储。\r \r * 选择资源并将指标绘制在图表上时，通过 Azure 门户轻松发现、访问和**查看所有指标**。\r \r * **使用** 指标。\r \r * **查询** 指标。\r \r   ![在 Azure 监视器中路由指标](./media/monitoring-overview-metrics/Metrics_Overview_v4.png)\r \r ## <a name=\"access-metrics-via-the-portal\"></a>通过门户访问指标\r 下图简要介绍了如何使用 Azure 门户创建指标图。\r \r ### <a name=\"to-view-metrics-after-creating-a-resource\"></a>创建资源之后查看指标\r 1. 打开 Azure 门户。\r 2. 创建 Azure 应用服务网站。\r 3. 创建网站后，转到网站的“概述”边栏选项卡。\r 4. 可以“监视”磁贴的形式查看新指标。 然后可以编辑该磁贴并选择更多指标。\r \r    ![Azure 监视器中的资源指标](./media/monitoring-overview-metrics/MetricsOverview1.png)\r \r ### <a name=\"to-access-all-metrics-in-a-single-place\"></a>在单个位置访问所有指标\r 1. 打开 Azure 门户。\r 2. 导航到新的“监视”选项卡，并选择其下面的“指标”选项。\r 3. 从下拉列表中选择订阅、资源组和资源名称。\r 4. 查看可用指标列表。 然后选择所需的指标并绘制其图表。\r 5. 可以单击右上角的“固定”，将它固定到仪表板。\r \r    ![在 Azure 监视器中通过单个位置访问所有指标](./media/monitoring-overview-metrics/MetricsOverview2.png)\r \r > [!NOTE]\r > 可以从 VM（基于 Azure 资源管理器）访问主机级指标和虚拟机规模集，无需指定任何额外的诊断设置。 这些新的主机级指标可供 Windows 和 Linux 实例使用。 这些指标不会与在 VM 或虚拟机规模集上打开 Azure 诊断后，有权访问的来宾 OS 级指标相混淆。 有关配置诊断的详细信息，请参阅[什么是 Azure 诊断](../azure-diagnostics.md)。\r >\r >\r \r Azure Monitor 预览版还提供全新的指标制图体验。 通过这种体验，用户可以在一个图表中覆盖来自多个资源的指标。 使用这种全新的指标制图体验，用户还可以绘制、细分和筛选多维度指标。 有关详细信息，请[单击此处](https://aka.ms/azuremonitor/new-metrics-charts)。\r \r ## <a name=\"access-metrics-via-the-rest-api\"></a>通过 REST API 访问指标\r 可以通过 Azure Monitor API 访问 Azure 指标。 有两个 API 可帮助发现和访问指标：\r \r * 使用 [Azure Monitor 指标定义 REST API](https://docs.microsoft.com/en-us/rest/api/monitor/metricdefinitions) 访问服务可用的指标和任何维度列表。\r * 使用 [Azure Monitor 指标 REST API](https://docs.microsoft.com/en-us/rest/api/monitor/metrics) 细分、筛选和访问实际指标数据。\r \r > [!NOTE]\r > 本文通过适用于 Azure 资源的[新指标 API](https://docs.microsoft.com/en-us/rest/api/monitor/) 介绍指标。 新指标定义和指标 API 的 API 版本为 2017-05-01-preview。 可以使用 API 版本 2014-04-01 访问旧指标定义和指标。\r >\r >\r \r 有关使用 Azure 监视器 REST API 的更详细演练，请参阅 [Azure 监视器 REST API 演练](monitoring-rest-api-walkthrough.md)。\r \r ## <a name=\"export-metrics\"></a>导出指标\r 可以转到“监视”选项卡下的“诊断设置”边栏选项卡，查看指标的导出选项。 对于本文中前面所述的用例，可以选择要路由到 Blob 存储、Azure 事件中心或 OMS 的指标（和诊断日志）。\r \r  ![Azure 监视器中指标的导出选项](./media/monitoring-overview-metrics/MetricsOverview3.png)\r \r 可以通过 Resource Manager 模板、[PowerShell](insights-powershell-samples.md)、[Azure CLI](insights-cli-samples.md) 或 [REST API](https://msdn.microsoft.com/library/dn931943.aspx) 配置此功能。\r \r ## <a name=\"take-action-on-metrics\"></a>对指标执行操作\r 可以配置自动缩放，以便接收指标数据的通知或对其采取自动化操作。\r \r ### <a name=\"autoscale-your-azure-resources\"></a>自动缩放 Azure 资源\r 某些 Azure 资源支持扩展或缩减多个实例，从而处理工作负荷。 自动缩放将应用到应用服务（Web 应用）、虚拟机规模集和经典 Azure 云服务。 可以配置自动缩放规则，以便在影响工作负荷的特定指标超过指定的阈值时进行扩展或缩减。 有关详细信息，请参阅[自动缩放概述](monitoring-overview-autoscale.md)。\r \r  ![Azure 监视器中的指标和自动缩放](./media/monitoring-overview-metrics/MetricsOverview5.png)\r \r ## <a name=\"learn-about-supported-services-and-metrics\"></a>了解支持的服务和指标\r 可以在 [Azure 监视器指标 - 每种资源类型支持的指标](monitoring-supported-metrics.md)中查看所有受支持服务及其指标的详细列表。\r \r ## <a name=\"next-steps\"></a>后续步骤\r 请参阅本文中的所有链接。 此外，请了解：  \r \r * [自动缩放的常用指标](insights-autoscale-common-metrics.md)\r "}