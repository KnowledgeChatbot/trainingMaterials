{"Title":"将活动 DNS 名称迁移到 Azure 应用服务","Description":"了解如何在不停机的情况下，将已分配到实时站点的自定义 DNS 域名迁移到 Azure 应用服务。","Content":"# <a name=\"migrate-an-active-dns-name-to-azure-app-service\"></a>将活动 DNS 名称迁移到 Azure 应用服务\r \r 本文介绍如何在不停机的情况下，将活动 DNS 名称迁移到 [Azure 应用服务](../app-service/app-service-web-overview.md)。\r \r 将实时站点及其 DNS 域名迁移到应用服务时，该 DNS 名称已在提供实时流量。 可以在迁移期间提前将活动 DNS 名称绑定到应用服务应用，从而避免 DNS 解析中的停机时间。\r \r 如果你不担心 DNS 解析中的停机时间，请参阅[将现有的自定义 DNS 名称映射到 Azure Web 应用](app-service-web-tutorial-custom-domain.md)。\r \r ## <a name=\"prerequisites\"></a>先决条件\r \r 若要完成本操作说明：\r \r - [确保应用服务应用不在“免费”层中](app-service-web-tutorial-custom-domain.md#checkpricing)。\r \r ## <a name=\"bind-the-domain-name-preemptively\"></a>提前绑定域名\r \r 提前绑定自定义域时，请先完成下面的两项操作，再对 DNS 记录进行更改：\r \r - 验证域所有权\r - 启用应用的域名\r \r 最终将自定义 DNS 名称从旧站点迁移到应用服务应用时，DNS 解析中将不会有停机时间。\r \r [!INCLUDE [Access DNS records with domain provider](../../includes/app-service-web-access-dns-records.md)]\r \r ### <a name=\"create-domain-verification-record\"></a>创建域验证记录\r \r 若要验证域所有权，请添加 TXT 记录。 TXT 记录从 awverify.&lt;subdomain> 映射到 &lt;appname>.chinacloudsites.cn。 \r \r 你需要的 TXT 记录取决于要迁移的 DNS 记录。 有关示例，请参阅下表（`@` 通常表示根域）：  \r \r | DNS 记录示例 | TXT 主机 | TXT 值 |\r | - | - | - |\r | @（根域） | awverify | _&lt;appname>.chinacloudsites.cn_ |\r | www（子域） | awverify.www | _&lt;appname>.chinacloudsites.cn_ |\r | \\*（通配符） | awverify.\\* | _&lt;appname>.chinacloudsites.cn_ |\r \r 在 DNS 记录页中，记下要迁移的 DNS 名称的记录类型。 应用服务支持来自 CNAME 和 A 记录的映射。\r \r ### <a name=\"enable-the-domain-for-your-app\"></a>启用应用的域\r \r 在 [Azure 门户](https://portal.azure.cn)中的应用页的左侧导航窗格中，选择“自定义域”。 \r \r ![自定义域菜单](./media/app-service-web-tutorial-custom-domain/custom-domain-menu.png)\r \r 在“自定义域”页中，选择“添加主机名”旁的 + 图标。\r \r ![添加主机名](./media/app-service-web-tutorial-custom-domain/add-host-name-cname.png)\r \r 键入已添加 TXT 记录的完全限定的域名，如 `www.contoso.com`。 对于通配符域（如 \\*.contoso.com），可以使用与通配符域匹配的任何 DNS 名称。 \r \r 选择“验证”。\r \r “添加主机名”按钮会被激活。 \r \r 请确保“主机名记录类型”设置为你想要迁移的 DNS 记录类型。\r \r 选择“添加主机名”。\r \r ![将 DNS 名称添加到应用](./media/app-service-web-tutorial-custom-domain/validate-domain-name-cname.png)\r \r 新主机名可能需要经过一段时间后才会反映在应用的“自定义域”页中。 请尝试刷新浏览器来更新数据。\r \r ![已添加 CNAME 记录](./media/app-service-web-tutorial-custom-domain/cname-record-added.png)\r \r 你的自定义 DNS 名称现已在 Azure 应用中启用。 \r \r ## <a name=\"remap-the-active-dns-name\"></a>重新映射活动 DNS 名称\r \r 唯一需要做的是重新映射活动 DNS 记录以指向应用服务。 现在，它仍然指向旧站点。\r \r <a name=\"info\"></a>\r \r ### <a name=\"copy-the-apps-ip-address-a-record-only\"></a>复制应用的 IP 地址（仅限 A 记录）\r \r 如果你要重新映射 CNAME 记录，请跳过此部分。 \r \r 若要重新映射 A 记录，需要应用服务应用的外部 IP 地址，此地址显示在“自定义域”页中。\r \r 通过选择右上角的 X 关闭“添加主机名”页。 \r \r 在“自定义域”页中，复制应用的 IP 地址。\r \r ![在门户中导航到 Azure 应用](./media/app-service-web-tutorial-custom-domain/mapping-information.png)\r \r ### <a name=\"update-the-dns-record\"></a>更新 DNS 记录\r \r 返回到域提供商的 DNS 记录页，选择要重新映射的 DNS 记录。\r \r 对于 `contoso.com` 根域示例，重新映射 A 或 CNAME 记录，如下表中的示例所示： \r \r | FQDN 示例 | 记录类型 | 主机 | 值 |\r | - | - | - | - |\r | contoso.com（根域） | A | `@` | 在[复制应用的 IP 地址](#info)步骤中复制的 IP 地址 |\r | www.contoso.com（子域） | CNAME | `www` | _&lt;appname>.chinacloudsites.cn_ |\r | \\*.contoso.com（通配符域） | CNAME | _\\*_ | _&lt;appname>.chinacloudsites.cn_ |\r \r 保存设置。\r \r 在 DNS 传播发生后，DNS 查询应立即开始解析应用服务应用。\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 了解如何将自定义 SSL 证书绑定到应用服务。\r \r > [!div class=\"nextstepaction\"]\r > [将现有的自定义 SSL 证书绑定到 Azure Web 应用](app-service-web-tutorial-custom-ssl.md)\r "}