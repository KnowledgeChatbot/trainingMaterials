{"Title":"使用 HDInsight .NET SDK 运行 Hive 查询 - Azure","Description":"了解如何使用 HDInsight .NET SDK 将 Hadoop 作业提交到 Azure HDInsight Hadoop。","Content":"# <a name=\"run-hive-queries-using-hdinsight-net-sdk\"></a>使用 HDInsight .NET SDK 运行 Hive 查询\r [!INCLUDE [hive-selector](../../../includes/hdinsight-selector-use-hive.md)]\r \r 了解如何使用 HDInsight .NET SDK 提交 Hive 查询。 编写 C# 程序来提交 Hive 查询以列出 Hive 表，并显示结果。\r \r > [!NOTE]\r > 必须从 Windows 客户端执行本文中的步骤。 有关使用 Linux、OS X 或 Unix 客户端处理 Hive 的信息，请使用本文顶部显示的选项卡选择器。\r > \r > \r \r ## <a name=\"prerequisites\"></a>先决条件\r 在开始阅读本文前，必须具有以下项：\r \r * **HDInsight 中的 Hadoop 群集**。 请参阅[在 HDInsight 中开始使用基于 Linux 的 Hadoop](apache-hadoop-linux-tutorial-get-started.md)。\r \r * **Visual Studio 2013/2015/2017**。\r \r ## <a name=\"submit-hive-queries-using-hdinsight-net-sdk\"></a>使用 HDInsight .NET SDK 提交 Hive 查询\r HDInsight .NET SDK 提供 .NET 客户端库，可简化从 .NET 中使用 HDInsight 群集的操作。 \r \r **提交作业**\r \r 1. 在 Visual Studio 中创建 C# 控制台应用程序。\r 2. 通过 Nuget 包管理器控制台运行以下命令：\r \r         Install-Package Microsoft.Azure.Management.HDInsight.Job\r 3. 使用以下代码：\r \r     ```csharp\r         using System.Collections.Generic;\r         using System.IO;\r         using System.Text;\r         using System.Threading;\r         using Microsoft.Azure.Management.HDInsight.Job;\r         using Microsoft.Azure.Management.HDInsight.Job.Models;\r         using Hyak.Common;\r \r         namespace SubmitHDInsightJobDotNet\r         {\r             class Program\r             {\r                 private static HDInsightJobManagementClient _hdiJobManagementClient;\r \r                 private const string ExistingClusterName = \"<Your HDInsight Cluster Name>\";\r                 private const string ExistingClusterUri = ExistingClusterName + \".azurehdinsight.cn\";\r                 private const string ExistingClusterUsername = \"<Cluster Username>\";\r                 private const string ExistingClusterPassword = \"<Cluster User Password>\";\r                 \r                 // Only Azure Storage accounts are supported by the SDK\r                 private const string DefaultStorageAccountName = \"<Default Storage Account Name>\";\r                 private const string StorageAccountSuffix = \"core.chinacloudapi.cn\";\r                 private const string DefaultStorageAccountKey = \"<Default Storage Account Key>\";\r                 private const string DefaultStorageContainerName = \"<Default Blob Container Name>\";\r \r                 static void Main(string[] args)\r                 {\r                     System.Console.WriteLine(\"The application is running ...\");\r \r                     var clusterCredentials = new BasicAuthenticationCloudCredentials { Username = ExistingClusterUsername, Password = ExistingClusterPassword };\r                     _hdiJobManagementClient = new HDInsightJobManagementClient(ExistingClusterUri, clusterCredentials);\r \r                     SubmitHiveJob();\r \r                     System.Console.WriteLine(\"Press ENTER to continue ...\");\r                     System.Console.ReadLine();\r                 }\r \r                 private static void SubmitHiveJob()\r                 {\r                     Dictionary<string, string> defines = new Dictionary<string, string> { { \"hive.execution.engine\", \"tez\" }, { \"hive.exec.reducers.max\", \"1\" } };\r                     List<string> args = new List<string> { { \"argA\" }, { \"argB\" } };\r                     var parameters = new HiveJobSubmissionParameters\r                     {\r                         Query = \"SHOW TABLES\",\r                         Defines = defines,\r                         Arguments = args\r                     };\r \r                     System.Console.WriteLine(\"Submitting the Hive job to the cluster...\");\r                     var jobResponse = _hdiJobManagementClient.JobManagement.SubmitHiveJob(parameters);\r                     var jobId = jobResponse.JobSubmissionJsonResponse.Id;\r                     System.Console.WriteLine(\"Response status code is \" + jobResponse.StatusCode);\r                     System.Console.WriteLine(\"JobId is \" + jobId);\r \r                     System.Console.WriteLine(\"Waiting for the job completion ...\");\r \r                     // Wait for job completion\r                     var jobDetail = _hdiJobManagementClient.JobManagement.GetJob(jobId).JobDetail;\r                     while (!jobDetail.Status.JobComplete)\r                     {\r                         Thread.Sleep(1000);\r                         jobDetail = _hdiJobManagementClient.JobManagement.GetJob(jobId).JobDetail;\r                     }\r \r                     // Get job output\r                     var storageAccess = new AzureStorageAccess(DefaultStorageAccountName, DefaultStorageAccountKey,\r                         DefaultStorageContainerName, StorageAccountSuffix);\r                     var output = (jobDetail.ExitValue == 0)\r                         ? _hdiJobManagementClient.JobManagement.GetJobOutput(jobId, storageAccess) // fetch stdout output in case of success\r                         : _hdiJobManagementClient.JobManagement.GetJobErrorLogs(jobId, storageAccess); // fetch stderr output in case of failure\r \r                     System.Console.WriteLine(\"Job output is: \");\r \r                     using (var reader = new StreamReader(output, Encoding.UTF8))\r                     {\r                         string value = reader.ReadToEnd();\r                         System.Console.WriteLine(value);\r                     }\r                 }\r             }\r         }\r     ```\r 4. 按 **F5** 运行应用程序。\r \r 应用程序的输出应如下：\r \r ![HDInsight Hadoop Hive 作业输出](./media/apache-hadoop-use-hive-dotnet-sdk/hdinsight-hadoop-use-hive-net-sdk-output.png)\r \r ## <a name=\"next-steps\"></a>后续步骤\r 在本文中，已经学习了几种创建 HDInsight 群集的方法。 若要了解更多信息，请参阅下列文章：\r \r * [Azure HDInsight 入门](apache-hadoop-linux-tutorial-get-started.md)\r * [在 HDInsight 中创建 Hadoop 群集](../hdinsight-hadoop-provision-linux-clusters.md)\r * [使用 Azure 门户管理 HDInsight 中的 Hadoop 群集](../hdinsight-administer-use-management-portal.md)\r * [将 Pig 与 HDInsight 配合使用](hdinsight-use-pig.md)\r * [将 Sqoop 与 HDInsight 配合使用](apache-hadoop-use-sqoop-mac-linux.md)\r * [创建非交互式身份验证 .NET HDInsight 应用程序](../hdinsight-create-non-interactive-authentication-dotnet-applications.md)\r  \r \r \r \r <!--Update_Description: update wording and link references-->"}