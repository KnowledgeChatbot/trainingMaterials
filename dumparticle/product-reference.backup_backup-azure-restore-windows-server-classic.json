{"Title":"使用经典部署模型将数据还原到 Windows Server 或 Windows 客户端","Description":"了解如何从 Windows Server 或 Windows 客户端还原。","Content":"# <a name=\"restore-files-to-a-windows-server-or-windows-client-machine-using-the-classic-deployment-model\"></a>使用经典部署模型将文件还原到 Windows Server 或 Windows 客户端计算机\r > [!div class=\"op_single_selector\"]\r > * [经典管理门户](backup-azure-restore-windows-server-classic.md)\r > * [Azure 门户](backup-azure-restore-windows-server.md)\r >\r >\r \r 本文介绍如何从备份保管库中恢复数据并将其还原到服务器或计算机。 自 2017 年 3 月起，无法再在经典管理门户中创建备份保管库。\r \r > [!IMPORTANT]\r > 现在可将备份保管库升级到恢复服务保管库。 有关详细信息，请参阅文章[将备份保管库升级到恢复服务保管库](backup-azure-upgrade-backup-to-recovery-services.md)。 Microsoft 鼓励将备份保管库升级到恢复服务保管库。<br/> 2017 年 11 月 30 日之后，将无法使用 PowerShell 创建备份保管库。 <br/> 从 2017 年 11 月 30 日起：\r >- 其余的所有备份保管库都会自动升级到恢复服务保管库。\r >- 无法在经典管理门户中访问备份数据。 应使用 Azure 门户在恢复服务保管库中访问备份数据。\r >\r \r 若要还原数据，请在 Azure 恢复服务 (MARS) 代理中使用“恢复数据”向导。 还原数据时，可以采用以下方式：\r \r - 将数据还原到备份时所在的同一台计算机。\r - 将数据还原到备用计算机。\r \r 2017 年 1 月，Microsoft 发布了 MARS 代理的预览版更新。 除了提供 Bug 修补程序外，此更新还启用了“即时还原”，允许用户将可写入恢复点快照作为恢复卷装载。 随后，用户便可以浏览恢复卷，并将文件复制到本地计算机，从而选择性地还原文件。\r \r > [!NOTE]\r > 若要使用“即时还原”还原数据，必须安装 [2017 年 1 月 Azure 备份更新](https://support.microsoft.com/help/3216528?preview) 。 此外，必须在支持文章所列区域中的保管库内保护备份数据。 请查阅 [2017 年 1 月 Azure 备份更新](https://support.microsoft.com/help/3216528?preview) ，获取支持“即时还原”的区域的最新列表。 “即时还原”目前 **并非** 在所有区域都可用。\r >\r \r “即时还原”可以在 Azure 门户的恢复服务保管库中使用，也可以在经典管理门户的备份保管库中使用。 如果要使用“即时还原”，请下载 MARS 更新，并按照提及“即时还原”的过程进行操作。\r \r \r ## <a name=\"use-instant-restore-to-recover-data-to-the-same-machine\"></a>使用即时还原将数据恢复到同一台计算机\r \r 如果意外删除了某个文件并想要在同一台计算机（备份位置）中还原文件，以下步骤可帮助你恢复数据。\r \r 1. 打开 **Azure 备份** 管理单元。 如果不知道该管理单元的安装位置，请在计算机或服务器中搜索“Azure 备份” 。\r \r     该桌面应用应会显示在搜索结果中。\r \r 2. 单击“恢复数据”  启动向导。\r \r     ![恢复数据](./media/backup-azure-restore-windows-server/recover.png)\r \r 3. 要将数据还原到同一台服务器或计算机，请在“开始”窗格中选择“此服务器(`<server name>`)”，然后单击“下一步”。\r \r     ![选择“此服务器”选项将数据还原到同一台计算机](./media/backup-azure-restore-windows-server/samemachine_gettingstarted_instantrestore.png)\r \r 4. 在“选择恢复模式”窗格中选择“单个文件和文件夹”，然后单击“下一步”。\r \r     ![浏览文件](./media/backup-azure-restore-windows-server/samemachine_selectrecoverymode_instantrestore.png)\r \r 5. 在“选择卷和日期”  窗格中，选择包含想要还原的文件和/或文件夹的卷。\r \r     在日历中选择恢复点。 可从任意恢复时间点还原。 以 **粗体** 显示的日期表示至少有一个可用的恢复点。 选择日期后，如果有多个恢复点可用，请从“时间”  下拉菜单中选择特定的恢复点。\r \r     ![卷和日期](./media/backup-azure-restore-windows-server/samemachine_selectvolumedate_instantrestore.png)\r \r 6. 选择要还原的恢复点后，单击“装载” 。\r \r     Azure 备份会装载本地恢复点，并将其用作恢复卷。\r \r 7. 在“浏览和恢复文件”窗格中，单击“浏览”打开 Windows 资源管理器并找到所需的文件和文件夹。\r \r     ![恢复选项](./media/backup-azure-restore-windows-server/samemachine_browserecover_instantrestore.png)\r \r \r 8. 在 Windows 资源管理器中，复制想要还原的文件和/或文件夹，将其粘贴到服务器或计算机本地的任何位置。 可以从恢复卷直接打开或流式传输文件，并验证是否恢复了正确的版本。\r \r     ![将文件和文件夹从装载的卷复制并粘贴到本地位置](./media/backup-azure-restore-windows-server/samemachine_copy_instantrestore.png)\r \r 9. 完成还原文件和/或文件夹后，请在“浏览和恢复文件”窗格中单击“卸载”。 然后单击“是”，确认要卸载该卷。\r \r     ![卸载卷并确认](./media/backup-azure-restore-windows-server/samemachine_unmount_instantrestore.png)\r \r     > [!Important]\r     > 如果不单击“卸载”，恢复卷将保持装载六个小时（从装载时算起）。 装载卷时，不会运行任何备份操作。 计划为在装载卷时运行的任何备份操作会在卸载恢复卷后运行。\r     >\r \r \r ## <a name=\"recover-data-to-the-same-machine\"></a>将数据恢复到同一台计算机\r 如果意外删除了某个文件并想要在同一台计算机（备份位置）中还原文件，以下步骤可帮助你恢复数据。\r \r 1. 打开 **Azure 备份** 管理单元。\r 2. 单击“**恢复数据**”以启动工作流。\r \r     ![恢复数据](./media/backup-azure-restore-windows-server-classic/recover.png)\r 3. 选择“**此服务器(*yourmachinename*)”** 选项，以便在同一台计算机上还原已备份的文件。\r \r     ![同一台计算机](./media/backup-azure-restore-windows-server-classic/samemachine.png)\r 4. 在“选择恢复模式”页中选择“卷”。 然后单击“下一步”。\r \r     ![浏览文件](./media/backup-azure-restore-windows-server-classic/browseandsearch.png)\r 5. 选择要从中还原文件的卷。\r \r     可以从任意时间点还原。 日历控件中以**粗体**显示的日期指明了还原点的可用性。 选择日期后，根据备份计划（和备份操作的成功与否），可以从“**时间**”下拉列表中选择一个时间点。\r \r     ![卷和日期](./media/backup-azure-restore-windows-server-classic/volanddate.png)\r 6. 指定恢复参数。\r \r     ![恢复选项](./media/backup-azure-restore-windows-server-classic/recoveroptions.png)\r \r    - 可以选择还原到原始位置（将覆盖其中的文件/文件夹），或者同一台计算机中的另一个位置。\r    - 如果要还原的文件/文件夹在目标位置存在，可创建副本（同一文件的两个版本）、覆盖目标位置的文件，或者跳过目标中存在文件的恢复。\r    - 强烈建议保留所要恢复的文件中的 ACL 还原默认选项。\r 7. 提供这些输入后，单击“下一步” 。 将文件还原到此计算机的恢复工作流将会开始。\r \r ## <a name=\"recover-to-an-alternate-machine\"></a>恢复到备用计算机\r 如果整个服务器断开连接，仍可将 Azure 备份中的数据恢复到另一台计算机。 下面的步骤演示了工作流。  \r \r 这些步骤中使用的术语包括：\r \r - *源计算机* - 从其中创建备份并且当前不可用的原始计算机。\r - *目标计算机* - 要将数据恢复到其中的计算机。\r - *示例保管库* - *源计算机*和*目标计算机*注册到的备份保管库。 <br/>\r \r > [!NOTE]\r > 从一台计算机创建的备份无法在运行更低版本操作系统的计算机上还原。 例如，如果备份是从 Windows 7 计算机创建的，它可以在 Windows 8 或更高版本的计算机上还原。 但是，如果反过来则无法还原。\r >\r >\r \r 1. 在“目标计算机”中打开“Azure 备份”管理单元。\r 2. 确保“*目标计算机*”和“*源计算机*”已还原到同一个备份保管库。\r 3. 单击“**恢复数据**”以启动工作流。\r \r     ![恢复数据](./media/backup-azure-restore-windows-server-classic/recover.png)\r 4. 选择“另一台服务器” \r \r     ![另一台服务器](./media/backup-azure-restore-windows-server-classic/anotherserver.png)\r 5. 提供对应于“*示例保管库*”的保管库凭据文件。 如果保管库凭据文件无效（或已过期），请在 Azure 经典管理门户中从“示例保管库”下载新的保管库凭据文件。 提供保管库凭据文件后，系统根据保管库凭据文件显示备份保管库。\r 6. 从显示的计算机列表中选择“*源计算机*”。\r \r     ![计算机列表](./media/backup-azure-restore-windows-server-classic/machinelist.png)\r 7. 选择“**搜索文件**”或“**浏览文件**”选项。 对于本部分，我们将使用“**搜索文件**”选项。\r \r     ![搜索](./media/backup-azure-restore-windows-server-classic/search.png)\r 8. 在下一屏幕中选择卷和日期。 搜索要还原的文件夹/文件的名称。\r \r     ![搜索项](./media/backup-azure-restore-windows-server-classic/searchitems.png)\r 9. 选择这些文件需要还原到的位置。\r \r     ![还原位置](./media/backup-azure-restore-windows-server-classic/restorelocation.png)\r 10. 提供在将“*源计算机*”注册到“*示例保管库*”期间所用的加密通行短语。\r \r     ![加密](./media/backup-azure-restore-windows-server-classic/encryption.png)\r 11. 提供输入后，单击“恢复”，随即将会触发在提供的目标中还原备份文件的操作。\r \r ## <a name=\"use-instant-restore-to-restore-data-to-an-alternate-machine\"></a>使用即时还原将数据还原到另一台计算机\r 如果整个服务器断开连接，仍可将 Azure 备份中的数据恢复到另一台计算机。 下面的步骤演示了工作流。\r \r 这些步骤中使用的术语包括：\r \r - *源计算机* - 从其中创建备份并且当前不可用的原始计算机。\r - *目标计算机* - 要将数据恢复到其中的计算机。\r - *示例保管库* - *源计算机*和*目标计算机*注册到的恢复服务保管库。 <br/>\r \r > [!NOTE]\r > 不能将备份还原到运行早期版本的操作系统的目标计算机。 例如，在 Windows 7 计算机中创建的备份可以还原到 Windows 8 或更高版本的计算机。 但是，在 Windows 8 计算机上创建的备份无法还原到 Windows 7 计算机。\r >\r >\r \r 1. 在“目标计算机”中打开“Azure 备份”管理单元。\r \r 2. 确保“目标计算机”和“源计算机”已注册到同一个恢复服务保管库。\r \r 3. 单击“恢复数据”打开“恢复数据向导”。\r \r     ![恢复数据](./media/backup-azure-restore-windows-server/recover.png)\r \r 4. 在“开始”窗格中选择“另一台服务器”\r \r     ![另一台服务器](./media/backup-azure-restore-windows-server/alternatemachine_gettingstarted_instantrestore.png)\r \r 5. 提供对应于“示例保管库”的保管库凭据文件，然后单击“下一步”。\r \r     如果保管库凭据文件无效（或已过期），请在 Azure 门户中从“示例保管库”下载新的保管库凭据文件。 提供有效的保管库凭据后，会显示相应备份保管库的名称。\r \r 6. 在“选择备份服务器”窗格中，从显示的计算机列表中选择“源计算机”并提供通行短语。 。\r \r     ![计算机列表](./media/backup-azure-restore-windows-server/alternatemachine_selectmachine_instantrestore.png)\r \r 7. 在“选择恢复模式”窗格中选择“单个文件和文件夹”，然后单击“下一步”。\r \r     ![搜索](./media/backup-azure-restore-windows-server/alternatemachine_selectrecoverymode_instantrestore.png)\r \r 8. 在“选择卷和日期”  窗格中，选择包含想要还原的文件和/或文件夹的卷。\r \r     在日历中选择恢复点。 可从任意恢复时间点还原。 以 **粗体** 显示的日期表示至少有一个可用的恢复点。 选择日期后，如果有多个恢复点可用，请从“时间”  下拉菜单中选择特定的恢复点。\r \r     ![搜索项](./media/backup-azure-restore-windows-server/alternatemachine_selectvolumedate_instantrestore.png)\r \r 9. 单击“装载”，在本地将恢复点装载为*目标计算机*上的恢复卷。\r \r 10. 在“浏览和恢复文件”窗格中，单击“浏览”打开 Windows 资源管理器并找到所需的文件和文件夹。\r \r     ![Encryption](./media/backup-azure-restore-windows-server/alternatemachine_browserecover_instantrestore.png)\r \r 11. 在 Windows 资源管理器中，从恢复卷复制文件和/或文件夹，并将其粘贴到“目标计算机” 位置。 可以从恢复卷直接打开或流式传输文件，并验证是否恢复了正确的版本。\r \r     ![Encryption](./media/backup-azure-restore-windows-server/alternatemachine_copy_instantrestore.png)\r \r 12. 完成还原文件和/或文件夹后，请在“浏览和恢复文件”窗格中单击“卸载”。 然后单击“是”，确认要卸载该卷。\r \r     ![Encryption](./media/backup-azure-restore-windows-server/alternatemachine_unmount_instantrestore.png)\r \r     > [!Important]\r     > 如果不单击“卸载”，恢复卷将保持装载六个小时（从装载时算起）。 装载卷时，不会运行任何备份操作。 计划为在装载卷时运行的任何备份操作会在卸载恢复卷后运行。\r     >\r \r \r ## <a name=\"next-steps\"></a>后续步骤\r - [Azure 备份常见问题](backup-azure-backup-faq.md)\r - 访问 [Azure 备份论坛](http://go.microsoft.com/fwlink/p/?LinkId=290933)。\r \r ## <a name=\"learn-more\"></a>了解详细信息\r - [Azure 备份概述](http://go.microsoft.com/fwlink/p/?LinkId=222425)\r - [备份 Azure 虚拟机](backup-azure-vms-introduction.md)\r - [备份 Microsoft 工作负荷](backup-azure-dpm-introduction.md)\r \r <!--Update_Description: wording update -->\r "}