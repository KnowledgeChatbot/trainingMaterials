{"Title":"使用 Azure CLI 1.0 创建具有多个 NIC 的 Linux 虚拟机","Description":"了解如何使用 Azure CLI 或 Resource Manager 模板创建附有多个 NIC 的 Linux VM。","Content":"# <a name=\"create-a-linux-virtual-machine-with-multiple-nics-using-the-azure-cli-10\"></a>使用 Azure CLI 1.0 创建具有多个 NIC 的 Linux 虚拟机\r 可以在 Azure 中创建附有多个虚拟网络接口 (NIC) 的虚拟机 (VM)。 一种常见方案是为前端和后端连接使用不同子网，或为监视或备份解决方案使用一个专用网络。 本文提供用于创建附有多个 NIC 的 VM 的快速命令。 不同的 [VM 大小](sizes.md)支持不同数目的 NIC，因此请相应地调整 VM 的大小。\r \r > [!WARNING]\r > 必须在创建 VM 时附加多个 NIC - 不能使用 Azure CLI 1.0 将 NIC 添加到现有 VM。 可[使用 Azure CLI 2.0 将 NIC 添加到现有 VM](multiple-nics.md)。 还可[基于原始虚拟磁盘创建 VM](copy-vm.md)，并在部署 VM 时创建多个 NIC。\r \r ## <a name=\"cli-versions-to-complete-the-task\"></a>用于完成任务的 CLI 版本\r 可使用以下 CLI 版本之一完成任务：\r \r - [Azure CLI 1.0](#create-supporting-resources) - 适用于经典部署模型和资源管理部署模型（本文）的 CLI\r - [Azure CLI 2.0](multiple-nics.md) - 适用于资源管理部署模型的下一代 CLI\r \r ## <a name=\"create-supporting-resources\"></a>创建支持资源\r 确保已登录 [Azure CLI](../../cli-install-nodejs.md) 并使用 Resource Manager 模式：\r \r ```azurecli\r azure config mode arm\r ```\r \r 在以下示例中，请将示例参数名称替换成自己的值。 示例参数名称包括 myResourceGroup、mystorageaccount 和 myVM。\r \r 首先创建一个资源组。 以下示例在“chinaeast”位置创建名为“myResourceGroup”的资源组：\r \r ```azurecli\r azure group create myResourceGroup --location chinaeast\r ```\r \r 创建一个存储帐户用于存放 VM。 以下示例创建一个名为 mystorageaccount 的存储帐户：\r \r ```azurecli\r azure storage account create mystorageaccount \\\r     --resource-group myResourceGroup \\\r     --location chinaeast \\\r     --kind Storage \\\r     --sku-name PLRS\r ```\r \r 创建要将 VM 连接到的虚拟网络。 以下示例使用 192.168.0.0/16 地址前缀创建一个名为 myVnet 的虚拟网络：\r \r ```azurecli\r azure network vnet create \\\r     --resource-group myResourceGroup \\\r     --location chinaeast \\\r     --name myVnet \\\r     --address-prefixes 192.168.0.0/16\r ```\r \r 创建两个虚拟网络子网 - 一个用于前端流量，一个用于后端流量。 以下示例创建两个子网（名为 mySubnetFrontEnd 和mySubnetBackEnd）：\r \r ```azurecli\r azure network vnet subnet create \\\r     --resource-group myResourceGroup \\\r     --location myVnet \\\r     --name mySubnetFrontEnd \\\r     --address-prefix 192.168.1.0/24\r azure network vnet subnet create \\\r     --resource-group myResourceGroup \\\r     --location myVnet \\\r     --name mySubnetBackEnd \\\r     --address-prefix 192.168.2.0/24\r ```\r \r ## <a name=\"create-and-configure-multiple-nics\"></a>创建和配置多个 NIC\r 详细了解如何[使用 Azure CLI 部署多个 NIC](../../virtual-machines/linux/multiple-nics.md)，包括如何编写循环创建所有 NIC 的过程脚本。\r \r 以下示例创建两个 NIC（名为 myNic1 和 myNic2），其中一个 NIC 将连接到每个子网：\r \r ```azurecli\r azure network nic create \\\r     --resource-group myResourceGroup \\\r     --location chinaeast \\\r     --name myNic1 \\\r     --subnet-vnet-name myVnet \\\r     --subnet-name mySubnetFrontEnd\r azure network nic create \\\r     --resource-group myResourceGroup \\\r     --location chinaeast \\\r     --name myNic2 \\\r     --subnet-vnet-name myVnet \\\r     --subnet-name mySubnetBackEnd\r ```\r \r 通常，还会创建[网络安全组](../../virtual-network/virtual-networks-nsg.md)或[负载均衡器](../../load-balancer/load-balancer-overview.md)来帮助管理流量以及跨 VM 分布流量。 以下示例创建名为“myNetworkSecurityGroup”的网络安全组：\r \r ```azurecli\r azure network nsg create \\\r     --resource-group myResourceGroup \\\r     --location chinaeast \\\r     --name myNetworkSecurityGroup\r ```\r \r 使用 `azure network nic set` 将 NIC 绑定到网络安全组。 以下示例将 myNic1 和 myNic2 与 myNetworkSecurityGroup 绑定：\r \r ```azurecli\r azure network nic set \\\r     --resource-group myResourceGroup \\\r     --name myNic1 \\\r     --network-security-group-name myNetworkSecurityGroup\r azure network nic set \\\r     --resource-group myResourceGroup \\\r     --name myNic2 \\\r     --network-security-group-name myNetworkSecurityGroup\r ```\r \r ## <a name=\"create-a-vm-and-attach-the-nics\"></a>创建 VM 并附加 NIC\r 创建 VM 时，可以指定多个 NIC。 请不要使用 `--nic-name` 提供单个 NIC，而要使用 `--nic-names` 并提供 NIC 的逗号分隔列表。 还需要谨慎选择 VM 的大小。 可添加到 VM 的 NIC 数目有限制。 详细了解 [Linux VM 大小](sizes.md)。 以下示例演示如何指定多个 NIC，然后指定可支持使用多个 NIC 的 VM 大小 (*Standard_DS2_v2*)：\r \r ```azurecli\r azure vm create \\\r     --resource-group myResourceGroup \\\r     --name myVM \\\r     --location chinaeast \\\r     --os-type linux \\\r     --nic-names myNic1,myNic2 \\\r     --vm-size Standard_DS2_v2 \\\r     --storage-account-name mystorageaccount \\\r     --image-urn UbuntuLTS \\\r     --admin-username azureuser \\\r     --ssh-publickey-file ~/.ssh/id_rsa.pub\r ```\r \r ## <a name=\"create-multiple-nics-using-resource-manager-templates\"></a>使用 Resource Manager 模板创建多个 NIC\r Azure Resource Manager 模板使用声明性 JSON 文件来定义环境。 可以阅读 [Azure Resource Manager 概述](../../azure-resource-manager/resource-group-overview.md)。 Resource Manager 模板可让你在部署期间创建资源的多个实例，例如，创建多个 NIC。 使用 *copy* 指定要创建的实例数：\r \r ```json\r \"copy\": {\r     \"name\": \"multiplenics\"\r     \"count\": \"[parameters('count')]\"\r }\r ```\r \r 阅读有关[使用 *copy* 创建多个实例](../../resource-group-create-multiple.md)的详细信息。 \r \r 也可以使用 `copyIndex()` 并在资源名称中追加一个数字，来创建 `myNic1`、`myNic2`，等等。下面显示了追加索引值的示例：\r \r ```json\r \"name\": \"[concat('myNic', copyIndex())]\", \r ```\r \r 可以阅读[使用 Resource Manager 模板创建多个 NIC](../../virtual-network/virtual-network-deploy-multinic-arm-template.md) 的完整示例。\r \r ## <a name=\"next-steps\"></a>后续步骤\r 尝试创建具有多个 NIC 的 VM 时，请务必查看 [Linux VM 大小](sizes.md)。 注意每个 VM 大小支持的 NIC 数目上限。 \r \r 请记住，不能将其他 NIC 添加到现有 VM，而必须在部署 VM 时创建所有 NIC。 仔细规划部署，确保从一开始就建立了全部所需的网络连接。\r \r <!--Update_Description: update meta properties， update link-->"}