{"Title":"将现有应用快速部署到 Azure Service Fabric 群集","Description":"通过 Visual Studio 使用 Azure Service Fabric 群集来托管现有的 Node.js 应用程序。","Content":"# <a name=\"host-a-nodejs-application-on-azure-service-fabric\"></a>在 Azure Service Fabric 上托管 Node.js 应用程序\r \r 本快速入门教程帮助将现有的应用程序（本示例中为 Node.js）部署到在 Azure 上运行的 Service Fabric 群集。\r \r ## <a name=\"prerequisites\"></a>先决条件\r \r 开始之前，请确保已 [设置开发环境](service-fabric-get-started.md)。 其中包括安装 Service Fabric SDK 和 Visual Studio 2017 或 2015。\r \r 此外还需一个用于部署的现有 Node.js 应用程序。 本快速入门教程使用简单的 Node.js 网站，可从[此处][download-sample]下载。 在下一步骤中，请在创建项目后将此文件提取到 `<path-to-project>\\ApplicationPackageRoot\\<package-name>\\Code\\` 文件夹。\r \r 如果还没有 Azure 订阅，请创建一个[试用帐户][create-account]。\r \r ## <a name=\"create-the-service\"></a>创建服务\r \r 以**管理员**身份启动 Visual Studio。\r \r 使用 `CTRL`+`SHIFT`+`N` 创建一个项目\r \r 在“新建项目”对话框中，选择“云”>“Service Fabric 应用程序”。\r \r 将应用程序命名为“MyGuestApp”，并按“确定”。\r \r >[!IMPORTANT]\r >Node.js 可能会轻松突破针对 Windows 路径的 260 字符限制。 请对项目本身使用短路径，例如 **c:\\code\\svc1**。 （可选）可以按照[这些说明](https://stackoverflow.com/a/41687101/1664231)在 Windows 10 中启用长文件路径。\r \r ![Visual Studio 中的新建项目对话框][new-project]\r \r 可以在下一对话框中创建任何类型的 Service Fabric 服务。 对于本快速入门教程，请选择“来宾可执行文件”。\r \r 将服务命名为“MyGuestService”，并将右侧的选项设置为以下值：\r \r | 设置                   | 值 |\r | ------------------------- | ------ |\r | 代码包文件夹       | _&lt;包含 Node.js 应用的文件夹&gt;_ |\r | 代码包行为     | 将文件夹内容复制到项目 |\r | 节目                   | node.exe |\r | 参数                 | server.js |\r | 工作文件夹            | CodePackage |\r \r 按“确定”。\r \r ![Visual Studio 中的新建服务对话框][new-service]\r \r Visual Studio 会创建应用程序项目和执行组件服务项目，并在解决方案资源管理器中显示它们。\r \r 应用程序项目 (**MyGuestApp**) 不直接包含任何代码。 而是引用一组服务项目。 此外，它包含三种其他类型的内容：\r \r * **发布配置文件**  \r 针对不同环境的工具首选项。\r \r * **脚本**  \r 用于部署/升级应用程序的 PowerShell 脚本。\r \r * **应用程序定义**  \r 包括 *ApplicationPackageRoot* 下的应用程序清单。 关联应用程序参数文件位于 *ApplicationParameters* 下，它们定义应用程序并使你可以专门为给定环境对其进行配置。\r \r 有关服务项目的内容概述，请参阅 [Reliable Services 入门](service-fabric-reliable-services-quick-start.md)。\r \r ## <a name=\"set-up-networking\"></a>设置网络\r \r 要部署的示例 Node.js 应用使用端口 **80**，我们需告知 Service Fabric：我们需公开该端口。\r \r 打开项目中的 **ServiceManifest.xml** 文件。 在清单底部，有一个已定义条目的 `<Resources> \\ <Endpoints>`。 修改该条目，添加 `Port`、`Protocol` 和 `Type`。 \r \r ```xml\r   <Resources>\r     <Endpoints>\r       <!-- This endpoint is used by the communication listener to obtain the port on which to \r            listen. Please note that if your service is partitioned, this port is shared with \r            replicas of different partitions that are placed in your code. -->\r       <Endpoint Name=\"MyGuestAppServiceTypeEndpoint\" Port=\"80\" Protocol=\"http\" Type=\"Input\" />\r     </Endpoints>\r   </Resources>\r ```\r \r ## <a name=\"deploy-to-azure\"></a>部署到 Azure\r \r 如果通过按 **F5** 来运行项目，则会将其部署到本地群集。 但请将其部署到 Azure。\r \r 右键单击项目，选择“发布...”，此时会打开一个将内容发布到 Azure 所需的对话框。\r \r ![用于 Service Fabric 服务的“发布到 Azure”对话框][publish]\r \r 选择 **PublishProfiles\\Cloud.xml** 目标配置文件。\r \r 选择要将内容部署到其中的 Azure 帐户（如果尚未这样做）。 如果还没有该帐户，请[在此注册一个][create-account]。\r \r 在“连接终结点”下，选择要将内容部署到其中的 Service Fabric 群集。 如果没有该群集，请选择**&lt;新建群集...&gt;**，此时会打开通往 Azure 门户的 Web 浏览器窗口。 有关详细信息，请参阅[在门户中创建群集](service-fabric-cluster-creation-via-portal.md#create-cluster-in-the-azure-portal)。 \r \r 创建 Service Fabric 群集时，请确保将“自定义终结点”设置设为“80”。\r \r ![终结点为自定义的 Service Fabric 节点类型配置][custom-endpoint]\r \r 创建新的 Service Fabric 群集需要一段时间来完成。 创建完以后，请回到发布对话框，并选择**&lt;刷新&gt;**。 新群集列在下拉列表框中；请将其选中。\r \r 按“发布”，并等待部署完成。\r \r 这可能需要几分钟的时间。 完成后，可能还需要等待几分钟，该应用程序才会完全可用。\r \r ## <a name=\"test-the-website\"></a>测试网站\r \r 发布服务以后，请在 Web 浏览器中对其进行测试。 \r \r 首先，打开 Azure 门户并找到 Service Fabric 服务。\r \r 检查服务地址的概览边栏选项卡。 使用“客户端连接终结点”属性中的域名。 例如，`http://mysvcfab1.chinanorth2.chinacloudapp.cn`。\r \r ![Azure 门户中的 Service Fabric 概览边栏选项卡][overview]\r \r 导航到该地址，可以在其中看到 `HELLO WORLD` 响应。\r \r ## <a name=\"delete-the-cluster\"></a>删除群集\r \r 请勿忘记删除为本快速入门教程创建的所有资源，因为系统会对这些资源收费。\r \r ## <a name=\"next-steps\"></a>后续步骤\r 阅读更多有关[来宾可执行文件](service-fabric-deploy-existing-app.md)的内容。\r \r <!-- Image References -->\r \r [new-project]: ./media/quickstart-guest-app/new-project.png\r [new-service]: ./media/quickstart-guest-app/template.png\r [solution-exp]: ./media/quickstart-guest-app/solution-explorer.png\r [publish]: ./media/quickstart-guest-app/publish.png\r [overview]: ./media/quickstart-guest-app/overview.png\r [custom-endpoint]: ./media/quickstart-guest-app/custom-endpoint.png\r \r [download-sample]: https://github.com/MicrosoftDocs/azure-cloud-services-files/raw/temp/service-fabric-node-website.zip\r [create-account]: https://www.azure.cn/pricing/1rmb-trial/?WT.mc_id=A261C142F\r <!--Update_Description: update meta properties, wording update-->"}