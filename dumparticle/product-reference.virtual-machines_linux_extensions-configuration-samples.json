{"Title":"Linux VM 扩展配置示例","Description":"使用扩展为 Linux VM 创作模板的示例配置","Content":"# <a name=\"linux-vm-extension-configuration-samples\"></a>Linux VM 扩展配置示例\r > [!div class=\"op_single_selector\"]\r > * [PowerShell - 模板](../windows/extensions-configuration-samples.md?toc=%2fvirtual-machines%2fwindows%2ftoc.json)\r > * [CLI - 模板](../windows/extensions-configuration-samples.md?toc=%2fvirtual-machines%2flinux%2ftoc.json)\r > \r > \r \r <br>\r \r >[!NOTE]\r > 必须修改从 GitHub 存储库“azure-quickstart-templates”下载的模板，以适应 Azure 中国云环境。 例如，替换某些终结点（将“blob.core.windows.net”替换为“blob.core.chinacloudapi.cn”，将“cloudapp.azure.com”替换为“chinacloudapp.cn”）；更改某些不受支持的 VM 映像；更改某些不受支持的 VM 大小。\r \r 本文提供为 Linux VM 配置 Azure VM 扩展的示例配置。\r \r 若要了解有关这些扩展的详细信息，请单击此处：[Azure VM 扩展概述](../windows/extensions-features.md?toc=%2fvirtual-machines%2fwindows%2ftoc.json)。\r \r 若要了解有关创作扩展模板的详细信息，请单击此处：[创作扩展模板](../windows/extensions-authoring-templates.md?toc=%2fvirtual-machines%2fwindows%2ftoc.json)。\r \r 本文列出了一些 Linux 扩展的预期配置值。\r \r ## <a name=\"sample-template-snippet-for-vm-extensions\"></a>VM 扩展的示例模板代码段。\r 用于部署扩展的模板代码段如下所示：\r \r       {\r       \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r       \"name\": \"MyExtension\",\r       \"apiVersion\": \"2015-05-01-preview\",\r       \"location\": \"[parameters('location')]\",\r       \"dependsOn\": [\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'))]\"],\r       \"properties\":\r       {\r       \"publisher\": \"Publisher Namespace\",\r       \"type\": \"extension Name\",\r       \"typeHandlerVersion\": \"extension version\",\r       \"autoUpgradeMinorVersion\":true,\r       \"settings\": {\r       // Extension specific configuration goes in here.\r       }\r       }\r       }\r \r ## <a name=\"sample-template-snippet-for-vm-extensions-with-vm-scale-sets\"></a>适用于 VM 规模集的 VM 扩展的示例模板代码段。\r           {\r            \"type\":\"Microsoft.Compute/virtualMachineScaleSets\",\r           ....\r                  \"extensionProfile\":{\r                  \"extensions\":[\r                    {\r                      \"name\":\"extension Name\",\r                      \"properties\":{\r                        \"publisher\":\"Publisher Namespace\",\r                        \"type\":\"extension Name\",\r                        \"typeHandlerVersion\":\"extension version\",\r                        \"autoUpgradeMinorVersion\":true,\r                        \"settings\":{\r                        // Extension specific configuration goes in here.\r                        }\r                      }\r                     }\r                   }\r                 }\r \r 在部署扩展之前，请检查最新的扩展版本，并将“typeHandlerVersion”替换为当前最新版本。\r \r 本文剩余部分提供 Linux VM 扩展的示例配置。\r \r ### <a name=\"cloudlink-securevm-agent\"></a>CloudLink SecureVM 代理\r           {\r             \"publisher\": \"CloudLinkEMC.SecureVM\",\r             \"type\": \"CloudLinkSecureVMLinuxAgent\",\r             \"typeHandlerVersion\": \"4.0\",\r             \"settings\": {\r               \"CloudLinkCenter\" : \"specify valid IP/FQDN to CloudLinkCenter\"\r             }\r           }\r \r ### <a name=\"customscript-extension-for-linux\"></a>适用于 Linux 的 CustomScript 扩展。\r     {\r         \"publisher\": \" Microsoft.Azure.Extensions\",\r         \"type\": \"CustomScript\",\r         \"typeHandlerVersion\": \"2.0\",\r         \"autoUpgradeMinorVersion\": true,\r         \"settings\": {\r             \"fileUris\": [\r                 \"http: //Yourstorageaccount.blob.core.chinacloudapi.cn/customscriptfiles/start.ps1\"\r             ],\r             \"commandToExecute\": \"powershell.exe-ExecutionPolicyUnrestricted-Filestart.ps1\"\r         }\r     }\r \r ### <a name=\"datadog-agent\"></a>Datadog 代理\r         {\r           \"publisher\": \"Datadog.Agent\",\r           \"type\": \"DatadogLinuxAgent\",\r           \"typeHandlerVersion\": \"0.4\",\r           \"settings\": {\r             \"api_key\" : \"API Key from https://app.datadoghq.com/account/settings#api\"\r           }\r         }\r \r ### <a name=\"chef-agent\"></a>Chef 代理\r         {\r           \"publisher\": \"Chef.Bootstrap.WindowsAzure\",\r           \"type\": \"CentosChefClient|LinuxChefClient\",\r           \"typeHandlerVersion\": \"1210.12\",\r           \"settings\": {\r             \"validation_key\" : \" Validation key\",\r             \"client_rb\" : \"client_rb file\",\r             \"runlist\" : \"Optional runlist\"\r           }\r         }\r \r ### <a name=\"vm-access-extension-password-reset\"></a>VM 访问扩展（密码重置）\r 有关更新的架构，请参阅 [VMAccessForLinux 文档](https://github.com/Azure/azure-linux-extensions/tree/master/VMAccess)\r \r         {\r           \"publisher\": \"Microsoft.OSTCExtensions\",\r           \"type\": \"VMAccessForLinux\",\r           \"typeHandlerVersion\": \"1.2\",\r           \"protectedSettings\": {\r             \"username\": \"(required, string) the name of the user\",\r             \"password\": \"(optional, string) the password of the user\",\r             \"reset_ssh\": \"(optional, boolean) whether or not reset the ssh\",\r             \"ssh_key\": \"(optional, string) the public key of the user, base64 encoded pem\",\r             \"remove_user\": \"(optional, string) the user name to remove\"\r           }\r         }\r \r ### <a name=\"os-patching\"></a>OS 修补\r 有关更新的架构，请参阅 [OSPatching 文档](https://github.com/Azure/azure-linux-extensions/tree/master/OSPatching)\r \r         {\r         \"publisher\": \"Microsoft.OSTCExtensions\",\r         \"type\": \"OSPatchingForLinux\",\r         \"typeHandlerVersion\": \"2.9\",\r         \"Settings\": {\r           \"disabled\": false,\r           \"stop\": false,\r           \"rebootAfterPatch\": \"RebootIfNeed|Required|NotRequired|Auto\",\r           \"category\": \"Important|ImportantAndRecommended\",\r           \"installDuration\": \"<hr:min>\",\r           \"oneoff\": false,\r           \"intervalOfWeeks\": \"<number>\",\r           \"dayOfWeek\": \"Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Everyday\",\r           \"startTime\": \"<hr:min>\",\r           \"vmStatusTest\": {\r               \"local\": false,\r               \"idleTestScript\": \"<path_to_idletestscript>\",\r               \"healthyTestScript\": \"<path_to_healthytestscript>\"\r           }\r         }\r         }\r \r ### <a name=\"docker-extension\"></a>Docker 扩展\r 有关更新的架构，请参阅 [Docker 扩展文档](https://github.com/Azure/azure-docker-extension/blob/master/README.md#1-configuration-schema)\r \r         {\r           \"publisher\": \"Microsoft.Azure.Extensions \",\r           \"type\": \"DockerExtension \",\r           \"typeHandlerVersion\": \"1.0\",\r           \"Settings\": {\r             \"docker\":{\r                 \"port\": \"2376\",\r                 \"options\": [\"-D\", \"--dns=8.8.8.8\"]\r             },\r             \"compose\": {\r                 \"cache\" : {\r                     \"image\" : \"memcached\",\r                     \"ports\" : [\"11211:11211\"]\r                 },\r                 \"blog\": {\r                     \"image\": \"ghost\",\r                     \"ports\": [\"80:2368\"]\r                 }\r             }\r             }\r         }\r \r ### <a name=\"linux-diagnostics-extension\"></a>Linux 诊断扩展\r         {\r         \"storageAccountName\": \"storage account to receive data\",\r         \"storageAccountKey\": \"key of the account\",\r         \"perfCfg\": [\r         {\r             \"query\": \"SELECT PercentAvailableMemory, AvailableMemory, UsedMemory ,PercentUsedSwap FROM SCX_MemoryStatisticalInformation\",\r             \"table\": \"LinuxMemory\"\r         }\r         ],\r         \"fileCfg\": [\r         {\r             \"file\": \"/var/log/mysql.err\",\r             \"table\": \"mysqlerr\"\r         }\r         ]\r         }\r \r 在上述示例中，请将版本号替换为最新版本号。\r \r 以下是使用扩展创建 Linux VM 的完整 VM 模板：\r \r [Linux VM 上的自定义脚本扩展](https://github.com/Azure/azure-quickstart-templates/blob/b1908e74259da56a92800cace97350af1f1fc32b/mongodb-on-ubuntu/azuredeploy.json/)\r "}