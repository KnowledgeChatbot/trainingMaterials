{"Title":"在 Azure Linux 虚拟机上手动安装配置 Zabbix 监控服务","Description":"本文介绍如何在 Azure Linux 虚拟机上配置 zabbix 监控","Content":"\r # 在 Azure Linux 虚拟机上手动安装配置 Zabbix 监控服务\r \r ## 目录\r \r - [介绍](#introduction)\r - [安装 zabbix server](#install-zabbix-server)\r - [安装 zabbix agent](#install-zabbix-agent)\r - [监控虚拟机](#Monitor-virtual-machines)\r - [设置邮件通知](#settingmailnotification)\r - [自定义监控项](#customizemonitoringitems)\r \r ##<a id=\"introduction\"></a> 介绍\r \r Zabbix 是一个的企业级的开源监控解决方案，它支持从服务器、虚拟机和网络设备大规模采集数据并进行实时监控。\r Zabbix 由2部分构成，zabbix server 与可选组件 zabbix agent。\r Zabbix server 可以通过 SNMP，zabbix agent，ping，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能\r Zabbix 的四种监控方式：Agent, SNMP, JMX, IPMI\r \r 本文主要介绍如何手动在 Azure Linux 虚拟机上搭建 Zabbix 监控服务，关于如何通过 Azure 资源管理器自动搭建 Zabbix 监控服务，请参阅[使用 Azure 资源管理器自动部署 Zabbix 监控服务](./open-source-azure-resource-manager-zabbix.md)。\r \r 我们将会在一台虚拟机上安装 zabbix server 软件包作为 zabbix server，在被监控的虚拟机上安装 zabbix 客户端软件包。\r \r ##<a id=\"install-zabbix-server\"></a> 安装 zabbix server\r \r 如果您还没有 Azure 下的 LINUX 虚拟机，请参考 [Azure Linux VM tutorial](/virtual-machines/virtual-machines-linux-quick-create-portal) 创建 LINUX 虚拟机。\r \r 连接到您的 LINUX 虚拟机。如果这是您第一次使用 Azure 的 LINUX 虚拟机，请参考\r  [Azure Linux VM tutorial](/virtual-machines/virtual-machines-linux-quick-create-portal) 连接到虚拟机。\r \r 不同的 LINUX 发行版在安装时有少许的不同。接下来我们以 CentOS 7.0 为例说明安装过程。\r \r 1. 关闭 selinux\r \r     ```\r     $sudo setenforce 0\r     $sudo sed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/sysconfig/selinux\r     ```\r \r 2. 关闭 firewalld 和 iptables\r \r     ```\r     $sudo systemctl stop firewalld\r     $sudo systemctl disable firewalld\r     $sudo systemctl stop iptables\r     $sudo systemctl disable iptables\r     ```\r \r 3. 准备过程\r \r     ```\r     $sudo yum install -y gcc gcc-c++ httpd httpd-devel mysql mysql-server mysql-devel php php-mysql php-common php-gd gd php-mcrtpt php-xml libcurl-develnet-snmp-devel curl-devel php-devel php-bcmath php-mbstring gd-devel\r     $ sudo yum install fontconfig-devel freetype-devel libX11-devel libXau-devel libXpm-devel libjpeg-turbo-devel libpng-devel libxcb-devel xorg-x11-proto-devel -y\r     ```\r 4. 下载和安装 jre\r \r     ```\r     $sudo yum install wget -y\r     $sudo wget --header \"Cookie: oraclelicense=accept-securebackup-cookie\" http://download.oracle.com/otn-pub/java/jdk/8u5-b13/jdk-8u5-linux-x64.rpm\r     $sudo rpm -ivh jdk-8u5-linux-x64.rpm\r     $java -version\r     ```\r \r     看到如下图示说明安装成功\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/1.png)    \r \r 5. 添加 zabbix 用户\r \r     ```\r     $sudo groupadd zabbix\r     $sudo useradd zabbix -g zabbix -s /sbin/nologin\r     ```\r \r 6. 配置数据库\r \r     ```\r     $sudo service mysqld start               #如果返回错误，说明 mysql 安装失败或未安装 \r     $sudo yum install mariadb-server -y       #我们安装 mariadb 代替 mysql\r     $sudo service mariadb start\r     $sudo systemctl enable mariadb\r     $sudo /usr/bin/mysqladmin -u root password abcde   #这里 abcde 是 mysql root 密码\r     $sudo cp /etc/my.cnf /etc/my.cnf.bak\r     $ sudo sed -i '/\\[mysqld\\]/a character-set-server=utf8' /etc/my.cnf\r     $ sudo sed -i '$a [client]\\ndefault-character-set = utf8' /etc/my.cnf\r     $sudo service mariadb restart\r     $mysql -uroot -pabcde\r     create database zabbix character set utf8;\r     grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';\r     flush privileges;\r     exit\r     ```\r \r 7. 下载zabbix 软件包\r \r     ```\r     $sudo wget http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/2.2.5/zabbix-2.2.5.tar.gz\r     ```\r \r 8. 安装\r \r     ```\r     $ sudo tar -zxvf zabbix-2.2.5.tar.gz\r     $cd zabbix-2.2.5\r     $sudo mkdir -p /usr/local/zabbix\r     $sudo yum install net-snmp-devel -y\r     $sudo ./configure --prefix=/usr/local/zabbix --enable-java --enable-server --enable-agent --with-mysql --with-net-snmp --with-libcurl\r     $sudo make install\r     $mysql -uzabbix -pzabbix -hlocalhost zabbix < database/mysql/schema.sql\r     $mysql -uzabbix -pzabbix -hlocalhost zabbix < database/mysql/images.sql\r     $mysql -uzabbix -pzabbix -hlocalhost zabbix < database/mysql/data.sql\r     $sudo cp misc/init.d/fedora/core/zabbix_server /etc/init.d/\r     $sudo cp misc/init.d/fedora/core/zabbix_agentd /etc/init.d/\r     $sudo cp -R frontends/php /var/www/html/zabbix\r     $sudo sed -i \"s/max_execution_time = 30/max_execution_time = 300/g\" /etc/php.ini\r     $sudo sed -i \"s/max_input_time = 60/max_input_time = 300/g\" /etc/php.ini\r     $sudo sed -i \"s/post_max_size = 8M/post_max_size = 16M/g\" /etc/php.ini\r     $sudo sed -i \"s/;date.timezone =/date.timezone = Asia\\/Shanghai/g\" /etc/php.ini\r     $sudo sed -i 's/^DBUser=.*$/DBUser=zabbix/g' /usr/local/zabbix/etc/zabbix_server.conf\r     $sudo sed -i 's/^.*DBPassword=.*$/DBPassword=zabbix/g' /usr/local/zabbix/etc/zabbix_server.conf\r     $sudo sed -i 's/BASEDIR=\\/usr\\/local/BASEDIR=\\/usr\\/local\\/zabbix/g' /etc/init.d/zabbix_server\r     $sudo sed -i 's/BASEDIR=\\/usr\\/local/BASEDIR=\\/usr\\/local\\/zabbix/g' /etc/init.d/zabbix_agentd\r     $sudo vi /etc/services                                #add below into /etc/services\r     zabbix-agent    10050/tcp              #Zabbix Agent\r     zabbix-agent    10050/udp              #Zabbix Agent\r     zabbix-trapper  10051/tcp               #Zabbix Trapper\r     zabbix-trapper  10051/udp              #Zabbix Trapper\r     $cd /usr/local/zabbix/bin/\r     $for i in *;do sudo ln -s /usr/local/zabbix/bin/${i} /usr/bin/${i};done\r     $cd /usr/local/zabbix/sbin/\r     $for i in *;do sudo ln -s /usr/local/zabbix/sbin/${i} /usr/sbin/${i};done\r     ```\r \r 9. 配置apache服务\r \r     ```\r     $sudo sed -i 's/^#\\(ServerName \\).*/\\1localhost:80/' /etc/httpd/conf/httpd.conf\r     $sudo service httpd restart\r     $sudo systemctl enable httpd\r     ```\r \r 10. 启动zabbix server和agentd\r \r     ```\r     $sudo /etc/init.d/zabbix_server start\r     $sudo /etc/init.d/zabbix_agentd start\r     $ sudo sed -i '$a /etc/init.d/zabbix_server start\\n/etc/init.d/zabbix_agentd start' /etc/rc.local\r     ```\r \r 11. 打开端口 80, 10050, 10051. 请参考链接[创建终结点](/virtual-machines/virtual-machines-linux-classic-setup-endpoints)打开这些端口\r 12. Zabbix server web 端配置. 打开网址 *http://zabbix server ip/zabbix*  \r     Zabbix server ip 是您的 zabbix server 虚拟机的 IP 地址。打开的页面如下图所示\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2.png)\r \r     点击 ‘next’. 之后会看到类似下图, 等待 pre-requisites 检测通过, 点击 ‘next’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/3.png)\r \r     之后会出现类似下图. 输入用户名和密码皆为 zabbix, 然后点击 ‘Test connection’. 通过之后，点击’next’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/4.png)\r \r     去到类似下图。点击 ‘next’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/5.png)\r \r     点击 ‘next’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/6.png)\r \r     点击 ‘Download configuration file’, 保存此文件到本地，然后上传至 zabbix server 虚拟机的目录 /var/www/html/zabbix/conf/, 然后点击 ‘Retry’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/7.png)\r \r     之后会出现类似下图。点击 ‘Finish’.\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/8.png)\r \r     输入 admin/zabbix 点击 ‘sign in’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/9.png)\r \r     您会看到类似下图。表明 zabbix server 正常工作了。\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/10.png)\r \r     如果还是显示未 login 的话，就在 zabbix server 执行命令\r \r     ```\r     $sudo /etc/init.d/zabbix_server restart\r     ```\r \r     然后重新输入 admin/zabbix 点击 ‘sign in’，登录即可。\r \r     接下来我们在需要被监控的虚拟机上安装 zabbix agent 软件包，这样 zabbix server 就能监控到了。\r \r ##<a id=\"install-zabbix-agent\"></a> 安装 zabbix agent\r \r 连接到您的 LINUX 虚拟机。如果这是您第一次使用 Azure 的 LINUX 虚拟机，请参考\r  [Azure Linux VM tutorial](/virtual-machines/virtual-machines-linux-quick-create-portal) 连接到虚拟机。\r \r 不同的 LINUX 发行版在安装 Redis 时有少许的不同。请根据您的 LINUX 版本选择对应的步骤。\r \r **Redhat base Linux**: ( 以 CentOS 7.0, 64-bit system 为例)\r \r 1. 安装 gcc 和 wget\r \r     ```\r     $sudo yum install -y gcc wget\r     ```\r \r 2. 下载和解压 zabbix 软件包\r \r     ```\r     $sudo wget http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/2.2.5/zabbix-2.2.5.tar.gz\r     $sudo tar zxvf zabbix-2.2.5.tar.gz\r     $cd zabbix-2.2.5\r     ```\r \r 3. 添加用户和组\r \r     ```\r     $sudo groupadd zabbix\r     $sudo useradd zabbix -g zabbix -s /sbin/nologin\r     ```\r \r 4. 安装 zabbix agent\r \r     ```\r     $ sudo mkdir -p /usr/local/zabbix\r     $ sudo ./configure --prefix=/usr/local/zabbix --enable-agent\r     $ sudo make install\r     $ sudo cp misc/init.d/fedora/core/zabbix_agentd /etc/init.d/\r     $ sudo sed -i 's/BASEDIR=\\/usr\\/local/BASEDIR=\\/usr\\/local\\/zabbix/g' /etc/init.d/zabbix_agentd\r     ```\r \r 5. 编辑 /etc/services, 添加以下行\r \r     ```\r     zabbix-agent    10050/tcp               #ZabbixAgent\r     zabbix-agent    10050/udp               #Zabbix Agent\r     ```\r \r 6. 编辑/usr/local/zabbix/etc/zabbix_agentd.conf, 修改下面四项，请根据实际情况修改。\r \r     ```\r     Server=zabbix server ip                        #这里是指真实的 zabbix server 的 IP\r     ServerActive=zabbix server ip                   #这里是指真实的 zabbix server 的 IP\r     LogFile=/var/log/zabbix_agentd.log\r     Hostname=zabbix agent VM hostname           #这里是指 zabbix agent 所在虚拟机主机名\r     ```\r \r 7. 编辑 /usr/local/zabbix/etc/zabbix_agent.conf, 修改下列项\r \r     ```\r     Server=zabbix server ip                        #这里是指真实的 zabbix server 的 IP\r     ```\r \r 8. 创建日志文件\r \r     ```\r     $ sudo touch /var/log/zabbix_agentd.log\r     $ sudo chown zabbix:zabbix /var/log/zabbix_agentd.log\r     ```\r \r 9. 启动进程\r \r     ```\r     $ sudo chkconfig --add zabbix_agentd\r     $ sudo chkconfig zabbix_agentd on\r     $ sudo /etc/init.d/zabbix_agentd start\r     ```\r \r 10. 打开端口 10050，10051。请参考链接创建终结点 打开端口.\r \r **Ubuntu base Linux**: ( 以 Ubuntu 14.04, 64-bit system 为例)\r \r 1. 安装 gcc 和 make\r \r     ```\r     $sudo apt-get update\r     $sudo apt-get install gcc make -y\r     ```\r \r 2. 下载和解压 zabbix 包\r \r     ```\r     $sudo wget http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/2.2.5/zabbix-2.2.5.tar.gz\r     $sudo tar zxvf zabbix-2.2.5.tar.gz\r     $cd zabbix-2.2.5.tar.gz\r     ```\r \r 3. 添加用户和组\r \r     ```\r     $sudo groupadd zabbix\r     $sudo useradd zabbix -g zabbix -s /sbin/nologin\r     ```\r \r 4. 安装 zabbix agent\r \r     ```\r     $ sudo mkdir -p /usr/local/zabbix\r     $ sudo ./configure --prefix=/usr/local/zabbix --enable-agent\r     $ sudo make install\r     ```\r \r 5. 编辑 /etc/services, 添加以下行\r \r     ```\r     zabbix-agent    10050/tcp               #ZabbixAgent\r     zabbix-agent    10050/udp               #Zabbix Agent\r     ```\r \r 6. 编辑 /usr/local/zabbix/etc/zabbix_agentd.conf, 修改下面四项，请根据实际情况修改\r \r     ```\r     Server=zabbix server ip                        #这里是指真实的 zabbix server 的 IP\r     ServerActive=zabbix server ip                   #这里是指真实的 zabbix server 的 IP\r     LogFile=/var/log/zabbix_agentd.log\r     Hostname=zabbix agent VM hostname            #这里指 zabbix agent 所在虚拟机主机名\r     ```\r \r 7. 编辑 /usr/local/zabbix/etc/zabbix_agent.conf, 修改以下行\r \r     ```\r     Server=zabbix server ip                        #这里是指真实的 zabbix server 的 IP\r     ```\r \r 8. 创建日志文件\r \r     ```\r     $ sudo touch /var/log/zabbix_agentd.log\r     $ sudo chown zabbix:zabbix /var/log/zabbix_agentd.log\r     ```\r \r 9. 编辑 /etc/rc.local, 添加下行\r \r     ```\r     /usr/local/zabbix/sbin/zabbix_agentd\r     ```\r \r 10. 启动进程\r \r     ```\r     $ sudo /usr/local/zabbix/sbin/zabbix_agentd\r     ```\r \r 11. 打开端口 10050 ，10051 。请参考链接 创建终结点\r \r **SUSE Linux**: (以 SLES 12 SP1, 64-bit system 为例)\r \r 1. 安装 gcc 和 make\r \r     ```\r     $sudo zypper install gcc make\r     ```\r \r 2. 下载和解压 zabbix 包\r \r     ```\r     $sudo wget http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/2.2.5/zabbix-2.2.5.tar.gz\r     $sudo tar zxvf zabbix-2.2.5.tar.gz\r     $cd zabbix-2.2.5.tar.gz\r     ```\r \r 3. 添加用户和组\r \r     ```\r     $sudo groupadd zabbix\r     $sudo useradd zabbix -g zabbix -s /sbin/nologin\r     ```\r \r 4. 安装 zabbix agent\r \r     ```\r     $ sudo mkdir -p /usr/local/zabbix\r     $ sudo ./configure --prefix=/usr/local/zabbix --enable-agent\r     $ sudo make install\r     ```\r \r 5. 编辑 /etc/services, 添加以下行\r \r     ```\r     zabbix-agent    10050/tcp               #ZabbixAgent\r     zabbix-agent    10050/udp               #Zabbix Agent\r     ```\r \r 6. 编辑 /usr/local/zabbix/etc/zabbix_agentd.conf, 修改下面四项，请根据实际情况修改\r \r     ```\r     Server=zabbix server ip                        #这里是指真实的 zabbix server 的 IP\r     ServerActive=zabbix server ip                   #这里是指真实的 zabbix server 的 IP\r     LogFile=/var/log/zabbix_agentd.log\r     Hostname=zabbix agent VM hostname            #这里指 zabbix agent 所在虚拟机主机名\r     ```\r \r 7. 编辑 /usr/local/zabbix/etc/zabbix_agent.conf, 修改以下行\r \r     ```\r     Server=zabbix server ip                        #这里是指真实的 zabbix server 的 IP\r     ```\r \r 8. 创建日志文件\r \r     ```\r     $ sudo touch /var/log/zabbix_agentd.log\r     $ sudo chown zabbix:zabbix /var/log/zabbix_agentd.log\r     ```\r \r 9. 启动进程\r \r     ```\r     $ sudo cp /usr/local/zabbix/sbin/zabbix_agentd /etc/init.d/\r     $ sudo chkconfig --add zabbix_agentd\r     $ sudo chkconfig zabbix_agentd on\r     $ sudo /etc/init.d/zabbix_agentd\r     ```\r \r 10. 打开端口10050, 10051. 请参考链接[创建终结点](/virtual-machines/virtual-machines-linux-classic-setup-endpoints)\r \r 当 zabbix agent 安装和启动之后，我们就可以把这些需要监控的虚拟机监控起来了！\r \r ##<a id=\"Monitor-virtual-machines\"></a> 监控虚拟机\r \r 1. 打开网址 *http://zabbix server ip:/zabbix* , 输入 admin/zabbix, 点击 ‘Configuration’ -- > ‘Hosts’ -- > ‘Create host’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/11.png)\r \r 2. 输入想要监控的虚拟机主机名, 选择 ‘linux servers’ 组然后点击 ‘<<’, 输入想要监控的虚拟机的 IP 地址\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/12.png)\r \r 3. 选择模板. 点击 ‘Templates’ -- > ‘Select’ -- > 选择 ‘Template OS Linux’ 和‘Template APP Zabbix Server’ -- > 点击 ‘Select’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/13.png)\r \r 4. 点击 ‘Add’, 然后点击 ‘Save’ \r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/14.png)\r \r 5. 这时能看到此虚拟机已经被监控起来了，它的状态是 ‘Monitored’.\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/15.png)\r \r 6. 您可以点击 ‘Applications’ 或者 ‘Items’ 或 ‘Triggers’ 以查看被监控主机的监控项, 这些监控项都来自于我们刚刚添加的模板，之后我们会演示如何自定义监控项。之后我们会演示如何自定义监控项和模板。\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/16.png)\r \r     把 zabbix server 也监控起来\r     在 ‘Configuration’ -- > ‘Hosts’ , 我们看到 zabbix server 也在列表中，不过它的状态是 ‘Not monitored’, 直接点击 ‘Not monitored’ -- > 点击 ‘Yes’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/17.png)\r \r     这时候状态变成 ‘monitored’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/18.png)\r \r ##<a name='settingmailnotification'></a>设置邮件通知\r \r 当被监控的虚拟机出现一些问题，比如 CPU 使用率，磁盘 I/O 等居高不下，您可以在“Monitoring” -- > “Dashboard” 看到这些消息，但是我们并不是时刻都盯着这个页面，我们需要在出现问题的时候第一时间收到邮件通知。\r 有好几种设置邮件通知的方式，接下来展示一种简单的设置方法： \r \r 1. 使用 putty 连接到 zabbix server, 执行如下命令 `$ sudo yum install mailx`\r \r 2. 检查邮件能否发出去 `$ echo “configuration” |sudo mail -s “haproxy” youremail@163.com`\r \r 3. youremail@163.com指的是您的真实有效的邮件地址。检查是否收到了邮件。如果收到，我们可以继续下一步\r \r 4. 打开网址 http://zabbix server ip/zabbix ,  输入 admin/zabbix, 点击 “Administration” -- > “Media types” -- > “Email” \r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_1.png)\r \r 5. 设置 smtp 服务器 以及smtp helo 填 localhost, smtp email 填 zabbix@localhost, 点击 ‘Save’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_2.png)\r \r 6. 点击 ‘Administration’ -- > ‘Users’ -- > ‘Admin(Zabbix Administrator)’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_3.png)\r \r 7. 点击 ‘Media’ -- > ‘Add’ -- >  ‘Send to’ 这里填您想要获取邮件通知的邮件地址, 即上面步骤中验证过的能收到邮件的邮件地址，选择邮件通知级别，可以选择所有，意味着任何事件都会发送邮件通知。请根据实际情况选择。然后点击‘Add’, 点击‘Save’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_4.png)\r \r 8. 点击 ‘Configuration’ -- > ‘Actions’ -- > ‘create action ‘\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_5.png)\r \r 9. 自定义’Name’, 勾选 ‘Recovery message’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_6.png)\r \r 10. 点击 ‘Conditions’ , 选择“OR” \r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_7.png)\r \r 11. 点击 ‘Operations’ -- > ‘New’ \r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_8.png)\r \r 12. 设置‘default operation step duration’ 值为60, 在 ‘Send to Users’ 区域点击 ‘Add’, 选择 “Admin” 用户, 点击 ‘Select’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_9.png)\r \r 13. 选择 ”Send only to” 为 “Email”, 点击“Add”\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_10.png)\r \r 14. 点击 ‘Save’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_11.png)\r \r 之后只要被监控的虚拟机出了‘问题’，您都将会收到邮件通知。\r \r ##<a name='customizemonitoringitems'></a>自定义监控项\r \r 我们也许有自定义的项目需要监控。接下来展示一个例子：\r \r 1. 点击 “Configuration” -- > “Hosts” -- > 选择其中一台机器的“Items”\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_21.png)\r \r 2. 点击“Create item”\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_22.png)\r \r 3. 设置项目名, 点击 “Select”, 选择您需要监控的项目, 这里我们选 “net.tcp.listen[port]”\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_23.png)\r \r 4. 将其中的 “port”用端口号代替, 比如我们想监控80端口，这里就填80\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_24.png)\r \r 5. 点击底部的”save”\r \r 6. 现在项目已经添加了。我们需要为此项目创建触发器。 点击 “Triggers”\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_25.png)\r \r 7. 点击 “Create trigger”\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_26.png)\r \r 8. 设置触发器名, 点击 ‘Add’ -- > ‘Select’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_27.png)\r \r 9. 选择 ‘http service’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_28.png)\r \r 10. 点击 ‘Insert’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_29.png)\r \r 11. 您可以选择 “Multiple PROBLEM events generation”,意思是会一直不断的发送邮件通知，只要这个监控项所代表的问题还存在，只有当问题解决才会停止发送邮件通知。比如我们这个监控项是监控80端口有没有打开，我们可以把使用 80 端口的 http 进程停掉，这样就会触发此触发器，邮件就会一直发送，直到我们再次启动 http 进程才停止邮件通知。 设置级别，点击 ‘Save’\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_210.png)\r \r 12. 现在触发器已经添加. 如果此虚拟机没有打开80端口，就会触发此事件。之后您就会看到事件状态。\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_211.png)\r \r 13. 检查您的邮箱。您会收到类似下图邮件:\r \r     ![](./media/open-source-azure-virtual-machines-linux-configure-zabbix-1/2_212.png)"}