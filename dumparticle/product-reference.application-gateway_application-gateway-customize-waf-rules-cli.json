{"Title":"自定义 Azure 应用程序网关的 Web 应用程序防火墙规则 - Azure CLI 2.0","Description":"此页提供有关如何使用 Azure CLI 2.0 自定义应用程序网关的 Web 应用程序防火墙规则的信息。","Content":"# <a name=\"customize-web-application-firewall-rules-through-the-azure-cli-20\"></a>通过 Azure CLI 2.0 自定义 Web 应用程序防火墙规则\r \r > [!div class=\"op_single_selector\"]\r > * [Azure 门户](application-gateway-customize-waf-rules-portal.md)\r > * [PowerShell](application-gateway-customize-waf-rules-powershell.md)\r > * [Azure CLI 2.0](application-gateway-customize-waf-rules-cli.md)\r \r 应用程序网关 Web 应用程序防火墙可为 Web 应用程序提供保护。 这些保护由 OWASP CRS 规则集提供。 某些规则可能会导致误报，并会阻止实际流量。  出于此原因，应用程序网关在启用了 Web 应用程序防火墙的应用程序网关上提供自定义规则组和规则的功能。 有关特定规则组和规则的详细信息，请访问 [Web 应用程序防火墙 CRS 规则组和规则](application-gateway-crs-rulegroups-rules.md)\r \r ## <a name=\"view-rule-groups-and-rules\"></a>查看规则组和规则\r \r 以下示例演示如何查看可在启用了 WAF 的应用程序网关上配置的规则和规则组。\r \r ### <a name=\"view-rule-groups\"></a>查看规则组\r \r ```azurecli-interactive\r az network application-gateway waf-config list-rule-sets --type OWASP\r ```\r \r 下面是截取自前一示例的响应。\r \r ```\r [\r   {\r     \"id\": \"/subscriptions//resourceGroups//providers/Microsoft.Network/applicationGatewayAvailableWafRuleSets/\",\r     \"location\": null,\r     \"name\": \"OWASP_3.0\",\r     \"provisioningState\": \"Succeeded\",\r     \"resourceGroup\": \"\",\r     \"ruleGroups\": [\r       {\r         \"description\": \"\",\r         \"ruleGroupName\": \"REQUEST-910-IP-REPUTATION\",\r         \"rules\": null\r       },\r       ...\r     ],\r     \"ruleSetType\": \"OWASP\",\r     \"ruleSetVersion\": \"3.0\",\r     \"tags\": null,\r     \"type\": \"Microsoft.Network/applicationGatewayAvailableWafRuleSets\"\r   },\r   {\r     \"id\": \"/subscriptions//resourceGroups//providers/Microsoft.Network/applicationGatewayAvailableWafRuleSets/\",\r     \"location\": null,\r     \"name\": \"OWASP_2.2.9\",\r     \"provisioningState\": \"Succeeded\",\r     \"resourceGroup\": \"\",\r    \"ruleGroups\": [\r       {\r         \"description\": \"\",\r         \"ruleGroupName\": \"crs_20_protocol_violations\",\r         \"rules\": null\r       },\r       ...\r     ],\r     \"ruleSetType\": \"OWASP\",\r     \"ruleSetVersion\": \"2.2.9\",\r     \"tags\": null,\r     \"type\": \"Microsoft.Network/applicationGatewayAvailableWafRuleSets\"\r   }\r ]\r ```\r \r ### <a name=\"view-rules-in-a-rule-group\"></a>查看规则组中的规则\r \r 以下示例演示如何查看指定的规则组中的规则。\r \r ```azurecli-interactive\r az network application-gateway waf-config list-rule-sets --group \"REQUEST-910-IP-REPUTATION\"\r ```\r \r 以下输出是截取自前一示例的响应。\r \r ```\r [\r   {\r     \"id\": \"/subscriptions//resourceGroups//providers/Microsoft.Network/applicationGatewayAvailableWafRuleSets/\",\r     \"location\": null,\r     \"name\": \"OWASP_3.0\",\r     \"provisioningState\": \"Succeeded\",\r     \"resourceGroup\": \"\",\r     \"ruleGroups\": [\r       {\r         \"description\": \"\",\r         \"ruleGroupName\": \"REQUEST-910-IP-REPUTATION\",\r         \"rules\": [\r           {\r             \"description\": \"Rule 910011\",\r             \"ruleId\": 910011\r           },\r           ...\r         ]\r       }\r     ],\r     \"ruleSetType\": \"OWASP\",\r     \"ruleSetVersion\": \"3.0\",\r     \"tags\": null,\r     \"type\": \"Microsoft.Network/applicationGatewayAvailableWafRuleSets\"\r   }\r ]\r ```\r \r ## <a name=\"disable-rules\"></a>禁用规则\r \r 以下示例在应用程序网关上禁用规则 `910018` 和 `910017`。\r \r ```azurecli-interactive\r az network application-gateway waf-config set --resource-group AdatumAppGatewayRG --gateway-name AdatumAppGateway --enabled true --rule-set-version 3.0 --disabled-rules 910018 910017\r ```\r \r ## <a name=\"next-steps\"></a>后续步骤\r \r 配置已禁用的规则后，可通过访问[应用程序网关诊断](application-gateway-diagnostics.md#diagnostic-logs)来了解如何查看 WAF 日志\r \r [fig1]: ./media/application-gateway-customize-waf-rules-portal/1.png\r [1]: ./media/application-gateway-customize-waf-rules-portal/figure1.png\r [2]: ./media/application-gateway-customize-waf-rules-portal/figure2.png\r [3]: ./media/application-gateway-customize-waf-rules-portal/figure3.png\r \r "}