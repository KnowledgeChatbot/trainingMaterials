{"Title":"流分析：轮转输入和输出的登录凭据","Description":"了解如何更新流分析输入和输出的凭据。","Content":"# <a name=\"rotate-login-credentials-for-inputs-and-outputs-in-stream-analytics-jobs\"></a>在流分析作业中轮转输入和输出的登录凭据\r ## <a name=\"abstract\"></a>摘要\r Azure 流分析目前不允许在作业运行时替换输入/输出上的凭据。\r \r 虽然 Azure 流分析支持从上一次输出恢复作业，但我们仍希望分享整个操作过程，尽量缩短从停止作业到开始作业这段时间的延迟，并轮转登录凭据。\r \r ## <a name=\"part-1---prepare-the-new-set-of-credentials\"></a>第 1 部分 - 准备一组新的凭据：\r 此部分适用于以下输入/输出：\r \r * Blob 存储\r * 事件中心\r * SQL 数据库\r * 表存储\r \r 对于其他输入/输出，请执行第 2 部分。\r \r ### <a name=\"blob-storagetable-storage\"></a>Blob 存储/表存储\r 1. 转到 Azure 管理门户的存储扩展：  \r     ![graphic1][graphic1]\r 2. 找到作业使用的存储并进入：  \r     ![graphic2][graphic2]\r 3. 单击“管理访问密钥”命令：  \r     ![graphic3][graphic3]\r 4. 从主访问密钥和辅助访问密钥之中**挑选作业不使用的那个密钥**。\r 5. 单击“重新生成”：  \r     ![graphic4][graphic4]\r 6. 复制新生成的密钥：  \r     ![graphic5][graphic5]\r 7. 继续完成第 2 部分。\r \r ### <a name=\"event-hubs\"></a>事件中心\r 1. 转到 Azure 管理门户的服务总线扩展：  \r     ![graphic6][graphic6]\r 2. 找到用户的作业使用的服务总线命名空间，并进入该空间：  \r     ![graphic7][graphic7]\r 3. 如果作业在服务总线命名空间上使用共享访问策略，请跳到步骤 6  \r 4. 转到“事件中心”选项卡：  \r     ![graphic8][graphic8]\r 5. 找到作业使用的事件中心并进入：  \r     ![graphic9][graphic9]\r 6. 转到“配置”选项卡：  \r     ![graphic10][graphic10]\r 7. 在“策略名称”下拉列表中，找到作业所使用的共享访问策略：  \r     ![graphic11][graphic11]\r 8. 从主密钥和辅助密钥之中**挑选作业不使用的那个密钥**。  \r 9. 单击“重新生成”：  \r     ![graphic12][graphic12]\r 10. 复制新生成的密钥：  \r     ![graphic13][graphic13]\r 11. 继续完成第 2 部分。  \r \r ### <a name=\"sql-database\"></a>SQL 数据库\r > [!NOTE]\r > 注意：需要连接到 SQL 数据库服务。 我们会根据 Azure 管理门户的管理经验来说明具体做法，但是，也可以选择使用某些客户端工具，例如 SQL Server Management Studio。\r >\r > \r \r 1. 转到 Azure 管理门户的 SQL 数据库扩展：  \r     ![graphic14][graphic14]\r 2. 找到作业使用的 SQL 数据库，并**单击服务器**链接（位于同一行）：  \r     ![graphic15][graphic15]\r 3. 单击“管理”命令：  \r     ![graphic16][graphic16]\r 4. 键入主数据库：  \r     ![graphic17][graphic17]\r 5. 键入用户名和密码，并单击“登录”：  \r     ![graphic18][graphic18]\r 6. 单击“新建查询”：  \r     ![graphic19][graphic19]\r 7. 键入以下查询，将 <login_name> 替换为用户名，将 <enterStrongPasswordHere> 替换为新密码：  \r     `CREATE LOGIN <login_name> WITH PASSWORD = '<enterStrongPasswordHere>'`\r 8. 单击“运行”：  \r     ![graphic20][graphic20]\r 9. 回到步骤 2，此时请单击数据库：  \r     ![graphic21][graphic21]\r 10. 单击“管理”命令：  \r    ![graphic22][graphic22]\r 11. 键入用户名和密码，并单击“登录”：  \r     ![graphic23][graphic23]\r 12. 单击“新建查询”：  \r     ![graphic24][graphic24]\r 13. 键入以下查询，将 <user_name> 替换为用于在该数据库的上下文中标识此登录名的名称（例如，提供的值可以与提供给 <login_name> 的值相同），并将 <login_name> 替换为新用户名：  \r     `CREATE USER <user_name> FROM LOGIN <login_name>`\r 14. 单击“运行”：  \r     ![graphic25][graphic25]\r 15. 现在，应该为新用户提供原来的用户所拥有的角色和权限。\r 16. 继续完成第 2 部分。\r \r ## <a name=\"part-2-stopping-the-stream-analytics-job\"></a>第 2 部分：停止流分析作业\r 1. 转到 Azure 管理门户的流分析扩展：  \r     ![graphic26][graphic26]\r 2. 找到作业并进入：  \r     ![graphic27][graphic27]\r 3. 转到“输入”选项卡或“输出”选项卡，具体取决于是在输入上轮转凭据还是在输出上轮转凭据。  \r     ![graphic28][graphic28]\r 4. 单击“停止”命令，确认作业已停止：  \r     ![graphic29][graphic29] 等待作业停止。\r 5. 找到要在其上轮转凭据的输入/输出，并进入：  \r     ![graphic30][graphic30]\r 6. 继续第 3 部分。\r \r ## <a name=\"part-3-editing-the-credentials-on-the-stream-analytics-job\"></a>第 3 部分：编辑流分析作业的凭据\r ### <a name=\"blob-storagetable-storage\"></a>Blob 存储/表存储\r 1. 找到“存储帐户密钥”字段，将新生成的密钥粘贴到其中：  \r     ![graphic31][graphic31]\r 2. 单击“保存”命令，并确认已保存所做的更改：  \r     ![graphic32][graphic32]\r 3. 保存所做的更改时，连接测试自动启动，请确保连接测试成功通过。\r 4. 继续第 4 部分。\r \r ### <a name=\"event-hubs\"></a>事件中心\r 1. 找到“事件中心策略密钥”字段，将新生成的密钥粘贴到其中：  \r     ![graphic33][graphic33]\r 2. 单击“保存”命令，并确认已保存所做的更改：  \r     ![graphic34][graphic34]\r 3. 保存所做的更改时，连接测试自动启动，请确保连接测试已成功通过。\r 4. 继续第 4 部分。\r \r <!-- Not Available ### Power BI -->\r ### <a name=\"sql-database\"></a>SQL 数据库\r 1. 找到“用户名”和“密码”字段，并将新创建的一组凭据粘贴到其中：  \r     ![graphic38][graphic38]\r 2. 单击“保存”命令，并确认已保存所做的更改：  \r     ![graphic39][graphic39]\r 3. 保存所做的更改时，连接测试自动启动，请确保连接测试已成功通过。  \r 4. 继续第 4 部分。\r \r ## <a name=\"part-4-starting-your-job-from-last-stopped-time\"></a>第 4 部分：启动上次停止时的作业\r 1. 通过导航离开“输入/输出”：  \r     ![graphic40][graphic40]\r 2. 单击“开始”命令：  \r     ![graphic41][graphic41]\r 3. 选取“上次停止时间”，并单击“确定”：  \r     ![graphic42][graphic42]\r 4. 继续第 5 部分。  \r \r ## <a name=\"part-5-removing-the-old-set-of-credentials\"></a>第 5 部分：删除旧的凭据组\r 此部分适用于以下输入/输出：\r \r * Blob 存储\r * 事件中心\r * SQL 数据库\r * 表存储\r \r ### <a name=\"blob-storagetable-storage\"></a>Blob 存储/表存储\r 重复第 1 部分，获取作业以前使用过的访问密钥，以续订现在不使用的访问密钥。\r \r ### <a name=\"event-hubs\"></a>事件中心\r 重复第 1 部分，获取作业以前使用过的密钥，以续订现在不使用的密钥。\r \r ### <a name=\"sql-database\"></a>SQL 数据库\r 1. 回到第 1 部分步骤 7 中的查询窗口，键入以下查询，将 <previous_login_name> 替换为作业以前使用过的用户名：  \r     `DROP LOGIN <previous_login_name>`  \r 2. 单击“运行”：  \r     ![graphic43][graphic43]  \r \r 你会获得以下确认： \r \r     Command(s) completed successfully.\r \r ## <a name=\"get-help\"></a>获取帮助\r 如需进一步的帮助，请尝试我们的 [Azure 流分析论坛](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics)\r \r ## <a name=\"next-steps\"></a>后续步骤\r * [Azure 流分析简介](stream-analytics-introduction.md)\r * [Azure 流分析入门](stream-analytics-real-time-fraud-detection.md)\r * [缩放 Azure 流分析作业](stream-analytics-scale-jobs.md)\r * [Azure 流分析查询语言参考](https://msdn.microsoft.com/library/azure/dn834998.aspx)\r * [Azure 流分析管理 REST API 参考](https://msdn.microsoft.com/library/azure/dn835031.aspx)\r \r [graphic1]: ./media/stream-analytics-login-credentials-inputs-outputs/1-stream-analytics-login-credentials-inputs-outputs.png\r [graphic2]: ./media/stream-analytics-login-credentials-inputs-outputs/2-stream-analytics-login-credentials-inputs-outputs.png\r [graphic3]: ./media/stream-analytics-login-credentials-inputs-outputs/3-stream-analytics-login-credentials-inputs-outputs.png\r [graphic4]: ./media/stream-analytics-login-credentials-inputs-outputs/4-stream-analytics-login-credentials-inputs-outputs.png\r [graphic5]: ./media/stream-analytics-login-credentials-inputs-outputs/5-stream-analytics-login-credentials-inputs-outputs.png\r [graphic6]: ./media/stream-analytics-login-credentials-inputs-outputs/6-stream-analytics-login-credentials-inputs-outputs.png\r [graphic7]: ./media/stream-analytics-login-credentials-inputs-outputs/7-stream-analytics-login-credentials-inputs-outputs.png\r [graphic8]: ./media/stream-analytics-login-credentials-inputs-outputs/8-stream-analytics-login-credentials-inputs-outputs.png\r [graphic9]: ./media/stream-analytics-login-credentials-inputs-outputs/9-stream-analytics-login-credentials-inputs-outputs.png\r [graphic10]: ./media/stream-analytics-login-credentials-inputs-outputs/10-stream-analytics-login-credentials-inputs-outputs.png\r [graphic11]: ./media/stream-analytics-login-credentials-inputs-outputs/11-stream-analytics-login-credentials-inputs-outputs.png\r [graphic12]: ./media/stream-analytics-login-credentials-inputs-outputs/12-stream-analytics-login-credentials-inputs-outputs.png\r [graphic13]: ./media/stream-analytics-login-credentials-inputs-outputs/13-stream-analytics-login-credentials-inputs-outputs.png\r [graphic14]: ./media/stream-analytics-login-credentials-inputs-outputs/14-stream-analytics-login-credentials-inputs-outputs.png\r [graphic15]: ./media/stream-analytics-login-credentials-inputs-outputs/15-stream-analytics-login-credentials-inputs-outputs.png\r [graphic16]: ./media/stream-analytics-login-credentials-inputs-outputs/16-stream-analytics-login-credentials-inputs-outputs.png\r [graphic17]: ./media/stream-analytics-login-credentials-inputs-outputs/17-stream-analytics-login-credentials-inputs-outputs.png\r [graphic18]: ./media/stream-analytics-login-credentials-inputs-outputs/18-stream-analytics-login-credentials-inputs-outputs.png\r [graphic19]: ./media/stream-analytics-login-credentials-inputs-outputs/19-stream-analytics-login-credentials-inputs-outputs.png\r [graphic20]: ./media/stream-analytics-login-credentials-inputs-outputs/20-stream-analytics-login-credentials-inputs-outputs.png\r [graphic21]: ./media/stream-analytics-login-credentials-inputs-outputs/21-stream-analytics-login-credentials-inputs-outputs.png\r [graphic22]: ./media/stream-analytics-login-credentials-inputs-outputs/22-stream-analytics-login-credentials-inputs-outputs.png\r [graphic23]: ./media/stream-analytics-login-credentials-inputs-outputs/23-stream-analytics-login-credentials-inputs-outputs.png\r [graphic24]: ./media/stream-analytics-login-credentials-inputs-outputs/24-stream-analytics-login-credentials-inputs-outputs.png\r [graphic25]: ./media/stream-analytics-login-credentials-inputs-outputs/25-stream-analytics-login-credentials-inputs-outputs.png\r [graphic26]: ./media/stream-analytics-login-credentials-inputs-outputs/26-stream-analytics-login-credentials-inputs-outputs.png\r [graphic27]: ./media/stream-analytics-login-credentials-inputs-outputs/27-stream-analytics-login-credentials-inputs-outputs.png\r [graphic28]: ./media/stream-analytics-login-credentials-inputs-outputs/28-stream-analytics-login-credentials-inputs-outputs.png\r [graphic29]: ./media/stream-analytics-login-credentials-inputs-outputs/29-stream-analytics-login-credentials-inputs-outputs.png\r [graphic30]: ./media/stream-analytics-login-credentials-inputs-outputs/30-stream-analytics-login-credentials-inputs-outputs.png\r [graphic31]: ./media/stream-analytics-login-credentials-inputs-outputs/31-stream-analytics-login-credentials-inputs-outputs.png\r [graphic32]: ./media/stream-analytics-login-credentials-inputs-outputs/32-stream-analytics-login-credentials-inputs-outputs.png\r [graphic33]: ./media/stream-analytics-login-credentials-inputs-outputs/33-stream-analytics-login-credentials-inputs-outputs.png\r [graphic34]: ./media/stream-analytics-login-credentials-inputs-outputs/34-stream-analytics-login-credentials-inputs-outputs.png\r [graphic35]: ./media/stream-analytics-login-credentials-inputs-outputs/35-stream-analytics-login-credentials-inputs-outputs.png\r [graphic36]: ./media/stream-analytics-login-credentials-inputs-outputs/36-stream-analytics-login-credentials-inputs-outputs.png\r [graphic37]: ./media/stream-analytics-login-credentials-inputs-outputs/37-stream-analytics-login-credentials-inputs-outputs.png\r [graphic38]: ./media/stream-analytics-login-credentials-inputs-outputs/38-stream-analytics-login-credentials-inputs-outputs.png\r [graphic39]: ./media/stream-analytics-login-credentials-inputs-outputs/39-stream-analytics-login-credentials-inputs-outputs.png\r [graphic40]: ./media/stream-analytics-login-credentials-inputs-outputs/40-stream-analytics-login-credentials-inputs-outputs.png\r [graphic41]: ./media/stream-analytics-login-credentials-inputs-outputs/41-stream-analytics-login-credentials-inputs-outputs.png\r [graphic42]: ./media/stream-analytics-login-credentials-inputs-outputs/42-stream-analytics-login-credentials-inputs-outputs.png\r [graphic43]: ./media/stream-analytics-login-credentials-inputs-outputs/43-stream-analytics-login-credentials-inputs-outputs.png\r \r <!--Update_Description: update meta properties -->"}