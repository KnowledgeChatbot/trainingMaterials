{"Title":"在 HDInsight 中将 Hadoop Pig 与 PowerShell 配合使用 - Azure","Description":"了解如何使用 Azure PowerShell 将 Pig 作业提交到 HDInsight 上的 Hadoop 群集。","Content":"# <a name=\"use-azure-powershell-to-run-pig-jobs-with-hdinsight\"></a>使用 Azure PowerShell 通过 HDInsight 运行 Pig 作业\r \r [!INCLUDE [azure-sdk-developer-differences](../../../includes/azure-sdk-developer-differences.md)]\r \r [!INCLUDE [pig-selector](../../../includes/hdinsight-selector-use-pig.md)]\r \r 本文档提供使用 Azure PowerShell 向 HDInsight 群集上的 Hadoop 提交 Pig 作业的示例。 Pig 允许使用可为数据转换建模的语言 (Pig Latin) 编写 MapReduce 作业，无需使用映射和化简函数。\r \r > [!NOTE]\r > 本文档未详细描述示例中使用的 Pig Latin 语句的作用。 有关此示例中使用的 Pig Latin 的详细信息，请参阅[将 Pig 与 HDInsight 上的 Hadoop 配合使用](hdinsight-use-pig.md)。\r \r ## <a id=\"prereq\"></a>先决条件\r \r * **一个 Azure HDInsight 群集**\r \r   > [!IMPORTANT]\r   > Linux 是在 HDInsight 3.4 版或更高版本上使用的唯一操作系统。 有关详细信息，请参阅 [HDInsight 在 Windows 上停用](../hdinsight-component-versioning.md#hdinsight-windows-retirement)。\r \r * **配备 Azure PowerShell 的工作站**。\r \r [!INCLUDE [upgrade-powershell](../../../includes/hdinsight-use-latest-powershell.md)]\r \r ## <a id=\"powershell\"></a>使用 PowerShell 运行 Pig 作业\r \r Azure PowerShell 提供 *cmdlet*，可让你在 HDInsight 上远程运行 Pig 作业。 PowerShell 在内部使用 REST 调用 HDInsight 群集上运行的 [WebHCat](https://cwiki.apache.org/confluence/display/Hive/WebHCat) 。\r \r 在远程 HDInsight 群集上运行 Pig 作业时，使用以下 Cmdlet：\r \r * **Login-AzureRmAccount**：在 Azure 订阅中进行 Azure PowerShell 身份验证。\r * **New-AzureRmHDInsightPigJobDefinition**：使用指定的 Pig Latin 语句创建“作业定义”。\r * **Start-AzureRmHDInsightJob**：将作业定义发送到 HDInsight 并启动作业。 将返回作业对象。\r * **Wait-AzureRmHDInsightJob**：使用作业对象来检查作业的状态。 它会等到作业完成或超出等待时间。\r * **Get-AzureRmHDInsightJobOutput**：用于检索作业输出。\r \r 以下步骤演示了如何使用这些 Cmdlet 在 HDInsight 群集上运行作业。\r \r 1. 使用编辑器将以下代码保存为 **pigjob.ps1**。\r \r     ```powershell\r     # Login to your Azure subscription\r     # Is there an active Azure subscription?\r     $sub = Get-AzureRmSubscription -ErrorAction SilentlyContinue\r     if(-not($sub))\r     {\r         Add-AzureRmAccount -EnvironmentName AzureChinaCloud\r     }\r \r     # Get cluster info\r     $clusterName = Read-Host -Prompt \"Enter the HDInsight cluster name\"\r     $creds=Get-Credential -Message \"Enter the login for the cluster\"\r \r     #Store the Pig Latin into $QueryString\r     $QueryString =  \"LOGS = LOAD '/example/data/sample.log';\" +\r     \"LEVELS = foreach LOGS generate REGEX_EXTRACT(`$0, '(TRACE|DEBUG|INFO|WARN|ERROR|FATAL)', 1)  as LOGLEVEL;\" +\r     \"FILTEREDLEVELS = FILTER LEVELS by LOGLEVEL is not null;\" +\r     \"GROUPEDLEVELS = GROUP FILTEREDLEVELS by LOGLEVEL;\" +\r     \"FREQUENCIES = foreach GROUPEDLEVELS generate group as LOGLEVEL, COUNT(FILTEREDLEVELS.LOGLEVEL) as COUNT;\" +\r     \"RESULT = order FREQUENCIES by COUNT desc;\" +\r     \"DUMP RESULT;\"\r \r     #Create a new HDInsight Pig Job definition\r     $pigJobDefinition = New-AzureRmHDInsightPigJobDefinition `\r         -Query $QueryString `\r         -Arguments \"-w\"\r \r     # Start the Pig job on the HDInsight cluster\r     Write-Host \"Start the Pig job ...\" -ForegroundColor Green\r     $pigJob = Start-AzureRmHDInsightJob `\r         -ClusterName $clusterName `\r         -JobDefinition $pigJobDefinition `\r         -HttpCredential $creds\r \r     # Wait for the Pig job to complete\r     Write-Host \"Wait for the Pig job to complete ...\" -ForegroundColor Green\r     Wait-AzureRmHDInsightJob `\r         -ClusterName $clusterName `\r         -JobId $pigJob.JobId `\r         -HttpCredential $creds\r \r     # Display the output of the Pig job.\r     Write-Host \"Display the standard output ...\" -ForegroundColor Green\r     Get-AzureRmHDInsightJobOutput `\r         -ClusterName $clusterName `\r         -JobId $pigJob.JobId `\r         -HttpCredential $creds\r     ```\r \r 1. 打开新的 Windows PowerShell 命令提示符。 将目录更改为 **pigjob.ps1** 文件的所在位置，并使用以下命令来运行脚本：\r \r         .\\pigjob.ps1\r \r     系统会提示用户登录到 Azure 订阅。 然后，要求输入 HDInsight 群集的 HTTPs/Admin 帐户名和密码。\r \r 2. 在作业完成时，它应返回类似于以下文本的信息：\r \r         Start the Pig job ...\r         Wait for the Pig job to complete ...\r         Display the standard output ...\r         (TRACE,816)\r         (DEBUG,434)\r         (INFO,96)\r         (WARN,11)\r         (ERROR,6)\r         (FATAL,2)\r \r ## <a id=\"troubleshooting\"></a>故障排除\r \r 如果作业完成时未返回任何信息，请查看错误日志。 如果要查看此作业的错误信息，请将以下命令添加到 **pigjob.ps1** 文件的末尾，保存后重新运行该文件。\r \r     # Print the output of the Pig job.\r     Write-Host \"Display the standard error output ...\" -ForegroundColor Green\r     Get-AzureRmHDInsightJobOutput `\r             -Clustername $clusterName `\r             -JobId $pigJob.JobId `\r             -HttpCredential $creds `\r             -DisplayOutputType StandardError\r \r 作业处理期间，此 cmdlet 返回写入到 STDERR 中的信息。\r \r ## <a id=\"summary\"></a>摘要\r Azure PowerShell 提供了一种简单方法，可在 HDInsight 群集上运行 Pig 作业、监视作业状态，以及检索输出。\r \r ## <a id=\"nextsteps\"></a>后续步骤\r 有关 HDInsight 中的 Pig 的一般信息：\r \r * [将 Pig 与 Hadoop on HDInsight 配合使用](hdinsight-use-pig.md)\r \r 有关 HDInsight 上的 Hadoop 的其他使用方法的信息：\r \r * [将 Hive 与 Hadoop on HDInsight 配合使用](hdinsight-use-hive.md)\r * [将 MapReduce 与 HDInsight 上的 Hadoop 配合使用](hdinsight-use-mapreduce.md)\r \r \r \r <!--Update_Description: update wording and link references-->"}