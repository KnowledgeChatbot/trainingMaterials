{"Title":"SensorTag 设备和 Azure IoT 网关 - 第 1 课：设置 Intel NUC","Description":"将 Intel NUC 设置为传感器和 Azure IoT 中心之间的 IoT 网关，用于收集传感器信息并将其发送到 IoT 中心。","Content":"# <a name=\"set-up-intel-nuc-as-an-iot-gateway\"></a>将 Intel NUC 设置为 IoT 网关\r [!INCLUDE [iot-hub-get-started-device-selector](../../includes/iot-hub-get-started-device-selector.md)]\r \r ## <a name=\"what-you-will-do\"></a>执行的操作\r \r - 将 Intel NUC 设置为 IoT 网关。\r - 在 Intel NUC 上安装 Azure IoT Edge 包。\r - 在 Intel NUC 上运行“hello_world”示例应用程序，验证网关功能。\r \r   > 如果有任何问题，请在[故障排除页面](./iot-hub-gateway-kit-c-troubleshooting.md)上查找解决方案。\r \r ## <a name=\"what-you-will-learn\"></a>要学习的知识\r \r 本课介绍以下内容：\r \r - 如何将 Intel NUC 与外设连接。\r - 如何使用智能包管理器在 Intel NUC 上安装和更新所需的包。\r - 如何运行“hello_world”示例应用程序来验证网关功能。\r \r ## <a name=\"what-you-need\"></a>需要什么\r \r - 预安装 Intel IoT 网关软件套件 (Wind River Linux *7.0.0.13) 的 Intel NUC 工具包 DE3815TYKE。 [单击此处购买 Grove IoT 商业网关工具包](https://www.seeedstudio.com/Grove-IoT-Commercial-Gateway-Kit-p-2724.html)。\r - 以太网电缆。\r - 键盘。\r - HDMI 或 VGA 电缆。\r - 带有 HDMI 或 VGA 端口的监视器。\r - 可选：[Texas Instruments Sensor Tag (CC2650STK)](http://www.ti.com/tool/cc2650stk)\r \r ![网关工具包](./media/iot-hub-gateway-kit-lessons/lesson1/kit.png)\r \r ## <a name=\"connect-intel-nuc-with-the-peripherals\"></a>将 Intel NUC 与外设连接\r \r 下图是已连接到各种外围设备的 Intel NUC 示例:\r \r 1. 连接到键盘。\r 2. 使用 VGA 电缆或 HDMI 电缆连接到监视器。\r 3. 使用以太网电缆连接到有线网络。\r 4. 通过电源线连接到电源。\r \r ![连接到外围设备的 Intel NUC](./media/iot-hub-gateway-kit-lessons/lesson1/nuc.png)\r \r ## <a name=\"connect-to-the-intel-nuc-system-from-host-computer-via-secure-shell-ssh\"></a>通过安全外壳 (SSH) 从主计算机连接到 Intel NUC 系统\r \r 此时需要键盘和监视器才能获取 Intel NUC 设备的 IP 地址。 如果已知道 IP 地址，可跳到本部分的步骤 3。\r \r 1. 按下电源按钮打开 Intel NUC，并登录。\r \r    默认用户名和密码都是 `root`。\r \r    启动时如果出现以下错误信息，请按回车键: 'A TPM error (7) occurred attempting to read a pcr value.' 或 'Timeout, No TPM chip found, activating TPM-bypass!'\r \r 2. 在 Intel NUC 设备上运行 `ifconfig` 命令，Intel NUC 的 IP 地址。\r \r    以下是命令输出的示例。\r \r    ![显示 Intel NUC IP 的 ifconfig 输出](media/iot-hub-gateway-kit-lessons/lesson1/ifconfig.png)\r \r    在此示例中，`inet addr:` 后面的值是计划从主计算机远程连接到 Intel NUC 时所需的 IP 地址。\r \r 3. 使用主计算机的以下任一 SSH 客户端连接到 Intel NUC。\r \r     - [PuTTY](http://www.putty.org/) for Windows。\r     - Ubuntu 或 macOS 上的内置 SSH 客户端。\r \r    通过主计算机在 Intel NUC 上执行操作更高效。 需要 Intel NUC 的 IP 地址、用户名和密码才能通过 SSH 客户端与它建立连接。 下面是在 macOS 使用 SSH 客户端的示例。\r    ![在 macOS 上运行的 SSH 客户端](./media/iot-hub-gateway-kit-lessons/lesson1/ssh.png)\r \r ## <a name=\"install-the-azure-iot-edge-package\"></a>安装 Azure IoT Edge 包\r \r Azure IoT Edge 包中包含 IoT Edge 及其依赖项的预编译二进制文件。 这些二进制文件包括 Azure IoT Edge、Azure IoT SDK 和相应的工具。 该包还包含用于验证网关功能的“hello_world”示例应用程序。 IoT Edge 是网关的核心部分。 \r \r 执行以下步骤安装该包。\r \r 1. 在终端窗口中运行以下命令，添加 IoT 云存储库：\r \r    ```bash\r    rpm --import https://iotdk.intel.com/misc/iot_pub2.key\r    smart channel --add IoT_Cloud type=rpm-md name=\"IoT_Cloud\" baseurl=http://iotdk.intel.com/repos/iot-cloud/wrlinux7/rcpl13/ -y\r    smart channel --add WR_Repo type=rpm-md baseurl=https://distro.windriver.com/release/idp-3-xt/public_feeds/WR-IDP-3-XT-Intel-Baytrail-public-repo/RCPL13/corei7_64/\r    ```\r \r    > 提示“是否包括此通道?”时，输入“y”\r    \r    如果收到 `import read failed(-1)` 错误，请使用以下命令来解决问题：\r    ```bash\r    wget http://iotdk.intel.com/misc/iot_pub2.key \r    rpm --import iot_pub2.key  \r    ```\r \r    `rpm` 命令导入 rpm 密钥。 `smart channel` 命令将 rpm 通道添加到智能包管理器。 运行 `smart update` 命令前，会看到如下输出。\r \r    ![rpm 和智能通道命令输出](./media/iot-hub-gateway-kit-lessons/lesson1/rpm_smart_channel.png)\r \r 2. 执行智能更新命令：\r \r    ```bash\r    smart update\r    ```\r \r 3. 运行以下命令安装 Azure IoT 网关包：\r \r    ```bash\r    smart install packagegroup-cloud-azure -y\r    ```\r \r    `packagegroup-cloud-azure` 是包的名称。 `smart install` 命令用于安装包。\r \r     > 如果出现“公钥不可用”错误，请运行以下命令\r \r     ```bash\r     smart config --set rpm-check-signatures=false\r     smart install packagegroup-cloud-azure -y\r     ```\r     > 如果看到此错误：“无任何包提供 util-linux-dev”，则重新启动 Intel NUC\r \r    安装此包后，Intel NUC 可用作网关。\r \r ## <a name=\"run-the-azure-iot-edge-helloworld-sample-application\"></a>运行 Azure IoT Edge“hello_world”示例应用程序\r \r 以下示例应用程序通过 `hello_world.json` 文件创建网关，并使用 Azure IoT Edge 体系结构的基本组件每隔 5 秒将“hello world”消息记录到文件 (log.txt)。\r \r 可以通过执行以下命令来运行 Hello World 示例：\r \r ```bash\r cd /usr/share/azureiotgatewaysdk/samples/hello_world/\r ./hello_world hello_world.json\r ```\r \r 允许 Hello World 应用程序运行几分钟，并点击 Enter 键来将其停止。\r \r ![应用程序输出](./media/iot-hub-gateway-kit-lessons/lesson1/hello_world.png)\r \r > 可以忽略后按 Enter，会显示任何参数无效 handle(NULL) 错误。\r \r 可以通过打开现在位于 hello_world 文件夹中的 log.txt 文件来验证网关是否成功运行。\r \r ![log.txt 目录视图](./media/iot-hub-gateway-kit-lessons/lesson1/logtxtdir.png)\r \r 使用以下命令打开 log.txt：\r \r ```bash\r vim log.txt\r ```\r \r 然后，用户将看到 log.txt，将每隔 5 秒编写的网关 Hello World 模块的日志记录消息的 JSON 格式输出的内容。\r \r ![log.txt 目录视图](./media/iot-hub-gateway-kit-lessons/lesson1/logtxtview.png)\r \r 如果有任何问题，请在[故障排除页面](./iot-hub-gateway-kit-c-troubleshooting.md)上查找解决方案。\r \r ## <a name=\"summary\"></a>摘要\r \r 祝贺！ 已将 Intel NUC 设置为网关。 接下来可进入下一课，了解如何设置主机、创建 Azure IoT 中心以及注册 Azure IoT 中心逻辑设备。\r \r ## <a name=\"next-steps\"></a>后续步骤\r [使用 IoT 网关将设备连接到 Azure IoT 中心](./iot-hub-gateway-kit-c-iot-gateway-connect-device-to-cloud.md)\r \r <!--Update_Description: update wording-->"}