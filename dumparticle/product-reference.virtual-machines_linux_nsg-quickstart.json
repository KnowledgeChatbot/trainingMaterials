{"Title":"使用 Azure CLI 打开 Linux VM 的端口和终结点","Description":"了解如何使用 Azure Resource Manager 部署模型和 Azure CLI 2.0 在 Linux VM 上打开端口/创建终结点","Content":"# <a name=\"open-ports-and-endpoints-to-a-linux-vm-with-the-azure-cli\"></a>使用 Azure CLI 打开 Linux VM 的端口和终结点\r 通过在子网或 VM 网络接口上创建网络筛选器可为 Azure 中的虚拟机 (VM) 打开端口或创建终结点。 将这些筛选器（控制入站和出站流量）放在网络安全组中，并附加到将接收流量的资源。 让我们在端口 80 上使用 Web 流量的常见示例。 本文说明如何使用 Azure CLI 2.0 打开 VM 的端口。 也可以使用 [Azure CLI 1.0](nsg-quickstart-nodejs.md) 执行这些步骤。\r \r ## <a name=\"quick-commands\"></a>快速命令\r 若要创建网络安全组和规则，需要安装最新的 [Azure CLI 2.0](https://docs.azure.cn/zh-cn/cli/install-az-cli2)，并使用 [az login](https://docs.microsoft.com/cli/azure/?view=azure-cli-latest#login) 登录到 Azure 帐户。\r \r [!INCLUDE [azure-cli-2-azurechinacloud-environment-parameter](../../../includes/azure-cli-2-azurechinacloud-environment-parameter.md)]\r \r 在以下示例中，请将示例参数名称替换成自己的值。 示例参数名称包括 *myResourceGroup*、*myNetworkSecurityGroup* 和 *myVnet*。\r \r 使用 [az network nsg create](https://docs.azure.cn/zh-cn/cli/network/nsg?view=azure-cli-latest#create)创建网络安全组。 以下示例在 *chinaeast* 位置创建名为 *myNetworkSecurityGroup* 的网络安全组：\r \r ```azurecli\r az network nsg create \\\r     --resource-group myResourceGroup \\\r     --location chinaeast \\\r     --name myNetworkSecurityGroup\r ```\r \r 借助 [az network nsg rule create](https://docs.azure.cn/zh-cn/cli/network/nsg/rule?view=azure-cli-latest#create) 添加规则以允许 HTTP 流量流向 Web 服务器（或者根据自己的情况（例如 SSH 访问或数据库连接）来调整此规则）。 以下示例创建一个名为 *myNetworkSecurityGroupRule* 的规则，以允许端口 80 上的 TCP 流量：\r \r ```azurecli\r az network nsg rule create \\\r     --resource-group myResourceGroup \\\r     --nsg-name myNetworkSecurityGroup \\\r     --name myNetworkSecurityGroupRule \\\r     --protocol tcp \\\r     --priority 1000 \\\r     --destination-port-range 80\r ```\r \r 借助 [az 网络 nic 更新](https://docs.azure.cn/zh-cn/cli/network/nic?view=azure-cli-latest#update)将网络安全组与 VM 的网络接口 (NIC) 相关联。 以下示例将名为 *myNic* 的现有 NIC 与名为 *myNetworkSecurityGroup* 的网络安全组相关联：\r \r ```azurecli\r az network nic update \\\r     --resource-group myResourceGroup \\\r     --name myNic \\\r     --network-security-group myNetworkSecurityGroup\r ```\r \r 或者，也可以借助 [az 网络 vnet 子网更新](https://docs.azure.cn/zh-cn/cli/network/vnet/subnet?view=azure-cli-latest#update)将网络安全组与虚拟网络的子网相关联，而不是只与单个 VM 上的网络接口相关联。 以下示例将 *myVnet* 虚拟网络中名为 *mySubnet* 的现有子网与名为 *myNetworkSecurityGroup* 的网络安全组相关联：\r \r ```azurecli\r az network vnet subnet update \\\r     --resource-group myResourceGroup \\\r     --vnet-name myVnet \\\r     --name mySubnet \\\r     --network-security-group myNetworkSecurityGroup\r ```\r \r ## <a name=\"more-information-on-network-security-groups\"></a>有关网络安全组的详细信息\r 利用此处的快速命令，可以让流向 VM 的流量开始正常运行。 网络安全组提供许多出色的功能和粒度来控制资源的访问。 可以[在此处详细了解如何创建网络安全组和 ACL 规则](tutorial-virtual-network.md#secure-network-traffic)。\r \r 对于高可用性 Web 应用程序，应将 VM 放置在 Azure 负载均衡器后。 当负载均衡器向 VM 分配流量时，网络安全组可以筛选流量。 有关详细信息，请参阅[如何在 Azure 中均衡 Linux 虚拟机负载以创建高可用性应用程序](tutorial-load-balancer.md)。\r \r ## <a name=\"next-steps\"></a>后续步骤\r 在本示例中，创建了简单的规则来允许 HTTP 流量。 下列文章更介绍了有关创建更详细环境的信息：\r \r * [Azure Resource Manager 概述](../../azure-resource-manager/resource-group-overview.md)\r * [什么是网络安全组 (NSG)？](../../virtual-network/virtual-networks-nsg.md)\r \r <!--Update_Description: update meta properties， wording update-->"}