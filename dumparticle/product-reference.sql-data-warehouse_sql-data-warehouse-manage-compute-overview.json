{"Title":"管理 Azure SQL 数据仓库中的计算能力（概述）","Description":"Azure SQL 数据仓库中的性能横向扩展功能。 通过调整 DWU 数目进行横向扩展，或者通过暂停和恢复计算资源来节省成本。","Content":"\r # <a name=\"manage-compute-power-in-azure-sql-data-warehouse-overview\"></a>管理 Azure SQL 数据仓库中的计算能力（概述）\r \r > [!div class=\"op_single_selector\"]\r > * [概述](sql-data-warehouse-manage-compute-overview.md)\r > * [门户](sql-data-warehouse-manage-compute-portal.md)\r > * [PowerShell](sql-data-warehouse-manage-compute-powershell.md)\r > * [REST](sql-data-warehouse-manage-compute-rest-api.md)\r > * [TSQL](sql-data-warehouse-manage-compute-tsql.md)\r >\r >\r \r SQL 数据仓库的体系结构对存储和计算功能进行了分隔，允许每项功能单独进行缩放。 因此，可以独立于数据量，根据性能需求缩放计算资源。 此体系结构的自然结果是，计算和存储的[计费][billed]是独立的。 \r \r 本概述文章介绍如何扩展 SQL 数据仓库，以及如何利用 SQL 数据仓库的暂停、恢复和缩放功能。 请查阅[数据仓库单位 (DWU)][data warehouse units (DWUs)]页，了解 DWU 与性能的关联方式。 \r \r ## <a name=\"how-compute-management-operations-work-in-sql-data-warehouse\"></a>SQL 数据仓库中计算管理操作的工作原理\r SQL 数据仓库的体系结构由控制节点、计算节点和跨 60 个分布区的存储层组成。 \r \r 在 SQL 数据仓库中，系统的头节点管理元数据，并且包含分布式的查询优化器中的正常活动会话。 此头节点下是计算节点和存储层。 对于 DWU 400，系统具有一个头节点、四个计算节点和存储层，包含 60 个分布区。 \r \r 进行缩放或暂停操作时，系统将首先将终止所有传入的查询，并会回滚事务以确保一致的状态。 为缩放操作，缩放仅后会进行此事务回滚已完成。 对于向上缩放操作，额外的所需数量的系统设置计算节点，并重新附加到的存储层的计算节点开始。 对于缩减操作，不需要的节点将发布和剩余的计算节点重新自身附加到相应数量的分发。 对于暂停操作，所有计算节点的发行和你的系统将进行各种元数据操作，以使最终系统处于稳定状态。\r \r | DWU  | 计算节点的 \\# | 每个节点的分布区 \\# |\r | ---- | ------------------ | ---------------------------- |\r | 100  | 1                  | 60                           |\r | 200  | 2                  | 30                           |\r | 300  | 3                  | 20                           |\r | 400  | 4                  | 15                           |\r | 500  | 5                  | 12                           |\r | 600  | 6                  | 10                           |\r | 1000 | 10                 | 6                            |\r | 1200 | 12                 | 5                            |\r | 1500 | 15                 | 4                            |\r | 2000 | 20                 | 3                            |\r | 3000 | 30                 | 2                            |\r | 6000 | 60                 | 1                            |\r \r 用于管理计算的三个主要功能是：\r \r 1. 暂停\r 2. 恢复\r 3. 缩放\r \r 其中每项操作可能需要几分钟才能完成。 如果自动将缩放/暂停/继续，可能想要实现逻辑，确保某些操作具有已完成，然后再继续进行另一项操作。 \r \r 检查通过不同的终结点的数据库状态将允许为了正确地实现这种操作的自动化。 门户将提供完成后通知运算和数据库的当前状态，但不允许对以编程方式检查状态。 \r \r >  [!NOTE]\r >\r >  计算所有终结点之间不存在管理功能。\r >\r >  \r \r |              | 暂停/恢复 | 缩放 | 检查数据库状态 |\r | ------------ | ------------ | ----- | -------------------- |\r | Azure 门户 | 是          | 是   | **否**               |\r | PowerShell   | 是          | 是   | 是                  |\r | REST API     | 是          | 是   | 是                  |\r | T-SQL        | **否**       | 是   | 是                  |\r \r ## <a name=\"scale-compute-bk\"></a><a name=\"scale-compute\"></a>缩放计算\r \r SQL 数据仓库中的性能以[数据仓库单位 (DWU)][data warehouse units (DWUs)] 度量，这是 CPU、内存和 I/O 带宽等计算资源的抽象度量值。 想要缩放其系统性能的用户可以通过不同的方式实现此目的，例如通过门户、T-SQL 和 REST API。 \r \r ### <a name=\"how-do-i-scale-compute\"></a>如何缩放计算资源？\r 可通过更改 DWU 设置来管理 SQL 数据仓库的计算能力。 为特定的操作添加更多 DWU 后，性能会[线性][linearly]提高。  我们提供确保性能将更改显著时是向上或向下扩展系统的 DWU 产品。 \r \r 若要调整 DWU，可以使用以下任何单个方法。\r \r * [通过 Azure 门户缩放计算能力][Scale compute power with Azure portal]\r * [通过 PowerShell 缩放计算能力][Scale compute power with PowerShell]\r * [通过 REST API 缩放计算能力][Scale compute power with REST APIs]\r * [通过 TSQL 缩放计算能力][Scale compute power with TSQL]\r \r ### <a name=\"how-many-dwus-should-i-use\"></a>应该使用多少 DWU？\r \r 若要了解理想的 DWU 值，请尝试在加载数据之后增加和减少 DWU 并运行几个查询。 由于缩放很快就能完成，可以在一个小时或更少时间内尝试一些不同级别的性能。 \r \r > [!Note] \r > SQL 数据仓库旨在处理大量数据。 若要了解数据仓库的真正缩放功能，尤其是大规模 DWU 处理能力，可以使用接近或超过 1 TB 的大型数据集。\r \r 针对工作负荷查找最佳 DWU 时，建议你：\r \r 1. 对于正在开发的数据仓库，可以从较小的 DWU 性能级别开始。  一个好的起点为 DW400 或 DW200。\r 2. 监视应用程序性能，将所选 DWU 数目与观测到的性能变化进行比较。\r 3. 通过假设线性缩放，判断需要将性能加快或减慢多少才能达到要求的最佳性能级别。\r 4. 如果你要加快或减慢工作负荷的执行速度，则可按比例相应地提高或降低 DWU 数目。 \r 5. 继续进行调整，直到达到业务要求的最佳性能级别。\r \r > [!NOTE]\r >\r > 此外，如果可以计算节点之间拆分工作，与多个并行化只会增加查询性能。 如果发现缩放未更改你的性能，请查看我们的性能优化文章，以检查是否没有数据均匀分布，或者如果正在引入大量的数据移动。 \r \r ### <a name=\"when-should-i-scale-dwus\"></a>何时应进行 DWU 缩放？\r 缩放 DWU 会改变以下重要方案：\r \r 1. 以线性方式更改系统对扫描、聚合和 CTAS 语句的性能\r 2. 使用 PolyBase 加载时增加读取器和编写器的数\r 3. 并发查询和并发槽的最大数量\r \r 关于何时进行 DWU 缩放的建议：\r \r 1. 执行繁重的数据加载或转换操作时，增加 DWU 数目即可更快速地获取数据。\r 2. 高峰业务时段，扩大规模以容纳更大数量的并发查询。 \r \r ## <a name=\"pause-compute-bk\"></a> 暂停计算\r [!INCLUDE [SQL Data Warehouse pause description](../../includes/sql-data-warehouse-pause-description.md)]\r \r 若要暂停数据库，请使用下列任意方法之一。\r \r * [通过 Azure 门户暂停计算][Pause compute with Azure portal]\r * [通过 PowerShell 暂停计算][Pause compute with PowerShell]\r * [通过 REST API 暂停计算][Pause compute with REST APIs]\r \r ## <a name=\"resume-compute-bk\"></a> 恢复计算\r [!INCLUDE [SQL Data Warehouse resume description](../../includes/sql-data-warehouse-resume-description.md)]\r \r 若要恢复数据库，请使用下列任意方法之一。\r \r * [通过 Azure 门户恢复计算][Resume compute with Azure portal]\r * [通过 PowerShell 恢复计算][Resume compute with PowerShell]\r * [通过 REST API 恢复计算][Resume compute with REST APIs]\r \r ## <a name=\"check-compute-bk\"></a>检查数据库状态 \r 若要恢复数据库，请使用下列任意方法之一。\r \r - [使用 T-SQL 检查数据库状态][Check database state with T-SQL]\r - [使用 PowerShell 检查数据库状态][Check database state with PowerShell]\r - [使用 REST API 检查数据库状态][Check database state with REST APIs]\r \r ## <a name=\"permissions\"></a>权限\r \r 缩放数据库需要 [ALTER DATABASE][ALTER DATABASE] 中所述的权限。  暂停和恢复需要 [SQL DB 参与者][SQL DB Contributor]权限，具体说来就是 Microsoft.Sql/servers/databases/action。\r \r ## <a name=\"next-steps-bk\"></a> 后续步骤\r 请参阅以下文章，了解其他一些重要性能概念：\r \r * [工作负荷和并发管理][Workload and concurrency management]\r * [表设计概述][Table design overview]\r * [表分布][Table distribution]\r * [表索引][Table indexing]\r * [表分区][Table partitioning]\r * [表统计信息][Table statistics]\r * [最佳做法][Best practices]\r \r <!--Image reference-->\r \r <!--Article references-->\r [data warehouse units (DWUs)]: ./sql-data-warehouse-overview-what-is.md#predictable-and-scalable-performance-with-data-warehouse-units\r [billed]: https://www.azure.cn/pricing/details/sql-data-warehouse/\r [linearly]: ./sql-data-warehouse-overview-what-is.md#predictable-and-scalable-performance-with-data-warehouse-units\r [Scale compute power with Azure portal]: ./sql-data-warehouse-manage-compute-portal.md#scale-compute-power\r [Scale compute power with PowerShell]: ./sql-data-warehouse-manage-compute-powershell.md#scale-compute-bk\r [Scale compute power with REST APIs]: ./sql-data-warehouse-manage-compute-rest-api.md#scale-compute-bk\r [Scale compute power with TSQL]: ./sql-data-warehouse-manage-compute-tsql.md#scale-compute-bk\r \r [capacity limits]: ./sql-data-warehouse-service-capacity-limits.md\r \r [Pause compute with Azure portal]:  ./sql-data-warehouse-manage-compute-portal.md#pause-compute-bk\r [Pause compute with PowerShell]: ./sql-data-warehouse-manage-compute-powershell.md#pause-compute-bk\r [Pause compute with REST APIs]: ./sql-data-warehouse-manage-compute-rest-api.md#pause-compute-bk\r \r [Resume compute with Azure portal]:  ./sql-data-warehouse-manage-compute-portal.md#resume-compute-bk\r [Resume compute with PowerShell]: ./sql-data-warehouse-manage-compute-powershell.md#resume-compute-bk\r [Resume compute with REST APIs]: ./sql-data-warehouse-manage-compute-rest-api.md#resume-compute-bk\r \r [Check database state with T-SQL]: ./sql-data-warehouse-manage-compute-tsql.md#check-database-state-and-operation-progress\r [Check database state with PowerShell]: ./sql-data-warehouse-manage-compute-powershell.md#check-database-state\r [Check database state with REST APIs]: ./sql-data-warehouse-manage-compute-rest-api.md#check-database-state\r \r [Workload and concurrency management]: ./sql-data-warehouse-develop-concurrency.md\r [Table design overview]: ./sql-data-warehouse-tables-overview.md\r [Table distribution]: ./sql-data-warehouse-tables-distribute.md\r [Table indexing]: ./sql-data-warehouse-tables-index.md\r [Table partitioning]: ./sql-data-warehouse-tables-partition.md\r [Table statistics]: ./sql-data-warehouse-tables-statistics.md\r [Best practices]: ./sql-data-warehouse-best-practices.md\r [development overview]: ./sql-data-warehouse-overview-develop.md\r \r [SQL DB Contributor]: ../active-directory/role-based-access-built-in-roles.md#sql-db-contributor\r \r <!--MSDN references-->\r [ALTER DATABASE]: https://msdn.microsoft.com/library/mt204042.aspx\r \r <!--Other Web references-->\r [Azure portal]: http://portal.azure.cn/\r "}